<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Pandas 基础用法 | Jackerzz's Blog</title><meta name="keywords" content="tookit"><meta name="author" content="Jackerzz"><meta name="copyright" content="Jackerzz"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="Pandas 基础用法本节介绍 Pandas 数据结构的基础用法。下列代码创建上一节用过的示例数据对象： 1234567In [1]: index &#x3D; pd.date_range(&amp;#x27;1&#x2F;1&#x2F;2000&amp;#x27;, periods&#x3D;8)In [2]: s &#x3D; pd.Series(np.random.randn(5), index&#x3D;[&amp;#x27;a&amp;#x27;, &amp;#x27;b&amp;#x27;,"><meta property="og:type" content="article"><meta property="og:title" content="Pandas 基础用法"><meta property="og:url" content="https://jackerzz.github.io/posts/toolkit/pandas/pd2.html"><meta property="og:site_name" content="Jackerzz&#39;s Blog"><meta property="og:description" content="Pandas 基础用法本节介绍 Pandas 数据结构的基础用法。下列代码创建上一节用过的示例数据对象： 1234567In [1]: index &#x3D; pd.date_range(&amp;#x27;1&#x2F;1&#x2F;2000&amp;#x27;, periods&#x3D;8)In [2]: s &#x3D; pd.Series(np.random.randn(5), index&#x3D;[&amp;#x27;a&amp;#x27;, &amp;#x27;b&amp;#x27;,"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/jackerzz/jackerzz.github.io@ersion1.1/images/canva/3244513.jpg"><meta property="article:published_time" content="2021-09-16T13:50:34.000Z"><meta property="article:modified_time" content="2021-10-02T15:17:32.138Z"><meta property="article:author" content="Jackerzz"><meta property="article:tag" content="tookit"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://cdn.jsdelivr.net/gh/jackerzz/jackerzz.github.io@ersion1.1/images/canva/3244513.jpg"><link rel="shortcut icon" href="https://cdn.jsdelivr.net/gh/jackerzz/jackerzz.github.io@sion1.0/images/img/bookgirl_ico.jpg"><link rel="canonical" href="https://jackerzz.github.io/posts/toolkit/pandas/pd2"><link rel="preconnect" href="//cdn.jsdelivr.net"><link rel="preconnect" href="//busuanzi.ibruce.info"><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload='this.media="all"'><script>const GLOBAL_CONFIG={root:"/",algolia:void 0,localSearch:void 0,translate:void 0,noticeOutdate:void 0,highlight:{plugin:"highlighjs",highlightCopy:!0,highlightLang:!0,highlightHeightLimit:200},copy:{success:"复制成功",error:"复制错误",noSupport:"浏览器不支持"},relativeDate:{homepage:!1,post:!1},runtime:"",date_suffix:{just:"刚刚",min:"分钟前",hour:"小时前",day:"天前",month:"个月前"},copyright:void 0,lightbox:"fancybox",Snackbar:void 0,source:{jQuery:"https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js",justifiedGallery:{js:"https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js",css:"https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css"},fancybox:{js:"https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js",css:"https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css"}},isPhotoFigcaption:!1,islazyload:!0,isanchor:!1}</script><script id="config-diff">var GLOBAL_CONFIG_SITE={title:"Pandas 基础用法",isPost:!0,isHome:!1,isHighlightShrink:!1,isToc:!0,postUpdate:"2021-10-02 23:17:32"}</script><noscript><style>#nav{opacity:1}.justified-gallery img{opacity:1}#post-meta time,#recent-posts time{display:inline!important}</style></noscript><script>(e=>{e.saveToLocal={set:function(e,t,o){if(0===o)return;const n=864e5*o,a={value:t,expiry:(new Date).getTime()+n};localStorage.setItem(e,JSON.stringify(a))},get:function(e){const t=localStorage.getItem(e);if(!t)return;const o=JSON.parse(t);if(!((new Date).getTime()>o.expiry))return o.value;localStorage.removeItem(e)}},e.getScript=e=>new Promise((t,o)=>{const n=document.createElement("script");n.src=e,n.async=!0,n.onerror=o,n.onload=n.onreadystatechange=function(){const e=this.readyState;e&&"loaded"!==e&&"complete"!==e||(n.onload=n.onreadystatechange=null,t())},document.head.appendChild(n)}),e.activateDarkMode=function(){document.documentElement.setAttribute("data-theme","dark"),null!==document.querySelector('meta[name="theme-color"]')&&document.querySelector('meta[name="theme-color"]').setAttribute("content","#0d0d0d")},e.activateLightMode=function(){document.documentElement.setAttribute("data-theme","light"),null!==document.querySelector('meta[name="theme-color"]')&&document.querySelector('meta[name="theme-color"]').setAttribute("content","#ffffff")};const t=saveToLocal.get("theme");"dark"===t?activateDarkMode():"light"===t&&activateLightMode();const o=saveToLocal.get("aside-status");void 0!==o&&("hide"===o?document.documentElement.classList.add("hide-aside"):document.documentElement.classList.remove("hide-aside"))})(window)</script><meta name="generator" content="Hexo 5.4.0"></head><body><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="author-avatar"><img class="avatar-img" src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://cdn.jsdelivr.net/gh/jackerzz/jackerzz.github.io@sion1.0/images/avatar/35586448.jpg" onerror='onerror=null,src="/img/friend_404.gif"' alt="avatar"></div><div class="site-data"><div class="data-item is-center"><div class="data-item-link"><a href="/archives/"><div class="headline">文章</div><div class="length-num">57</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/tags/"><div class="headline">标签</div><div class="length-num">11</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/categories/"><div class="headline">分类</div><div class="length-num">8</div></a></div></div></div><hr><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i> <span>主页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i> <span>归档</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i> <span>文章分类</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i> <span>About</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image:url(https://cdn.jsdelivr.net/gh/jackerzz/jackerzz.github.io@ersion1.1/images/canva/3244513.jpg)"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">Jackerzz's Blog</a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i> <span>主页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i> <span>归档</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i> <span>文章分类</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i> <span>About</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">Pandas 基础用法</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2021-09-16T13:50:34.000Z" title="发表于 2021-09-16 21:50:34">2021-09-16</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2021-10-02T15:17:32.138Z" title="更新于 2021-10-02 23:17:32">2021-10-02</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/pandas/">pandas</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" data-flag-title="Pandas 基础用法"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="Pandas-基础用法"><a href="#Pandas-基础用法" class="headerlink" title="Pandas 基础用法"></a>Pandas 基础用法</h1><p>本节介绍 Pandas 数据结构的基础用法。下列代码创建上一节用过的示例数据对象：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">In [1]: index = pd.date_range(&#x27;1/1/2000&#x27;, periods=8)</span><br><span class="line"></span><br><span class="line">In [2]: s = pd.Series(np.random.randn(5), index=[&#x27;a&#x27;, &#x27;b&#x27;, &#x27;c&#x27;, &#x27;d&#x27;, &#x27;e&#x27;])</span><br><span class="line"></span><br><span class="line">In [3]: df = pd.DataFrame(np.random.randn(8, 3), index=index,</span><br><span class="line">   ...:                   columns=[&#x27;A&#x27;, &#x27;B&#x27;, &#x27;C&#x27;])</span><br><span class="line">   ...: </span><br></pre></td></tr></table></figure><h2 id="Head-与-Tail"><a href="#Head-与-Tail" class="headerlink" title="Head 与 Tail"></a>Head 与 Tail</h2><p><a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.head.html#pandas.DataFrame.head"><code>head()</code></a> 与 <a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.tail.html#pandas.DataFrame.tail"><code>tail()</code></a> 用于快速预览 Series 与 DataFrame，默认显示 5 条数据，也可以指定显示数据的数量。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">4</span>]: long_series = pd.Series(np.random.randn(<span class="number">1000</span>))</span><br><span class="line"></span><br><span class="line">In [<span class="number">5</span>]: long_series.head()</span><br><span class="line">Out[<span class="number">5</span>]: </span><br><span class="line"><span class="number">0</span>   -<span class="number">1.157892</span></span><br><span class="line"><span class="number">1</span>   -<span class="number">1.344312</span></span><br><span class="line"><span class="number">2</span>    <span class="number">0.844885</span></span><br><span class="line"><span class="number">3</span>    <span class="number">1.075770</span></span><br><span class="line"><span class="number">4</span>   -<span class="number">0.109050</span></span><br><span class="line">dtype: float64</span><br><span class="line"></span><br><span class="line">In [<span class="number">6</span>]: long_series.tail(<span class="number">3</span>)</span><br><span class="line">Out[<span class="number">6</span>]: </span><br><span class="line"><span class="number">997</span>   -<span class="number">0.289388</span></span><br><span class="line"><span class="number">998</span>   -<span class="number">1.020544</span></span><br><span class="line"><span class="number">999</span>    <span class="number">0.589993</span></span><br><span class="line">dtype: float64</span><br></pre></td></tr></table></figure><h2 id="属性与底层数据"><a href="#属性与底层数据" class="headerlink" title="属性与底层数据"></a>属性与底层数据</h2><p>Pandas 可以通过多个属性访问元数据：</p><ul><li><p><strong>shape</strong>:</p><ul><li>输出对象的轴维度，与 ndarray 一致</li></ul></li><li><p><strong>轴标签</strong></p><ul><li><strong>Series</strong>: <em>Index</em> (仅有此轴)</li><li><strong>DataFrame</strong>: <em>Index</em> (行) 与<em>列</em></li></ul></li></ul><p>注意： <strong>为属性赋值是安全的</strong>！</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">7</span>]: df[:<span class="number">2</span>]</span><br><span class="line">Out[<span class="number">7</span>]: </span><br><span class="line">                   A         B         C</span><br><span class="line"><span class="number">2000</span>-01-01 -<span class="number">0.173215</span>  <span class="number">0.119209</span> -<span class="number">1.044236</span></span><br><span class="line"><span class="number">2000</span>-01-02 -<span class="number">0.861849</span> -<span class="number">2.104569</span> -<span class="number">0.494929</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">8</span>]: df.columns = [x.lower() <span class="keyword">for</span> x <span class="keyword">in</span> df.columns]</span><br><span class="line"></span><br><span class="line">In [<span class="number">9</span>]: df</span><br><span class="line">Out[<span class="number">9</span>]: </span><br><span class="line">                   a         b         c</span><br><span class="line"><span class="number">2000</span>-01-01 -<span class="number">0.173215</span>  <span class="number">0.119209</span> -<span class="number">1.044236</span></span><br><span class="line"><span class="number">2000</span>-01-02 -<span class="number">0.861849</span> -<span class="number">2.104569</span> -<span class="number">0.494929</span></span><br><span class="line"><span class="number">2000</span>-01-03  <span class="number">1.071804</span>  <span class="number">0.721555</span> -<span class="number">0.706771</span></span><br><span class="line"><span class="number">2000</span>-01-04 -<span class="number">1.039575</span>  <span class="number">0.271860</span> -<span class="number">0.424972</span></span><br><span class="line"><span class="number">2000</span>-01-05  <span class="number">0.567020</span>  <span class="number">0.276232</span> -<span class="number">1.087401</span></span><br><span class="line"><span class="number">2000</span>-01-06 -<span class="number">0.673690</span>  <span class="number">0.113648</span> -<span class="number">1.478427</span></span><br><span class="line"><span class="number">2000</span>-01-07  <span class="number">0.524988</span>  <span class="number">0.404705</span>  <span class="number">0.577046</span></span><br><span class="line"><span class="number">2000</span>-01-08 -<span class="number">1.715002</span> -<span class="number">1.039268</span> -<span class="number">0.370647</span></span><br></pre></td></tr></table></figure><p>Pandas 对象（<a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.Index.html#pandas.Index" title="pandas.Index"><code>Index</code></a>， <a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.Series.html#pandas.Series" title="pandas.Series"><code>Series</code></a>， <a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.html#pandas.DataFrame" title="pandas.DataFrame"><code>DataFrame</code></a>）相当于数组的容器，用于存储数据、执行计算。大部分类型的底层数组都是 <a target="_blank" rel="noopener" href="https://docs.scipy.org/doc/numpy/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v1.16)"><code>numpy.ndarray</code></a>。不过，Pandas 与第三方支持库一般都会扩展 NumPy 类型系统，添加自定义数组（见<a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/getting_started/basics.html#basics-dtypes">数据类型</a>）。</p><p><code>.array</code> 属性用于提取 <a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.Index.html#pandas.Index" title="pandas.Index"><code>Index</code></a> 或 <a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.Series.html#pandas.Series" title="pandas.Series"><code>Series</code></a> 里的数据。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">10</span>]: s.array</span><br><span class="line">Out[<span class="number">10</span>]: </span><br><span class="line">&lt;PandasArray&gt;</span><br><span class="line">[ <span class="number">0.4691122999071863</span>, -<span class="number">0.2828633443286633</span>, -<span class="number">1.5090585031735124</span>,</span><br><span class="line"> -<span class="number">1.1356323710171934</span>,  <span class="number">1.2121120250208506</span>]</span><br><span class="line">Length: <span class="number">5</span>, dtype: float64</span><br><span class="line"></span><br><span class="line">In [<span class="number">11</span>]: s.index.array</span><br><span class="line">Out[<span class="number">11</span>]: </span><br><span class="line">&lt;PandasArray&gt;</span><br><span class="line">[<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;c&#x27;</span>, <span class="string">&#x27;d&#x27;</span>, <span class="string">&#x27;e&#x27;</span>]</span><br><span class="line">Length: <span class="number">5</span>, dtype: <span class="built_in">object</span></span><br></pre></td></tr></table></figure><p><a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.Series.array.html#pandas.Series.array" title="pandas.Series.array"><code>array</code></a> 一般指 <a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.api.extensions.ExtensionArray.html#pandas.api.extensions.ExtensionArray" title="pandas.api.extensions.ExtensionArray"><code>ExtensionArray</code></a>。至于什么是 <a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.api.extensions.ExtensionArray.html#pandas.api.extensions.ExtensionArray" title="pandas.api.extensions.ExtensionArray"><code>ExtensionArray</code></a> 及 Pandas 为什么要用 <a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.api.extensions.ExtensionArray.html#pandas.api.extensions.ExtensionArray" title="pandas.api.extensions.ExtensionArray"><code>ExtensionArray</code></a> 不是本节要说明的内容。更多信息请参阅<a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/getting_started/basics.html#basics-dtypes">数据类型</a>。</p><p>提取 NumPy 数组，用 <a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.Series.to_numpy.html#pandas.Series.to_numpy" title="pandas.Series.to_numpy"><code>to_numpy()</code></a> 或 <code>numpy.asarray()</code>。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">12</span>]: s.to_numpy()</span><br><span class="line">Out[<span class="number">12</span>]: array([ <span class="number">0.4691</span>, -<span class="number">0.2829</span>, -<span class="number">1.5091</span>, -<span class="number">1.1356</span>,  <span class="number">1.2121</span>])</span><br><span class="line"></span><br><span class="line">In [<span class="number">13</span>]: np.asarray(s)</span><br><span class="line">Out[<span class="number">13</span>]: array([ <span class="number">0.4691</span>, -<span class="number">0.2829</span>, -<span class="number">1.5091</span>, -<span class="number">1.1356</span>,  <span class="number">1.2121</span>])</span><br></pre></td></tr></table></figure><p><code>Series</code> 与 <code>Index</code> 的类型是 <a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.api.extensions.ExtensionArray.html#pandas.api.extensions.ExtensionArray" title="pandas.api.extensions.ExtensionArray"><code>ExtensionArray</code></a> 时， <a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.Series.to_numpy.html#pandas.Series.to_numpy" title="pandas.Series.to_numpy"><code>to_numpy()</code></a> 会复制数据，并强制转换值。详情见<a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/getting_started/basics.html#basics-dtypes">数据类型</a>。</p><p><a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.Series.to_numpy.html#pandas.Series.to_numpy" title="pandas.Series.to_numpy"><code>to_numpy()</code></a> 可以控制 <a target="_blank" rel="noopener" href="https://docs.scipy.org/doc/numpy/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v1.16)"><code>numpy.ndarray</code></a> 生成的数据类型。以带时区的 datetime 为例，NumPy 未提供时区信息的 datetime 数据类型，Pandas 则提供了两种表现形式：</p><ol><li><p>一种是带 <a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.Timestamp.html#pandas.Timestamp" title="pandas.Timestamp"><code>Timestamp</code></a> 的 <a target="_blank" rel="noopener" href="https://docs.scipy.org/doc/numpy/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v1.16)"><code>numpy.ndarray</code></a>，提供了正确的 <code>tz</code> 信息。</p></li><li><p>另一种是 <code>datetime64[ns]</code>，这也是一种 <a target="_blank" rel="noopener" href="https://docs.scipy.org/doc/numpy/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v1.16)"><code>numpy.ndarray</code></a>，值被转换为 UTC，但去掉了时区信息。</p></li></ol><p>时区信息可以用 <code>dtype=object</code> 保存。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">14</span>]: ser = pd.Series(pd.date_range(<span class="string">&#x27;2000&#x27;</span>, periods=<span class="number">2</span>, tz=<span class="string">&quot;CET&quot;</span>))</span><br><span class="line"></span><br><span class="line">In [<span class="number">15</span>]: ser.to_numpy(dtype=<span class="built_in">object</span>)</span><br><span class="line">Out[<span class="number">15</span>]: </span><br><span class="line">array([Timestamp(<span class="string">&#x27;2000-01-01 00:00:00+0100&#x27;</span>, tz=<span class="string">&#x27;CET&#x27;</span>, freq=<span class="string">&#x27;D&#x27;</span>),</span><br><span class="line">       Timestamp(<span class="string">&#x27;2000-01-02 00:00:00+0100&#x27;</span>, tz=<span class="string">&#x27;CET&#x27;</span>, freq=<span class="string">&#x27;D&#x27;</span>)],</span><br><span class="line">      dtype=<span class="built_in">object</span>)</span><br></pre></td></tr></table></figure><p>或用 <code>dtype=&#39;datetime64[ns]&#39;</code> 去除。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">16</span>]: ser.to_numpy(dtype=<span class="string">&quot;datetime64[ns]&quot;</span>)</span><br><span class="line">Out[<span class="number">16</span>]: </span><br><span class="line">array([<span class="string">&#x27;1999-12-31T23:00:00.000000000&#x27;</span>, <span class="string">&#x27;2000-01-01T23:00:00.000000000&#x27;</span>],</span><br><span class="line">      dtype=<span class="string">&#x27;datetime64[ns]&#x27;</span>)</span><br></pre></td></tr></table></figure><p>提取 <code>DataFrame</code> 里的<strong>原数据</strong>稍微有点复杂。DataFrame 里所有列的数据类型都一样时，<a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.to_numpy.html#pandas.DataFrame.to_numpy" title="pandas.DataFrame.to_numpy"><code>DataFrame.to_numpy()</code></a> 返回底层数据：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">17</span>]: df.to_numpy()</span><br><span class="line">Out[<span class="number">17</span>]: </span><br><span class="line">array([[-<span class="number">0.1732</span>,  <span class="number">0.1192</span>, -<span class="number">1.0442</span>],</span><br><span class="line">       [-<span class="number">0.8618</span>, -<span class="number">2.1046</span>, -<span class="number">0.4949</span>],</span><br><span class="line">       [ <span class="number">1.0718</span>,  <span class="number">0.7216</span>, -<span class="number">0.7068</span>],</span><br><span class="line">       [-<span class="number">1.0396</span>,  <span class="number">0.2719</span>, -<span class="number">0.425</span> ],</span><br><span class="line">       [ <span class="number">0.567</span> ,  <span class="number">0.2762</span>, -<span class="number">1.0874</span>],</span><br><span class="line">       [-<span class="number">0.6737</span>,  <span class="number">0.1136</span>, -<span class="number">1.4784</span>],</span><br><span class="line">       [ <span class="number">0.525</span> ,  <span class="number">0.4047</span>,  <span class="number">0.577</span> ],</span><br><span class="line">       [-<span class="number">1.715</span> , -<span class="number">1.0393</span>, -<span class="number">0.3706</span>]])</span><br></pre></td></tr></table></figure><p>DataFrame 为同构型数据时，Pandas 直接修改原始 <code>ndarray</code>，所做修改会直接反应在数据结构里。对于异质型数据，即 DataFrame 列的数据类型不一样时，就不是这种操作模式了。与轴标签不同，不能为值的属性赋值。</p><p>::: tip 注意</p><p>处理异质型数据时，输出结果 <code>ndarray</code> 的数据类型适用于涉及的各类数据。若 DataFrame 里包含字符串，输出结果的数据类型就是 <code>object</code>。要是只有浮点数或整数，则输出结果的数据类型是浮点数。</p><p>:::</p><p>以前，Pandas 推荐用 <a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.Series.values.html#pandas.Series.values" title="pandas.Series.values"><code>Series.values</code></a> 或 <a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.values.html#pandas.DataFrame.values" title="pandas.DataFrame.values"><code>DataFrame.values</code></a> 从 Series 或 DataFrame 里提取数据。旧有代码库或在线教程里仍在用这种操作，但 Pandas 已改进了此功能，现在，推荐用 <code>.array</code> 或 <code>to_numpy</code> 提取数据，别再用 <code>.values</code> 了。<code>.values</code> 有以下几个缺点：</p><ol><li><p>Series 含<a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/development/extending.html#extending-extension-types">扩展类型</a>时，<a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.Series.values.html#pandas.Series.values">Series.values</a> 无法判断到底是该返回 NumPy <code>array</code>，还是返回 <code>ExtensionArray</code>。而 <a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.Series.array.html#pandas.Series.array" title="pandas.Series.array"><code>Series.array</code></a> 则只返回 <a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.api.extensions.ExtensionArray.html#pandas.api.extensions.ExtensionArray" title="pandas.api.extensions.ExtensionArray"><code>ExtensionArray</code></a>，且不会复制数据。<a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.Series.to_numpy.html#pandas.Series.to_numpy" title="pandas.Series.to_numpy"><code>Series.to_numpy()</code></a> 则返回 NumPy 数组，其代价是需要复制、并强制转换数据的值。</p></li><li><p>DataFrame 含多种数据类型时，<a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.values.html#pandas.DataFrame.values" title="pandas.DataFrame.values"><code>DataFrame.values</code></a> 会复制数据，并将数据的值强制转换同一种数据类型，这是一种代价较高的操作。<a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.to_numpy.html#pandas.DataFrame.to_numpy" title="pandas.DataFrame.to_numpy"><code>DataFrame.to_numpy()</code></a> 则返回 NumPy 数组，这种方式更清晰，也不会把 DataFrame 里的数据都当作一种类型。</p></li></ol><h2 id="加速操作"><a href="#加速操作" class="headerlink" title="加速操作"></a>加速操作</h2><p>借助 <code>numexpr</code> 与 <code>bottleneck</code> 支持库，Pandas 可以加速特定类型的二进制数值与布尔操作。</p><p>处理大型数据集时，这两个支持库特别有用，加速效果也非常明显。 <code>numexpr</code> 使用智能分块、缓存与多核技术。<code>bottleneck</code> 是一组专属 cython 例程，处理含 <code>nans</code> 值的数组时，特别快。</p><p>请看下面这个例子（<code>DataFrame</code> 包含 100 列 X 10 万行数据）:</p><table><thead><tr><th align="center">操作</th><th align="center">0.11.0版 (ms)</th><th align="center">旧版 (ms)</th><th align="center">提升比率</th></tr></thead><tbody><tr><td align="center"><code>df1 &gt; df2</code></td><td align="center">13.32</td><td align="center">125.35</td><td align="center">0.1063</td></tr><tr><td align="center"><code>df1 * df2</code></td><td align="center">21.71</td><td align="center">36.63</td><td align="center">0.5928</td></tr><tr><td align="center"><code>df1 + df2</code></td><td align="center">22.04</td><td align="center">36.50</td><td align="center">0.6039</td></tr></tbody></table><p>强烈建议安装这两个支持库，更多信息，请参阅<a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/install.html#install-recommended-dependencies">推荐支持库</a>。</p><p>这两个支持库默认为启用状态，可用以下选项设置：</p><p><em>0.20.0 版新增。</em></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">pd.set_option(<span class="string">&#x27;compute.use_bottleneck&#x27;</span>, <span class="literal">False</span>)</span><br><span class="line">pd.set_option(<span class="string">&#x27;compute.use_numexpr&#x27;</span>, <span class="literal">False</span>)</span><br></pre></td></tr></table></figure><h2 id="二进制操作"><a href="#二进制操作" class="headerlink" title="二进制操作"></a>二进制操作</h2><p>Pandas 数据结构之间执行二进制操作，要注意下列两个关键点：</p><ul><li>多维（DataFrame）与低维（Series）对象之间的广播机制；</li><li>计算中的缺失值处理。</li></ul><p>这两个问题可以同时处理，但下面先介绍怎么分开处理。</p><h3 id="匹配-广播机制"><a href="#匹配-广播机制" class="headerlink" title="匹配/广播机制"></a>匹配/广播机制</h3><p>DataFrame 支持 <a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.add.html#pandas.DataFrame.add" title="pandas.DataFrame.add"><code>add()</code></a>、<a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.sub.html#pandas.DataFrame.sub" title="pandas.DataFrame.sub"><code>sub()</code></a>、<a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.mul.html#pandas.DataFrame.mul" title="pandas.DataFrame.mul"><code>mul()</code></a>、<a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.div.html#pandas.DataFrame.div" title="pandas.DataFrame.div"><code>div()</code></a> 及 <a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.radd.html#pandas.DataFrame.radd" title="pandas.DataFrame.radd"><code>radd()</code></a>、<a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.rsub.html#pandas.DataFrame.rsub" title="pandas.DataFrame.rsub"><code>rsub()</code></a> 等方法执行二进制操作。广播机制重点关注输入的 Series。通过 <code>axis</code> 关键字，匹配 <em>index</em> 或 <em>columns</em> 即可调用这些函数。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">18</span>]: df = pd.DataFrame(&#123;</span><br><span class="line">   ....:     <span class="string">&#x27;one&#x27;</span>: pd.Series(np.random.randn(<span class="number">3</span>), index=[<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;c&#x27;</span>]),</span><br><span class="line">   ....:     <span class="string">&#x27;two&#x27;</span>: pd.Series(np.random.randn(<span class="number">4</span>), index=[<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;c&#x27;</span>, <span class="string">&#x27;d&#x27;</span>]),</span><br><span class="line">   ....:     <span class="string">&#x27;three&#x27;</span>: pd.Series(np.random.randn(<span class="number">3</span>), index=[<span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;c&#x27;</span>, <span class="string">&#x27;d&#x27;</span>])&#125;)</span><br><span class="line">   ....: </span><br><span class="line"></span><br><span class="line">In [<span class="number">19</span>]: df</span><br><span class="line">Out[<span class="number">19</span>]: </span><br><span class="line">        one       two     three</span><br><span class="line">a  <span class="number">1.394981</span>  <span class="number">1.772517</span>       NaN</span><br><span class="line">b  <span class="number">0.343054</span>  <span class="number">1.912123</span> -<span class="number">0.050390</span></span><br><span class="line">c  <span class="number">0.695246</span>  <span class="number">1.478369</span>  <span class="number">1.227435</span></span><br><span class="line">d       NaN  <span class="number">0.279344</span> -<span class="number">0.613172</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">20</span>]: row = df.iloc[<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line">In [<span class="number">21</span>]: column = df[<span class="string">&#x27;two&#x27;</span>]</span><br><span class="line"></span><br><span class="line">In [<span class="number">22</span>]: df.sub(row, axis=<span class="string">&#x27;columns&#x27;</span>)</span><br><span class="line">Out[<span class="number">22</span>]: </span><br><span class="line">        one       two     three</span><br><span class="line">a  <span class="number">1.051928</span> -<span class="number">0.139606</span>       NaN</span><br><span class="line">b  <span class="number">0.000000</span>  <span class="number">0.000000</span>  <span class="number">0.000000</span></span><br><span class="line">c  <span class="number">0.352192</span> -<span class="number">0.433754</span>  <span class="number">1.277825</span></span><br><span class="line">d       NaN -<span class="number">1.632779</span> -<span class="number">0.562782</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">23</span>]: df.sub(row, axis=<span class="number">1</span>)</span><br><span class="line">Out[<span class="number">23</span>]: </span><br><span class="line">        one       two     three</span><br><span class="line">a  <span class="number">1.051928</span> -<span class="number">0.139606</span>       NaN</span><br><span class="line">b  <span class="number">0.000000</span>  <span class="number">0.000000</span>  <span class="number">0.000000</span></span><br><span class="line">c  <span class="number">0.352192</span> -<span class="number">0.433754</span>  <span class="number">1.277825</span></span><br><span class="line">d       NaN -<span class="number">1.632779</span> -<span class="number">0.562782</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">24</span>]: df.sub(column, axis=<span class="string">&#x27;index&#x27;</span>)</span><br><span class="line">Out[<span class="number">24</span>]: </span><br><span class="line">        one  two     three</span><br><span class="line">a -<span class="number">0.377535</span>  <span class="number">0.0</span>       NaN</span><br><span class="line">b -<span class="number">1.569069</span>  <span class="number">0.0</span> -<span class="number">1.962513</span></span><br><span class="line">c -<span class="number">0.783123</span>  <span class="number">0.0</span> -<span class="number">0.250933</span></span><br><span class="line">d       NaN  <span class="number">0.0</span> -<span class="number">0.892516</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">25</span>]: df.sub(column, axis=<span class="number">0</span>)</span><br><span class="line">Out[<span class="number">25</span>]: </span><br><span class="line">        one  two     three</span><br><span class="line">a -<span class="number">0.377535</span>  <span class="number">0.0</span>       NaN</span><br><span class="line">b -<span class="number">1.569069</span>  <span class="number">0.0</span> -<span class="number">1.962513</span></span><br><span class="line">c -<span class="number">0.783123</span>  <span class="number">0.0</span> -<span class="number">0.250933</span></span><br><span class="line">d       NaN  <span class="number">0.0</span> -<span class="number">0.892516</span></span><br></pre></td></tr></table></figure><p>还可以用 Series 对齐多层索引 DataFrame 的某一层级。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">26</span>]: dfmi = df.copy()</span><br><span class="line"></span><br><span class="line">In [<span class="number">27</span>]: dfmi.index = pd.MultiIndex.from_tuples([(<span class="number">1</span>, <span class="string">&#x27;a&#x27;</span>), (<span class="number">1</span>, <span class="string">&#x27;b&#x27;</span>),</span><br><span class="line">   ....:                                         (<span class="number">1</span>, <span class="string">&#x27;c&#x27;</span>), (<span class="number">2</span>, <span class="string">&#x27;a&#x27;</span>)],</span><br><span class="line">   ....:                                        names=[<span class="string">&#x27;first&#x27;</span>, <span class="string">&#x27;second&#x27;</span>])</span><br><span class="line">   ....: </span><br><span class="line"></span><br><span class="line">In [<span class="number">28</span>]: dfmi.sub(column, axis=<span class="number">0</span>, level=<span class="string">&#x27;second&#x27;</span>)</span><br><span class="line">Out[<span class="number">28</span>]: </span><br><span class="line">                   one       two     three</span><br><span class="line">first second                              </span><br><span class="line"><span class="number">1</span>     a      -<span class="number">0.377535</span>  <span class="number">0.000000</span>       NaN</span><br><span class="line">      b      -<span class="number">1.569069</span>  <span class="number">0.000000</span> -<span class="number">1.962513</span></span><br><span class="line">      c      -<span class="number">0.783123</span>  <span class="number">0.000000</span> -<span class="number">0.250933</span></span><br><span class="line"><span class="number">2</span>     a            NaN -<span class="number">1.493173</span> -<span class="number">2.385688</span></span><br></pre></td></tr></table></figure><p>Series 与 Index 还支持 <a target="_blank" rel="noopener" href="https://docs.python.org/3/library/functions.html#divmod" title="(in Python v3.7)"><code>divmod()</code></a> 内置函数，该函数同时执行向下取整除与模运算，返回两个与左侧类型相同的元组。示例如下：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">29</span>]: s = pd.Series(np.arange(<span class="number">10</span>))</span><br><span class="line"></span><br><span class="line">In [<span class="number">30</span>]: s</span><br><span class="line">Out[<span class="number">30</span>]: </span><br><span class="line"><span class="number">0</span>    <span class="number">0</span></span><br><span class="line"><span class="number">1</span>    <span class="number">1</span></span><br><span class="line"><span class="number">2</span>    <span class="number">2</span></span><br><span class="line"><span class="number">3</span>    <span class="number">3</span></span><br><span class="line"><span class="number">4</span>    <span class="number">4</span></span><br><span class="line"><span class="number">5</span>    <span class="number">5</span></span><br><span class="line"><span class="number">6</span>    <span class="number">6</span></span><br><span class="line"><span class="number">7</span>    <span class="number">7</span></span><br><span class="line"><span class="number">8</span>    <span class="number">8</span></span><br><span class="line"><span class="number">9</span>    <span class="number">9</span></span><br><span class="line">dtype: int64</span><br><span class="line"></span><br><span class="line">In [<span class="number">31</span>]: div, rem = <span class="built_in">divmod</span>(s, <span class="number">3</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">32</span>]: div</span><br><span class="line">Out[<span class="number">32</span>]: </span><br><span class="line"><span class="number">0</span>    <span class="number">0</span></span><br><span class="line"><span class="number">1</span>    <span class="number">0</span></span><br><span class="line"><span class="number">2</span>    <span class="number">0</span></span><br><span class="line"><span class="number">3</span>    <span class="number">1</span></span><br><span class="line"><span class="number">4</span>    <span class="number">1</span></span><br><span class="line"><span class="number">5</span>    <span class="number">1</span></span><br><span class="line"><span class="number">6</span>    <span class="number">2</span></span><br><span class="line"><span class="number">7</span>    <span class="number">2</span></span><br><span class="line"><span class="number">8</span>    <span class="number">2</span></span><br><span class="line"><span class="number">9</span>    <span class="number">3</span></span><br><span class="line">dtype: int64</span><br><span class="line"></span><br><span class="line">In [<span class="number">33</span>]: rem</span><br><span class="line">Out[<span class="number">33</span>]: </span><br><span class="line"><span class="number">0</span>    <span class="number">0</span></span><br><span class="line"><span class="number">1</span>    <span class="number">1</span></span><br><span class="line"><span class="number">2</span>    <span class="number">2</span></span><br><span class="line"><span class="number">3</span>    <span class="number">0</span></span><br><span class="line"><span class="number">4</span>    <span class="number">1</span></span><br><span class="line"><span class="number">5</span>    <span class="number">2</span></span><br><span class="line"><span class="number">6</span>    <span class="number">0</span></span><br><span class="line"><span class="number">7</span>    <span class="number">1</span></span><br><span class="line"><span class="number">8</span>    <span class="number">2</span></span><br><span class="line"><span class="number">9</span>    <span class="number">0</span></span><br><span class="line">dtype: int64</span><br><span class="line"></span><br><span class="line">In [<span class="number">34</span>]: idx = pd.Index(np.arange(<span class="number">10</span>))</span><br><span class="line"></span><br><span class="line">In [<span class="number">35</span>]: idx</span><br><span class="line">Out[<span class="number">35</span>]: Int64Index([<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>], dtype=<span class="string">&#x27;int64&#x27;</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">36</span>]: div, rem = <span class="built_in">divmod</span>(idx, <span class="number">3</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">37</span>]: div</span><br><span class="line">Out[<span class="number">37</span>]: Int64Index([<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">3</span>], dtype=<span class="string">&#x27;int64&#x27;</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">38</span>]: rem</span><br><span class="line">Out[<span class="number">38</span>]: Int64Index([<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">0</span>], dtype=<span class="string">&#x27;int64&#x27;</span>)</span><br></pre></td></tr></table></figure><p><a target="_blank" rel="noopener" href="https://docs.python.org/3/library/functions.html#divmod" title="(in Python v3.7)"><code>divmod()</code></a> 还支持元素级运算：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">39</span>]: div, rem = <span class="built_in">divmod</span>(s, [<span class="number">2</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">6</span>])</span><br><span class="line"></span><br><span class="line">In [<span class="number">40</span>]: div</span><br><span class="line">Out[<span class="number">40</span>]: </span><br><span class="line"><span class="number">0</span>    <span class="number">0</span></span><br><span class="line"><span class="number">1</span>    <span class="number">0</span></span><br><span class="line"><span class="number">2</span>    <span class="number">0</span></span><br><span class="line"><span class="number">3</span>    <span class="number">1</span></span><br><span class="line"><span class="number">4</span>    <span class="number">1</span></span><br><span class="line"><span class="number">5</span>    <span class="number">1</span></span><br><span class="line"><span class="number">6</span>    <span class="number">1</span></span><br><span class="line"><span class="number">7</span>    <span class="number">1</span></span><br><span class="line"><span class="number">8</span>    <span class="number">1</span></span><br><span class="line"><span class="number">9</span>    <span class="number">1</span></span><br><span class="line">dtype: int64</span><br><span class="line"></span><br><span class="line">In [<span class="number">41</span>]: rem</span><br><span class="line">Out[<span class="number">41</span>]: </span><br><span class="line"><span class="number">0</span>    <span class="number">0</span></span><br><span class="line"><span class="number">1</span>    <span class="number">1</span></span><br><span class="line"><span class="number">2</span>    <span class="number">2</span></span><br><span class="line"><span class="number">3</span>    <span class="number">0</span></span><br><span class="line"><span class="number">4</span>    <span class="number">0</span></span><br><span class="line"><span class="number">5</span>    <span class="number">1</span></span><br><span class="line"><span class="number">6</span>    <span class="number">1</span></span><br><span class="line"><span class="number">7</span>    <span class="number">2</span></span><br><span class="line"><span class="number">8</span>    <span class="number">2</span></span><br><span class="line"><span class="number">9</span>    <span class="number">3</span></span><br><span class="line">dtype: int64</span><br></pre></td></tr></table></figure><h3 id="缺失值与填充缺失值操作"><a href="#缺失值与填充缺失值操作" class="headerlink" title="缺失值与填充缺失值操作"></a>缺失值与填充缺失值操作</h3><p>Series 与 DataFrame 的算数函数支持 <code>fill_value</code> 选项，即用指定值替换某个位置的缺失值。比如，两个 DataFrame 相加，除非两个 DataFrame 里同一个位置都有缺失值，其相加的和仍为 <code>NaN</code>，如果只有一个 DataFrame 里存在缺失值，则可以用 <code>fill_value</code> 指定一个值来替代 <code>NaN</code>，当然，也可以用 <code>fillna</code> 把 <code>NaN</code> 替换为想要的值。</p><h4 id="tip-注意"><a href="#tip-注意" class="headerlink" title="tip 注意"></a><code>tip 注意</code></h4><p>下面第 43 条代码里，Pandas 官档没有写 df2 是哪里来的，这里补上，与 df 类似。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">41</span>] df2 = pd.DataFrame(&#123;</span><br><span class="line">   ....:     <span class="string">&#x27;one&#x27;</span>: pd.Series(np.random.randn(<span class="number">3</span>), index=[<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;c&#x27;</span>]),</span><br><span class="line">   ....:     <span class="string">&#x27;two&#x27;</span>: pd.Series(np.random.randn(<span class="number">4</span>), index=[<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;c&#x27;</span>, <span class="string">&#x27;d&#x27;</span>]),</span><br><span class="line">   ....:     <span class="string">&#x27;three&#x27;</span>: pd.Series(np.random.randn(<span class="number">3</span>), index=[<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;c&#x27;</span>, <span class="string">&#x27;d&#x27;</span>])&#125;)</span><br><span class="line">   ....:</span><br><span class="line">In [<span class="number">42</span>]: df</span><br><span class="line">Out[<span class="number">42</span>]: </span><br><span class="line">        one       two     three</span><br><span class="line">a  <span class="number">1.394981</span>  <span class="number">1.772517</span>       NaN</span><br><span class="line">b  <span class="number">0.343054</span>  <span class="number">1.912123</span> -<span class="number">0.050390</span></span><br><span class="line">c  <span class="number">0.695246</span>  <span class="number">1.478369</span>  <span class="number">1.227435</span></span><br><span class="line">d       NaN  <span class="number">0.279344</span> -<span class="number">0.613172</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">43</span>]: df2</span><br><span class="line">Out[<span class="number">43</span>]: </span><br><span class="line">        one       two     three</span><br><span class="line">a  <span class="number">1.394981</span>  <span class="number">1.772517</span>  <span class="number">1.000000</span></span><br><span class="line">b  <span class="number">0.343054</span>  <span class="number">1.912123</span> -<span class="number">0.050390</span></span><br><span class="line">c  <span class="number">0.695246</span>  <span class="number">1.478369</span>  <span class="number">1.227435</span></span><br><span class="line">d       NaN  <span class="number">0.279344</span> -<span class="number">0.613172</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">44</span>]: df + df2</span><br><span class="line">Out[<span class="number">44</span>]: </span><br><span class="line">        one       two     three</span><br><span class="line">a  <span class="number">2.789963</span>  <span class="number">3.545034</span>       NaN</span><br><span class="line">b  <span class="number">0.686107</span>  <span class="number">3.824246</span> -<span class="number">0.100780</span></span><br><span class="line">c  <span class="number">1.390491</span>  <span class="number">2.956737</span>  <span class="number">2.454870</span></span><br><span class="line">d       NaN  <span class="number">0.558688</span> -<span class="number">1.226343</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">45</span>]: df.add(df2, fill_value=<span class="number">0</span>)</span><br><span class="line">Out[<span class="number">45</span>]: </span><br><span class="line">        one       two     three</span><br><span class="line">a  <span class="number">2.789963</span>  <span class="number">3.545034</span>  <span class="number">1.000000</span></span><br><span class="line">b  <span class="number">0.686107</span>  <span class="number">3.824246</span> -<span class="number">0.100780</span></span><br><span class="line">c  <span class="number">1.390491</span>  <span class="number">2.956737</span>  <span class="number">2.454870</span></span><br><span class="line">d       NaN  <span class="number">0.558688</span> -<span class="number">1.226343</span></span><br></pre></td></tr></table></figure><h3 id="比较操作"><a href="#比较操作" class="headerlink" title="比较操作"></a>比较操作</h3><p>与上一小节的算数运算类似，Series 与 DataFrame 还支持 <code>eq</code>、<code>ne</code>、<code>lt</code>、<code>gt</code>、<code>le</code>、<code>ge</code> 等二进制比较操作的方法：</p><table><thead><tr><th align="center">序号</th><th align="center">缩写</th><th align="center">英文</th><th align="center">中文</th></tr></thead><tbody><tr><td align="center">1</td><td align="center">eq</td><td align="center">equal to</td><td align="center">等于</td></tr><tr><td align="center">2</td><td align="center">ne</td><td align="center">not equal to</td><td align="center">不等于</td></tr><tr><td align="center">3</td><td align="center">lt</td><td align="center">less than</td><td align="center">小于</td></tr><tr><td align="center">4</td><td align="center">gt</td><td align="center">greater than</td><td align="center">大于</td></tr><tr><td align="center">5</td><td align="center">le</td><td align="center">less than or equal to</td><td align="center">小于等于</td></tr><tr><td align="center">6</td><td align="center">ge</td><td align="center">greater than or equal to</td><td align="center">大于等于</td></tr></tbody></table><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">In [46]: df.gt(df2)</span><br><span class="line">Out[46]: </span><br><span class="line">     one    two  three</span><br><span class="line">a  False  False  False</span><br><span class="line">b  False  False  False</span><br><span class="line">c  False  False  False</span><br><span class="line">d  False  False  False</span><br><span class="line"></span><br><span class="line">In [47]: df2.ne(df)</span><br><span class="line">Out[47]: </span><br><span class="line">     one    two  three</span><br><span class="line">a  False  False   True</span><br><span class="line">b  False  False  False</span><br><span class="line">c  False  False  False</span><br><span class="line">d   True  False  False</span><br></pre></td></tr></table></figure><p>这些操作生成一个与左侧输入对象类型相同的 Pandas 对象，即，dtype 为 <code>bool</code>。<code>boolean</code> 对象可用于索引操作，参阅<a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#indexing-boolean">布尔索引</a>。</p><h3 id="布尔简化"><a href="#布尔简化" class="headerlink" title="布尔简化"></a>布尔简化</h3><p><a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.empty.html#pandas.DataFrame.empty" title="pandas.DataFrame.empty"><code>empty</code></a>、<a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.any.html#pandas.DataFrame.any" title="pandas.DataFrame.any"><code>any()</code></a>、<a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.all.html#pandas.DataFrame.all" title="pandas.DataFrame.all"><code>all()</code></a>、<a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.bool.html#pandas.DataFrame.bool" title="pandas.DataFrame.bool"><code>bool()</code></a> 可以把数据汇总简化至单个布尔值。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">In [48]: (df &gt; 0).all()</span><br><span class="line">Out[48]: </span><br><span class="line">one      False</span><br><span class="line">two       True</span><br><span class="line">three    False</span><br><span class="line">dtype: bool</span><br><span class="line"></span><br><span class="line">In [49]: (df &gt; 0).any()</span><br><span class="line">Out[49]: </span><br><span class="line">one      True</span><br><span class="line">two      True</span><br><span class="line">three    True</span><br><span class="line">dtype: bool</span><br></pre></td></tr></table></figure><p>还可以进一步把上面的结果简化为单个布尔值。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">In [50]: (df &gt; 0).any().any()</span><br><span class="line">Out[50]: True</span><br></pre></td></tr></table></figure><p>通过 <a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.empty.html#pandas.DataFrame.empty" title="pandas.DataFrame.empty"><code>empty</code></a> 属性，可以验证 Pandas 对象是否为<strong>空</strong>。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">In [51]: df.empty</span><br><span class="line">Out[51]: False</span><br><span class="line"></span><br><span class="line">In [52]: pd.DataFrame(columns=list(&#x27;ABC&#x27;)).empty</span><br><span class="line">Out[52]: True</span><br></pre></td></tr></table></figure><p>用 <a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.bool.html#pandas.DataFrame.bool" title="pandas.DataFrame.bool"><code>bool()</code></a> 方法验证单元素 pandas 对象的布尔值。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">In [53]: pd.Series([True]).bool()</span><br><span class="line">Out[53]: True</span><br><span class="line"></span><br><span class="line">In [54]: pd.Series([False]).bool()</span><br><span class="line">Out[54]: False</span><br><span class="line"></span><br><span class="line">In [55]: pd.DataFrame([[True]]).bool()</span><br><span class="line">Out[55]: True</span><br><span class="line"></span><br><span class="line">In [56]: pd.DataFrame([[False]]).bool()</span><br><span class="line">Out[56]: False</span><br></pre></td></tr></table></figure><h4 id="danger-警告"><a href="#danger-警告" class="headerlink" title="danger 警告"></a><code>danger 警告</code></h4><p>以下代码：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> df:</span><br><span class="line"><span class="meta">... </span>    <span class="keyword">pass</span></span><br><span class="line"><span class="comment"># 或者</span></span><br><span class="line">df <span class="keyword">and</span> df2</span><br><span class="line"><span class="comment"># 上述代码试图比对多个值，因此，这两种操作都会触发错误：</span></span><br><span class="line">ValueError: The truth value of an array <span class="keyword">is</span> ambiguous. Use a.empty, a.<span class="built_in">any</span>() <span class="keyword">or</span> a.<span class="built_in">all</span>().</span><br></pre></td></tr></table></figure><p>了解详情，请参阅<a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/user_guide/gotchas.html#gotchas-truth">各种坑</a>小节的内容。</p><h3 id="比较对象是否等效"><a href="#比较对象是否等效" class="headerlink" title="比较对象是否等效"></a>比较对象是否等效</h3><p>一般情况下，多种方式都能得出相同的结果。以 <code>df + df</code> 与 <code>df * 2</code> 为例。应用上一小节学到的知识，测试这两种计算方式的结果是否一致，一般人都会用 <code>(df + df == df * 2).all()</code>，不过，这个表达式的结果是 <code>False</code>：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">57</span>]: df + df == df * <span class="number">2</span></span><br><span class="line">Out[<span class="number">57</span>]: </span><br><span class="line">     one   two  three</span><br><span class="line">a   <span class="literal">True</span>  <span class="literal">True</span>  <span class="literal">False</span></span><br><span class="line">b   <span class="literal">True</span>  <span class="literal">True</span>   <span class="literal">True</span></span><br><span class="line">c   <span class="literal">True</span>  <span class="literal">True</span>   <span class="literal">True</span></span><br><span class="line">d  <span class="literal">False</span>  <span class="literal">True</span>   <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">58</span>]: (df + df == df * <span class="number">2</span>).<span class="built_in">all</span>()</span><br><span class="line">Out[<span class="number">58</span>]: </span><br><span class="line">one      <span class="literal">False</span></span><br><span class="line">two       <span class="literal">True</span></span><br><span class="line">three    <span class="literal">False</span></span><br><span class="line">dtype: <span class="built_in">bool</span></span><br></pre></td></tr></table></figure><h4 id="注意：布尔型-DataFrame-df-df-df-2-中有-False-值！这是因为两个-NaN-值的比较结果为不等："><a href="#注意：布尔型-DataFrame-df-df-df-2-中有-False-值！这是因为两个-NaN-值的比较结果为不等：" class="headerlink" title="注意：布尔型 DataFrame df + df == df * 2 中有 False 值！这是因为两个 NaN 值的比较结果为不等："></a>注意：布尔型 DataFrame <code>df + df == df * 2</code> 中有 <code>False</code> 值！这是因为两个 <code>NaN</code> 值的比较结果为<strong>不等</strong>：</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">59</span>]: np.nan == np.nan</span><br><span class="line">Out[<span class="number">59</span>]: <span class="literal">False</span></span><br></pre></td></tr></table></figure><p>为了验证数据是否等效，Series 与 DataFrame 等 N 维框架提供了 <a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.equals.html#pandas.DataFrame.equals" title="pandas.DataFrame.equals"><code>equals()</code></a> 方法，用这个方法验证 <code>NaN</code> 值的结果为<strong>相等</strong>。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">60</span>]: (df + df).equals(df * <span class="number">2</span>)</span><br><span class="line">Out[<span class="number">60</span>]: <span class="literal">True</span></span><br></pre></td></tr></table></figure><p>注意：Series 与 DataFrame 索引的顺序必须一致，验证结果才能为 <code>True</code>：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">61</span>]: df1 = pd.DataFrame(&#123;<span class="string">&#x27;col&#x27;</span>: [<span class="string">&#x27;foo&#x27;</span>, <span class="number">0</span>, np.nan]&#125;)</span><br><span class="line"></span><br><span class="line">In [<span class="number">62</span>]: df2 = pd.DataFrame(&#123;<span class="string">&#x27;col&#x27;</span>: [np.nan, <span class="number">0</span>, <span class="string">&#x27;foo&#x27;</span>]&#125;, index=[<span class="number">2</span>, <span class="number">1</span>, <span class="number">0</span>])</span><br><span class="line"></span><br><span class="line">In [<span class="number">63</span>]: df1.equals(df2)</span><br><span class="line">Out[<span class="number">63</span>]: <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">64</span>]: df1.equals(df2.sort_index())</span><br><span class="line">Out[<span class="number">64</span>]: <span class="literal">True</span></span><br></pre></td></tr></table></figure><h3 id="比较-array-型对象"><a href="#比较-array-型对象" class="headerlink" title="比较 array 型对象"></a>比较 array 型对象</h3><p>用标量值与 Pandas 数据结构对比数据元素非常简单：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">65</span>]: pd.Series([<span class="string">&#x27;foo&#x27;</span>, <span class="string">&#x27;bar&#x27;</span>, <span class="string">&#x27;baz&#x27;</span>]) == <span class="string">&#x27;foo&#x27;</span></span><br><span class="line">Out[<span class="number">65</span>]: </span><br><span class="line"><span class="number">0</span>     <span class="literal">True</span></span><br><span class="line"><span class="number">1</span>    <span class="literal">False</span></span><br><span class="line"><span class="number">2</span>    <span class="literal">False</span></span><br><span class="line">dtype: <span class="built_in">bool</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">66</span>]: pd.Index([<span class="string">&#x27;foo&#x27;</span>, <span class="string">&#x27;bar&#x27;</span>, <span class="string">&#x27;baz&#x27;</span>]) == <span class="string">&#x27;foo&#x27;</span></span><br><span class="line">Out[<span class="number">66</span>]: array([ <span class="literal">True</span>, <span class="literal">False</span>, <span class="literal">False</span>])</span><br></pre></td></tr></table></figure><p>Pandas 还能对比两个等长 <code>array</code> 对象里的数据元素：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">67</span>]: pd.Series([<span class="string">&#x27;foo&#x27;</span>, <span class="string">&#x27;bar&#x27;</span>, <span class="string">&#x27;baz&#x27;</span>]) == pd.Index([<span class="string">&#x27;foo&#x27;</span>, <span class="string">&#x27;bar&#x27;</span>, <span class="string">&#x27;qux&#x27;</span>])</span><br><span class="line">Out[<span class="number">67</span>]: </span><br><span class="line"><span class="number">0</span>     <span class="literal">True</span></span><br><span class="line"><span class="number">1</span>     <span class="literal">True</span></span><br><span class="line"><span class="number">2</span>    <span class="literal">False</span></span><br><span class="line">dtype: <span class="built_in">bool</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">68</span>]: pd.Series([<span class="string">&#x27;foo&#x27;</span>, <span class="string">&#x27;bar&#x27;</span>, <span class="string">&#x27;baz&#x27;</span>]) == np.array([<span class="string">&#x27;foo&#x27;</span>, <span class="string">&#x27;bar&#x27;</span>, <span class="string">&#x27;qux&#x27;</span>])</span><br><span class="line">Out[<span class="number">68</span>]: </span><br><span class="line"><span class="number">0</span>     <span class="literal">True</span></span><br><span class="line"><span class="number">1</span>     <span class="literal">True</span></span><br><span class="line"><span class="number">2</span>    <span class="literal">False</span></span><br><span class="line">dtype: <span class="built_in">bool</span></span><br></pre></td></tr></table></figure><p>对比不等长的 <code>Index</code> 或 <code>Series</code> 对象会触发 <code>ValueError</code>：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">55</span>]: pd.Series([<span class="string">&#x27;foo&#x27;</span>, <span class="string">&#x27;bar&#x27;</span>, <span class="string">&#x27;baz&#x27;</span>]) == pd.Series([<span class="string">&#x27;foo&#x27;</span>, <span class="string">&#x27;bar&#x27;</span>])</span><br><span class="line">ValueError: Series lengths must match to compare</span><br><span class="line"></span><br><span class="line">In [<span class="number">56</span>]: pd.Series([<span class="string">&#x27;foo&#x27;</span>, <span class="string">&#x27;bar&#x27;</span>, <span class="string">&#x27;baz&#x27;</span>]) == pd.Series([<span class="string">&#x27;foo&#x27;</span>])</span><br><span class="line">ValueError: Series lengths must match to compare</span><br></pre></td></tr></table></figure><p>注意： 这里的操作与 NumPy 的广播机制不同：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">69</span>]: np.array([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]) == np.array([<span class="number">2</span>])</span><br><span class="line">Out[<span class="number">69</span>]: array([<span class="literal">False</span>,  <span class="literal">True</span>, <span class="literal">False</span>])</span><br></pre></td></tr></table></figure><p>NumPy 无法执行广播操作时，返回 <code>False</code>:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">70</span>]: np.array([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]) == np.array([<span class="number">1</span>, <span class="number">2</span>])</span><br><span class="line">Out[<span class="number">70</span>]: <span class="literal">False</span></span><br></pre></td></tr></table></figure><h3 id="合并重叠数据集"><a href="#合并重叠数据集" class="headerlink" title="合并重叠数据集"></a>合并重叠数据集</h3><p>有时，要合并两个相似的数据集，两个数据集里的其中一个的数据比另一个多。比如，展示特定经济指标的两个数据序列，其中一个是“高质量”指标，另一个是“低质量”指标。一般来说，低质量序列可能包含更多的历史数据，或覆盖更广的数据。因此，要合并这两个 DataFrame 对象，其中一个 DataFrame 中的缺失值将按指定条件用另一个 DataFrame 里类似标签中的数据进行填充。要实现这一操作，请用下列代码中的 <a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.combine_first.html#pandas.DataFrame.combine_first" title="pandas.DataFrame.combine_first"><code>combine_first()</code></a> 函数。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">71</span>]: df1 = pd.DataFrame(&#123;<span class="string">&#x27;A&#x27;</span>: [<span class="number">1.</span>, np.nan, <span class="number">3.</span>, <span class="number">5.</span>, np.nan],</span><br><span class="line">   ....:                     <span class="string">&#x27;B&#x27;</span>: [np.nan, <span class="number">2.</span>, <span class="number">3.</span>, np.nan, <span class="number">6.</span>]&#125;)</span><br><span class="line">   ....: </span><br><span class="line"></span><br><span class="line">In [<span class="number">72</span>]: df2 = pd.DataFrame(&#123;<span class="string">&#x27;A&#x27;</span>: [<span class="number">5.</span>, <span class="number">2.</span>, <span class="number">4.</span>, np.nan, <span class="number">3.</span>, <span class="number">7.</span>],</span><br><span class="line">   ....:                     <span class="string">&#x27;B&#x27;</span>: [np.nan, np.nan, <span class="number">3.</span>, <span class="number">4.</span>, <span class="number">6.</span>, <span class="number">8.</span>]&#125;)</span><br><span class="line">   ....: </span><br><span class="line"></span><br><span class="line">In [<span class="number">73</span>]: df1</span><br><span class="line">Out[<span class="number">73</span>]: </span><br><span class="line">     A    B</span><br><span class="line"><span class="number">0</span>  <span class="number">1.0</span>  NaN</span><br><span class="line"><span class="number">1</span>  NaN  <span class="number">2.0</span></span><br><span class="line"><span class="number">2</span>  <span class="number">3.0</span>  <span class="number">3.0</span></span><br><span class="line"><span class="number">3</span>  <span class="number">5.0</span>  NaN</span><br><span class="line"><span class="number">4</span>  NaN  <span class="number">6.0</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">74</span>]: df2</span><br><span class="line">Out[<span class="number">74</span>]: </span><br><span class="line">     A    B</span><br><span class="line"><span class="number">0</span>  <span class="number">5.0</span>  NaN</span><br><span class="line"><span class="number">1</span>  <span class="number">2.0</span>  NaN</span><br><span class="line"><span class="number">2</span>  <span class="number">4.0</span>  <span class="number">3.0</span></span><br><span class="line"><span class="number">3</span>  NaN  <span class="number">4.0</span></span><br><span class="line"><span class="number">4</span>  <span class="number">3.0</span>  <span class="number">6.0</span></span><br><span class="line"><span class="number">5</span>  <span class="number">7.0</span>  <span class="number">8.0</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">75</span>]: df1.combine_first(df2)</span><br><span class="line">Out[<span class="number">75</span>]: </span><br><span class="line">     A    B</span><br><span class="line"><span class="number">0</span>  <span class="number">1.0</span>  NaN</span><br><span class="line"><span class="number">1</span>  <span class="number">2.0</span>  <span class="number">2.0</span></span><br><span class="line"><span class="number">2</span>  <span class="number">3.0</span>  <span class="number">3.0</span></span><br><span class="line"><span class="number">3</span>  <span class="number">5.0</span>  <span class="number">4.0</span></span><br><span class="line"><span class="number">4</span>  <span class="number">3.0</span>  <span class="number">6.0</span></span><br><span class="line"><span class="number">5</span>  <span class="number">7.0</span>  <span class="number">8.0</span></span><br></pre></td></tr></table></figure><h3 id="DataFrame-通用合并方法"><a href="#DataFrame-通用合并方法" class="headerlink" title="DataFrame 通用合并方法"></a>DataFrame 通用合并方法</h3><p>上述 <a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.combine_first.html#pandas.DataFrame.combine_first" title="pandas.DataFrame.combine_first"><code>combine_first()</code></a> 方法调用了更普适的 <a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.combine.html#pandas.DataFrame.combine" title="pandas.DataFrame.combine"><code>DataFrame.combine()</code></a> 方法。该方法提取另一个 DataFrame 及合并器函数，并将之与输入的 DataFrame 对齐，再传递与 Series 配对的合并器函数（比如，名称相同的列）。</p><p>下面的代码复现了上述的 <a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.combine_first.html#pandas.DataFrame.combine_first" title="pandas.DataFrame.combine_first"><code>combine_first()</code></a> 函数：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">76</span>]: <span class="function"><span class="keyword">def</span> <span class="title">combiner</span>(<span class="params">x, y</span>):</span></span><br><span class="line">   ....:     <span class="keyword">return</span> np.where(pd.isna(x), y, x)</span><br><span class="line">   ....: </span><br></pre></td></tr></table></figure><h2 id="描述性统计"><a href="#描述性统计" class="headerlink" title="描述性统计"></a>描述性统计</h2><p><a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/reference/series.html#api-series-stats">Series</a> 与 <a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/reference/frame.html#api-dataframe-stats">DataFrame</a> 支持大量计算描述性统计的方法与操作。这些方法大部分都是 <a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.sum.html#pandas.DataFrame.sum" title="pandas.DataFrame.sum"><code>sum()</code></a>、<a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.mean.html#pandas.DataFrame.mean" title="pandas.DataFrame.mean"><code>mean()</code></a>、<a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.quantile.html#pandas.DataFrame.quantile" title="pandas.DataFrame.quantile"><code>quantile()</code></a> 等聚合函数，其输出结果比原始数据集小；此外，还有输出结果与原始数据集同样大小的 <a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.cumsum.html#pandas.DataFrame.cumsum" title="pandas.DataFrame.cumsum"><code>cumsum()</code></a> 、 <a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.cumprod.html#pandas.DataFrame.cumprod" title="pandas.DataFrame.cumprod"><code>cumprod()</code></a> 等函数。这些方法都基本上都接受 <code>axis</code> 参数，如， <code>ndarray.&#123;sum,std,…&#125;</code>，但这里的 <code>axis</code> 可以用名称或整数指定：</p><ul><li><strong>Series</strong>：无需 <code>axis</code> 参数</li><li><strong>DataFrame</strong>：<ul><li><code>index</code>，即 <code>axis=0</code>，默认值</li><li><code>columns</code>, 即 <code>axis=1</code></li></ul></li></ul><p>示例如下：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">77</span>]: df</span><br><span class="line">Out[<span class="number">77</span>]: </span><br><span class="line">        one       two     three</span><br><span class="line">a  <span class="number">1.394981</span>  <span class="number">1.772517</span>       NaN</span><br><span class="line">b  <span class="number">0.343054</span>  <span class="number">1.912123</span> -<span class="number">0.050390</span></span><br><span class="line">c  <span class="number">0.695246</span>  <span class="number">1.478369</span>  <span class="number">1.227435</span></span><br><span class="line">d       NaN  <span class="number">0.279344</span> -<span class="number">0.613172</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">78</span>]: df.mean(<span class="number">0</span>)</span><br><span class="line">Out[<span class="number">78</span>]: </span><br><span class="line">one      <span class="number">0.811094</span></span><br><span class="line">two      <span class="number">1.360588</span></span><br><span class="line">three    <span class="number">0.187958</span></span><br><span class="line">dtype: float64</span><br><span class="line"></span><br><span class="line">In [<span class="number">79</span>]: df.mean(<span class="number">1</span>)</span><br><span class="line">Out[<span class="number">79</span>]: </span><br><span class="line">a    <span class="number">1.583749</span></span><br><span class="line">b    <span class="number">0.734929</span></span><br><span class="line">c    <span class="number">1.133683</span></span><br><span class="line">d   -<span class="number">0.166914</span></span><br><span class="line">dtype: float64</span><br></pre></td></tr></table></figure><p>上述方法都支持 <code>skipna</code> 关键字，指定是否要排除缺失数据，默认值为 <code>True</code>。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">80</span>]: df.<span class="built_in">sum</span>(<span class="number">0</span>, skipna=<span class="literal">False</span>)</span><br><span class="line">Out[<span class="number">80</span>]: </span><br><span class="line">one           NaN</span><br><span class="line">two      <span class="number">5.442353</span></span><br><span class="line">three         NaN</span><br><span class="line">dtype: float64</span><br><span class="line"></span><br><span class="line">In [<span class="number">81</span>]: df.<span class="built_in">sum</span>(axis=<span class="number">1</span>, skipna=<span class="literal">True</span>)</span><br><span class="line">Out[<span class="number">81</span>]: </span><br><span class="line">a    <span class="number">3.167498</span></span><br><span class="line">b    <span class="number">2.204786</span></span><br><span class="line">c    <span class="number">3.401050</span></span><br><span class="line">d   -<span class="number">0.333828</span></span><br><span class="line">dtype: float64</span><br></pre></td></tr></table></figure><p>结合广播机制或算数操作，可以描述不同统计过程，比如标准化，即渲染数据零均值与标准差 1，这种操作非常简单：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">82</span>]: ts_stand = (df - df.mean()) / df.std()</span><br><span class="line"></span><br><span class="line">In [<span class="number">83</span>]: ts_stand.std()</span><br><span class="line">Out[<span class="number">83</span>]: </span><br><span class="line">one      <span class="number">1.0</span></span><br><span class="line">two      <span class="number">1.0</span></span><br><span class="line">three    <span class="number">1.0</span></span><br><span class="line">dtype: float64</span><br><span class="line"></span><br><span class="line">In [<span class="number">84</span>]: xs_stand = df.sub(df.mean(<span class="number">1</span>), axis=<span class="number">0</span>).div(df.std(<span class="number">1</span>), axis=<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">85</span>]: xs_stand.std(<span class="number">1</span>)</span><br><span class="line">Out[<span class="number">85</span>]: </span><br><span class="line">a    <span class="number">1.0</span></span><br><span class="line">b    <span class="number">1.0</span></span><br><span class="line">c    <span class="number">1.0</span></span><br><span class="line">d    <span class="number">1.0</span></span><br><span class="line">dtype: float64</span><br></pre></td></tr></table></figure><p>注 ： <a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.cumsum.html#pandas.DataFrame.cumsum"><code>cumsum()</code></a> 与 <a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.cumprod.html#pandas.DataFrame.cumprod"><code>cumprod()</code></a> 等方法保留 <code>NaN</code> 值的位置。这与 <a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.expanding.html#pandas.DataFrame.expanding"><code>expanding()</code></a> 和 <a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.rolling.html#pandas.DataFrame.rolling"><code>rolling()</code></a> 略显不同，详情请参阅<a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/user_guide/computation.html#stats-moments-expanding-note">本文</a>。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">86</span>]: df.cumsum()</span><br><span class="line">Out[<span class="number">86</span>]: </span><br><span class="line">        one       two     three</span><br><span class="line">a  <span class="number">1.394981</span>  <span class="number">1.772517</span>       NaN</span><br><span class="line">b  <span class="number">1.738035</span>  <span class="number">3.684640</span> -<span class="number">0.050390</span></span><br><span class="line">c  <span class="number">2.433281</span>  <span class="number">5.163008</span>  <span class="number">1.177045</span></span><br><span class="line">d       NaN  <span class="number">5.442353</span>  <span class="number">0.563873</span></span><br></pre></td></tr></table></figure><p>下表为常用函数汇总表。每个函数都支持 <code>level</code> 参数，仅在数据对象为<a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/user_guide/advanced.html#advanced-hierarchical">结构化 Index</a> 时使用。</p><table><thead><tr><th align="center">函数</th><th align="center">描述</th></tr></thead><tbody><tr><td align="center"><code>count</code></td><td align="center">统计非空值数量</td></tr><tr><td align="center"><code>sum</code></td><td align="center">汇总值</td></tr><tr><td align="center"><code>mean</code></td><td align="center">平均值</td></tr><tr><td align="center"><code>mad</code></td><td align="center">平均绝对偏差</td></tr><tr><td align="center"><code>median</code></td><td align="center">算数中位数</td></tr><tr><td align="center"><code>min</code></td><td align="center">最小值</td></tr><tr><td align="center"><code>max</code></td><td align="center">最大值</td></tr><tr><td align="center"><code>mode</code></td><td align="center">众数</td></tr><tr><td align="center"><code>abs</code></td><td align="center">绝对值</td></tr><tr><td align="center"><code>prod</code></td><td align="center">乘积</td></tr><tr><td align="center"><code>std</code></td><td align="center">贝塞尔校正的样本标准偏差</td></tr><tr><td align="center"><code>var</code></td><td align="center">无偏方差</td></tr><tr><td align="center"><code>sem</code></td><td align="center">平均值的标准误差</td></tr><tr><td align="center"><code>skew</code></td><td align="center">样本偏度 (第三阶)</td></tr><tr><td align="center"><code>kurt</code></td><td align="center">样本峰度 (第四阶)</td></tr><tr><td align="center"><code>quantile</code></td><td align="center">样本分位数 (不同 % 的值)</td></tr><tr><td align="center"><code>cumsum</code></td><td align="center">累加</td></tr><tr><td align="center"><code>cumprod</code></td><td align="center">累乘</td></tr><tr><td align="center"><code>cummax</code></td><td align="center">累积最大值</td></tr><tr><td align="center"><code>cummin</code></td><td align="center">累积最小值</td></tr></tbody></table><p>注意：NumPy 的 <code>mean</code>、<code>std</code>、<code>sum</code> 等方法默认不统计 Series 里的空值。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">87</span>]: np.mean(df[<span class="string">&#x27;one&#x27;</span>])</span><br><span class="line">Out[<span class="number">87</span>]: <span class="number">0.8110935116651192</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">88</span>]: np.mean(df[<span class="string">&#x27;one&#x27;</span>].to_numpy())</span><br><span class="line">Out[<span class="number">88</span>]: nan</span><br></pre></td></tr></table></figure><p><a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.Series.nunique.html#pandas.Series.nunique"><code>Series.nunique()</code></a> 返回 Series 里所有非空值的唯一值。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">89</span>]: series = pd.Series(np.random.randn(<span class="number">500</span>))</span><br><span class="line"></span><br><span class="line">In [<span class="number">90</span>]: series[<span class="number">20</span>:<span class="number">500</span>] = np.nan</span><br><span class="line"></span><br><span class="line">In [<span class="number">91</span>]: series[<span class="number">10</span>:<span class="number">20</span>] = <span class="number">5</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">92</span>]: series.nunique()</span><br><span class="line">Out[<span class="number">92</span>]: <span class="number">11</span></span><br></pre></td></tr></table></figure><h3 id="数据总结：describe"><a href="#数据总结：describe" class="headerlink" title="数据总结：describe"></a>数据总结：<code>describe</code></h3><p><a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.describe.html#pandas.DataFrame.describe"><code>describe()</code></a> 函数计算 Series 与 DataFrame 数据列的各种数据统计量，注意，这里排除了<strong>空值</strong>。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">93</span>]: series = pd.Series(np.random.randn(<span class="number">1000</span>))</span><br><span class="line"></span><br><span class="line">In [<span class="number">94</span>]: series[::<span class="number">2</span>] = np.nan</span><br><span class="line"></span><br><span class="line">In [<span class="number">95</span>]: series.describe()</span><br><span class="line">Out[<span class="number">95</span>]: </span><br><span class="line">count    <span class="number">500.000000</span></span><br><span class="line">mean      -<span class="number">0.021292</span></span><br><span class="line">std        <span class="number">1.015906</span></span><br><span class="line"><span class="built_in">min</span>       -<span class="number">2.683763</span></span><br><span class="line"><span class="number">25</span>%       -<span class="number">0.699070</span></span><br><span class="line"><span class="number">50</span>%       -<span class="number">0.069718</span></span><br><span class="line"><span class="number">75</span>%        <span class="number">0.714483</span></span><br><span class="line"><span class="built_in">max</span>        <span class="number">3.160915</span></span><br><span class="line">dtype: float64</span><br><span class="line"></span><br><span class="line">In [<span class="number">96</span>]: frame = pd.DataFrame(np.random.randn(<span class="number">1000</span>, <span class="number">5</span>),</span><br><span class="line">   ....:                      columns=[<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;c&#x27;</span>, <span class="string">&#x27;d&#x27;</span>, <span class="string">&#x27;e&#x27;</span>])</span><br><span class="line">   ....: </span><br><span class="line"></span><br><span class="line">In [<span class="number">97</span>]: frame.iloc[::<span class="number">2</span>] = np.nan</span><br><span class="line"></span><br><span class="line">In [<span class="number">98</span>]: frame.describe()</span><br><span class="line">Out[<span class="number">98</span>]: </span><br><span class="line">                a           b           c           d           e</span><br><span class="line">count  <span class="number">500.000000</span>  <span class="number">500.000000</span>  <span class="number">500.000000</span>  <span class="number">500.000000</span>  <span class="number">500.000000</span></span><br><span class="line">mean     <span class="number">0.033387</span>    <span class="number">0.030045</span>   -<span class="number">0.043719</span>   -<span class="number">0.051686</span>    <span class="number">0.005979</span></span><br><span class="line">std      <span class="number">1.017152</span>    <span class="number">0.978743</span>    <span class="number">1.025270</span>    <span class="number">1.015988</span>    <span class="number">1.006695</span></span><br><span class="line"><span class="built_in">min</span>     -<span class="number">3.000951</span>   -<span class="number">2.637901</span>   -<span class="number">3.303099</span>   -<span class="number">3.159200</span>   -<span class="number">3.188821</span></span><br><span class="line"><span class="number">25</span>%     -<span class="number">0.647623</span>   -<span class="number">0.576449</span>   -<span class="number">0.712369</span>   -<span class="number">0.691338</span>   -<span class="number">0.691115</span></span><br><span class="line"><span class="number">50</span>%      <span class="number">0.047578</span>   -<span class="number">0.021499</span>   -<span class="number">0.023888</span>   -<span class="number">0.032652</span>   -<span class="number">0.025363</span></span><br><span class="line"><span class="number">75</span>%      <span class="number">0.729907</span>    <span class="number">0.775880</span>    <span class="number">0.618896</span>    <span class="number">0.670047</span>    <span class="number">0.649748</span></span><br><span class="line"><span class="built_in">max</span>      <span class="number">2.740139</span>    <span class="number">2.752332</span>    <span class="number">3.004229</span>    <span class="number">2.728702</span>    <span class="number">3.240991</span></span><br></pre></td></tr></table></figure><p>此外，还可以指定输出结果包含的分位数：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">99</span>]: series.describe(percentiles=[<span class="number">.05</span>, <span class="number">.25</span>, <span class="number">.75</span>, <span class="number">.95</span>])</span><br><span class="line">Out[<span class="number">99</span>]: </span><br><span class="line">count    <span class="number">500.000000</span></span><br><span class="line">mean      -<span class="number">0.021292</span></span><br><span class="line">std        <span class="number">1.015906</span></span><br><span class="line"><span class="built_in">min</span>       -<span class="number">2.683763</span></span><br><span class="line"><span class="number">5</span>%        -<span class="number">1.645423</span></span><br><span class="line"><span class="number">25</span>%       -<span class="number">0.699070</span></span><br><span class="line"><span class="number">50</span>%       -<span class="number">0.069718</span></span><br><span class="line"><span class="number">75</span>%        <span class="number">0.714483</span></span><br><span class="line"><span class="number">95</span>%        <span class="number">1.711409</span></span><br><span class="line"><span class="built_in">max</span>        <span class="number">3.160915</span></span><br><span class="line">dtype: float64</span><br></pre></td></tr></table></figure><p>一般情况下，默认值包含<strong>中位数</strong>。</p><p>对于非数值型 Series 对象， <a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.Series.describe.html#pandas.Series.describe"><code>describe()</code></a> 返回值的总数、唯一值数量、出现次数最多的值及出现的次数。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">100</span>]: s = pd.Series([<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;a&#x27;</span>, np.nan, <span class="string">&#x27;c&#x27;</span>, <span class="string">&#x27;d&#x27;</span>, <span class="string">&#x27;a&#x27;</span>])</span><br><span class="line"></span><br><span class="line">In [<span class="number">101</span>]: s.describe()</span><br><span class="line">Out[<span class="number">101</span>]: </span><br><span class="line">count     <span class="number">9</span></span><br><span class="line">unique    <span class="number">4</span></span><br><span class="line">top       a</span><br><span class="line">freq      <span class="number">5</span></span><br><span class="line">dtype: <span class="built_in">object</span></span><br></pre></td></tr></table></figure><p>注意：对于混合型的 DataFrame 对象， <a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.Series.describe.html#pandas.Series.describe"><code>describe()</code></a> 只返回数值列的汇总统计量，如果没有数值列，则只显示类别型的列。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">102</span>]: frame = pd.DataFrame(&#123;<span class="string">&#x27;a&#x27;</span>: [<span class="string">&#x27;Yes&#x27;</span>, <span class="string">&#x27;Yes&#x27;</span>, <span class="string">&#x27;No&#x27;</span>, <span class="string">&#x27;No&#x27;</span>], <span class="string">&#x27;b&#x27;</span>: <span class="built_in">range</span>(<span class="number">4</span>)&#125;)</span><br><span class="line"></span><br><span class="line">In [<span class="number">103</span>]: frame.describe()</span><br><span class="line">Out[<span class="number">103</span>]: </span><br><span class="line">              b</span><br><span class="line">count  <span class="number">4.000000</span></span><br><span class="line">mean   <span class="number">1.500000</span></span><br><span class="line">std    <span class="number">1.290994</span></span><br><span class="line"><span class="built_in">min</span>    <span class="number">0.000000</span></span><br><span class="line"><span class="number">25</span>%    <span class="number">0.750000</span></span><br><span class="line"><span class="number">50</span>%    <span class="number">1.500000</span></span><br><span class="line"><span class="number">75</span>%    <span class="number">2.250000</span></span><br><span class="line"><span class="built_in">max</span>    <span class="number">3.000000</span></span><br></pre></td></tr></table></figure><p><code>include/exclude</code> 参数的值为列表，用该参数可以控制包含或排除的数据类型。这里还有一个特殊值，<code>all</code>：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">104</span>]: frame.describe(include=[<span class="string">&#x27;object&#x27;</span>])</span><br><span class="line">Out[<span class="number">104</span>]: </span><br><span class="line">          a</span><br><span class="line">count     <span class="number">4</span></span><br><span class="line">unique    <span class="number">2</span></span><br><span class="line">top     Yes</span><br><span class="line">freq      <span class="number">2</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">105</span>]: frame.describe(include=[<span class="string">&#x27;number&#x27;</span>])</span><br><span class="line">Out[<span class="number">105</span>]: </span><br><span class="line">              b</span><br><span class="line">count  <span class="number">4.000000</span></span><br><span class="line">mean   <span class="number">1.500000</span></span><br><span class="line">std    <span class="number">1.290994</span></span><br><span class="line"><span class="built_in">min</span>    <span class="number">0.000000</span></span><br><span class="line"><span class="number">25</span>%    <span class="number">0.750000</span></span><br><span class="line"><span class="number">50</span>%    <span class="number">1.500000</span></span><br><span class="line"><span class="number">75</span>%    <span class="number">2.250000</span></span><br><span class="line"><span class="built_in">max</span>    <span class="number">3.000000</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">106</span>]: frame.describe(include=<span class="string">&#x27;all&#x27;</span>)</span><br><span class="line">Out[<span class="number">106</span>]: </span><br><span class="line">          a         b</span><br><span class="line">count     <span class="number">4</span>  <span class="number">4.000000</span></span><br><span class="line">unique    <span class="number">2</span>       NaN</span><br><span class="line">top     Yes       NaN</span><br><span class="line">freq      <span class="number">2</span>       NaN</span><br><span class="line">mean    NaN  <span class="number">1.500000</span></span><br><span class="line">std     NaN  <span class="number">1.290994</span></span><br><span class="line"><span class="built_in">min</span>     NaN  <span class="number">0.000000</span></span><br><span class="line"><span class="number">25</span>%     NaN  <span class="number">0.750000</span></span><br><span class="line"><span class="number">50</span>%     NaN  <span class="number">1.500000</span></span><br><span class="line"><span class="number">75</span>%     NaN  <span class="number">2.250000</span></span><br><span class="line"><span class="built_in">max</span>     NaN  <span class="number">3.000000</span></span><br></pre></td></tr></table></figure><p>本功能依托于 <a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/getting_started/basics.html#basics-selectdtypes"><code>select_dtypes</code></a>，要了解该参数接受哪些输入内容请参阅<a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/getting_started/basics.html#basics-selectdtypes">本文</a>。</p><h3 id="最大值与最小值对应的索引"><a href="#最大值与最小值对应的索引" class="headerlink" title="最大值与最小值对应的索引"></a>最大值与最小值对应的索引</h3><p>Series 与 DataFrame 的 <a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.idxmax.html#pandas.DataFrame.idxmax"><code>idxmax()</code></a> 与 <a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.idxmin.html#pandas.DataFrame.idxmin"><code>idxmin()</code></a> 函数计算最大值与最小值对应的索引。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">107</span>]: s1 = pd.Series(np.random.randn(<span class="number">5</span>))</span><br><span class="line"></span><br><span class="line">In [<span class="number">108</span>]: s1</span><br><span class="line">Out[<span class="number">108</span>]: </span><br><span class="line"><span class="number">0</span>    <span class="number">1.118076</span></span><br><span class="line"><span class="number">1</span>   -<span class="number">0.352051</span></span><br><span class="line"><span class="number">2</span>   -<span class="number">1.242883</span></span><br><span class="line"><span class="number">3</span>   -<span class="number">1.277155</span></span><br><span class="line"><span class="number">4</span>   -<span class="number">0.641184</span></span><br><span class="line">dtype: float64</span><br><span class="line"></span><br><span class="line">In [<span class="number">109</span>]: s1.idxmin(), s1.idxmax()</span><br><span class="line">Out[<span class="number">109</span>]: (<span class="number">3</span>, <span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">110</span>]: df1 = pd.DataFrame(np.random.randn(<span class="number">5</span>, <span class="number">3</span>), columns=[<span class="string">&#x27;A&#x27;</span>, <span class="string">&#x27;B&#x27;</span>, <span class="string">&#x27;C&#x27;</span>])</span><br><span class="line"></span><br><span class="line">In [<span class="number">111</span>]: df1</span><br><span class="line">Out[<span class="number">111</span>]: </span><br><span class="line">          A         B         C</span><br><span class="line"><span class="number">0</span> -<span class="number">0.327863</span> -<span class="number">0.946180</span> -<span class="number">0.137570</span></span><br><span class="line"><span class="number">1</span> -<span class="number">0.186235</span> -<span class="number">0.257213</span> -<span class="number">0.486567</span></span><br><span class="line"><span class="number">2</span> -<span class="number">0.507027</span> -<span class="number">0.871259</span> -<span class="number">0.111110</span></span><br><span class="line"><span class="number">3</span>  <span class="number">2.000339</span> -<span class="number">2.430505</span>  <span class="number">0.089759</span></span><br><span class="line"><span class="number">4</span> -<span class="number">0.321434</span> -<span class="number">0.033695</span>  <span class="number">0.096271</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">112</span>]: df1.idxmin(axis=<span class="number">0</span>)</span><br><span class="line">Out[<span class="number">112</span>]: </span><br><span class="line">A    <span class="number">2</span></span><br><span class="line">B    <span class="number">3</span></span><br><span class="line">C    <span class="number">1</span></span><br><span class="line">dtype: int64</span><br><span class="line"></span><br><span class="line">In [<span class="number">113</span>]: df1.idxmax(axis=<span class="number">1</span>)</span><br><span class="line">Out[<span class="number">113</span>]: </span><br><span class="line"><span class="number">0</span>    C</span><br><span class="line"><span class="number">1</span>    A</span><br><span class="line"><span class="number">2</span>    C</span><br><span class="line"><span class="number">3</span>    A</span><br><span class="line"><span class="number">4</span>    C</span><br><span class="line">dtype: <span class="built_in">object</span></span><br></pre></td></tr></table></figure><p>多行或多列中存在多个最大值或最小值时，<a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.idxmax.html#pandas.DataFrame.idxmax"><code>idxmax()</code></a> 与 <a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.idxmin.html#pandas.DataFrame.idxmin"><code>idxmin()</code></a> 只返回匹配到的第一个值的 <code>Index</code>：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">114</span>]: df3 = pd.DataFrame([<span class="number">2</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">3</span>, np.nan], columns=[<span class="string">&#x27;A&#x27;</span>], index=<span class="built_in">list</span>(<span class="string">&#x27;edcba&#x27;</span>))</span><br><span class="line"></span><br><span class="line">In [<span class="number">115</span>]: df3</span><br><span class="line">Out[<span class="number">115</span>]: </span><br><span class="line">     A</span><br><span class="line">e  <span class="number">2.0</span></span><br><span class="line">d  <span class="number">1.0</span></span><br><span class="line">c  <span class="number">1.0</span></span><br><span class="line">b  <span class="number">3.0</span></span><br><span class="line">a  NaN</span><br><span class="line"></span><br><span class="line">In [<span class="number">116</span>]: df3[<span class="string">&#x27;A&#x27;</span>].idxmin()</span><br><span class="line">Out[<span class="number">116</span>]: <span class="string">&#x27;d&#x27;</span></span><br></pre></td></tr></table></figure><p>::: tip 注意</p><p><code>idxmin</code> 与 <code>idxmax</code> 对应 NumPy 里的 <code>argmin</code> 与 <code>argmax</code>。</p><h3 id="值计数（直方图）与众数"><a href="#值计数（直方图）与众数" class="headerlink" title="值计数（直方图）与众数"></a>值计数（直方图）与众数</h3><p>Series 的 <a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.Series.value_counts.html#pandas.Series.value_counts"><code>value_counts()</code></a> 方法及顶级函数计算一维数组中数据值的直方图，还可以用作常规数组的函数：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">117</span>]: data = np.random.randint(<span class="number">0</span>, <span class="number">7</span>, size=<span class="number">50</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">118</span>]: data</span><br><span class="line">Out[<span class="number">118</span>]: </span><br><span class="line">array([<span class="number">6</span>, <span class="number">6</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">5</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">4</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">4</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">3</span>, <span class="number">2</span>,</span><br><span class="line">       <span class="number">2</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">5</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">6</span>, <span class="number">4</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">4</span>, <span class="number">3</span>, <span class="number">6</span>, <span class="number">2</span>, <span class="number">6</span>, <span class="number">6</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">2</span>, <span class="number">1</span>,</span><br><span class="line">       <span class="number">6</span>, <span class="number">2</span>, <span class="number">6</span>, <span class="number">1</span>, <span class="number">5</span>, <span class="number">4</span>])</span><br><span class="line"></span><br><span class="line">In [<span class="number">119</span>]: s = pd.Series(data)</span><br><span class="line"></span><br><span class="line">In [<span class="number">120</span>]: s.value_counts()</span><br><span class="line">Out[<span class="number">120</span>]: </span><br><span class="line"><span class="number">6</span>    <span class="number">10</span></span><br><span class="line"><span class="number">2</span>    <span class="number">10</span></span><br><span class="line"><span class="number">4</span>     <span class="number">9</span></span><br><span class="line"><span class="number">5</span>     <span class="number">8</span></span><br><span class="line"><span class="number">3</span>     <span class="number">8</span></span><br><span class="line"><span class="number">0</span>     <span class="number">3</span></span><br><span class="line"><span class="number">1</span>     <span class="number">2</span></span><br><span class="line">dtype: int64</span><br><span class="line"></span><br><span class="line">In [<span class="number">121</span>]: pd.value_counts(data)</span><br><span class="line">Out[<span class="number">121</span>]: </span><br><span class="line"><span class="number">6</span>    <span class="number">10</span></span><br><span class="line"><span class="number">2</span>    <span class="number">10</span></span><br><span class="line"><span class="number">4</span>     <span class="number">9</span></span><br><span class="line"><span class="number">5</span>     <span class="number">8</span></span><br><span class="line"><span class="number">3</span>     <span class="number">8</span></span><br><span class="line"><span class="number">0</span>     <span class="number">3</span></span><br><span class="line"><span class="number">1</span>     <span class="number">2</span></span><br><span class="line">dtype: int64</span><br></pre></td></tr></table></figure><p>与上述操作类似，还可以统计 Series 或 DataFrame 的众数，即出现频率最高的值：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">122</span>]: s5 = pd.Series([<span class="number">1</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">3</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">5</span>, <span class="number">7</span>, <span class="number">7</span>, <span class="number">7</span>])</span><br><span class="line"></span><br><span class="line">In [<span class="number">123</span>]: s5.mode()</span><br><span class="line">Out[<span class="number">123</span>]: </span><br><span class="line"><span class="number">0</span>    <span class="number">3</span></span><br><span class="line"><span class="number">1</span>    <span class="number">7</span></span><br><span class="line">dtype: int64</span><br><span class="line"></span><br><span class="line">In [<span class="number">124</span>]: df5 = pd.DataFrame(&#123;<span class="string">&quot;A&quot;</span>: np.random.randint(<span class="number">0</span>, <span class="number">7</span>, size=<span class="number">50</span>),</span><br><span class="line">   .....:                     <span class="string">&quot;B&quot;</span>: np.random.randint(-<span class="number">10</span>, <span class="number">15</span>, size=<span class="number">50</span>)&#125;)</span><br><span class="line">   .....: </span><br><span class="line"></span><br><span class="line">In [<span class="number">125</span>]: df5.mode()</span><br><span class="line">Out[<span class="number">125</span>]: </span><br><span class="line">     A   B</span><br><span class="line"><span class="number">0</span>  <span class="number">1.0</span>  -<span class="number">9</span></span><br><span class="line"><span class="number">1</span>  NaN  <span class="number">10</span></span><br><span class="line"><span class="number">2</span>  NaN  <span class="number">13</span></span><br></pre></td></tr></table></figure><h3 id="离散化与分位数"><a href="#离散化与分位数" class="headerlink" title="离散化与分位数"></a>离散化与分位数</h3><p><a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.cut.html#pandas.cut"><code>cut() 函数</code></a>（以值为依据实现分箱）及 <a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.qcut.html#pandas.qcut"><code>qcut() 函数</code></a>（以样本分位数为依据实现分箱）用于连续值的离散化：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">126</span>]: arr = np.random.randn(<span class="number">20</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">127</span>]: factor = pd.cut(arr, <span class="number">4</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">128</span>]: factor</span><br><span class="line">Out[<span class="number">128</span>]: </span><br><span class="line">[(-<span class="number">0.251</span>, <span class="number">0.464</span>], (-<span class="number">0.968</span>, -<span class="number">0.251</span>], (<span class="number">0.464</span>, <span class="number">1.179</span>], (-<span class="number">0.251</span>, <span class="number">0.464</span>], (-<span class="number">0.968</span>, -<span class="number">0.251</span>], ..., (-<span class="number">0.251</span>, <span class="number">0.464</span>], (-<span class="number">0.968</span>, -<span class="number">0.251</span>], (-<span class="number">0.968</span>, -<span class="number">0.251</span>], (-<span class="number">0.968</span>, -<span class="number">0.251</span>], (-<span class="number">0.968</span>, -<span class="number">0.251</span>]]</span><br><span class="line">Length: <span class="number">20</span></span><br><span class="line">Categories (<span class="number">4</span>, interval[float64]): [(-<span class="number">0.968</span>, -<span class="number">0.251</span>] &lt; (-<span class="number">0.251</span>, <span class="number">0.464</span>] &lt; (<span class="number">0.464</span>, <span class="number">1.179</span>] &lt;</span><br><span class="line">                                    (<span class="number">1.179</span>, <span class="number">1.893</span>]]</span><br><span class="line"></span><br><span class="line">In [<span class="number">129</span>]: factor = pd.cut(arr, [-<span class="number">5</span>, -<span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">5</span>])</span><br><span class="line"></span><br><span class="line">In [<span class="number">130</span>]: factor</span><br><span class="line">Out[<span class="number">130</span>]: </span><br><span class="line">[(<span class="number">0</span>, <span class="number">1</span>], (-<span class="number">1</span>, <span class="number">0</span>], (<span class="number">0</span>, <span class="number">1</span>], (<span class="number">0</span>, <span class="number">1</span>], (-<span class="number">1</span>, <span class="number">0</span>], ..., (-<span class="number">1</span>, <span class="number">0</span>], (-<span class="number">1</span>, <span class="number">0</span>], (-<span class="number">1</span>, <span class="number">0</span>], (-<span class="number">1</span>, <span class="number">0</span>], (-<span class="number">1</span>, <span class="number">0</span>]]</span><br><span class="line">Length: <span class="number">20</span></span><br><span class="line">Categories (<span class="number">4</span>, interval[int64]): [(-<span class="number">5</span>, -<span class="number">1</span>] &lt; (-<span class="number">1</span>, <span class="number">0</span>] &lt; (<span class="number">0</span>, <span class="number">1</span>] &lt; (<span class="number">1</span>, <span class="number">5</span>]]</span><br></pre></td></tr></table></figure><p><a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.qcut.html#pandas.qcut"><code>qcut()</code></a> 计算样本分位数。比如，下列代码按等距分位数分割正态分布的数据：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">131</span>]: arr = np.random.randn(<span class="number">30</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">132</span>]: factor = pd.qcut(arr, [<span class="number">0</span>, <span class="number">.25</span>, <span class="number">.5</span>, <span class="number">.75</span>, <span class="number">1</span>])</span><br><span class="line"></span><br><span class="line">In [<span class="number">133</span>]: factor</span><br><span class="line">Out[<span class="number">133</span>]: </span><br><span class="line">[(<span class="number">0.569</span>, <span class="number">1.184</span>], (-<span class="number">2.278</span>, -<span class="number">0.301</span>], (-<span class="number">2.278</span>, -<span class="number">0.301</span>], (<span class="number">0.569</span>, <span class="number">1.184</span>], (<span class="number">0.569</span>, <span class="number">1.184</span>], ..., (-<span class="number">0.301</span>, <span class="number">0.569</span>], (<span class="number">1.184</span>, <span class="number">2.346</span>], (<span class="number">1.184</span>, <span class="number">2.346</span>], (-<span class="number">0.301</span>, <span class="number">0.569</span>], (-<span class="number">2.278</span>, -<span class="number">0.301</span>]]</span><br><span class="line">Length: <span class="number">30</span></span><br><span class="line">Categories (<span class="number">4</span>, interval[float64]): [(-<span class="number">2.278</span>, -<span class="number">0.301</span>] &lt; (-<span class="number">0.301</span>, <span class="number">0.569</span>] &lt; (<span class="number">0.569</span>, <span class="number">1.184</span>] &lt;</span><br><span class="line">                                    (<span class="number">1.184</span>, <span class="number">2.346</span>]]</span><br><span class="line"></span><br><span class="line">In [<span class="number">134</span>]: pd.value_counts(factor)</span><br><span class="line">Out[<span class="number">134</span>]: </span><br><span class="line">(<span class="number">1.184</span>, <span class="number">2.346</span>]      <span class="number">8</span></span><br><span class="line">(-<span class="number">2.278</span>, -<span class="number">0.301</span>]    <span class="number">8</span></span><br><span class="line">(<span class="number">0.569</span>, <span class="number">1.184</span>]      <span class="number">7</span></span><br><span class="line">(-<span class="number">0.301</span>, <span class="number">0.569</span>]     <span class="number">7</span></span><br><span class="line">dtype: int64</span><br></pre></td></tr></table></figure><p>定义分箱时，还可以传递无穷值：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">135</span>]: arr = np.random.randn(<span class="number">20</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">136</span>]: factor = pd.cut(arr, [-np.inf, <span class="number">0</span>, np.inf])</span><br><span class="line"></span><br><span class="line">In [<span class="number">137</span>]: factor</span><br><span class="line">Out[<span class="number">137</span>]: </span><br><span class="line">[(-inf, <span class="number">0.0</span>], (<span class="number">0.0</span>, inf], (<span class="number">0.0</span>, inf], (-inf, <span class="number">0.0</span>], (-inf, <span class="number">0.0</span>], ..., (-inf, <span class="number">0.0</span>], (-inf, <span class="number">0.0</span>], (-inf, <span class="number">0.0</span>], (<span class="number">0.0</span>, inf], (<span class="number">0.0</span>, inf]]</span><br><span class="line">Length: <span class="number">20</span></span><br><span class="line">Categories (<span class="number">2</span>, interval[float64]): [(-inf, <span class="number">0.0</span>] &lt; (<span class="number">0.0</span>, inf]]</span><br></pre></td></tr></table></figure><h2 id="函数应用"><a href="#函数应用" class="headerlink" title="函数应用"></a>函数应用</h2><p>不管是为 Pandas 对象应用自定义函数，还是应用第三方函数，都离不开以下三种方法。用哪种方法取决于操作的对象是 <code>DataFrame</code>，还是 <code>Series</code> ；是行、列，还是元素。</p><ol><li><p>表级函数应用：<a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.pipe.html#pandas.DataFrame.pipe"><code>pipe()</code></a></p></li><li><p>行列级函数应用： <a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.apply.html#pandas.DataFrame.apply"><code>apply()</code></a></p></li><li><p>聚合 API： <a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.agg.html#pandas.DataFrame.agg"><code>agg()</code></a> 与 <a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.transform.html#pandas.DataFrame.transform"><code>transform()</code></a></p></li><li><p>元素级函数应用：<a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.applymap.html#pandas.DataFrame.applymap"><code>applymap()</code></a></p></li></ol><h3 id="表级函数应用"><a href="#表级函数应用" class="headerlink" title="表级函数应用"></a>表级函数应用</h3><p>虽然可以把 DataFrame 与 Series 传递给函数，不过链式调用函数时，最好使用 <a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.pipe.html#pandas.DataFrame.pipe"><code>pipe()</code></a> 方法。对比以下两种方式：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># f、g、h 是提取、返回 `DataFrames` 的函数</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>f(g(h(df), arg1=<span class="number">1</span>), arg2=<span class="number">2</span>, arg3=<span class="number">3</span>)</span><br></pre></td></tr></table></figure><p>下列代码与上述代码等效：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>(df.pipe(h)</span><br><span class="line"><span class="meta">... </span>   .pipe(g, arg1=<span class="number">1</span>)</span><br><span class="line"><span class="meta">... </span>   .pipe(f, arg2=<span class="number">2</span>, arg3=<span class="number">3</span>))</span><br></pre></td></tr></table></figure><p>Pandas 鼓励使用第二种方式，即链式方法。在链式方法中调用自定义函数或第三方支持库函数时，用 <code>pipe</code> 更容易，与用 Pandas 自身方法一样。</p><p>上例中，<code>f</code>、<code>g</code> 与 <code>h</code> 这几个函数都把 <code>DataFrame</code> 当作首位参数。要是想把数据作为第二个参数，该怎么办？本例中，<code>pipe</code> 为元组 （<code>callable,data_keyword</code>）形式。<code>.pipe</code> 把 <code>DataFrame</code> 作为元组里指定的参数。</p><p>下例用 statsmodels 拟合回归。该 API 先接收一个公式，<code>DataFrame</code> 是第二个参数，<code>data</code>。要传递函数，则要用<code>pipe</code> 接收关键词对 (<code>sm.ols,&#39;data&#39;</code>)。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">138</span>]: <span class="keyword">import</span> statsmodels.formula.api <span class="keyword">as</span> sm</span><br><span class="line"></span><br><span class="line">In [<span class="number">139</span>]: bb = pd.read_csv(<span class="string">&#x27;data/baseball.csv&#x27;</span>, index_col=<span class="string">&#x27;id&#x27;</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">140</span>]: (bb.query(<span class="string">&#x27;h &gt; 0&#x27;</span>)</span><br><span class="line">   .....:    .assign(ln_h=<span class="keyword">lambda</span> df: np.log(df.h))</span><br><span class="line">   .....:    .pipe((sm.ols, <span class="string">&#x27;data&#x27;</span>), <span class="string">&#x27;hr ~ ln_h + year + g + C(lg)&#x27;</span>)</span><br><span class="line">   .....:    .fit()</span><br><span class="line">   .....:    .summary()</span><br><span class="line">   .....:  )</span><br><span class="line">   .....: </span><br><span class="line">Out[<span class="number">140</span>]: </span><br><span class="line">&lt;<span class="class"><span class="keyword">class</span> &#x27;<span class="title">statsmodels</span>.<span class="title">iolib</span>.<span class="title">summary</span>.<span class="title">Summary</span>&#x27;&gt;</span></span><br><span class="line"><span class="class">&quot;&quot;&quot;</span></span><br><span class="line"><span class="class">                            <span class="title">OLS</span> <span class="title">Regression</span> <span class="title">Results</span>                            </span></span><br><span class="line"><span class="class">==============================================================================</span></span><br><span class="line"><span class="class"><span class="title">Dep</span>. <span class="title">Variable</span>:</span>                     hr   R-squared:                       <span class="number">0.685</span></span><br><span class="line">Model:                            OLS   Adj. R-squared:                  <span class="number">0.665</span></span><br><span class="line">Method:                 Least Squares   F-statistic:                     <span class="number">34.28</span></span><br><span class="line">Date:                Thu, <span class="number">22</span> Aug <span class="number">2019</span>   Prob (F-statistic):           <span class="number">3.48e-15</span></span><br><span class="line">Time:                        <span class="number">15</span>:<span class="number">48</span>:<span class="number">59</span>   Log-Likelihood:                -<span class="number">205.92</span></span><br><span class="line">No. Observations:                  <span class="number">68</span>   AIC:                             <span class="number">421.8</span></span><br><span class="line">Df Residuals:                      <span class="number">63</span>   BIC:                             <span class="number">432.9</span></span><br><span class="line">Df Model:                           <span class="number">4</span>                                         </span><br><span class="line">Covariance <span class="type">Type</span>:            nonrobust                                         </span><br><span class="line">===============================================================================</span><br><span class="line">                  coef    std err          t      P&gt;|t|      [<span class="number">0.025</span>      <span class="number">0.975</span>]</span><br><span class="line">-------------------------------------------------------------------------------</span><br><span class="line">Intercept   -<span class="number">8484.7720</span>   <span class="number">4664.146</span>     -<span class="number">1.819</span>      <span class="number">0.074</span>   -<span class="number">1.78e+04</span>     <span class="number">835.780</span></span><br><span class="line">C(lg)[T.NL]    -<span class="number">2.2736</span>      <span class="number">1.325</span>     -<span class="number">1.716</span>      <span class="number">0.091</span>      -<span class="number">4.922</span>       <span class="number">0.375</span></span><br><span class="line">ln_h           -<span class="number">1.3542</span>      <span class="number">0.875</span>     -<span class="number">1.547</span>      <span class="number">0.127</span>      -<span class="number">3.103</span>       <span class="number">0.395</span></span><br><span class="line">year            <span class="number">4.2277</span>      <span class="number">2.324</span>      <span class="number">1.819</span>      <span class="number">0.074</span>      -<span class="number">0.417</span>       <span class="number">8.872</span></span><br><span class="line">g               <span class="number">0.1841</span>      <span class="number">0.029</span>      <span class="number">6.258</span>      <span class="number">0.000</span>       <span class="number">0.125</span>       <span class="number">0.243</span></span><br><span class="line">==============================================================================</span><br><span class="line">Omnibus:                       <span class="number">10.875</span>   Durbin-Watson:                   <span class="number">1.999</span></span><br><span class="line">Prob(Omnibus):                  <span class="number">0.004</span>   Jarque-Bera (JB):               <span class="number">17.298</span></span><br><span class="line">Skew:                           <span class="number">0.537</span>   Prob(JB):                     <span class="number">0.000175</span></span><br><span class="line">Kurtosis:                       <span class="number">5.225</span>   Cond. No.                     <span class="number">1.49e+07</span></span><br><span class="line">==============================================================================</span><br><span class="line"></span><br><span class="line">Warnings:</span><br><span class="line">[<span class="number">1</span>] Standard Errors assume that the covariance matrix of the errors <span class="keyword">is</span> correctly specified.</span><br><span class="line">[<span class="number">2</span>] The condition number <span class="keyword">is</span> large, <span class="number">1.49e+07</span>. This might indicate that there are</span><br><span class="line">strong multicollinearity <span class="keyword">or</span> other numerical problems.</span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure><p>unix 的 <code>pipe</code> 与后来出现的 <a target="_blank" rel="noopener" href="https://github.com/hadley/dplyr">dplyr</a> 及 <a target="_blank" rel="noopener" href="https://github.com/smbache/magrittr">magrittr</a> 启发了<code>pipe</code> 方法，在此，引入了 R 语言里用于读取 pipe 的操作符 (<code>%&gt;%</code>)。<code>pipe</code> 的实现思路非常清晰，仿佛 Python 源生的一样。强烈建议大家阅读 <a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.pipe.html#pandas.DataFrame.pipe"><code>pipe()</code></a> 的源代码。</p><h3 id="行列级函数应用"><a href="#行列级函数应用" class="headerlink" title="行列级函数应用"></a>行列级函数应用</h3><p><a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.apply.html#pandas.DataFrame.apply"><code>apply()</code></a> 方法沿着 DataFrame 的轴应用函数，比如，描述性统计方法，该方法支持 <code>axis</code> 参数。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">141</span>]: df.apply(np.mean)</span><br><span class="line">Out[<span class="number">141</span>]: </span><br><span class="line">one      <span class="number">0.811094</span></span><br><span class="line">two      <span class="number">1.360588</span></span><br><span class="line">three    <span class="number">0.187958</span></span><br><span class="line">dtype: float64</span><br><span class="line"></span><br><span class="line">In [<span class="number">142</span>]: df.apply(np.mean, axis=<span class="number">1</span>)</span><br><span class="line">Out[<span class="number">142</span>]: </span><br><span class="line">a    <span class="number">1.583749</span></span><br><span class="line">b    <span class="number">0.734929</span></span><br><span class="line">c    <span class="number">1.133683</span></span><br><span class="line">d   -<span class="number">0.166914</span></span><br><span class="line">dtype: float64</span><br><span class="line"></span><br><span class="line">In [<span class="number">143</span>]: df.apply(<span class="keyword">lambda</span> x: x.<span class="built_in">max</span>() - x.<span class="built_in">min</span>())</span><br><span class="line">Out[<span class="number">143</span>]: </span><br><span class="line">one      <span class="number">1.051928</span></span><br><span class="line">two      <span class="number">1.632779</span></span><br><span class="line">three    <span class="number">1.840607</span></span><br><span class="line">dtype: float64</span><br><span class="line"></span><br><span class="line">In [<span class="number">144</span>]: df.apply(np.cumsum)</span><br><span class="line">Out[<span class="number">144</span>]: </span><br><span class="line">        one       two     three</span><br><span class="line">a  <span class="number">1.394981</span>  <span class="number">1.772517</span>       NaN</span><br><span class="line">b  <span class="number">1.738035</span>  <span class="number">3.684640</span> -<span class="number">0.050390</span></span><br><span class="line">c  <span class="number">2.433281</span>  <span class="number">5.163008</span>  <span class="number">1.177045</span></span><br><span class="line">d       NaN  <span class="number">5.442353</span>  <span class="number">0.563873</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">145</span>]: df.apply(np.exp)</span><br><span class="line">Out[<span class="number">145</span>]: </span><br><span class="line">        one       two     three</span><br><span class="line">a  <span class="number">4.034899</span>  <span class="number">5.885648</span>       NaN</span><br><span class="line">b  <span class="number">1.409244</span>  <span class="number">6.767440</span>  <span class="number">0.950858</span></span><br><span class="line">c  <span class="number">2.004201</span>  <span class="number">4.385785</span>  <span class="number">3.412466</span></span><br><span class="line">d       NaN  <span class="number">1.322262</span>  <span class="number">0.541630</span></span><br></pre></td></tr></table></figure><p><a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.apply.html#pandas.DataFrame.apply"><code>apply()</code></a> 方法还支持通过函数名字符串调用函数。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">146</span>]: df.apply(<span class="string">&#x27;mean&#x27;</span>)</span><br><span class="line">Out[<span class="number">146</span>]: </span><br><span class="line">one      <span class="number">0.811094</span></span><br><span class="line">two      <span class="number">1.360588</span></span><br><span class="line">three    <span class="number">0.187958</span></span><br><span class="line">dtype: float64</span><br><span class="line"></span><br><span class="line">In [<span class="number">147</span>]: df.apply(<span class="string">&#x27;mean&#x27;</span>, axis=<span class="number">1</span>)</span><br><span class="line">Out[<span class="number">147</span>]: </span><br><span class="line">a    <span class="number">1.583749</span></span><br><span class="line">b    <span class="number">0.734929</span></span><br><span class="line">c    <span class="number">1.133683</span></span><br><span class="line">d   -<span class="number">0.166914</span></span><br><span class="line">dtype: float64</span><br></pre></td></tr></table></figure><p>默认情况下，<a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.apply.html#pandas.DataFrame.apply"><code>apply()</code></a> 调用的函数返回的类型会影响 <code>DataFrame.apply</code> 输出结果的类型。</p><ul><li><p>函数返回的是 <code>Series</code> 时，最终输出结果是 <code>DataFrame</code>。输出的列与函数返回的 <code>Series</code> 索引相匹配。</p></li><li><p>函数返回其它任意类型时，输出结果是 <code>Series</code>。</p></li></ul><p><code>result_type</code> 会覆盖默认行为，该参数有三个选项：<code>reduce</code>、<code>broadcast</code>、<code>expand</code>。这些选项决定了列表型返回值是否扩展为 <code>DataFrame</code>。</p><p>用好 <a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.apply.html#pandas.DataFrame.apply" title="pandas.DataFrame.apply"><code>apply()</code></a> 可以了解数据集的很多信息。比如可以提取每列的最大值对应的日期：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">148</span>]: tsdf = pd.DataFrame(np.random.randn(<span class="number">1000</span>, <span class="number">3</span>), columns=[<span class="string">&#x27;A&#x27;</span>, <span class="string">&#x27;B&#x27;</span>, <span class="string">&#x27;C&#x27;</span>],</span><br><span class="line">   .....:                     index=pd.date_range(<span class="string">&#x27;1/1/2000&#x27;</span>, periods=<span class="number">1000</span>))</span><br><span class="line">   .....: </span><br><span class="line"></span><br><span class="line">In [<span class="number">149</span>]: tsdf.apply(<span class="keyword">lambda</span> x: x.idxmax())</span><br><span class="line">Out[<span class="number">149</span>]: </span><br><span class="line">A   <span class="number">2000</span>-08-06</span><br><span class="line">B   <span class="number">2001</span>-01-<span class="number">18</span></span><br><span class="line">C   <span class="number">2001</span>-07-<span class="number">18</span></span><br><span class="line">dtype: datetime64[ns]</span><br></pre></td></tr></table></figure><p>还可以向 <a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.apply.html#pandas.DataFrame.apply" title="pandas.DataFrame.apply"><code>apply()</code></a> 方法传递额外的参数与关键字参数。比如下例中要应用的这个函数：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">subtract_and_divide</span>(<span class="params">x, sub, divide=<span class="number">1</span></span>):</span></span><br><span class="line">    <span class="keyword">return</span> (x - sub) / divide</span><br></pre></td></tr></table></figure><p>可以用下列方式应用该函数：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">df.apply(subtract_and_divide, args=(<span class="number">5</span>,), divide=<span class="number">3</span>)</span><br></pre></td></tr></table></figure><p>为每行或每列执行 <code>Series</code> 方法的功能也很实用：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">150</span>]: tsdf</span><br><span class="line">Out[<span class="number">150</span>]: </span><br><span class="line">                   A         B         C</span><br><span class="line"><span class="number">2000</span>-01-01 -<span class="number">0.158131</span> -<span class="number">0.232466</span>  <span class="number">0.321604</span></span><br><span class="line"><span class="number">2000</span>-01-02 -<span class="number">1.810340</span> -<span class="number">3.105758</span>  <span class="number">0.433834</span></span><br><span class="line"><span class="number">2000</span>-01-03 -<span class="number">1.209847</span> -<span class="number">1.156793</span> -<span class="number">0.136794</span></span><br><span class="line"><span class="number">2000</span>-01-04       NaN       NaN       NaN</span><br><span class="line"><span class="number">2000</span>-01-05       NaN       NaN       NaN</span><br><span class="line"><span class="number">2000</span>-01-06       NaN       NaN       NaN</span><br><span class="line"><span class="number">2000</span>-01-07       NaN       NaN       NaN</span><br><span class="line"><span class="number">2000</span>-01-08 -<span class="number">0.653602</span>  <span class="number">0.178875</span>  <span class="number">1.008298</span></span><br><span class="line"><span class="number">2000</span>-01-09  <span class="number">1.007996</span>  <span class="number">0.462824</span>  <span class="number">0.254472</span></span><br><span class="line"><span class="number">2000</span>-01-<span class="number">10</span>  <span class="number">0.307473</span>  <span class="number">0.600337</span>  <span class="number">1.643950</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">151</span>]: tsdf.apply(pd.Series.interpolate)</span><br><span class="line">Out[<span class="number">151</span>]: </span><br><span class="line">                   A         B         C</span><br><span class="line"><span class="number">2000</span>-01-01 -<span class="number">0.158131</span> -<span class="number">0.232466</span>  <span class="number">0.321604</span></span><br><span class="line"><span class="number">2000</span>-01-02 -<span class="number">1.810340</span> -<span class="number">3.105758</span>  <span class="number">0.433834</span></span><br><span class="line"><span class="number">2000</span>-01-03 -<span class="number">1.209847</span> -<span class="number">1.156793</span> -<span class="number">0.136794</span></span><br><span class="line"><span class="number">2000</span>-01-04 -<span class="number">1.098598</span> -<span class="number">0.889659</span>  <span class="number">0.092225</span></span><br><span class="line"><span class="number">2000</span>-01-05 -<span class="number">0.987349</span> -<span class="number">0.622526</span>  <span class="number">0.321243</span></span><br><span class="line"><span class="number">2000</span>-01-06 -<span class="number">0.876100</span> -<span class="number">0.355392</span>  <span class="number">0.550262</span></span><br><span class="line"><span class="number">2000</span>-01-07 -<span class="number">0.764851</span> -<span class="number">0.088259</span>  <span class="number">0.779280</span></span><br><span class="line"><span class="number">2000</span>-01-08 -<span class="number">0.653602</span>  <span class="number">0.178875</span>  <span class="number">1.008298</span></span><br><span class="line"><span class="number">2000</span>-01-09  <span class="number">1.007996</span>  <span class="number">0.462824</span>  <span class="number">0.254472</span></span><br><span class="line"><span class="number">2000</span>-01-<span class="number">10</span>  <span class="number">0.307473</span>  <span class="number">0.600337</span>  <span class="number">1.643950</span></span><br></pre></td></tr></table></figure><p><a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.apply.html#pandas.DataFrame.apply" title="pandas.DataFrame.apply"><code>apply()</code></a> 有一个参数 <code>raw</code>，默认值为 <code>False</code>，在应用函数前，使用该参数可以将每行或列转换为 <code>Series</code>。该参数为 <code>True</code> 时，传递的函数接收 ndarray 对象，若不需要索引功能，这种操作能显著提高性能。</p><h3 id="聚合-API"><a href="#聚合-API" class="headerlink" title="聚合 API"></a>聚合 API</h3><p><em>0.20.0 版新增</em>。</p><p>聚合 API 可以快速、简洁地执行多个聚合操作。Pandas 对象支持多个类似的 API，如 <a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/user_guide/groupby.html#groupby-aggregate">groupby API</a>、<a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/user_guide/computation.html#stats-aggregate">window functions API</a>、<a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/user_guide/timeseries.html#timeseries-aggregate">resample API</a>。聚合函数为<a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.aggregate.html#pandas.DataFrame.aggregate" title="pandas.DataFrame.aggregate"><code>DataFrame.aggregate()</code></a>，它的别名是 <a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.agg.html#pandas.DataFrame.agg" title="pandas.DataFrame.agg"><code>DataFrame.agg()</code></a>。</p><p>此处用与上例类似的 <code>DataFrame</code>：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">152</span>]: tsdf = pd.DataFrame(np.random.randn(<span class="number">10</span>, <span class="number">3</span>), columns=[<span class="string">&#x27;A&#x27;</span>, <span class="string">&#x27;B&#x27;</span>, <span class="string">&#x27;C&#x27;</span>],</span><br><span class="line">   .....:                     index=pd.date_range(<span class="string">&#x27;1/1/2000&#x27;</span>, periods=<span class="number">10</span>))</span><br><span class="line">   .....: </span><br><span class="line"></span><br><span class="line">In [<span class="number">153</span>]: tsdf.iloc[<span class="number">3</span>:<span class="number">7</span>] = np.nan</span><br><span class="line"></span><br><span class="line">In [<span class="number">154</span>]: tsdf</span><br><span class="line">Out[<span class="number">154</span>]: </span><br><span class="line">                   A         B         C</span><br><span class="line"><span class="number">2000</span>-01-01  <span class="number">1.257606</span>  <span class="number">1.004194</span>  <span class="number">0.167574</span></span><br><span class="line"><span class="number">2000</span>-01-02 -<span class="number">0.749892</span>  <span class="number">0.288112</span> -<span class="number">0.757304</span></span><br><span class="line"><span class="number">2000</span>-01-03 -<span class="number">0.207550</span> -<span class="number">0.298599</span>  <span class="number">0.116018</span></span><br><span class="line"><span class="number">2000</span>-01-04       NaN       NaN       NaN</span><br><span class="line"><span class="number">2000</span>-01-05       NaN       NaN       NaN</span><br><span class="line"><span class="number">2000</span>-01-06       NaN       NaN       NaN</span><br><span class="line"><span class="number">2000</span>-01-07       NaN       NaN       NaN</span><br><span class="line"><span class="number">2000</span>-01-08  <span class="number">0.814347</span> -<span class="number">0.257623</span>  <span class="number">0.869226</span></span><br><span class="line"><span class="number">2000</span>-01-09 -<span class="number">0.250663</span> -<span class="number">1.206601</span>  <span class="number">0.896839</span></span><br><span class="line"><span class="number">2000</span>-01-<span class="number">10</span>  <span class="number">2.169758</span> -<span class="number">1.333363</span>  <span class="number">0.283157</span></span><br></pre></td></tr></table></figure><p>应用单个函数时，该操作与 <a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.apply.html#pandas.DataFrame.apply" title="pandas.DataFrame.apply"><code>apply()</code></a> 等效，这里也可以用字符串表示聚合函数名。下面的聚合函数输出的结果为 <code>Series</code>：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">155</span>]: tsdf.agg(np.<span class="built_in">sum</span>)</span><br><span class="line">Out[<span class="number">155</span>]: </span><br><span class="line">A    <span class="number">3.033606</span></span><br><span class="line">B   -<span class="number">1.803879</span></span><br><span class="line">C    <span class="number">1.575510</span></span><br><span class="line">dtype: float64</span><br><span class="line"></span><br><span class="line">In [<span class="number">156</span>]: tsdf.agg(<span class="string">&#x27;sum&#x27;</span>)</span><br><span class="line">Out[<span class="number">156</span>]: </span><br><span class="line">A    <span class="number">3.033606</span></span><br><span class="line">B   -<span class="number">1.803879</span></span><br><span class="line">C    <span class="number">1.575510</span></span><br><span class="line">dtype: float64</span><br><span class="line"></span><br><span class="line"><span class="comment"># 因为应用的是单个函数，该操作与`.sum()` 是等效的</span></span><br><span class="line">In [<span class="number">157</span>]: tsdf.<span class="built_in">sum</span>()</span><br><span class="line">Out[<span class="number">157</span>]: </span><br><span class="line">A    <span class="number">3.033606</span></span><br><span class="line">B   -<span class="number">1.803879</span></span><br><span class="line">C    <span class="number">1.575510</span></span><br><span class="line">dtype: float64</span><br></pre></td></tr></table></figure><p><code>Series</code> 单个聚合操作返回标量值：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">158</span>]: tsdf.A.agg(<span class="string">&#x27;sum&#x27;</span>)</span><br><span class="line">Out[<span class="number">158</span>]: <span class="number">3.033606102414146</span></span><br></pre></td></tr></table></figure><h3 id="多函数聚合"><a href="#多函数聚合" class="headerlink" title="多函数聚合"></a>多函数聚合</h3><p>还可以用列表形式传递多个聚合函数。每个函数在输出结果 <code>DataFrame</code> 里以行的形式显示，行名是每个聚合函数的函数名。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">159</span>]: tsdf.agg([<span class="string">&#x27;sum&#x27;</span>])</span><br><span class="line">Out[<span class="number">159</span>]: </span><br><span class="line">            A         B        C</span><br><span class="line"><span class="built_in">sum</span>  <span class="number">3.033606</span> -<span class="number">1.803879</span>  <span class="number">1.57551</span></span><br></pre></td></tr></table></figure><p>多个函数输出多行：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">160</span>]: tsdf.agg([<span class="string">&#x27;sum&#x27;</span>, <span class="string">&#x27;mean&#x27;</span>])</span><br><span class="line">Out[<span class="number">160</span>]: </span><br><span class="line">             A         B         C</span><br><span class="line"><span class="built_in">sum</span>   <span class="number">3.033606</span> -<span class="number">1.803879</span>  <span class="number">1.575510</span></span><br><span class="line">mean  <span class="number">0.505601</span> -<span class="number">0.300647</span>  <span class="number">0.262585</span></span><br></pre></td></tr></table></figure><p><code>Series</code> 聚合多函数返回结果还是 <code>Series</code>，索引为函数名：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">161</span>]: tsdf.A.agg([<span class="string">&#x27;sum&#x27;</span>, <span class="string">&#x27;mean&#x27;</span>])</span><br><span class="line">Out[<span class="number">161</span>]: </span><br><span class="line"><span class="built_in">sum</span>     <span class="number">3.033606</span></span><br><span class="line">mean    <span class="number">0.505601</span></span><br><span class="line">Name: A, dtype: float64</span><br></pre></td></tr></table></figure><p>传递 <code>lambda</code> 函数时，输出名为 <code>&lt;lambda&gt;</code> 的行：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">162</span>]: tsdf.A.agg([<span class="string">&#x27;sum&#x27;</span>, <span class="keyword">lambda</span> x: x.mean()])</span><br><span class="line">Out[<span class="number">162</span>]: </span><br><span class="line"><span class="built_in">sum</span>         <span class="number">3.033606</span></span><br><span class="line">&lt;<span class="keyword">lambda</span>&gt;    <span class="number">0.505601</span></span><br><span class="line">Name: A, dtype: float64</span><br></pre></td></tr></table></figure><p>应用自定义函数时，该函数名为输出结果的行名：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">163</span>]: <span class="function"><span class="keyword">def</span> <span class="title">mymean</span>(<span class="params">x</span>):</span></span><br><span class="line">   .....:     <span class="keyword">return</span> x.mean()</span><br><span class="line">   .....: </span><br><span class="line"></span><br><span class="line">In [<span class="number">164</span>]: tsdf.A.agg([<span class="string">&#x27;sum&#x27;</span>, mymean])</span><br><span class="line">Out[<span class="number">164</span>]: </span><br><span class="line"><span class="built_in">sum</span>       <span class="number">3.033606</span></span><br><span class="line">mymean    <span class="number">0.505601</span></span><br><span class="line">Name: A, dtype: float64</span><br></pre></td></tr></table></figure><h3 id="用字典实现聚合"><a href="#用字典实现聚合" class="headerlink" title="用字典实现聚合"></a>用字典实现聚合</h3><p>指定为哪些列应用哪些聚合函数时，需要把包含列名与标量（或标量列表）的字典传递给 <code>DataFrame.agg</code>。</p><p>注意：这里输出结果的顺序不是固定的，要想让输出顺序与输入顺序一致，请使用 <code>OrderedDict</code>。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">165</span>]: tsdf.agg(&#123;<span class="string">&#x27;A&#x27;</span>: <span class="string">&#x27;mean&#x27;</span>, <span class="string">&#x27;B&#x27;</span>: <span class="string">&#x27;sum&#x27;</span>&#125;)</span><br><span class="line">Out[<span class="number">165</span>]: </span><br><span class="line">A    <span class="number">0.505601</span></span><br><span class="line">B   -<span class="number">1.803879</span></span><br><span class="line">dtype: float64</span><br></pre></td></tr></table></figure><p>输入的参数是列表时，输出结果为 <code>DataFrame</code>，并以矩阵形式显示所有聚合函数的计算结果，且输出结果由所有唯一函数组成。未执行聚合操作的列输出结果为 <code>NaN</code> 值：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">166</span>]: tsdf.agg(&#123;<span class="string">&#x27;A&#x27;</span>: [<span class="string">&#x27;mean&#x27;</span>, <span class="string">&#x27;min&#x27;</span>], <span class="string">&#x27;B&#x27;</span>: <span class="string">&#x27;sum&#x27;</span>&#125;)</span><br><span class="line">Out[<span class="number">166</span>]: </span><br><span class="line">             A         B</span><br><span class="line">mean  <span class="number">0.505601</span>       NaN</span><br><span class="line"><span class="built_in">min</span>  -<span class="number">0.749892</span>       NaN</span><br><span class="line"><span class="built_in">sum</span>        NaN -<span class="number">1.803879</span></span><br></pre></td></tr></table></figure><h3 id="多种数据类型（Dtype）"><a href="#多种数据类型（Dtype）" class="headerlink" title="多种数据类型（Dtype）"></a>多种数据类型（Dtype）</h3><p>与 <code>groupby</code> 的 <code>.agg</code> 操作类似，DataFrame 含不能执行聚合的数据类型时，<code>.agg</code> 只计算可聚合的列：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">167</span>]: mdf = pd.DataFrame(&#123;<span class="string">&#x27;A&#x27;</span>: [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>],</span><br><span class="line">   .....:                     <span class="string">&#x27;B&#x27;</span>: [<span class="number">1.</span>, <span class="number">2.</span>, <span class="number">3.</span>],</span><br><span class="line">   .....:                     <span class="string">&#x27;C&#x27;</span>: [<span class="string">&#x27;foo&#x27;</span>, <span class="string">&#x27;bar&#x27;</span>, <span class="string">&#x27;baz&#x27;</span>],</span><br><span class="line">   .....:                     <span class="string">&#x27;D&#x27;</span>: pd.date_range(<span class="string">&#x27;20130101&#x27;</span>, periods=<span class="number">3</span>)&#125;)</span><br><span class="line">   .....: </span><br><span class="line"></span><br><span class="line">In [<span class="number">168</span>]: mdf.dtypes</span><br><span class="line">Out[<span class="number">168</span>]: </span><br><span class="line">A             int64</span><br><span class="line">B           float64</span><br><span class="line">C            <span class="built_in">object</span></span><br><span class="line">D    datetime64[ns]</span><br><span class="line">dtype: <span class="built_in">object</span></span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">169</span>]: mdf.agg([<span class="string">&#x27;min&#x27;</span>, <span class="string">&#x27;sum&#x27;</span>])</span><br><span class="line">Out[<span class="number">169</span>]: </span><br><span class="line">     A    B          C          D</span><br><span class="line"><span class="built_in">min</span>  <span class="number">1</span>  <span class="number">1.0</span>        bar <span class="number">2013</span>-01-01</span><br><span class="line"><span class="built_in">sum</span>  <span class="number">6</span>  <span class="number">6.0</span>  foobarbaz        NaT</span><br></pre></td></tr></table></figure><h3 id="自定义-Describe"><a href="#自定义-Describe" class="headerlink" title="自定义 Describe"></a>自定义 Describe</h3><p><code>.agg()</code> 可以创建类似于内置 <a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/getting_started/basics.html#basics-describe">describe 函数</a> 的自定义 describe 函数。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">170</span>]: <span class="keyword">from</span> functools <span class="keyword">import</span> partial</span><br><span class="line"></span><br><span class="line">In [<span class="number">171</span>]: q_25 = partial(pd.Series.quantile, q=<span class="number">0.25</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">172</span>]: q_25.__name__ = <span class="string">&#x27;25%&#x27;</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">173</span>]: q_75 = partial(pd.Series.quantile, q=<span class="number">0.75</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">174</span>]: q_75.__name__ = <span class="string">&#x27;75%&#x27;</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">175</span>]: tsdf.agg([<span class="string">&#x27;count&#x27;</span>, <span class="string">&#x27;mean&#x27;</span>, <span class="string">&#x27;std&#x27;</span>, <span class="string">&#x27;min&#x27;</span>, q_25, <span class="string">&#x27;median&#x27;</span>, q_75, <span class="string">&#x27;max&#x27;</span>])</span><br><span class="line">Out[<span class="number">175</span>]: </span><br><span class="line">               A         B         C</span><br><span class="line">count   <span class="number">6.000000</span>  <span class="number">6.000000</span>  <span class="number">6.000000</span></span><br><span class="line">mean    <span class="number">0.505601</span> -<span class="number">0.300647</span>  <span class="number">0.262585</span></span><br><span class="line">std     <span class="number">1.103362</span>  <span class="number">0.887508</span>  <span class="number">0.606860</span></span><br><span class="line"><span class="built_in">min</span>    -<span class="number">0.749892</span> -<span class="number">1.333363</span> -<span class="number">0.757304</span></span><br><span class="line"><span class="number">25</span>%    -<span class="number">0.239885</span> -<span class="number">0.979600</span>  <span class="number">0.128907</span></span><br><span class="line">median  <span class="number">0.303398</span> -<span class="number">0.278111</span>  <span class="number">0.225365</span></span><br><span class="line"><span class="number">75</span>%     <span class="number">1.146791</span>  <span class="number">0.151678</span>  <span class="number">0.722709</span></span><br><span class="line"><span class="built_in">max</span>     <span class="number">2.169758</span>  <span class="number">1.004194</span>  <span class="number">0.896839</span></span><br></pre></td></tr></table></figure><h3 id="Transform-API"><a href="#Transform-API" class="headerlink" title="Transform API"></a>Transform API</h3><p><em>0.20.0 版新增</em>。</p><p><a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.transform.html#pandas.DataFrame.transform" title="pandas.DataFrame.transform"><code>transform()</code></a> 方法的返回结果与原始数据的索引相同，大小相同。与 <code>.agg</code> API 类似，该 API 支持同时处理多种操作，不用一个一个操作。</p><p>下面，先创建一个 DataFrame：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">176</span>]: tsdf = pd.DataFrame(np.random.randn(<span class="number">10</span>, <span class="number">3</span>), columns=[<span class="string">&#x27;A&#x27;</span>, <span class="string">&#x27;B&#x27;</span>, <span class="string">&#x27;C&#x27;</span>],</span><br><span class="line">   .....:                     index=pd.date_range(<span class="string">&#x27;1/1/2000&#x27;</span>, periods=<span class="number">10</span>))</span><br><span class="line">   .....: </span><br><span class="line"></span><br><span class="line">In [<span class="number">177</span>]: tsdf.iloc[<span class="number">3</span>:<span class="number">7</span>] = np.nan</span><br><span class="line"></span><br><span class="line">In [<span class="number">178</span>]: tsdf</span><br><span class="line">Out[<span class="number">178</span>]: </span><br><span class="line">                   A         B         C</span><br><span class="line"><span class="number">2000</span>-01-01 -<span class="number">0.428759</span> -<span class="number">0.864890</span> -<span class="number">0.675341</span></span><br><span class="line"><span class="number">2000</span>-01-02 -<span class="number">0.168731</span>  <span class="number">1.338144</span> -<span class="number">1.279321</span></span><br><span class="line"><span class="number">2000</span>-01-03 -<span class="number">1.621034</span>  <span class="number">0.438107</span>  <span class="number">0.903794</span></span><br><span class="line"><span class="number">2000</span>-01-04       NaN       NaN       NaN</span><br><span class="line"><span class="number">2000</span>-01-05       NaN       NaN       NaN</span><br><span class="line"><span class="number">2000</span>-01-06       NaN       NaN       NaN</span><br><span class="line"><span class="number">2000</span>-01-07       NaN       NaN       NaN</span><br><span class="line"><span class="number">2000</span>-01-08  <span class="number">0.254374</span> -<span class="number">1.240447</span> -<span class="number">0.201052</span></span><br><span class="line"><span class="number">2000</span>-01-09 -<span class="number">0.157795</span>  <span class="number">0.791197</span> -<span class="number">1.144209</span></span><br><span class="line"><span class="number">2000</span>-01-<span class="number">10</span> -<span class="number">0.030876</span>  <span class="number">0.371900</span>  <span class="number">0.061932</span></span><br></pre></td></tr></table></figure><p>这里转换的是整个 DataFrame。<code>.transform()</code> 支持 NumPy 函数、字符串函数及自定义函数。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">179</span>]: tsdf.transform(np.<span class="built_in">abs</span>)</span><br><span class="line">Out[<span class="number">179</span>]: </span><br><span class="line">                   A         B         C</span><br><span class="line"><span class="number">2000</span>-01-01  <span class="number">0.428759</span>  <span class="number">0.864890</span>  <span class="number">0.675341</span></span><br><span class="line"><span class="number">2000</span>-01-02  <span class="number">0.168731</span>  <span class="number">1.338144</span>  <span class="number">1.279321</span></span><br><span class="line"><span class="number">2000</span>-01-03  <span class="number">1.621034</span>  <span class="number">0.438107</span>  <span class="number">0.903794</span></span><br><span class="line"><span class="number">2000</span>-01-04       NaN       NaN       NaN</span><br><span class="line"><span class="number">2000</span>-01-05       NaN       NaN       NaN</span><br><span class="line"><span class="number">2000</span>-01-06       NaN       NaN       NaN</span><br><span class="line"><span class="number">2000</span>-01-07       NaN       NaN       NaN</span><br><span class="line"><span class="number">2000</span>-01-08  <span class="number">0.254374</span>  <span class="number">1.240447</span>  <span class="number">0.201052</span></span><br><span class="line"><span class="number">2000</span>-01-09  <span class="number">0.157795</span>  <span class="number">0.791197</span>  <span class="number">1.144209</span></span><br><span class="line"><span class="number">2000</span>-01-<span class="number">10</span>  <span class="number">0.030876</span>  <span class="number">0.371900</span>  <span class="number">0.061932</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">180</span>]: tsdf.transform(<span class="string">&#x27;abs&#x27;</span>)</span><br><span class="line">Out[<span class="number">180</span>]: </span><br><span class="line">                   A         B         C</span><br><span class="line"><span class="number">2000</span>-01-01  <span class="number">0.428759</span>  <span class="number">0.864890</span>  <span class="number">0.675341</span></span><br><span class="line"><span class="number">2000</span>-01-02  <span class="number">0.168731</span>  <span class="number">1.338144</span>  <span class="number">1.279321</span></span><br><span class="line"><span class="number">2000</span>-01-03  <span class="number">1.621034</span>  <span class="number">0.438107</span>  <span class="number">0.903794</span></span><br><span class="line"><span class="number">2000</span>-01-04       NaN       NaN       NaN</span><br><span class="line"><span class="number">2000</span>-01-05       NaN       NaN       NaN</span><br><span class="line"><span class="number">2000</span>-01-06       NaN       NaN       NaN</span><br><span class="line"><span class="number">2000</span>-01-07       NaN       NaN       NaN</span><br><span class="line"><span class="number">2000</span>-01-08  <span class="number">0.254374</span>  <span class="number">1.240447</span>  <span class="number">0.201052</span></span><br><span class="line"><span class="number">2000</span>-01-09  <span class="number">0.157795</span>  <span class="number">0.791197</span>  <span class="number">1.144209</span></span><br><span class="line"><span class="number">2000</span>-01-<span class="number">10</span>  <span class="number">0.030876</span>  <span class="number">0.371900</span>  <span class="number">0.061932</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">181</span>]: tsdf.transform(<span class="keyword">lambda</span> x: x.<span class="built_in">abs</span>())</span><br><span class="line">Out[<span class="number">181</span>]: </span><br><span class="line">                   A         B         C</span><br><span class="line"><span class="number">2000</span>-01-01  <span class="number">0.428759</span>  <span class="number">0.864890</span>  <span class="number">0.675341</span></span><br><span class="line"><span class="number">2000</span>-01-02  <span class="number">0.168731</span>  <span class="number">1.338144</span>  <span class="number">1.279321</span></span><br><span class="line"><span class="number">2000</span>-01-03  <span class="number">1.621034</span>  <span class="number">0.438107</span>  <span class="number">0.903794</span></span><br><span class="line"><span class="number">2000</span>-01-04       NaN       NaN       NaN</span><br><span class="line"><span class="number">2000</span>-01-05       NaN       NaN       NaN</span><br><span class="line"><span class="number">2000</span>-01-06       NaN       NaN       NaN</span><br><span class="line"><span class="number">2000</span>-01-07       NaN       NaN       NaN</span><br><span class="line"><span class="number">2000</span>-01-08  <span class="number">0.254374</span>  <span class="number">1.240447</span>  <span class="number">0.201052</span></span><br><span class="line"><span class="number">2000</span>-01-09  <span class="number">0.157795</span>  <span class="number">0.791197</span>  <span class="number">1.144209</span></span><br><span class="line"><span class="number">2000</span>-01-<span class="number">10</span>  <span class="number">0.030876</span>  <span class="number">0.371900</span>  <span class="number">0.061932</span></span><br></pre></td></tr></table></figure><p>这里的 <a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.transform.html#pandas.DataFrame.transform" title="pandas.DataFrame.transform"><code>transform()</code></a> 接受单个函数；与 ufunc 等效。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">182</span>]: np.<span class="built_in">abs</span>(tsdf)</span><br><span class="line">Out[<span class="number">182</span>]: </span><br><span class="line">                   A         B         C</span><br><span class="line"><span class="number">2000</span>-01-01  <span class="number">0.428759</span>  <span class="number">0.864890</span>  <span class="number">0.675341</span></span><br><span class="line"><span class="number">2000</span>-01-02  <span class="number">0.168731</span>  <span class="number">1.338144</span>  <span class="number">1.279321</span></span><br><span class="line"><span class="number">2000</span>-01-03  <span class="number">1.621034</span>  <span class="number">0.438107</span>  <span class="number">0.903794</span></span><br><span class="line"><span class="number">2000</span>-01-04       NaN       NaN       NaN</span><br><span class="line"><span class="number">2000</span>-01-05       NaN       NaN       NaN</span><br><span class="line"><span class="number">2000</span>-01-06       NaN       NaN       NaN</span><br><span class="line"><span class="number">2000</span>-01-07       NaN       NaN       NaN</span><br><span class="line"><span class="number">2000</span>-01-08  <span class="number">0.254374</span>  <span class="number">1.240447</span>  <span class="number">0.201052</span></span><br><span class="line"><span class="number">2000</span>-01-09  <span class="number">0.157795</span>  <span class="number">0.791197</span>  <span class="number">1.144209</span></span><br><span class="line"><span class="number">2000</span>-01-<span class="number">10</span>  <span class="number">0.030876</span>  <span class="number">0.371900</span>  <span class="number">0.061932</span></span><br></pre></td></tr></table></figure><p><code>.transform()</code> 向 <code>Series</code> 传递单个函数时，返回的结果也是单个 <code>Series</code>。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">183</span>]: tsdf.A.transform(np.<span class="built_in">abs</span>)</span><br><span class="line">Out[<span class="number">183</span>]: </span><br><span class="line"><span class="number">2000</span>-01-01    <span class="number">0.428759</span></span><br><span class="line"><span class="number">2000</span>-01-02    <span class="number">0.168731</span></span><br><span class="line"><span class="number">2000</span>-01-03    <span class="number">1.621034</span></span><br><span class="line"><span class="number">2000</span>-01-04         NaN</span><br><span class="line"><span class="number">2000</span>-01-05         NaN</span><br><span class="line"><span class="number">2000</span>-01-06         NaN</span><br><span class="line"><span class="number">2000</span>-01-07         NaN</span><br><span class="line"><span class="number">2000</span>-01-08    <span class="number">0.254374</span></span><br><span class="line"><span class="number">2000</span>-01-09    <span class="number">0.157795</span></span><br><span class="line"><span class="number">2000</span>-01-<span class="number">10</span>    <span class="number">0.030876</span></span><br><span class="line">Freq: D, Name: A, dtype: float64</span><br></pre></td></tr></table></figure><h3 id="多函数-Transform"><a href="#多函数-Transform" class="headerlink" title="多函数 Transform"></a>多函数 Transform</h3><p><code>transform()</code> 调用多个函数时，生成多层索引 DataFrame。第一层是原始数据集的列名；第二层是 <code>transform()</code> 调用的函数名。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">184</span>]: tsdf.transform([np.<span class="built_in">abs</span>, <span class="keyword">lambda</span> x: x + <span class="number">1</span>])</span><br><span class="line">Out[<span class="number">184</span>]: </span><br><span class="line">                   A                   B                   C          </span><br><span class="line">            absolute  &lt;<span class="keyword">lambda</span>&gt;  absolute  &lt;<span class="keyword">lambda</span>&gt;  absolute  &lt;<span class="keyword">lambda</span>&gt;</span><br><span class="line"><span class="number">2000</span>-01-01  <span class="number">0.428759</span>  <span class="number">0.571241</span>  <span class="number">0.864890</span>  <span class="number">0.135110</span>  <span class="number">0.675341</span>  <span class="number">0.324659</span></span><br><span class="line"><span class="number">2000</span>-01-02  <span class="number">0.168731</span>  <span class="number">0.831269</span>  <span class="number">1.338144</span>  <span class="number">2.338144</span>  <span class="number">1.279321</span> -<span class="number">0.279321</span></span><br><span class="line"><span class="number">2000</span>-01-03  <span class="number">1.621034</span> -<span class="number">0.621034</span>  <span class="number">0.438107</span>  <span class="number">1.438107</span>  <span class="number">0.903794</span>  <span class="number">1.903794</span></span><br><span class="line"><span class="number">2000</span>-01-04       NaN       NaN       NaN       NaN       NaN       NaN</span><br><span class="line"><span class="number">2000</span>-01-05       NaN       NaN       NaN       NaN       NaN       NaN</span><br><span class="line"><span class="number">2000</span>-01-06       NaN       NaN       NaN       NaN       NaN       NaN</span><br><span class="line"><span class="number">2000</span>-01-07       NaN       NaN       NaN       NaN       NaN       NaN</span><br><span class="line"><span class="number">2000</span>-01-08  <span class="number">0.254374</span>  <span class="number">1.254374</span>  <span class="number">1.240447</span> -<span class="number">0.240447</span>  <span class="number">0.201052</span>  <span class="number">0.798948</span></span><br><span class="line"><span class="number">2000</span>-01-09  <span class="number">0.157795</span>  <span class="number">0.842205</span>  <span class="number">0.791197</span>  <span class="number">1.791197</span>  <span class="number">1.144209</span> -<span class="number">0.144209</span></span><br><span class="line"><span class="number">2000</span>-01-<span class="number">10</span>  <span class="number">0.030876</span>  <span class="number">0.969124</span>  <span class="number">0.371900</span>  <span class="number">1.371900</span>  <span class="number">0.061932</span>  <span class="number">1.061932</span></span><br></pre></td></tr></table></figure><p>为 Series 应用多个函数时，输出结果是 DataFrame，列名是 <code>transform()</code> 调用的函数名。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">185</span>]: tsdf.A.transform([np.<span class="built_in">abs</span>, <span class="keyword">lambda</span> x: x + <span class="number">1</span>])</span><br><span class="line">Out[<span class="number">185</span>]: </span><br><span class="line">            absolute  &lt;<span class="keyword">lambda</span>&gt;</span><br><span class="line"><span class="number">2000</span>-01-01  <span class="number">0.428759</span>  <span class="number">0.571241</span></span><br><span class="line"><span class="number">2000</span>-01-02  <span class="number">0.168731</span>  <span class="number">0.831269</span></span><br><span class="line"><span class="number">2000</span>-01-03  <span class="number">1.621034</span> -<span class="number">0.621034</span></span><br><span class="line"><span class="number">2000</span>-01-04       NaN       NaN</span><br><span class="line"><span class="number">2000</span>-01-05       NaN       NaN</span><br><span class="line"><span class="number">2000</span>-01-06       NaN       NaN</span><br><span class="line"><span class="number">2000</span>-01-07       NaN       NaN</span><br><span class="line"><span class="number">2000</span>-01-08  <span class="number">0.254374</span>  <span class="number">1.254374</span></span><br><span class="line"><span class="number">2000</span>-01-09  <span class="number">0.157795</span>  <span class="number">0.842205</span></span><br><span class="line"><span class="number">2000</span>-01-<span class="number">10</span>  <span class="number">0.030876</span>  <span class="number">0.969124</span></span><br></pre></td></tr></table></figure><h3 id="用字典执行-transform-操作"><a href="#用字典执行-transform-操作" class="headerlink" title="用字典执行 transform 操作"></a>用字典执行 <code>transform</code> 操作</h3><p>函数字典可以为每列执行指定 <code>transform()</code> 操作。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">186</span>]: tsdf.transform(&#123;<span class="string">&#x27;A&#x27;</span>: np.<span class="built_in">abs</span>, <span class="string">&#x27;B&#x27;</span>: <span class="keyword">lambda</span> x: x + <span class="number">1</span>&#125;)</span><br><span class="line">Out[<span class="number">186</span>]: </span><br><span class="line">                   A         B</span><br><span class="line"><span class="number">2000</span>-01-01  <span class="number">0.428759</span>  <span class="number">0.135110</span></span><br><span class="line"><span class="number">2000</span>-01-02  <span class="number">0.168731</span>  <span class="number">2.338144</span></span><br><span class="line"><span class="number">2000</span>-01-03  <span class="number">1.621034</span>  <span class="number">1.438107</span></span><br><span class="line"><span class="number">2000</span>-01-04       NaN       NaN</span><br><span class="line"><span class="number">2000</span>-01-05       NaN       NaN</span><br><span class="line"><span class="number">2000</span>-01-06       NaN       NaN</span><br><span class="line"><span class="number">2000</span>-01-07       NaN       NaN</span><br><span class="line"><span class="number">2000</span>-01-08  <span class="number">0.254374</span> -<span class="number">0.240447</span></span><br><span class="line"><span class="number">2000</span>-01-09  <span class="number">0.157795</span>  <span class="number">1.791197</span></span><br><span class="line"><span class="number">2000</span>-01-<span class="number">10</span>  <span class="number">0.030876</span>  <span class="number">1.371900</span></span><br></pre></td></tr></table></figure><p><code>transform()</code> 的参数是列表字典时，生成的是以 <code>transform()</code> 调用的函数为名的多层索引 DataFrame。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">187</span>]: tsdf.transform(&#123;<span class="string">&#x27;A&#x27;</span>: np.<span class="built_in">abs</span>, <span class="string">&#x27;B&#x27;</span>: [<span class="keyword">lambda</span> x: x + <span class="number">1</span>, <span class="string">&#x27;sqrt&#x27;</span>]&#125;)</span><br><span class="line">Out[<span class="number">187</span>]: </span><br><span class="line">                   A         B          </span><br><span class="line">            absolute  &lt;<span class="keyword">lambda</span>&gt;      sqrt</span><br><span class="line"><span class="number">2000</span>-01-01  <span class="number">0.428759</span>  <span class="number">0.135110</span>       NaN</span><br><span class="line"><span class="number">2000</span>-01-02  <span class="number">0.168731</span>  <span class="number">2.338144</span>  <span class="number">1.156782</span></span><br><span class="line"><span class="number">2000</span>-01-03  <span class="number">1.621034</span>  <span class="number">1.438107</span>  <span class="number">0.661897</span></span><br><span class="line"><span class="number">2000</span>-01-04       NaN       NaN       NaN</span><br><span class="line"><span class="number">2000</span>-01-05       NaN       NaN       NaN</span><br><span class="line"><span class="number">2000</span>-01-06       NaN       NaN       NaN</span><br><span class="line"><span class="number">2000</span>-01-07       NaN       NaN       NaN</span><br><span class="line"><span class="number">2000</span>-01-08  <span class="number">0.254374</span> -<span class="number">0.240447</span>       NaN</span><br><span class="line"><span class="number">2000</span>-01-09  <span class="number">0.157795</span>  <span class="number">1.791197</span>  <span class="number">0.889493</span></span><br><span class="line"><span class="number">2000</span>-01-<span class="number">10</span>  <span class="number">0.030876</span>  <span class="number">1.371900</span>  <span class="number">0.609836</span></span><br></pre></td></tr></table></figure><h3 id="元素级函数应用"><a href="#元素级函数应用" class="headerlink" title="元素级函数应用"></a>元素级函数应用</h3><p>并非所有函数都能矢量化，即接受 NumPy 数组，返回另一个数组或值，DataFrame 的 <a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.applymap.html#pandas.DataFrame.applymap" title="pandas.DataFrame.applymap"><code>applymap()</code></a> 及 Series 的 <a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.Series.map.html#pandas.Series.map" title="pandas.Series.map"><code>map()</code></a> ，支持任何接收单个值并返回单个值的 Python 函数。</p><p>示例如下：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">188</span>]: df4</span><br><span class="line">Out[<span class="number">188</span>]: </span><br><span class="line">        one       two     three</span><br><span class="line">a  <span class="number">1.394981</span>  <span class="number">1.772517</span>       NaN</span><br><span class="line">b  <span class="number">0.343054</span>  <span class="number">1.912123</span> -<span class="number">0.050390</span></span><br><span class="line">c  <span class="number">0.695246</span>  <span class="number">1.478369</span>  <span class="number">1.227435</span></span><br><span class="line">d       NaN  <span class="number">0.279344</span> -<span class="number">0.613172</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">189</span>]: <span class="function"><span class="keyword">def</span> <span class="title">f</span>(<span class="params">x</span>):</span></span><br><span class="line">   .....:     <span class="keyword">return</span> <span class="built_in">len</span>(<span class="built_in">str</span>(x))</span><br><span class="line">   .....: </span><br><span class="line"></span><br><span class="line">In [<span class="number">190</span>]: df4[<span class="string">&#x27;one&#x27;</span>].<span class="built_in">map</span>(f)</span><br><span class="line">Out[<span class="number">190</span>]: </span><br><span class="line">a    <span class="number">18</span></span><br><span class="line">b    <span class="number">19</span></span><br><span class="line">c    <span class="number">18</span></span><br><span class="line">d     <span class="number">3</span></span><br><span class="line">Name: one, dtype: int64</span><br><span class="line"></span><br><span class="line">In [<span class="number">191</span>]: df4.applymap(f)</span><br><span class="line">Out[<span class="number">191</span>]: </span><br><span class="line">   one  two  three</span><br><span class="line">a   <span class="number">18</span>   <span class="number">17</span>      <span class="number">3</span></span><br><span class="line">b   <span class="number">19</span>   <span class="number">18</span>     <span class="number">20</span></span><br><span class="line">c   <span class="number">18</span>   <span class="number">18</span>     <span class="number">16</span></span><br><span class="line">d    <span class="number">3</span>   <span class="number">19</span>     <span class="number">19</span></span><br></pre></td></tr></table></figure><p><a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.Series.map.html#pandas.Series.map" title="pandas.Series.map"><code>Series.map()</code></a> 还有个功能，可以“连接”或“映射”第二个 Series 定义的值。这与 <a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/user_guide/merging.html#merging">merging / joining 功能</a>联系非常紧密：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">192</span>]: s = pd.Series([<span class="string">&#x27;six&#x27;</span>, <span class="string">&#x27;seven&#x27;</span>, <span class="string">&#x27;six&#x27;</span>, <span class="string">&#x27;seven&#x27;</span>, <span class="string">&#x27;six&#x27;</span>],</span><br><span class="line">   .....:               index=[<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;c&#x27;</span>, <span class="string">&#x27;d&#x27;</span>, <span class="string">&#x27;e&#x27;</span>])</span><br><span class="line">   .....: </span><br><span class="line"></span><br><span class="line">In [<span class="number">193</span>]: t = pd.Series(&#123;<span class="string">&#x27;six&#x27;</span>: <span class="number">6.</span>, <span class="string">&#x27;seven&#x27;</span>: <span class="number">7.</span>&#125;)</span><br><span class="line"></span><br><span class="line">In [<span class="number">194</span>]: s</span><br><span class="line">Out[<span class="number">194</span>]: </span><br><span class="line">a      six</span><br><span class="line">b    seven</span><br><span class="line">c      six</span><br><span class="line">d    seven</span><br><span class="line">e      six</span><br><span class="line">dtype: <span class="built_in">object</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">195</span>]: s.<span class="built_in">map</span>(t)</span><br><span class="line">Out[<span class="number">195</span>]: </span><br><span class="line">a    <span class="number">6.0</span></span><br><span class="line">b    <span class="number">7.0</span></span><br><span class="line">c    <span class="number">6.0</span></span><br><span class="line">d    <span class="number">7.0</span></span><br><span class="line">e    <span class="number">6.0</span></span><br><span class="line">dtype: float64</span><br></pre></td></tr></table></figure><h2 id="重置索引与更换标签"><a href="#重置索引与更换标签" class="headerlink" title="重置索引与更换标签"></a>重置索引与更换标签</h2><p><a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.Series.reindex.html#pandas.Series.reindex" title="pandas.Series.reindex"><code>reindex()</code></a> 是 Pandas 里实现数据对齐的基本方法，该方法执行几乎所有功能都要用到的标签对齐功能。 <code>reindex</code> 指的是沿着指定轴，让数据与给定的一组标签进行匹配。该功能完成以下几项操作：</p><ul><li>让现有数据匹配一组新标签，并重新排序；</li><li>在无数据但有标签的位置插入缺失值（<code>NA</code>）标记；</li><li>如果指定，则按逻辑<strong>填充</strong>无标签的数据，该操作多见于时间序列数据。</li></ul><p>示例如下：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">196</span>]: s = pd.Series(np.random.randn(<span class="number">5</span>), index=[<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;c&#x27;</span>, <span class="string">&#x27;d&#x27;</span>, <span class="string">&#x27;e&#x27;</span>])</span><br><span class="line"></span><br><span class="line">In [<span class="number">197</span>]: s</span><br><span class="line">Out[<span class="number">197</span>]: </span><br><span class="line">a    <span class="number">1.695148</span></span><br><span class="line">b    <span class="number">1.328614</span></span><br><span class="line">c    <span class="number">1.234686</span></span><br><span class="line">d   -<span class="number">0.385845</span></span><br><span class="line">e   -<span class="number">1.326508</span></span><br><span class="line">dtype: float64</span><br><span class="line"></span><br><span class="line">In [<span class="number">198</span>]: s.reindex([<span class="string">&#x27;e&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;f&#x27;</span>, <span class="string">&#x27;d&#x27;</span>])</span><br><span class="line">Out[<span class="number">198</span>]: </span><br><span class="line">e   -<span class="number">1.326508</span></span><br><span class="line">b    <span class="number">1.328614</span></span><br><span class="line">f         NaN</span><br><span class="line">d   -<span class="number">0.385845</span></span><br><span class="line">dtype: float64</span><br></pre></td></tr></table></figure><p>本例中，原 Series 里没有标签 <code>f</code> ，因此，输出结果里 <code>f</code> 对应的值为 <code>NaN</code>。</p><p>DataFrame 支持同时 <code>reindex</code> 索引与列：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">199</span>]: df</span><br><span class="line">Out[<span class="number">199</span>]: </span><br><span class="line">        one       two     three</span><br><span class="line">a  <span class="number">1.394981</span>  <span class="number">1.772517</span>       NaN</span><br><span class="line">b  <span class="number">0.343054</span>  <span class="number">1.912123</span> -<span class="number">0.050390</span></span><br><span class="line">c  <span class="number">0.695246</span>  <span class="number">1.478369</span>  <span class="number">1.227435</span></span><br><span class="line">d       NaN  <span class="number">0.279344</span> -<span class="number">0.613172</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">200</span>]: df.reindex(index=[<span class="string">&#x27;c&#x27;</span>, <span class="string">&#x27;f&#x27;</span>, <span class="string">&#x27;b&#x27;</span>], columns=[<span class="string">&#x27;three&#x27;</span>, <span class="string">&#x27;two&#x27;</span>, <span class="string">&#x27;one&#x27;</span>])</span><br><span class="line">Out[<span class="number">200</span>]: </span><br><span class="line">      three       two       one</span><br><span class="line">c  <span class="number">1.227435</span>  <span class="number">1.478369</span>  <span class="number">0.695246</span></span><br><span class="line">f       NaN       NaN       NaN</span><br><span class="line">b -<span class="number">0.050390</span>  <span class="number">1.912123</span>  <span class="number">0.343054</span></span><br></pre></td></tr></table></figure><p><code>reindex</code> 还支持 <code>axis</code> 关键字：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">201</span>]: df.reindex([<span class="string">&#x27;c&#x27;</span>, <span class="string">&#x27;f&#x27;</span>, <span class="string">&#x27;b&#x27;</span>], axis=<span class="string">&#x27;index&#x27;</span>)</span><br><span class="line">Out[<span class="number">201</span>]: </span><br><span class="line">        one       two     three</span><br><span class="line">c  <span class="number">0.695246</span>  <span class="number">1.478369</span>  <span class="number">1.227435</span></span><br><span class="line">f       NaN       NaN       NaN</span><br><span class="line">b  <span class="number">0.343054</span>  <span class="number">1.912123</span> -<span class="number">0.050390</span></span><br></pre></td></tr></table></figure><p>注意：不同对象可以<strong>共享</strong> <code>Index</code> 包含的轴标签。比如，有一个 Series，还有一个 DataFrame，可以执行下列操作：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">202</span>]: rs = s.reindex(df.index)</span><br><span class="line"></span><br><span class="line">In [<span class="number">203</span>]: rs</span><br><span class="line">Out[<span class="number">203</span>]: </span><br><span class="line">a    <span class="number">1.695148</span></span><br><span class="line">b    <span class="number">1.328614</span></span><br><span class="line">c    <span class="number">1.234686</span></span><br><span class="line">d   -<span class="number">0.385845</span></span><br><span class="line">dtype: float64</span><br><span class="line"></span><br><span class="line">In [<span class="number">204</span>]: rs.index <span class="keyword">is</span> df.index</span><br><span class="line">Out[<span class="number">204</span>]: <span class="literal">True</span></span><br></pre></td></tr></table></figure><p>这里指的是，重置后，Series 的索引与 DataFrame 的索引是同一个 Python 对象。</p><p><em>0.21.0 版新增</em>。</p><p><a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.reindex.html#pandas.DataFrame.reindex" title="pandas.DataFrame.reindex"><code>DataFrame.reindex()</code></a> 还支持 “轴样式”调用习语，可以指定单个 <code>labels</code> 参数，并指定应用于哪个 <code>axis</code>。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">205</span>]: df.reindex([<span class="string">&#x27;c&#x27;</span>, <span class="string">&#x27;f&#x27;</span>, <span class="string">&#x27;b&#x27;</span>], axis=<span class="string">&#x27;index&#x27;</span>)</span><br><span class="line">Out[<span class="number">205</span>]: </span><br><span class="line">        one       two     three</span><br><span class="line">c  <span class="number">0.695246</span>  <span class="number">1.478369</span>  <span class="number">1.227435</span></span><br><span class="line">f       NaN       NaN       NaN</span><br><span class="line">b  <span class="number">0.343054</span>  <span class="number">1.912123</span> -<span class="number">0.050390</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">206</span>]: df.reindex([<span class="string">&#x27;three&#x27;</span>, <span class="string">&#x27;two&#x27;</span>, <span class="string">&#x27;one&#x27;</span>], axis=<span class="string">&#x27;columns&#x27;</span>)</span><br><span class="line">Out[<span class="number">206</span>]: </span><br><span class="line">      three       two       one</span><br><span class="line">a       NaN  <span class="number">1.772517</span>  <span class="number">1.394981</span></span><br><span class="line">b -<span class="number">0.050390</span>  <span class="number">1.912123</span>  <span class="number">0.343054</span></span><br><span class="line">c  <span class="number">1.227435</span>  <span class="number">1.478369</span>  <span class="number">0.695246</span></span><br><span class="line">d -<span class="number">0.613172</span>  <span class="number">0.279344</span>       NaN</span><br></pre></td></tr></table></figure><p>::: tip 注意</p><p><a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/user_guide/advanced.html#advanced">多层索引与高级索引</a>介绍了怎样用更简洁的方式重置索引。</p><p>:::</p><p>::: tip 注意</p><p>编写注重性能的代码时，最好花些时间深入理解 <code>reindex</code>：<strong>预对齐数据后，操作会更快</strong>。两个未对齐的 DataFrame 相加，后台操作会执行 <code>reindex</code>。探索性分析时很难注意到这点有什么不同，这是因为 <code>reindex</code> 已经进行了高度优化，但需要注重 CPU 周期时，显式调用 <code>reindex</code> 还是有一些影响的。</p><p>:::</p><h3 id="重置索引，并与其它对象对齐"><a href="#重置索引，并与其它对象对齐" class="headerlink" title="重置索引，并与其它对象对齐"></a>重置索引，并与其它对象对齐</h3><p>提取一个对象，并用另一个具有相同标签的对象 <code>reindex</code> 该对象的轴。这种操作的语法虽然简单，但未免有些啰嗦。这时，最好用 <a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.reindex_like.html#pandas.DataFrame.reindex_like" title="pandas.DataFrame.reindex_like"><code>reindex_like()</code></a> 方法，这是一种既有效，又简单的方式：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">207</span>]: df2</span><br><span class="line">Out[<span class="number">207</span>]: </span><br><span class="line">        one       two</span><br><span class="line">a  <span class="number">1.394981</span>  <span class="number">1.772517</span></span><br><span class="line">b  <span class="number">0.343054</span>  <span class="number">1.912123</span></span><br><span class="line">c  <span class="number">0.695246</span>  <span class="number">1.478369</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">208</span>]: df3</span><br><span class="line">Out[<span class="number">208</span>]: </span><br><span class="line">        one       two</span><br><span class="line">a  <span class="number">0.583888</span>  <span class="number">0.051514</span></span><br><span class="line">b -<span class="number">0.468040</span>  <span class="number">0.191120</span></span><br><span class="line">c -<span class="number">0.115848</span> -<span class="number">0.242634</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">209</span>]: df.reindex_like(df2)</span><br><span class="line">Out[<span class="number">209</span>]: </span><br><span class="line">        one       two</span><br><span class="line">a  <span class="number">1.394981</span>  <span class="number">1.772517</span></span><br><span class="line">b  <span class="number">0.343054</span>  <span class="number">1.912123</span></span><br><span class="line">c  <span class="number">0.695246</span>  <span class="number">1.478369</span></span><br></pre></td></tr></table></figure><h3 id="用-align-对齐多个对象"><a href="#用-align-对齐多个对象" class="headerlink" title="用 align 对齐多个对象"></a>用 <code>align</code> 对齐多个对象</h3><p><a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.Series.align.html#pandas.Series.align" title="pandas.Series.align"><code>align()</code></a> 方法是对齐两个对象最快的方式，该方法支持 <code>join</code> 参数（请参阅 <a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/user_guide/merging.html#merging">joining 与 merging</a>）：</p><ul><li><code>join=&#39;outer&#39;</code>：使用两个对象索引的合集，默认值</li><li><code>join=&#39;left&#39;</code>：使用左侧调用对象的索引</li><li><code>join=&#39;right&#39;</code>：使用右侧传递对象的索引</li><li><code>join=&#39;inner&#39;</code>：使用两个对象索引的交集</li></ul><p>该方法返回重置索引后的两个 Series 元组：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">210</span>]: s = pd.Series(np.random.randn(<span class="number">5</span>), index=[<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;c&#x27;</span>, <span class="string">&#x27;d&#x27;</span>, <span class="string">&#x27;e&#x27;</span>])</span><br><span class="line"></span><br><span class="line">In [<span class="number">211</span>]: s1 = s[:<span class="number">4</span>]</span><br><span class="line"></span><br><span class="line">In [<span class="number">212</span>]: s2 = s[<span class="number">1</span>:]</span><br><span class="line"></span><br><span class="line">In [<span class="number">213</span>]: s1.align(s2)</span><br><span class="line">Out[<span class="number">213</span>]: </span><br><span class="line">(a   -<span class="number">0.186646</span></span><br><span class="line"> b   -<span class="number">1.692424</span></span><br><span class="line"> c   -<span class="number">0.303893</span></span><br><span class="line"> d   -<span class="number">1.425662</span></span><br><span class="line"> e         NaN</span><br><span class="line"> dtype: float64, a         NaN</span><br><span class="line"> b   -<span class="number">1.692424</span></span><br><span class="line"> c   -<span class="number">0.303893</span></span><br><span class="line"> d   -<span class="number">1.425662</span></span><br><span class="line"> e    <span class="number">1.114285</span></span><br><span class="line"> dtype: float64)</span><br><span class="line"></span><br><span class="line">In [<span class="number">214</span>]: s1.align(s2, join=<span class="string">&#x27;inner&#x27;</span>)</span><br><span class="line">Out[<span class="number">214</span>]: </span><br><span class="line">(b   -<span class="number">1.692424</span></span><br><span class="line"> c   -<span class="number">0.303893</span></span><br><span class="line"> d   -<span class="number">1.425662</span></span><br><span class="line"> dtype: float64, b   -<span class="number">1.692424</span></span><br><span class="line"> c   -<span class="number">0.303893</span></span><br><span class="line"> d   -<span class="number">1.425662</span></span><br><span class="line"> dtype: float64)</span><br><span class="line"></span><br><span class="line">In [<span class="number">215</span>]: s1.align(s2, join=<span class="string">&#x27;left&#x27;</span>)</span><br><span class="line">Out[<span class="number">215</span>]: </span><br><span class="line">(a   -<span class="number">0.186646</span></span><br><span class="line"> b   -<span class="number">1.692424</span></span><br><span class="line"> c   -<span class="number">0.303893</span></span><br><span class="line"> d   -<span class="number">1.425662</span></span><br><span class="line"> dtype: float64, a         NaN</span><br><span class="line"> b   -<span class="number">1.692424</span></span><br><span class="line"> c   -<span class="number">0.303893</span></span><br><span class="line"> d   -<span class="number">1.425662</span></span><br><span class="line"> dtype: float64)</span><br></pre></td></tr></table></figure><p>默认条件下， <code>join</code> 方法既应用于索引，也应用于列：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">216</span>]: df.align(df2, join=<span class="string">&#x27;inner&#x27;</span>)</span><br><span class="line">Out[<span class="number">216</span>]: </span><br><span class="line">(        one       two</span><br><span class="line"> a  <span class="number">1.394981</span>  <span class="number">1.772517</span></span><br><span class="line"> b  <span class="number">0.343054</span>  <span class="number">1.912123</span></span><br><span class="line"> c  <span class="number">0.695246</span>  <span class="number">1.478369</span>,         one       two</span><br><span class="line"> a  <span class="number">1.394981</span>  <span class="number">1.772517</span></span><br><span class="line"> b  <span class="number">0.343054</span>  <span class="number">1.912123</span></span><br><span class="line"> c  <span class="number">0.695246</span>  <span class="number">1.478369</span>)</span><br></pre></td></tr></table></figure><p><code>align</code> 方法还支持 <code>axis</code> 选项，用来指定要对齐的轴：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">217</span>]: df.align(df2, join=<span class="string">&#x27;inner&#x27;</span>, axis=<span class="number">0</span>)</span><br><span class="line">Out[<span class="number">217</span>]: </span><br><span class="line">(        one       two     three</span><br><span class="line"> a  <span class="number">1.394981</span>  <span class="number">1.772517</span>       NaN</span><br><span class="line"> b  <span class="number">0.343054</span>  <span class="number">1.912123</span> -<span class="number">0.050390</span></span><br><span class="line"> c  <span class="number">0.695246</span>  <span class="number">1.478369</span>  <span class="number">1.227435</span>,         one       two</span><br><span class="line"> a  <span class="number">1.394981</span>  <span class="number">1.772517</span></span><br><span class="line"> b  <span class="number">0.343054</span>  <span class="number">1.912123</span></span><br><span class="line"> c  <span class="number">0.695246</span>  <span class="number">1.478369</span>)</span><br></pre></td></tr></table></figure><p>如果把 Series 传递给 <a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.align.html#pandas.DataFrame.align" title="pandas.DataFrame.align"><code>DataFrame.align()</code></a>，可以用 <code>axis</code> 参数选择是在 DataFrame 的索引，还是列上对齐两个对象：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">218</span>]: df.align(df2.iloc[<span class="number">0</span>], axis=<span class="number">1</span>)</span><br><span class="line">Out[<span class="number">218</span>]: </span><br><span class="line">(        one     three       two</span><br><span class="line"> a  <span class="number">1.394981</span>       NaN  <span class="number">1.772517</span></span><br><span class="line"> b  <span class="number">0.343054</span> -<span class="number">0.050390</span>  <span class="number">1.912123</span></span><br><span class="line"> c  <span class="number">0.695246</span>  <span class="number">1.227435</span>  <span class="number">1.478369</span></span><br><span class="line"> d       NaN -<span class="number">0.613172</span>  <span class="number">0.279344</span>, one      <span class="number">1.394981</span></span><br><span class="line"> three         NaN</span><br><span class="line"> two      <span class="number">1.772517</span></span><br><span class="line"> Name: a, dtype: float64)</span><br></pre></td></tr></table></figure><table><thead><tr><th align="left">方法</th><th align="left">动作</th></tr></thead><tbody><tr><td align="left">pad / ffill</td><td align="left">先前填充</td></tr><tr><td align="left">bfill / backfill</td><td align="left">向后填充</td></tr><tr><td align="left">nearest</td><td align="left">从最近的索引值填充</td></tr></tbody></table><p>下面用一个简单的 Series 展示 <code>fill</code> 方法：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">219</span>]: rng = pd.date_range(<span class="string">&#x27;1/3/2000&#x27;</span>, periods=<span class="number">8</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">220</span>]: ts = pd.Series(np.random.randn(<span class="number">8</span>), index=rng)</span><br><span class="line"></span><br><span class="line">In [<span class="number">221</span>]: ts2 = ts[[<span class="number">0</span>, <span class="number">3</span>, <span class="number">6</span>]]</span><br><span class="line"></span><br><span class="line">In [<span class="number">222</span>]: ts</span><br><span class="line">Out[<span class="number">222</span>]: </span><br><span class="line"><span class="number">2000</span>-01-03    <span class="number">0.183051</span></span><br><span class="line"><span class="number">2000</span>-01-04    <span class="number">0.400528</span></span><br><span class="line"><span class="number">2000</span>-01-05   -<span class="number">0.015083</span></span><br><span class="line"><span class="number">2000</span>-01-06    <span class="number">2.395489</span></span><br><span class="line"><span class="number">2000</span>-01-07    <span class="number">1.414806</span></span><br><span class="line"><span class="number">2000</span>-01-08    <span class="number">0.118428</span></span><br><span class="line"><span class="number">2000</span>-01-09    <span class="number">0.733639</span></span><br><span class="line"><span class="number">2000</span>-01-<span class="number">10</span>   -<span class="number">0.936077</span></span><br><span class="line">Freq: D, dtype: float64</span><br><span class="line"></span><br><span class="line">In [<span class="number">223</span>]: ts2</span><br><span class="line">Out[<span class="number">223</span>]: </span><br><span class="line"><span class="number">2000</span>-01-03    <span class="number">0.183051</span></span><br><span class="line"><span class="number">2000</span>-01-06    <span class="number">2.395489</span></span><br><span class="line"><span class="number">2000</span>-01-09    <span class="number">0.733639</span></span><br><span class="line">dtype: float64</span><br><span class="line"></span><br><span class="line">In [<span class="number">224</span>]: ts2.reindex(ts.index)</span><br><span class="line">Out[<span class="number">224</span>]: </span><br><span class="line"><span class="number">2000</span>-01-03    <span class="number">0.183051</span></span><br><span class="line"><span class="number">2000</span>-01-04         NaN</span><br><span class="line"><span class="number">2000</span>-01-05         NaN</span><br><span class="line"><span class="number">2000</span>-01-06    <span class="number">2.395489</span></span><br><span class="line"><span class="number">2000</span>-01-07         NaN</span><br><span class="line"><span class="number">2000</span>-01-08         NaN</span><br><span class="line"><span class="number">2000</span>-01-09    <span class="number">0.733639</span></span><br><span class="line"><span class="number">2000</span>-01-<span class="number">10</span>         NaN</span><br><span class="line">Freq: D, dtype: float64</span><br><span class="line"></span><br><span class="line">In [<span class="number">225</span>]: ts2.reindex(ts.index, method=<span class="string">&#x27;ffill&#x27;</span>)</span><br><span class="line">Out[<span class="number">225</span>]: </span><br><span class="line"><span class="number">2000</span>-01-03    <span class="number">0.183051</span></span><br><span class="line"><span class="number">2000</span>-01-04    <span class="number">0.183051</span></span><br><span class="line"><span class="number">2000</span>-01-05    <span class="number">0.183051</span></span><br><span class="line"><span class="number">2000</span>-01-06    <span class="number">2.395489</span></span><br><span class="line"><span class="number">2000</span>-01-07    <span class="number">2.395489</span></span><br><span class="line"><span class="number">2000</span>-01-08    <span class="number">2.395489</span></span><br><span class="line"><span class="number">2000</span>-01-09    <span class="number">0.733639</span></span><br><span class="line"><span class="number">2000</span>-01-<span class="number">10</span>    <span class="number">0.733639</span></span><br><span class="line">Freq: D, dtype: float64</span><br><span class="line"></span><br><span class="line">In [<span class="number">226</span>]: ts2.reindex(ts.index, method=<span class="string">&#x27;bfill&#x27;</span>)</span><br><span class="line">Out[<span class="number">226</span>]: </span><br><span class="line"><span class="number">2000</span>-01-03    <span class="number">0.183051</span></span><br><span class="line"><span class="number">2000</span>-01-04    <span class="number">2.395489</span></span><br><span class="line"><span class="number">2000</span>-01-05    <span class="number">2.395489</span></span><br><span class="line"><span class="number">2000</span>-01-06    <span class="number">2.395489</span></span><br><span class="line"><span class="number">2000</span>-01-07    <span class="number">0.733639</span></span><br><span class="line"><span class="number">2000</span>-01-08    <span class="number">0.733639</span></span><br><span class="line"><span class="number">2000</span>-01-09    <span class="number">0.733639</span></span><br><span class="line"><span class="number">2000</span>-01-<span class="number">10</span>         NaN</span><br><span class="line">Freq: D, dtype: float64</span><br><span class="line"></span><br><span class="line">In [<span class="number">227</span>]: ts2.reindex(ts.index, method=<span class="string">&#x27;nearest&#x27;</span>)</span><br><span class="line">Out[<span class="number">227</span>]: </span><br><span class="line"><span class="number">2000</span>-01-03    <span class="number">0.183051</span></span><br><span class="line"><span class="number">2000</span>-01-04    <span class="number">0.183051</span></span><br><span class="line"><span class="number">2000</span>-01-05    <span class="number">2.395489</span></span><br><span class="line"><span class="number">2000</span>-01-06    <span class="number">2.395489</span></span><br><span class="line"><span class="number">2000</span>-01-07    <span class="number">2.395489</span></span><br><span class="line"><span class="number">2000</span>-01-08    <span class="number">0.733639</span></span><br><span class="line"><span class="number">2000</span>-01-09    <span class="number">0.733639</span></span><br><span class="line"><span class="number">2000</span>-01-<span class="number">10</span>    <span class="number">0.733639</span></span><br><span class="line">Freq: D, dtype: float64</span><br></pre></td></tr></table></figure><p>上述操作要求索引按递增或递减<strong>排序</strong>。</p><p>注意：除了 <code>method=&#39;nearest&#39;</code>，用 <a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/user_guide/missing_data.html#missing-data-fillna"><code>fillna</code></a> 或 <a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/user_guide/missing_data.html#missing-data-interpolate"><code>interpolate</code></a> 也能实现同样的效果：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">228</span>]: ts2.reindex(ts.index).fillna(method=<span class="string">&#x27;ffill&#x27;</span>)</span><br><span class="line">Out[<span class="number">228</span>]: </span><br><span class="line"><span class="number">2000</span>-01-03    <span class="number">0.183051</span></span><br><span class="line"><span class="number">2000</span>-01-04    <span class="number">0.183051</span></span><br><span class="line"><span class="number">2000</span>-01-05    <span class="number">0.183051</span></span><br><span class="line"><span class="number">2000</span>-01-06    <span class="number">2.395489</span></span><br><span class="line"><span class="number">2000</span>-01-07    <span class="number">2.395489</span></span><br><span class="line"><span class="number">2000</span>-01-08    <span class="number">2.395489</span></span><br><span class="line"><span class="number">2000</span>-01-09    <span class="number">0.733639</span></span><br><span class="line"><span class="number">2000</span>-01-<span class="number">10</span>    <span class="number">0.733639</span></span><br><span class="line">Freq: D, dtype: float64</span><br></pre></td></tr></table></figure><p>如果索引不是按递增或递减排序，<a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.Series.reindex.html#pandas.Series.reindex" title="pandas.Series.reindex"><code>reindex()</code></a> 会触发 ValueError 错误。<a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.Series.fillna.html#pandas.Series.fillna" title="pandas.Series.fillna"><code>fillna()</code></a> 与 <a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.Series.interpolate.html#pandas.Series.interpolate" title="pandas.Series.interpolate"><code>interpolate()</code></a> 则不检查索引的排序。</p><h3 id="重置索引填充的限制"><a href="#重置索引填充的限制" class="headerlink" title="重置索引填充的限制"></a>重置索引填充的限制</h3><p><code>limit</code> 与 <code>tolerance</code> 参数可以控制 <code>reindex</code> 的填充操作。<code>limit</code> 限定了连续匹配的最大数量：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">229</span>]: ts2.reindex(ts.index, method=<span class="string">&#x27;ffill&#x27;</span>, limit=<span class="number">1</span>)</span><br><span class="line">Out[<span class="number">229</span>]: </span><br><span class="line"><span class="number">2000</span>-01-03    <span class="number">0.183051</span></span><br><span class="line"><span class="number">2000</span>-01-04    <span class="number">0.183051</span></span><br><span class="line"><span class="number">2000</span>-01-05         NaN</span><br><span class="line"><span class="number">2000</span>-01-06    <span class="number">2.395489</span></span><br><span class="line"><span class="number">2000</span>-01-07    <span class="number">2.395489</span></span><br><span class="line"><span class="number">2000</span>-01-08         NaN</span><br><span class="line"><span class="number">2000</span>-01-09    <span class="number">0.733639</span></span><br><span class="line"><span class="number">2000</span>-01-<span class="number">10</span>    <span class="number">0.733639</span></span><br><span class="line">Freq: D, dtype: float64</span><br></pre></td></tr></table></figure><p>反之，<code>tolerance</code> 限定了索引与索引器值之间的最大距离：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">230</span>]: ts2.reindex(ts.index, method=<span class="string">&#x27;ffill&#x27;</span>, tolerance=<span class="string">&#x27;1 day&#x27;</span>)</span><br><span class="line">Out[<span class="number">230</span>]: </span><br><span class="line"><span class="number">2000</span>-01-03    <span class="number">0.183051</span></span><br><span class="line"><span class="number">2000</span>-01-04    <span class="number">0.183051</span></span><br><span class="line"><span class="number">2000</span>-01-05         NaN</span><br><span class="line"><span class="number">2000</span>-01-06    <span class="number">2.395489</span></span><br><span class="line"><span class="number">2000</span>-01-07    <span class="number">2.395489</span></span><br><span class="line"><span class="number">2000</span>-01-08         NaN</span><br><span class="line"><span class="number">2000</span>-01-09    <span class="number">0.733639</span></span><br><span class="line"><span class="number">2000</span>-01-<span class="number">10</span>    <span class="number">0.733639</span></span><br><span class="line">Freq: D, dtype: float64</span><br></pre></td></tr></table></figure><p>注意：索引为 <code>DatetimeIndex</code>、<code>TimedeltaIndex</code> 或 <code>PeriodIndex</code> 时，<code>tolerance</code> 会尽可能将这些索引强制转换为 <code>Timedelta</code>，这里要求用户用恰当的字符串设定 <code>tolerance</code> 参数。</p><h3 id="去掉轴上的标签"><a href="#去掉轴上的标签" class="headerlink" title="去掉轴上的标签"></a>去掉轴上的标签</h3><p><a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.drop.html#pandas.DataFrame.drop" title="pandas.DataFrame.drop"><code>drop()</code></a> 函数与 <code>reindex</code> 经常配合使用，该函数用于删除轴上的一组标签：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">231</span>]: df</span><br><span class="line">Out[<span class="number">231</span>]: </span><br><span class="line">        one       two     three</span><br><span class="line">a  <span class="number">1.394981</span>  <span class="number">1.772517</span>       NaN</span><br><span class="line">b  <span class="number">0.343054</span>  <span class="number">1.912123</span> -<span class="number">0.050390</span></span><br><span class="line">c  <span class="number">0.695246</span>  <span class="number">1.478369</span>  <span class="number">1.227435</span></span><br><span class="line">d       NaN  <span class="number">0.279344</span> -<span class="number">0.613172</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">232</span>]: df.drop([<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;d&#x27;</span>], axis=<span class="number">0</span>)</span><br><span class="line">Out[<span class="number">232</span>]: </span><br><span class="line">        one       two     three</span><br><span class="line">b  <span class="number">0.343054</span>  <span class="number">1.912123</span> -<span class="number">0.050390</span></span><br><span class="line">c  <span class="number">0.695246</span>  <span class="number">1.478369</span>  <span class="number">1.227435</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">233</span>]: df.drop([<span class="string">&#x27;one&#x27;</span>], axis=<span class="number">1</span>)</span><br><span class="line">Out[<span class="number">233</span>]: </span><br><span class="line">        two     three</span><br><span class="line">a  <span class="number">1.772517</span>       NaN</span><br><span class="line">b  <span class="number">1.912123</span> -<span class="number">0.050390</span></span><br><span class="line">c  <span class="number">1.478369</span>  <span class="number">1.227435</span></span><br><span class="line">d  <span class="number">0.279344</span> -<span class="number">0.613172</span></span><br></pre></td></tr></table></figure><p>注意：下面的代码可以运行，但不够清晰：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">234</span>]: df.reindex(df.index.difference([<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;d&#x27;</span>]))</span><br><span class="line">Out[<span class="number">234</span>]: </span><br><span class="line">        one       two     three</span><br><span class="line">b  <span class="number">0.343054</span>  <span class="number">1.912123</span> -<span class="number">0.050390</span></span><br><span class="line">c  <span class="number">0.695246</span>  <span class="number">1.478369</span>  <span class="number">1.227435</span></span><br></pre></td></tr></table></figure><h3 id="重命名或映射标签"><a href="#重命名或映射标签" class="headerlink" title="重命名或映射标签"></a>重命名或映射标签</h3><p><a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.rename.html#pandas.DataFrame.rename" title="pandas.DataFrame.rename"><code>rename()</code></a> 方法支持按不同的轴基于映射（字典或 Series）调整标签。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">235</span>]: s</span><br><span class="line">Out[<span class="number">235</span>]: </span><br><span class="line">a   -<span class="number">0.186646</span></span><br><span class="line">b   -<span class="number">1.692424</span></span><br><span class="line">c   -<span class="number">0.303893</span></span><br><span class="line">d   -<span class="number">1.425662</span></span><br><span class="line">e    <span class="number">1.114285</span></span><br><span class="line">dtype: float64</span><br><span class="line"></span><br><span class="line">In [<span class="number">236</span>]: s.rename(<span class="built_in">str</span>.upper)</span><br><span class="line">Out[<span class="number">236</span>]: </span><br><span class="line">A   -<span class="number">0.186646</span></span><br><span class="line">B   -<span class="number">1.692424</span></span><br><span class="line">C   -<span class="number">0.303893</span></span><br><span class="line">D   -<span class="number">1.425662</span></span><br><span class="line">E    <span class="number">1.114285</span></span><br><span class="line">dtype: float64</span><br></pre></td></tr></table></figure><p>如果调用的是函数，该函数在处理标签时，必须返回一个值，而且生成的必须是一组唯一值。此外，<code>rename()</code> 还可以调用字典或 Series。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">237</span>]: df.rename(columns=&#123;<span class="string">&#x27;one&#x27;</span>: <span class="string">&#x27;foo&#x27;</span>, <span class="string">&#x27;two&#x27;</span>: <span class="string">&#x27;bar&#x27;</span>&#125;,</span><br><span class="line">   .....:           index=&#123;<span class="string">&#x27;a&#x27;</span>: <span class="string">&#x27;apple&#x27;</span>, <span class="string">&#x27;b&#x27;</span>: <span class="string">&#x27;banana&#x27;</span>, <span class="string">&#x27;d&#x27;</span>: <span class="string">&#x27;durian&#x27;</span>&#125;)</span><br><span class="line">   .....: </span><br><span class="line">Out[<span class="number">237</span>]: </span><br><span class="line">             foo       bar     three</span><br><span class="line">apple   <span class="number">1.394981</span>  <span class="number">1.772517</span>       NaN</span><br><span class="line">banana  <span class="number">0.343054</span>  <span class="number">1.912123</span> -<span class="number">0.050390</span></span><br><span class="line">c       <span class="number">0.695246</span>  <span class="number">1.478369</span>  <span class="number">1.227435</span></span><br><span class="line">durian       NaN  <span class="number">0.279344</span> -<span class="number">0.613172</span></span><br></pre></td></tr></table></figure><p>Pandas 不会重命名标签未包含在映射里的列或索引。注意，映射里多出的标签不会触发错误。</p><p><em>0.21.0 版新增</em>。</p><p><a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.rename.html#pandas.DataFrame.rename" title="pandas.DataFrame.rename"><code>DataFrame.rename()</code></a> 还支持“轴式”习语，用这种方式可以指定单个 <code>mapper</code>，及执行映射的 <code>axis</code>。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">238</span>]: df.rename(&#123;<span class="string">&#x27;one&#x27;</span>: <span class="string">&#x27;foo&#x27;</span>, <span class="string">&#x27;two&#x27;</span>: <span class="string">&#x27;bar&#x27;</span>&#125;, axis=<span class="string">&#x27;columns&#x27;</span>)</span><br><span class="line">Out[<span class="number">238</span>]: </span><br><span class="line">        foo       bar     three</span><br><span class="line">a  <span class="number">1.394981</span>  <span class="number">1.772517</span>       NaN</span><br><span class="line">b  <span class="number">0.343054</span>  <span class="number">1.912123</span> -<span class="number">0.050390</span></span><br><span class="line">c  <span class="number">0.695246</span>  <span class="number">1.478369</span>  <span class="number">1.227435</span></span><br><span class="line">d       NaN  <span class="number">0.279344</span> -<span class="number">0.613172</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">239</span>]: df.rename(&#123;<span class="string">&#x27;a&#x27;</span>: <span class="string">&#x27;apple&#x27;</span>, <span class="string">&#x27;b&#x27;</span>: <span class="string">&#x27;banana&#x27;</span>, <span class="string">&#x27;d&#x27;</span>: <span class="string">&#x27;durian&#x27;</span>&#125;, axis=<span class="string">&#x27;index&#x27;</span>)</span><br><span class="line">Out[<span class="number">239</span>]: </span><br><span class="line">             one       two     three</span><br><span class="line">apple   <span class="number">1.394981</span>  <span class="number">1.772517</span>       NaN</span><br><span class="line">banana  <span class="number">0.343054</span>  <span class="number">1.912123</span> -<span class="number">0.050390</span></span><br><span class="line">c       <span class="number">0.695246</span>  <span class="number">1.478369</span>  <span class="number">1.227435</span></span><br><span class="line">durian       NaN  <span class="number">0.279344</span> -<span class="number">0.613172</span></span><br></pre></td></tr></table></figure><p><a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.Series.rename.html#pandas.Series.rename" title="pandas.Series.rename"><code>rename()</code></a> 方法还提供了 <code>inplace</code> 命名参数，默认为 <code>False</code>，并会复制底层数据。<code>inplace=True</code> 时，会直接在原数据上重命名。</p><p><em>0.18.0 版新增</em>。</p><p><a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.Series.rename.html#pandas.Series.rename" title="pandas.Series.rename"><code>rename()</code></a> 还支持用标量或列表更改 <code>Series.name</code> 属性。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">240</span>]: s.rename(<span class="string">&quot;scalar-name&quot;</span>)</span><br><span class="line">Out[<span class="number">240</span>]: </span><br><span class="line">a   -<span class="number">0.186646</span></span><br><span class="line">b   -<span class="number">1.692424</span></span><br><span class="line">c   -<span class="number">0.303893</span></span><br><span class="line">d   -<span class="number">1.425662</span></span><br><span class="line">e    <span class="number">1.114285</span></span><br><span class="line">Name: scalar-name, dtype: float64</span><br></pre></td></tr></table></figure><p><em>0.24.0 版新增</em>。</p><p><a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.Series.rename_axis.html#pandas.Series.rename_axis" title="pandas.Series.rename_axis"><code>rename_axis()</code></a> 方法支持指定 <code>多层索引</code> 名称，与标签相对应。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">241</span>]: df = pd.DataFrame(&#123;<span class="string">&#x27;x&#x27;</span>: [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>],</span><br><span class="line">   .....:                    <span class="string">&#x27;y&#x27;</span>: [<span class="number">10</span>, <span class="number">20</span>, <span class="number">30</span>, <span class="number">40</span>, <span class="number">50</span>, <span class="number">60</span>]&#125;,</span><br><span class="line">   .....:                   index=pd.MultiIndex.from_product([[<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;c&#x27;</span>], [<span class="number">1</span>, <span class="number">2</span>]],</span><br><span class="line">   .....:                   names=[<span class="string">&#x27;let&#x27;</span>, <span class="string">&#x27;num&#x27;</span>]))</span><br><span class="line">   .....: </span><br><span class="line"></span><br><span class="line">In [<span class="number">242</span>]: df</span><br><span class="line">Out[<span class="number">242</span>]: </span><br><span class="line">         x   y</span><br><span class="line">let num       </span><br><span class="line">a   <span class="number">1</span>    <span class="number">1</span>  <span class="number">10</span></span><br><span class="line">    <span class="number">2</span>    <span class="number">2</span>  <span class="number">20</span></span><br><span class="line">b   <span class="number">1</span>    <span class="number">3</span>  <span class="number">30</span></span><br><span class="line">    <span class="number">2</span>    <span class="number">4</span>  <span class="number">40</span></span><br><span class="line">c   <span class="number">1</span>    <span class="number">5</span>  <span class="number">50</span></span><br><span class="line">    <span class="number">2</span>    <span class="number">6</span>  <span class="number">60</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">243</span>]: df.rename_axis(index=&#123;<span class="string">&#x27;let&#x27;</span>: <span class="string">&#x27;abc&#x27;</span>&#125;)</span><br><span class="line">Out[<span class="number">243</span>]: </span><br><span class="line">         x   y</span><br><span class="line">abc num       </span><br><span class="line">a   <span class="number">1</span>    <span class="number">1</span>  <span class="number">10</span></span><br><span class="line">    <span class="number">2</span>    <span class="number">2</span>  <span class="number">20</span></span><br><span class="line">b   <span class="number">1</span>    <span class="number">3</span>  <span class="number">30</span></span><br><span class="line">    <span class="number">2</span>    <span class="number">4</span>  <span class="number">40</span></span><br><span class="line">c   <span class="number">1</span>    <span class="number">5</span>  <span class="number">50</span></span><br><span class="line">    <span class="number">2</span>    <span class="number">6</span>  <span class="number">60</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">244</span>]: df.rename_axis(index=<span class="built_in">str</span>.upper)</span><br><span class="line">Out[<span class="number">244</span>]: </span><br><span class="line">         x   y</span><br><span class="line">LET NUM       </span><br><span class="line">a   <span class="number">1</span>    <span class="number">1</span>  <span class="number">10</span></span><br><span class="line">    <span class="number">2</span>    <span class="number">2</span>  <span class="number">20</span></span><br><span class="line">b   <span class="number">1</span>    <span class="number">3</span>  <span class="number">30</span></span><br><span class="line">    <span class="number">2</span>    <span class="number">4</span>  <span class="number">40</span></span><br><span class="line">c   <span class="number">1</span>    <span class="number">5</span>  <span class="number">50</span></span><br><span class="line">    <span class="number">2</span>    <span class="number">6</span>  <span class="number">60</span></span><br></pre></td></tr></table></figure><h2 id="迭代"><a href="#迭代" class="headerlink" title="迭代"></a>迭代</h2><p>Pandas 对象基于类型进行迭代操作。Series 迭代时被视为数组，基础迭代生成值。DataFrame 则遵循字典式习语，用对象的 <code>key</code> 实现迭代操作。</p><p>简言之，基础迭代（<code>for i in object</code>）生成：</p><ul><li><strong>Series</strong> ：值</li><li><strong>DataFrame</strong>：列标签</li></ul><p>例如，DataFrame 迭代时输出列名：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">245</span>]: df = pd.DataFrame(&#123;<span class="string">&#x27;col1&#x27;</span>: np.random.randn(<span class="number">3</span>),</span><br><span class="line">   .....:                    <span class="string">&#x27;col2&#x27;</span>: np.random.randn(<span class="number">3</span>)&#125;, index=[<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;c&#x27;</span>])</span><br><span class="line">   .....: </span><br><span class="line"></span><br><span class="line">In [<span class="number">246</span>]: <span class="keyword">for</span> col <span class="keyword">in</span> df:</span><br><span class="line">   .....:     <span class="built_in">print</span>(col)</span><br><span class="line">   .....: </span><br><span class="line">col1</span><br><span class="line">col2</span><br></pre></td></tr></table></figure><p>Pandas 对象还支持字典式的 <a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.items.html#pandas.DataFrame.items" title="pandas.DataFrame.items"><code>items()</code></a> 方法，通过键值对迭代。</p><p>用下列方法可以迭代 DataFrame 里的行：</p><ul><li><p><a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.iterrows.html#pandas.DataFrame.iterrows" title="pandas.DataFrame.iterrows"><code>iterrows()</code></a>：把 DataFrame 里的行当作 （index， Series）对进行迭代。该操作把行转为 Series，同时改变数据类型，并对性能有影响。</p></li><li><p><a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.itertuples.html#pandas.DataFrame.itertuples" title="pandas.DataFrame.itertuples"><code>itertuples()</code></a> 把 DataFrame 的行当作值的命名元组进行迭代。该操作比 <a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.iterrows.html#pandas.DataFrame.iterrows" title="pandas.DataFrame.iterrows"><code>iterrows()</code></a> 快的多，建议尽量用这种方法迭代 DataFrame 的值。</p></li></ul><p>::: danger 警告</p><p>Pandas 对象迭代的速度较慢。大部分情况下，没必要对行执行迭代操作，建议用以下几种替代方式：</p><ul><li>矢量化：很多操作可以用内置方法或 NumPy 函数，布尔索引……</li><li>调用的函数不能在完整的 DataFrame / Series 上运行时，最好用 <a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.apply.html#pandas.DataFrame.apply" title="pandas.DataFrame.apply"><code>apply()</code></a>，不要对值进行迭代操作。请参阅<a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/getting_started/basics.html#basics-apply">函数应用</a>文档。</li><li>如果必须对值进行迭代，请务必注意代码的性能，建议在 cython 或 numba 环境下实现内循环。参阅<a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/user_guide/enhancingperf.html#enhancingperf">性能优化</a>一节，查看这种操作方法的示例。</li></ul><p>:::</p><p>::: danger 警告</p><p><strong>永远不要修改</strong>迭代的内容，这种方式不能确保所有操作都能正常运作。基于数据类型，迭代器返回的是复制（copy）的结果，不是视图（view），这种写入可能不会生效！</p><p>下例中的赋值就不会生效：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">247</span>]: df = pd.DataFrame(&#123;<span class="string">&#x27;a&#x27;</span>: [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>], <span class="string">&#x27;b&#x27;</span>: [<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;c&#x27;</span>]&#125;)</span><br><span class="line"></span><br><span class="line">In [<span class="number">248</span>]: <span class="keyword">for</span> index, row <span class="keyword">in</span> df.iterrows():</span><br><span class="line">.....:     row[<span class="string">&#x27;a&#x27;</span>] = <span class="number">10</span></span><br><span class="line">.....: </span><br><span class="line"></span><br><span class="line">In [<span class="number">249</span>]: df</span><br><span class="line">Out[<span class="number">249</span>]: </span><br><span class="line">a  b</span><br><span class="line"><span class="number">0</span>  <span class="number">1</span>  a</span><br><span class="line"><span class="number">1</span>  <span class="number">2</span>  b</span><br><span class="line"><span class="number">2</span>  <span class="number">3</span>  c</span><br></pre></td></tr></table></figure><p>:::</p><h3 id="项目（items）"><a href="#项目（items）" class="headerlink" title="项目（items）"></a>项目（items）</h3><p>与字典型接口类似，<a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.items.html#pandas.DataFrame.items" title="pandas.DataFrame.items"><code>items()</code></a> 通过键值对进行迭代：</p><ul><li><strong>Series</strong>：（Index，标量值）对</li><li><strong>DataFrame</strong>：（列，Series）对</li></ul><p>示例如下：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">250</span>]: <span class="keyword">for</span> label, ser <span class="keyword">in</span> df.items():</span><br><span class="line">   .....:     <span class="built_in">print</span>(label)</span><br><span class="line">   .....:     <span class="built_in">print</span>(ser)</span><br><span class="line">   .....: </span><br><span class="line">a</span><br><span class="line"><span class="number">0</span>    <span class="number">1</span></span><br><span class="line"><span class="number">1</span>    <span class="number">2</span></span><br><span class="line"><span class="number">2</span>    <span class="number">3</span></span><br><span class="line">Name: a, dtype: int64</span><br><span class="line">b</span><br><span class="line"><span class="number">0</span>    a</span><br><span class="line"><span class="number">1</span>    b</span><br><span class="line"><span class="number">2</span>    c</span><br><span class="line">Name: b, dtype: <span class="built_in">object</span></span><br></pre></td></tr></table></figure><h3 id="iterrows"><a href="#iterrows" class="headerlink" title="iterrows"></a>iterrows</h3><p><a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.iterrows.html#pandas.DataFrame.iterrows" title="pandas.DataFrame.iterrows"><code>iterrows()</code></a> 迭代 DataFrame 或 Series 里的每一行数据。这个操作返回一个迭代器，生成索引值及包含每行数据的 Series：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">251</span>]: <span class="keyword">for</span> row_index, row <span class="keyword">in</span> df.iterrows():</span><br><span class="line">   .....:     <span class="built_in">print</span>(row_index, row, sep=<span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line">   .....: </span><br><span class="line"><span class="number">0</span></span><br><span class="line">a    <span class="number">1</span></span><br><span class="line">b    a</span><br><span class="line">Name: <span class="number">0</span>, dtype: <span class="built_in">object</span></span><br><span class="line"><span class="number">1</span></span><br><span class="line">a    <span class="number">2</span></span><br><span class="line">b    b</span><br><span class="line">Name: <span class="number">1</span>, dtype: <span class="built_in">object</span></span><br><span class="line"><span class="number">2</span></span><br><span class="line">a    <span class="number">3</span></span><br><span class="line">b    c</span><br><span class="line">Name: <span class="number">2</span>, dtype: <span class="built_in">object</span></span><br></pre></td></tr></table></figure><p>::: tip 注意</p><p><a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.iterrows.html#pandas.DataFrame.iterrows" title="pandas.DataFrame.iterrows"><code>iterrows()</code></a> 返回的是 Series 里的每一行数据，该操作<strong>不</strong>保留每行数据的数据类型，因为数据类型是通过 DataFrame 的列界定的。</p><p>示例如下：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">252</span>]: df_orig = pd.DataFrame([[<span class="number">1</span>, <span class="number">1.5</span>]], columns=[<span class="string">&#x27;int&#x27;</span>, <span class="string">&#x27;float&#x27;</span>])</span><br><span class="line"></span><br><span class="line">In [<span class="number">253</span>]: df_orig.dtypes</span><br><span class="line">Out[<span class="number">253</span>]: </span><br><span class="line"><span class="built_in">int</span>        int64</span><br><span class="line"><span class="built_in">float</span>    float64</span><br><span class="line">dtype: <span class="built_in">object</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">254</span>]: row = <span class="built_in">next</span>(df_orig.iterrows())[<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line">In [<span class="number">255</span>]: row</span><br><span class="line">Out[<span class="number">255</span>]: </span><br><span class="line"><span class="built_in">int</span>      <span class="number">1.0</span></span><br><span class="line"><span class="built_in">float</span>    <span class="number">1.5</span></span><br><span class="line">Name: <span class="number">0</span>, dtype: float64</span><br></pre></td></tr></table></figure><p><code>row</code> 里的值以 Series 形式返回，并被转换为浮点数，原始的整数值则在列 X：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">In [256]: row[&#x27;int&#x27;].dtype</span><br><span class="line">Out[256]: dtype(&#x27;float64&#x27;)</span><br><span class="line"></span><br><span class="line">In [257]: df_orig[&#x27;int&#x27;].dtype</span><br><span class="line">Out[257]: dtype(&#x27;int64&#x27;)</span><br></pre></td></tr></table></figure><p>要想在行迭代时保存数据类型，最好用 <a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.itertuples.html#pandas.DataFrame.itertuples" title="pandas.DataFrame.itertuples"><code>itertuples()</code></a>，这个函数返回值的命名元组，总的来说，该操作比 <a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.iterrows.html#pandas.DataFrame.iterrows" title="pandas.DataFrame.iterrows"><code>iterrows()</code></a> 速度更快。</p><p>:::</p><p>下例展示了怎样转置 DataFrame：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">258</span>]: df2 = pd.DataFrame(&#123;<span class="string">&#x27;x&#x27;</span>: [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>], <span class="string">&#x27;y&#x27;</span>: [<span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>]&#125;)</span><br><span class="line"></span><br><span class="line">In [<span class="number">259</span>]: <span class="built_in">print</span>(df2)</span><br><span class="line">   x  y</span><br><span class="line"><span class="number">0</span>  <span class="number">1</span>  <span class="number">4</span></span><br><span class="line"><span class="number">1</span>  <span class="number">2</span>  <span class="number">5</span></span><br><span class="line"><span class="number">2</span>  <span class="number">3</span>  <span class="number">6</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">260</span>]: <span class="built_in">print</span>(df2.T)</span><br><span class="line">   <span class="number">0</span>  <span class="number">1</span>  <span class="number">2</span></span><br><span class="line">x  <span class="number">1</span>  <span class="number">2</span>  <span class="number">3</span></span><br><span class="line">y  <span class="number">4</span>  <span class="number">5</span>  <span class="number">6</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">261</span>]: df2_t = pd.DataFrame(&#123;idx: values <span class="keyword">for</span> idx, values <span class="keyword">in</span> df2.iterrows()&#125;)</span><br><span class="line"></span><br><span class="line">In [<span class="number">262</span>]: <span class="built_in">print</span>(df2_t)</span><br><span class="line">   <span class="number">0</span>  <span class="number">1</span>  <span class="number">2</span></span><br><span class="line">x  <span class="number">1</span>  <span class="number">2</span>  <span class="number">3</span></span><br><span class="line">y  <span class="number">4</span>  <span class="number">5</span>  <span class="number">6</span></span><br></pre></td></tr></table></figure><h3 id="itertuples"><a href="#itertuples" class="headerlink" title="itertuples"></a>itertuples</h3><p><a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.itertuples.html#pandas.DataFrame.itertuples" title="pandas.DataFrame.itertuples"><code>itertuples()</code></a> 方法返回为 DataFrame 里每行数据生成命名元组的迭代器。该元组的第一个元素是行的索引值，其余的值则是行的值。</p><p>示例如下：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">263</span>]: <span class="keyword">for</span> row <span class="keyword">in</span> df.itertuples():</span><br><span class="line">   .....:     <span class="built_in">print</span>(row)</span><br><span class="line">   .....: </span><br><span class="line">Pandas(Index=<span class="number">0</span>, a=<span class="number">1</span>, b=<span class="string">&#x27;a&#x27;</span>)</span><br><span class="line">Pandas(Index=<span class="number">1</span>, a=<span class="number">2</span>, b=<span class="string">&#x27;b&#x27;</span>)</span><br><span class="line">Pandas(Index=<span class="number">2</span>, a=<span class="number">3</span>, b=<span class="string">&#x27;c&#x27;</span>)</span><br></pre></td></tr></table></figure><p>该方法不会把行转换为 Series，只是返回命名元组里的值。<a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.itertuples.html#pandas.DataFrame.itertuples" title="pandas.DataFrame.itertuples"><code>itertuples()</code></a> 保存值的数据类型，而且比 <a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.iterrows.html#pandas.DataFrame.iterrows" title="pandas.DataFrame.iterrows"><code>iterrows()</code></a> 快。</p><p>::: tip 注意</p><p>包含无效 Python 识别符的列名、重复的列名及以下划线开头的列名，会被重命名为位置名称。如果列数较大，比如大于 255 列，则返回正则元组。</p><p>:::</p><h2 id="dt-访问器"><a href="#dt-访问器" class="headerlink" title=".dt 访问器"></a>.dt 访问器</h2><p><code>Series</code> 提供一个可以简单、快捷地返回 <code>datetime</code> 属性值的访问器。这个访问器返回的也是 Series，索引与现有的 Series 一样。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># datetime</span></span><br><span class="line">In [<span class="number">264</span>]: s = pd.Series(pd.date_range(<span class="string">&#x27;20130101 09:10:12&#x27;</span>, periods=<span class="number">4</span>))</span><br><span class="line"></span><br><span class="line">In [<span class="number">265</span>]: s</span><br><span class="line">Out[<span class="number">265</span>]: </span><br><span class="line"><span class="number">0</span>   <span class="number">2013</span>-01-01 09:<span class="number">10</span>:<span class="number">12</span></span><br><span class="line"><span class="number">1</span>   <span class="number">2013</span>-01-02 09:<span class="number">10</span>:<span class="number">12</span></span><br><span class="line"><span class="number">2</span>   <span class="number">2013</span>-01-03 09:<span class="number">10</span>:<span class="number">12</span></span><br><span class="line"><span class="number">3</span>   <span class="number">2013</span>-01-04 09:<span class="number">10</span>:<span class="number">12</span></span><br><span class="line">dtype: datetime64[ns]</span><br><span class="line"></span><br><span class="line">In [<span class="number">266</span>]: s.dt.hour</span><br><span class="line">Out[<span class="number">266</span>]: </span><br><span class="line"><span class="number">0</span>    <span class="number">9</span></span><br><span class="line"><span class="number">1</span>    <span class="number">9</span></span><br><span class="line"><span class="number">2</span>    <span class="number">9</span></span><br><span class="line"><span class="number">3</span>    <span class="number">9</span></span><br><span class="line">dtype: int64</span><br><span class="line"></span><br><span class="line">In [<span class="number">267</span>]: s.dt.second</span><br><span class="line">Out[<span class="number">267</span>]: </span><br><span class="line"><span class="number">0</span>    <span class="number">12</span></span><br><span class="line"><span class="number">1</span>    <span class="number">12</span></span><br><span class="line"><span class="number">2</span>    <span class="number">12</span></span><br><span class="line"><span class="number">3</span>    <span class="number">12</span></span><br><span class="line">dtype: int64</span><br><span class="line"></span><br><span class="line">In [<span class="number">268</span>]: s.dt.day</span><br><span class="line">Out[<span class="number">268</span>]: </span><br><span class="line"><span class="number">0</span>    <span class="number">1</span></span><br><span class="line"><span class="number">1</span>    <span class="number">2</span></span><br><span class="line"><span class="number">2</span>    <span class="number">3</span></span><br><span class="line"><span class="number">3</span>    <span class="number">4</span></span><br><span class="line">dtype: int64</span><br></pre></td></tr></table></figure><p>用下列表达式进行筛选非常方便：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">269</span>]: s[s.dt.day == <span class="number">2</span>]</span><br><span class="line">Out[<span class="number">269</span>]: </span><br><span class="line"><span class="number">1</span>   <span class="number">2013</span>-01-02 09:<span class="number">10</span>:<span class="number">12</span></span><br><span class="line">dtype: datetime64[ns]</span><br></pre></td></tr></table></figure><p>时区转换也很轻松：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">270</span>]: stz = s.dt.tz_localize(<span class="string">&#x27;US/Eastern&#x27;</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">271</span>]: stz</span><br><span class="line">Out[<span class="number">271</span>]: </span><br><span class="line"><span class="number">0</span>   <span class="number">2013</span>-01-01 09:<span class="number">10</span>:<span class="number">12</span>-05:<span class="number">00</span></span><br><span class="line"><span class="number">1</span>   <span class="number">2013</span>-01-02 09:<span class="number">10</span>:<span class="number">12</span>-05:<span class="number">00</span></span><br><span class="line"><span class="number">2</span>   <span class="number">2013</span>-01-03 09:<span class="number">10</span>:<span class="number">12</span>-05:<span class="number">00</span></span><br><span class="line"><span class="number">3</span>   <span class="number">2013</span>-01-04 09:<span class="number">10</span>:<span class="number">12</span>-05:<span class="number">00</span></span><br><span class="line">dtype: datetime64[ns, US/Eastern]</span><br><span class="line"></span><br><span class="line">In [<span class="number">272</span>]: stz.dt.tz</span><br><span class="line">Out[<span class="number">272</span>]: &lt;DstTzInfo <span class="string">&#x27;US/Eastern&#x27;</span> LMT-<span class="number">1</span> day, <span class="number">19</span>:04:<span class="number">00</span> STD&gt;</span><br></pre></td></tr></table></figure><p>可以把这些操作连在一起：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">273</span>]: s.dt.tz_localize(<span class="string">&#x27;UTC&#x27;</span>).dt.tz_convert(<span class="string">&#x27;US/Eastern&#x27;</span>)</span><br><span class="line">Out[<span class="number">273</span>]: </span><br><span class="line"><span class="number">0</span>   <span class="number">2013</span>-01-01 04:<span class="number">10</span>:<span class="number">12</span>-05:<span class="number">00</span></span><br><span class="line"><span class="number">1</span>   <span class="number">2013</span>-01-02 04:<span class="number">10</span>:<span class="number">12</span>-05:<span class="number">00</span></span><br><span class="line"><span class="number">2</span>   <span class="number">2013</span>-01-03 04:<span class="number">10</span>:<span class="number">12</span>-05:<span class="number">00</span></span><br><span class="line"><span class="number">3</span>   <span class="number">2013</span>-01-04 04:<span class="number">10</span>:<span class="number">12</span>-05:<span class="number">00</span></span><br><span class="line">dtype: datetime64[ns, US/Eastern]</span><br></pre></td></tr></table></figure><p>还可以用 <a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.Series.dt.strftime.html#pandas.Series.dt.strftime" title="pandas.Series.dt.strftime"><code>Series.dt.strftime()</code></a> 把 <code>datetime</code> 的值当成字符串进行格式化，支持与标准 <a target="_blank" rel="noopener" href="https://docs.python.org/3/library/datetime.html#datetime.datetime.strftime" title="(in Python v3.7)"><code>strftime()</code></a> 同样的格式。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># DatetimeIndex</span></span><br><span class="line">In [<span class="number">274</span>]: s = pd.Series(pd.date_range(<span class="string">&#x27;20130101&#x27;</span>, periods=<span class="number">4</span>))</span><br><span class="line"></span><br><span class="line">In [<span class="number">275</span>]: s</span><br><span class="line">Out[<span class="number">275</span>]: </span><br><span class="line"><span class="number">0</span>   <span class="number">2013</span>-01-01</span><br><span class="line"><span class="number">1</span>   <span class="number">2013</span>-01-02</span><br><span class="line"><span class="number">2</span>   <span class="number">2013</span>-01-03</span><br><span class="line"><span class="number">3</span>   <span class="number">2013</span>-01-04</span><br><span class="line">dtype: datetime64[ns]</span><br><span class="line"></span><br><span class="line">In [<span class="number">276</span>]: s.dt.strftime(<span class="string">&#x27;%Y/%m/%d&#x27;</span>)</span><br><span class="line">Out[<span class="number">276</span>]: </span><br><span class="line"><span class="number">0</span>    <span class="number">2013</span>/01/01</span><br><span class="line"><span class="number">1</span>    <span class="number">2013</span>/01/02</span><br><span class="line"><span class="number">2</span>    <span class="number">2013</span>/01/03</span><br><span class="line"><span class="number">3</span>    <span class="number">2013</span>/01/04</span><br><span class="line">dtype: <span class="built_in">object</span></span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># PeriodIndex</span></span><br><span class="line">In [<span class="number">277</span>]: s = pd.Series(pd.period_range(<span class="string">&#x27;20130101&#x27;</span>, periods=<span class="number">4</span>))</span><br><span class="line"></span><br><span class="line">In [<span class="number">278</span>]: s</span><br><span class="line">Out[<span class="number">278</span>]: </span><br><span class="line"><span class="number">0</span>    <span class="number">2013</span>-01-01</span><br><span class="line"><span class="number">1</span>    <span class="number">2013</span>-01-02</span><br><span class="line"><span class="number">2</span>    <span class="number">2013</span>-01-03</span><br><span class="line"><span class="number">3</span>    <span class="number">2013</span>-01-04</span><br><span class="line">dtype: period[D]</span><br><span class="line"></span><br><span class="line">In [<span class="number">279</span>]: s.dt.strftime(<span class="string">&#x27;%Y/%m/%d&#x27;</span>)</span><br><span class="line">Out[<span class="number">279</span>]: </span><br><span class="line"><span class="number">0</span>    <span class="number">2013</span>/01/01</span><br><span class="line"><span class="number">1</span>    <span class="number">2013</span>/01/02</span><br><span class="line"><span class="number">2</span>    <span class="number">2013</span>/01/03</span><br><span class="line"><span class="number">3</span>    <span class="number">2013</span>/01/04</span><br><span class="line">dtype: <span class="built_in">object</span></span><br></pre></td></tr></table></figure><p><code>.dt</code> 访问器还支持 <code>period</code> 与 <code>timedelta</code>。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># period</span></span><br><span class="line">In [<span class="number">280</span>]: s = pd.Series(pd.period_range(<span class="string">&#x27;20130101&#x27;</span>, periods=<span class="number">4</span>, freq=<span class="string">&#x27;D&#x27;</span>))</span><br><span class="line"></span><br><span class="line">In [<span class="number">281</span>]: s</span><br><span class="line">Out[<span class="number">281</span>]: </span><br><span class="line"><span class="number">0</span>    <span class="number">2013</span>-01-01</span><br><span class="line"><span class="number">1</span>    <span class="number">2013</span>-01-02</span><br><span class="line"><span class="number">2</span>    <span class="number">2013</span>-01-03</span><br><span class="line"><span class="number">3</span>    <span class="number">2013</span>-01-04</span><br><span class="line">dtype: period[D]</span><br><span class="line"></span><br><span class="line">In [<span class="number">282</span>]: s.dt.year</span><br><span class="line">Out[<span class="number">282</span>]: </span><br><span class="line"><span class="number">0</span>    <span class="number">2013</span></span><br><span class="line"><span class="number">1</span>    <span class="number">2013</span></span><br><span class="line"><span class="number">2</span>    <span class="number">2013</span></span><br><span class="line"><span class="number">3</span>    <span class="number">2013</span></span><br><span class="line">dtype: int64</span><br><span class="line"></span><br><span class="line">In [<span class="number">283</span>]: s.dt.day</span><br><span class="line">Out[<span class="number">283</span>]: </span><br><span class="line"><span class="number">0</span>    <span class="number">1</span></span><br><span class="line"><span class="number">1</span>    <span class="number">2</span></span><br><span class="line"><span class="number">2</span>    <span class="number">3</span></span><br><span class="line"><span class="number">3</span>    <span class="number">4</span></span><br><span class="line">dtype: int64</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># timedelta</span></span><br><span class="line">In [<span class="number">284</span>]: s = pd.Series(pd.timedelta_range(<span class="string">&#x27;1 day 00:00:05&#x27;</span>, periods=<span class="number">4</span>, freq=<span class="string">&#x27;s&#x27;</span>))</span><br><span class="line"></span><br><span class="line">In [<span class="number">285</span>]: s</span><br><span class="line">Out[<span class="number">285</span>]: </span><br><span class="line"><span class="number">0</span>   <span class="number">1</span> days <span class="number">00</span>:<span class="number">00</span>:05</span><br><span class="line"><span class="number">1</span>   <span class="number">1</span> days <span class="number">00</span>:<span class="number">00</span>:06</span><br><span class="line"><span class="number">2</span>   <span class="number">1</span> days <span class="number">00</span>:<span class="number">00</span>:07</span><br><span class="line"><span class="number">3</span>   <span class="number">1</span> days <span class="number">00</span>:<span class="number">00</span>:08</span><br><span class="line">dtype: timedelta64[ns]</span><br><span class="line"></span><br><span class="line">In [<span class="number">286</span>]: s.dt.days</span><br><span class="line">Out[<span class="number">286</span>]: </span><br><span class="line"><span class="number">0</span>    <span class="number">1</span></span><br><span class="line"><span class="number">1</span>    <span class="number">1</span></span><br><span class="line"><span class="number">2</span>    <span class="number">1</span></span><br><span class="line"><span class="number">3</span>    <span class="number">1</span></span><br><span class="line">dtype: int64</span><br><span class="line"></span><br><span class="line">In [<span class="number">287</span>]: s.dt.seconds</span><br><span class="line">Out[<span class="number">287</span>]: </span><br><span class="line"><span class="number">0</span>    <span class="number">5</span></span><br><span class="line"><span class="number">1</span>    <span class="number">6</span></span><br><span class="line"><span class="number">2</span>    <span class="number">7</span></span><br><span class="line"><span class="number">3</span>    <span class="number">8</span></span><br><span class="line">dtype: int64</span><br><span class="line"></span><br><span class="line">In [<span class="number">288</span>]: s.dt.components</span><br><span class="line">Out[<span class="number">288</span>]: </span><br><span class="line">   days  hours  minutes  seconds  milliseconds  microseconds  nanoseconds</span><br><span class="line"><span class="number">0</span>     <span class="number">1</span>      <span class="number">0</span>        <span class="number">0</span>        <span class="number">5</span>             <span class="number">0</span>             <span class="number">0</span>            <span class="number">0</span></span><br><span class="line"><span class="number">1</span>     <span class="number">1</span>      <span class="number">0</span>        <span class="number">0</span>        <span class="number">6</span>             <span class="number">0</span>             <span class="number">0</span>            <span class="number">0</span></span><br><span class="line"><span class="number">2</span>     <span class="number">1</span>      <span class="number">0</span>        <span class="number">0</span>        <span class="number">7</span>             <span class="number">0</span>             <span class="number">0</span>            <span class="number">0</span></span><br><span class="line"><span class="number">3</span>     <span class="number">1</span>      <span class="number">0</span>        <span class="number">0</span>        <span class="number">8</span>             <span class="number">0</span>             <span class="number">0</span>            <span class="number">0</span></span><br></pre></td></tr></table></figure><p>::: tip 注意</p><p>用这个访问器处理不是 <code>datetime</code> 类型的值时，<code>Series.dt</code> 会触发 <code>TypeError</code> 错误。</p><p>:::</p><h2 id="矢量化字符串方法"><a href="#矢量化字符串方法" class="headerlink" title="矢量化字符串方法"></a>矢量化字符串方法</h2><p>Series 支持字符串处理方法，可以非常方便地操作数组里的每个元素。这些方法会自动排除缺失值与空值，这也许是其最重要的特性。这些方法通过 Series 的 <code>str</code> 属性访问，一般情况下，这些操作的名称与内置的字符串方法一致。示例如下：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">289</span>]: s = pd.Series([<span class="string">&#x27;A&#x27;</span>, <span class="string">&#x27;B&#x27;</span>, <span class="string">&#x27;C&#x27;</span>, <span class="string">&#x27;Aaba&#x27;</span>, <span class="string">&#x27;Baca&#x27;</span>, np.nan, <span class="string">&#x27;CABA&#x27;</span>, <span class="string">&#x27;dog&#x27;</span>, <span class="string">&#x27;cat&#x27;</span>])</span><br><span class="line"></span><br><span class="line">In [<span class="number">290</span>]: s.<span class="built_in">str</span>.lower()</span><br><span class="line">Out[<span class="number">290</span>]: </span><br><span class="line"><span class="number">0</span>       a</span><br><span class="line"><span class="number">1</span>       b</span><br><span class="line"><span class="number">2</span>       c</span><br><span class="line"><span class="number">3</span>    aaba</span><br><span class="line"><span class="number">4</span>    baca</span><br><span class="line"><span class="number">5</span>     NaN</span><br><span class="line"><span class="number">6</span>    caba</span><br><span class="line"><span class="number">7</span>     dog</span><br><span class="line"><span class="number">8</span>     cat</span><br><span class="line">dtype: <span class="built_in">object</span></span><br></pre></td></tr></table></figure><p>这里还提供了强大的模式匹配方法，但工业注意，模式匹配方法默认使用<a target="_blank" rel="noopener" href="https://docs.python.org/3/library/re.html">正则表达式</a>。</p><p>参阅<a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/user_guide/text.html#text-string-methods">矢量化字符串方法</a>，了解完整内容。</p><h2 id="排序"><a href="#排序" class="headerlink" title="排序"></a>排序</h2><p>Pandas 支持三种排序方式，按索引标签排序，按列里的值排序，按两种方式混合排序。</p><h3 id="按索引排序"><a href="#按索引排序" class="headerlink" title="按索引排序"></a>按索引排序</h3><p><a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.Series.sort_index.html#pandas.Series.sort_index" title="pandas.Series.sort_index"><code>Series.sort_index()</code></a> 与 <a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.sort_index.html#pandas.DataFrame.sort_index" title="pandas.DataFrame.sort_index"><code>DataFrame.sort_index()</code></a> 方法用于按索引层级对 Pandas 对象排序。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">291</span>]: df = pd.DataFrame(&#123;</span><br><span class="line">   .....:     <span class="string">&#x27;one&#x27;</span>: pd.Series(np.random.randn(<span class="number">3</span>), index=[<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;c&#x27;</span>]),</span><br><span class="line">   .....:     <span class="string">&#x27;two&#x27;</span>: pd.Series(np.random.randn(<span class="number">4</span>), index=[<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;c&#x27;</span>, <span class="string">&#x27;d&#x27;</span>]),</span><br><span class="line">   .....:     <span class="string">&#x27;three&#x27;</span>: pd.Series(np.random.randn(<span class="number">3</span>), index=[<span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;c&#x27;</span>, <span class="string">&#x27;d&#x27;</span>])&#125;)</span><br><span class="line">   .....: </span><br><span class="line"></span><br><span class="line">In [<span class="number">292</span>]: unsorted_df = df.reindex(index=[<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;d&#x27;</span>, <span class="string">&#x27;c&#x27;</span>, <span class="string">&#x27;b&#x27;</span>],</span><br><span class="line">   .....:                          columns=[<span class="string">&#x27;three&#x27;</span>, <span class="string">&#x27;two&#x27;</span>, <span class="string">&#x27;one&#x27;</span>])</span><br><span class="line">   .....: </span><br><span class="line"></span><br><span class="line">In [<span class="number">293</span>]: unsorted_df</span><br><span class="line">Out[<span class="number">293</span>]: </span><br><span class="line">      three       two       one</span><br><span class="line">a       NaN -<span class="number">1.152244</span>  <span class="number">0.562973</span></span><br><span class="line">d -<span class="number">0.252916</span> -<span class="number">0.109597</span>       NaN</span><br><span class="line">c  <span class="number">1.273388</span> -<span class="number">0.167123</span>  <span class="number">0.640382</span></span><br><span class="line">b -<span class="number">0.098217</span>  <span class="number">0.009797</span> -<span class="number">1.299504</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># DataFrame</span></span><br><span class="line">In [<span class="number">294</span>]: unsorted_df.sort_index()</span><br><span class="line">Out[<span class="number">294</span>]: </span><br><span class="line">      three       two       one</span><br><span class="line">a       NaN -<span class="number">1.152244</span>  <span class="number">0.562973</span></span><br><span class="line">b -<span class="number">0.098217</span>  <span class="number">0.009797</span> -<span class="number">1.299504</span></span><br><span class="line">c  <span class="number">1.273388</span> -<span class="number">0.167123</span>  <span class="number">0.640382</span></span><br><span class="line">d -<span class="number">0.252916</span> -<span class="number">0.109597</span>       NaN</span><br><span class="line"></span><br><span class="line">In [<span class="number">295</span>]: unsorted_df.sort_index(ascending=<span class="literal">False</span>)</span><br><span class="line">Out[<span class="number">295</span>]: </span><br><span class="line">      three       two       one</span><br><span class="line">d -<span class="number">0.252916</span> -<span class="number">0.109597</span>       NaN</span><br><span class="line">c  <span class="number">1.273388</span> -<span class="number">0.167123</span>  <span class="number">0.640382</span></span><br><span class="line">b -<span class="number">0.098217</span>  <span class="number">0.009797</span> -<span class="number">1.299504</span></span><br><span class="line">a       NaN -<span class="number">1.152244</span>  <span class="number">0.562973</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">296</span>]: unsorted_df.sort_index(axis=<span class="number">1</span>)</span><br><span class="line">Out[<span class="number">296</span>]: </span><br><span class="line">        one     three       two</span><br><span class="line">a  <span class="number">0.562973</span>       NaN -<span class="number">1.152244</span></span><br><span class="line">d       NaN -<span class="number">0.252916</span> -<span class="number">0.109597</span></span><br><span class="line">c  <span class="number">0.640382</span>  <span class="number">1.273388</span> -<span class="number">0.167123</span></span><br><span class="line">b -<span class="number">1.299504</span> -<span class="number">0.098217</span>  <span class="number">0.009797</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Series</span></span><br><span class="line">In [<span class="number">297</span>]: unsorted_df[<span class="string">&#x27;three&#x27;</span>].sort_index()</span><br><span class="line">Out[<span class="number">297</span>]: </span><br><span class="line">a         NaN</span><br><span class="line">b   -<span class="number">0.098217</span></span><br><span class="line">c    <span class="number">1.273388</span></span><br><span class="line">d   -<span class="number">0.252916</span></span><br><span class="line">Name: three, dtype: float64</span><br></pre></td></tr></table></figure><h3 id="按值排序"><a href="#按值排序" class="headerlink" title="按值排序"></a>按值排序</h3><p><a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.Series.sort_values.html#pandas.Series.sort_values" title="pandas.Series.sort_values"><code>Series.sort_values()</code></a> 方法用于按值对 Series 排序。<a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.sort_values.html#pandas.DataFrame.sort_values" title="pandas.DataFrame.sort_values"><code>DataFrame.sort_values()</code></a> 方法用于按行列的值对 DataFrame 排序。<a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.sort_values.html#pandas.DataFrame.sort_values" title="pandas.DataFrame.sort_values"><code>DataFrame.sort_values()</code></a> 的可选参数 <code>by</code> 用于指定按哪列排序，该参数的值可以是一列或多列数据。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">298</span>]: df1 = pd.DataFrame(&#123;<span class="string">&#x27;one&#x27;</span>: [<span class="number">2</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>],</span><br><span class="line">   .....:                     <span class="string">&#x27;two&#x27;</span>: [<span class="number">1</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">4</span>],</span><br><span class="line">   .....:                     <span class="string">&#x27;three&#x27;</span>: [<span class="number">5</span>, <span class="number">4</span>, <span class="number">3</span>, <span class="number">2</span>]&#125;)</span><br><span class="line">   .....: </span><br><span class="line"></span><br><span class="line">In [<span class="number">299</span>]: df1.sort_values(by=<span class="string">&#x27;two&#x27;</span>)</span><br><span class="line">Out[<span class="number">299</span>]: </span><br><span class="line">   one  two  three</span><br><span class="line"><span class="number">0</span>    <span class="number">2</span>    <span class="number">1</span>      <span class="number">5</span></span><br><span class="line"><span class="number">2</span>    <span class="number">1</span>    <span class="number">2</span>      <span class="number">3</span></span><br><span class="line"><span class="number">1</span>    <span class="number">1</span>    <span class="number">3</span>      <span class="number">4</span></span><br><span class="line"><span class="number">3</span>    <span class="number">1</span>    <span class="number">4</span>      <span class="number">2</span></span><br></pre></td></tr></table></figure><p>参数 <code>by</code> 支持列名列表，示例如下：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">300</span>]: df1[[<span class="string">&#x27;one&#x27;</span>, <span class="string">&#x27;two&#x27;</span>, <span class="string">&#x27;three&#x27;</span>]].sort_values(by=[<span class="string">&#x27;one&#x27;</span>, <span class="string">&#x27;two&#x27;</span>])</span><br><span class="line">Out[<span class="number">300</span>]: </span><br><span class="line">   one  two  three</span><br><span class="line"><span class="number">2</span>    <span class="number">1</span>    <span class="number">2</span>      <span class="number">3</span></span><br><span class="line"><span class="number">1</span>    <span class="number">1</span>    <span class="number">3</span>      <span class="number">4</span></span><br><span class="line"><span class="number">3</span>    <span class="number">1</span>    <span class="number">4</span>      <span class="number">2</span></span><br><span class="line"><span class="number">0</span>    <span class="number">2</span>    <span class="number">1</span>      <span class="number">5</span></span><br></pre></td></tr></table></figure><p>这些方法支持用 <code>na_position</code> 参数处理空值。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">301</span>]: s[<span class="number">2</span>] = np.nan</span><br><span class="line"></span><br><span class="line">In [<span class="number">302</span>]: s.sort_values()</span><br><span class="line">Out[<span class="number">302</span>]: </span><br><span class="line"><span class="number">0</span>       A</span><br><span class="line"><span class="number">3</span>    Aaba</span><br><span class="line"><span class="number">1</span>       B</span><br><span class="line"><span class="number">4</span>    Baca</span><br><span class="line"><span class="number">6</span>    CABA</span><br><span class="line"><span class="number">8</span>     cat</span><br><span class="line"><span class="number">7</span>     dog</span><br><span class="line"><span class="number">2</span>     NaN</span><br><span class="line"><span class="number">5</span>     NaN</span><br><span class="line">dtype: <span class="built_in">object</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">303</span>]: s.sort_values(na_position=<span class="string">&#x27;first&#x27;</span>)</span><br><span class="line">Out[<span class="number">303</span>]: </span><br><span class="line"><span class="number">2</span>     NaN</span><br><span class="line"><span class="number">5</span>     NaN</span><br><span class="line"><span class="number">0</span>       A</span><br><span class="line"><span class="number">3</span>    Aaba</span><br><span class="line"><span class="number">1</span>       B</span><br><span class="line"><span class="number">4</span>    Baca</span><br><span class="line"><span class="number">6</span>    CABA</span><br><span class="line"><span class="number">8</span>     cat</span><br><span class="line"><span class="number">7</span>     dog</span><br><span class="line">dtype: <span class="built_in">object</span></span><br></pre></td></tr></table></figure><h3 id="按索引与值排序"><a href="#按索引与值排序" class="headerlink" title="按索引与值排序"></a>按索引与值排序</h3><p><em>0.23.0 版新增</em>。</p><p>通过参数 <code>by</code> 传递给 <a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.sort_values.html#pandas.DataFrame.sort_values" title="pandas.DataFrame.sort_values"><code>DataFrame.sort_values()</code></a> 的字符串可以引用列或索引层名。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建 MultiIndex</span></span><br><span class="line">In [<span class="number">304</span>]: idx = pd.MultiIndex.from_tuples([(<span class="string">&#x27;a&#x27;</span>, <span class="number">1</span>), (<span class="string">&#x27;a&#x27;</span>, <span class="number">2</span>), (<span class="string">&#x27;a&#x27;</span>, <span class="number">2</span>),</span><br><span class="line">   .....:                                 (<span class="string">&#x27;b&#x27;</span>, <span class="number">2</span>), (<span class="string">&#x27;b&#x27;</span>, <span class="number">1</span>), (<span class="string">&#x27;b&#x27;</span>, <span class="number">1</span>)])</span><br><span class="line">   .....: </span><br><span class="line"></span><br><span class="line">In [<span class="number">305</span>]: idx.names = [<span class="string">&#x27;first&#x27;</span>, <span class="string">&#x27;second&#x27;</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建 DataFrame</span></span><br><span class="line">In [<span class="number">306</span>]: df_multi = pd.DataFrame(&#123;<span class="string">&#x27;A&#x27;</span>: np.arange(<span class="number">6</span>, <span class="number">0</span>, -<span class="number">1</span>)&#125;,</span><br><span class="line">   .....:                         index=idx)</span><br><span class="line">   .....: </span><br><span class="line"></span><br><span class="line">In [<span class="number">307</span>]: df_multi</span><br><span class="line">Out[<span class="number">307</span>]: </span><br><span class="line">              A</span><br><span class="line">first second   </span><br><span class="line">a     <span class="number">1</span>       <span class="number">6</span></span><br><span class="line">      <span class="number">2</span>       <span class="number">5</span></span><br><span class="line">      <span class="number">2</span>       <span class="number">4</span></span><br><span class="line">b     <span class="number">2</span>       <span class="number">3</span></span><br><span class="line">      <span class="number">1</span>       <span class="number">2</span></span><br><span class="line">      <span class="number">1</span>       <span class="number">1</span></span><br></pre></td></tr></table></figure><p>按 <code>second</code>（索引）与 <code>A</code>（列）排序。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">308</span>]: df_multi.sort_values(by=[<span class="string">&#x27;second&#x27;</span>, <span class="string">&#x27;A&#x27;</span>])</span><br><span class="line">Out[<span class="number">308</span>]: </span><br><span class="line">              A</span><br><span class="line">first second   </span><br><span class="line">b     <span class="number">1</span>       <span class="number">1</span></span><br><span class="line">      <span class="number">1</span>       <span class="number">2</span></span><br><span class="line">a     <span class="number">1</span>       <span class="number">6</span></span><br><span class="line">b     <span class="number">2</span>       <span class="number">3</span></span><br><span class="line">a     <span class="number">2</span>       <span class="number">4</span></span><br><span class="line">      <span class="number">2</span>       <span class="number">5</span></span><br></pre></td></tr></table></figure><p>::: tip 注意</p><p>字符串、列名、索引层名重名时，会触发警告提示，并以列名为准。后期版本中，这种情况将会触发模糊错误。</p><p>:::</p><h3 id="搜索排序"><a href="#搜索排序" class="headerlink" title="搜索排序"></a>搜索排序</h3><p>Series 支持 <a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.Series.searchsorted.html#pandas.Series.searchsorted" title="pandas.Series.searchsorted"><code>searchsorted()</code></a> 方法，这与<a target="_blank" rel="noopener" href="https://docs.scipy.org/doc/numpy/reference/generated/numpy.ndarray.searchsorted.html#numpy.ndarray.searchsorted" title="(in NumPy v1.17)"><code>numpy.ndarray.searchsorted()</code></a> 的操作方式类似。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">309</span>]: ser = pd.Series([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>])</span><br><span class="line"></span><br><span class="line">In [<span class="number">310</span>]: ser.searchsorted([<span class="number">0</span>, <span class="number">3</span>])</span><br><span class="line">Out[<span class="number">310</span>]: array([<span class="number">0</span>, <span class="number">2</span>])</span><br><span class="line"></span><br><span class="line">In [<span class="number">311</span>]: ser.searchsorted([<span class="number">0</span>, <span class="number">4</span>])</span><br><span class="line">Out[<span class="number">311</span>]: array([<span class="number">0</span>, <span class="number">3</span>])</span><br><span class="line"></span><br><span class="line">In [<span class="number">312</span>]: ser.searchsorted([<span class="number">1</span>, <span class="number">3</span>], side=<span class="string">&#x27;right&#x27;</span>)</span><br><span class="line">Out[<span class="number">312</span>]: array([<span class="number">1</span>, <span class="number">3</span>])</span><br><span class="line"></span><br><span class="line">In [<span class="number">313</span>]: ser.searchsorted([<span class="number">1</span>, <span class="number">3</span>], side=<span class="string">&#x27;left&#x27;</span>)</span><br><span class="line">Out[<span class="number">313</span>]: array([<span class="number">0</span>, <span class="number">2</span>])</span><br><span class="line"></span><br><span class="line">In [<span class="number">314</span>]: ser = pd.Series([<span class="number">3</span>, <span class="number">1</span>, <span class="number">2</span>])</span><br><span class="line"></span><br><span class="line">In [<span class="number">315</span>]: ser.searchsorted([<span class="number">0</span>, <span class="number">3</span>], sorter=np.argsort(ser))</span><br><span class="line">Out[<span class="number">315</span>]: array([<span class="number">0</span>, <span class="number">2</span>])</span><br></pre></td></tr></table></figure><h3 id="最大值与最小值"><a href="#最大值与最小值" class="headerlink" title="最大值与最小值"></a>最大值与最小值</h3><p>Series 支持 <a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.Series.nsmallest.html#pandas.Series.nsmallest" title="pandas.Series.nsmallest"><code>nsmallest()</code></a> 与 <a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.Series.nlargest.html#pandas.Series.nlargest" title="pandas.Series.nlargest"><code>nlargest()</code></a> 方法，本方法返回 N 个最大或最小的值。对于数据量大的 <code>Series</code> 来说，该方法比先为整个 Series 排序，再调用 <code>head(n)</code> 这种方式的速度要快得多。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">316</span>]: s = pd.Series(np.random.permutation(<span class="number">10</span>))</span><br><span class="line"></span><br><span class="line">In [<span class="number">317</span>]: s</span><br><span class="line">Out[<span class="number">317</span>]: </span><br><span class="line"><span class="number">0</span>    <span class="number">2</span></span><br><span class="line"><span class="number">1</span>    <span class="number">0</span></span><br><span class="line"><span class="number">2</span>    <span class="number">3</span></span><br><span class="line"><span class="number">3</span>    <span class="number">7</span></span><br><span class="line"><span class="number">4</span>    <span class="number">1</span></span><br><span class="line"><span class="number">5</span>    <span class="number">5</span></span><br><span class="line"><span class="number">6</span>    <span class="number">9</span></span><br><span class="line"><span class="number">7</span>    <span class="number">6</span></span><br><span class="line"><span class="number">8</span>    <span class="number">8</span></span><br><span class="line"><span class="number">9</span>    <span class="number">4</span></span><br><span class="line">dtype: int64</span><br><span class="line"></span><br><span class="line">In [<span class="number">318</span>]: s.sort_values()</span><br><span class="line">Out[<span class="number">318</span>]: </span><br><span class="line"><span class="number">1</span>    <span class="number">0</span></span><br><span class="line"><span class="number">4</span>    <span class="number">1</span></span><br><span class="line"><span class="number">0</span>    <span class="number">2</span></span><br><span class="line"><span class="number">2</span>    <span class="number">3</span></span><br><span class="line"><span class="number">9</span>    <span class="number">4</span></span><br><span class="line"><span class="number">5</span>    <span class="number">5</span></span><br><span class="line"><span class="number">7</span>    <span class="number">6</span></span><br><span class="line"><span class="number">3</span>    <span class="number">7</span></span><br><span class="line"><span class="number">8</span>    <span class="number">8</span></span><br><span class="line"><span class="number">6</span>    <span class="number">9</span></span><br><span class="line">dtype: int64</span><br><span class="line"></span><br><span class="line">In [<span class="number">319</span>]: s.nsmallest(<span class="number">3</span>)</span><br><span class="line">Out[<span class="number">319</span>]: </span><br><span class="line"><span class="number">1</span>    <span class="number">0</span></span><br><span class="line"><span class="number">4</span>    <span class="number">1</span></span><br><span class="line"><span class="number">0</span>    <span class="number">2</span></span><br><span class="line">dtype: int64</span><br><span class="line"></span><br><span class="line">In [<span class="number">320</span>]: s.nlargest(<span class="number">3</span>)</span><br><span class="line">Out[<span class="number">320</span>]: </span><br><span class="line"><span class="number">6</span>    <span class="number">9</span></span><br><span class="line"><span class="number">8</span>    <span class="number">8</span></span><br><span class="line"><span class="number">3</span>    <span class="number">7</span></span><br><span class="line">dtype: int64</span><br></pre></td></tr></table></figure><p><code>DataFrame</code> 也支持 <code>nlargest</code> 与 <code>nsmallest</code> 方法。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">321</span>]: df = pd.DataFrame(&#123;<span class="string">&#x27;a&#x27;</span>: [-<span class="number">2</span>, -<span class="number">1</span>, <span class="number">1</span>, <span class="number">10</span>, <span class="number">8</span>, <span class="number">11</span>, -<span class="number">1</span>],</span><br><span class="line">   .....:                    <span class="string">&#x27;b&#x27;</span>: <span class="built_in">list</span>(<span class="string">&#x27;abdceff&#x27;</span>),</span><br><span class="line">   .....:                    <span class="string">&#x27;c&#x27;</span>: [<span class="number">1.0</span>, <span class="number">2.0</span>, <span class="number">4.0</span>, <span class="number">3.2</span>, np.nan, <span class="number">3.0</span>, <span class="number">4.0</span>]&#125;)</span><br><span class="line">   .....: </span><br><span class="line"></span><br><span class="line">In [<span class="number">322</span>]: df.nlargest(<span class="number">3</span>, <span class="string">&#x27;a&#x27;</span>)</span><br><span class="line">Out[<span class="number">322</span>]: </span><br><span class="line">    a  b    c</span><br><span class="line"><span class="number">5</span>  <span class="number">11</span>  f  <span class="number">3.0</span></span><br><span class="line"><span class="number">3</span>  <span class="number">10</span>  c  <span class="number">3.2</span></span><br><span class="line"><span class="number">4</span>   <span class="number">8</span>  e  NaN</span><br><span class="line"></span><br><span class="line">In [<span class="number">323</span>]: df.nlargest(<span class="number">5</span>, [<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;c&#x27;</span>])</span><br><span class="line">Out[<span class="number">323</span>]: </span><br><span class="line">    a  b    c</span><br><span class="line"><span class="number">5</span>  <span class="number">11</span>  f  <span class="number">3.0</span></span><br><span class="line"><span class="number">3</span>  <span class="number">10</span>  c  <span class="number">3.2</span></span><br><span class="line"><span class="number">4</span>   <span class="number">8</span>  e  NaN</span><br><span class="line"><span class="number">2</span>   <span class="number">1</span>  d  <span class="number">4.0</span></span><br><span class="line"><span class="number">6</span>  -<span class="number">1</span>  f  <span class="number">4.0</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">324</span>]: df.nsmallest(<span class="number">3</span>, <span class="string">&#x27;a&#x27;</span>)</span><br><span class="line">Out[<span class="number">324</span>]: </span><br><span class="line">   a  b    c</span><br><span class="line"><span class="number">0</span> -<span class="number">2</span>  a  <span class="number">1.0</span></span><br><span class="line"><span class="number">1</span> -<span class="number">1</span>  b  <span class="number">2.0</span></span><br><span class="line"><span class="number">6</span> -<span class="number">1</span>  f  <span class="number">4.0</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">325</span>]: df.nsmallest(<span class="number">5</span>, [<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;c&#x27;</span>])</span><br><span class="line">Out[<span class="number">325</span>]: </span><br><span class="line">   a  b    c</span><br><span class="line"><span class="number">0</span> -<span class="number">2</span>  a  <span class="number">1.0</span></span><br><span class="line"><span class="number">1</span> -<span class="number">1</span>  b  <span class="number">2.0</span></span><br><span class="line"><span class="number">6</span> -<span class="number">1</span>  f  <span class="number">4.0</span></span><br><span class="line"><span class="number">2</span>  <span class="number">1</span>  d  <span class="number">4.0</span></span><br><span class="line"><span class="number">4</span>  <span class="number">8</span>  e  NaN</span><br></pre></td></tr></table></figure><h3 id="用多层索引的列排序"><a href="#用多层索引的列排序" class="headerlink" title="用多层索引的列排序"></a>用多层索引的列排序</h3><p>列为多层索引时，可以显式排序，用 <code>by</code> 指定所有层级。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">326</span>]: df1.columns = pd.MultiIndex.from_tuples([(<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;one&#x27;</span>),</span><br><span class="line">   .....:                                          (<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;two&#x27;</span>),</span><br><span class="line">   .....:                                          (<span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;three&#x27;</span>)])</span><br><span class="line">   .....: </span><br><span class="line"></span><br><span class="line">In [<span class="number">327</span>]: df1.sort_values(by=(<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;two&#x27;</span>))</span><br><span class="line">Out[<span class="number">327</span>]: </span><br><span class="line">    a         b</span><br><span class="line">  one two three</span><br><span class="line"><span class="number">0</span>   <span class="number">2</span>   <span class="number">1</span>     <span class="number">5</span></span><br><span class="line"><span class="number">2</span>   <span class="number">1</span>   <span class="number">2</span>     <span class="number">3</span></span><br><span class="line"><span class="number">1</span>   <span class="number">1</span>   <span class="number">3</span>     <span class="number">4</span></span><br><span class="line"><span class="number">3</span>   <span class="number">1</span>   <span class="number">4</span>     <span class="number">2</span></span><br></pre></td></tr></table></figure><h2 id="复制"><a href="#复制" class="headerlink" title="复制"></a>复制</h2><p>在 Pandas 对象上执行 <a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.copy.html#pandas.DataFrame.copy" title="pandas.DataFrame.copy"><code>copy()</code></a> 方法，将复制底层数据（但不包括轴索引，因为轴索引不可变），并返回一个新的对象。注意，<strong>复制对象这种操作一般来说不是必须的</strong>。比如说，以下几种方式可以<em><strong>就地（inplace）</strong></em> 改变 DataFrame：</p><ul><li>插入、删除、修改列</li><li>为 <code>index</code> 或 <code>columns</code> 属性赋值</li><li>对于同质数据，用 <code>values</code> 属性或高级索引即可直接修改值</li></ul><p>注意，用 Pandas 方法修改数据不会带来任何副作用，几乎所有方法都返回新的对象，不会修改原始数据对象。如果原始数据有所改动，唯一的可能就是用户显式指定了要修改原始数据。</p><h2 id="数据类型"><a href="#数据类型" class="headerlink" title="数据类型"></a>数据类型</h2><p>大多数情况下，Pandas 使用 NumPy 数组、Series 或 DataFrame 里某列的数据类型。NumPy 支持 <code>float</code>、<code>int</code>、<code>bool</code>、<code>timedelta[ns]</code>、<code>datetime64[ns]</code>，注意，NumPy 不支持带时区信息的 <code>datetime</code>。</p><p>Pandas 与第三方支持库扩充了 NumPy 类型系统，本节只介绍 Pandas 的内部扩展。如需了解如何编写与 Pandas 扩展类型，请参阅<a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/development/extending.html#extending-extension-types">扩展类型</a>，参阅<a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/ecosystem.html#ecosystem-extensions">扩展数据类型</a>了解第三方支持库提供的扩展类型。</p><p>下表列出了 Pandas 扩展类型，参阅列出的文档内容，查看每种类型的详细说明。</p><table><thead><tr><th align="center">数据种类</th><th align="center">数据类型</th><th align="center">标量</th><th align="center">数组</th><th align="center">文档</th></tr></thead><tbody><tr><td align="center">tz-aware datetime</td><td align="center"><a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DatetimeTZDtype.html#pandas.DatetimeTZDtype"><code>DatetimeTZDtype</code></a></td><td align="center"><a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.Timestamp.html#pandas.Timestamp"><code>Timestamp</code></a></td><td align="center"><a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.arrays.DatetimeArray.html#pandas.arrays.DatetimeArray"><code>arrays.DatetimeArray</code></a></td><td align="center"><a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/user_guide/timeseries.html#timeseries-timezone">Time zone handling</a></td></tr><tr><td align="center">Categorical</td><td align="center"><a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.CategoricalDtype.html#pandas.CategoricalDtype"><code>CategoricalDtype</code></a></td><td align="center">(无)</td><td align="center"><a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.Categorical.html#pandas.Categorical"><code>Categorical</code></a></td><td align="center"><a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/user_guide/categorical.html#categorical">Categorical data</a></td></tr><tr><td align="center">period (time spans)</td><td align="center"><a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.PeriodDtype.html#pandas.PeriodDtype"><code>PeriodDtype</code></a></td><td align="center"><a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.Period.html#pandas.Period"><code>Period</code></a></td><td align="center"><a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.arrays.PeriodArray.html#pandas.arrays.PeriodArray"><code>arrays.PeriodArray</code></a></td><td align="center"><a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/user_guide/timeseries.html#timeseries-periods">Time span representation</a></td></tr><tr><td align="center">sparse</td><td align="center"><a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.SparseDtype.html#pandas.SparseDtype"><code>SparseDtype</code></a></td><td align="center">(无)</td><td align="center"><code>arrays.SparseArray</code></td><td align="center"><a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/user_guide/sparse.html#sparse">Sparse data structures</a></td></tr><tr><td align="center">intervals</td><td align="center"><a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.IntervalDtype.html#pandas.IntervalDtype"><code>IntervalDtype</code></a></td><td align="center"><a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.Interval.html#pandas.Interval"><code>Interval</code></a></td><td align="center"><a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.arrays.IntervalArray.html#pandas.arrays.IntervalArray"><code>arrays.IntervalArray</code></a></td><td align="center"><a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/user_guide/advanced.html#advanced-intervalindex">IntervalIndex</a></td></tr><tr><td align="center">nullable integer</td><td align="center"><a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.Int64Dtype.html#pandas.Int64Dtype"><code>Int64Dtype</code></a>, …</td><td align="center">(无)</td><td align="center"><a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.arrays.IntegerArray.html#pandas.arrays.IntegerArray"><code>arrays.IntegerArray</code></a></td><td align="center"><a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/user_guide/integer_na.html#integer-na">Nullable integer data type</a></td></tr></tbody></table><p>Pandas 用 <code>object</code> 存储字符串。</p><p>虽然， <code>object</code> 数据类型能够存储任何对象，但应尽量避免这种操作，要了解与其它支持库与方法的性能与交互操作，参阅 <a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/getting_started/basics.html#basics-object-conversion">对象转换</a>。</p><p>DataFrame 的 <a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.dtypes.html#pandas.DataFrame.dtypes" title="pandas.DataFrame.dtypes"><code>dtypes</code></a> 属性用起来很方便，以 Series 形式返回每列的数据类型。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">328</span>]: dft = pd.DataFrame(&#123;<span class="string">&#x27;A&#x27;</span>: np.random.rand(<span class="number">3</span>),</span><br><span class="line">   .....:                     <span class="string">&#x27;B&#x27;</span>: <span class="number">1</span>,</span><br><span class="line">   .....:                     <span class="string">&#x27;C&#x27;</span>: <span class="string">&#x27;foo&#x27;</span>,</span><br><span class="line">   .....:                     <span class="string">&#x27;D&#x27;</span>: pd.Timestamp(<span class="string">&#x27;20010102&#x27;</span>),</span><br><span class="line">   .....:                     <span class="string">&#x27;E&#x27;</span>: pd.Series([<span class="number">1.0</span>] * <span class="number">3</span>).astype(<span class="string">&#x27;float32&#x27;</span>),</span><br><span class="line">   .....:                     <span class="string">&#x27;F&#x27;</span>: <span class="literal">False</span>,</span><br><span class="line">   .....:                     <span class="string">&#x27;G&#x27;</span>: pd.Series([<span class="number">1</span>] * <span class="number">3</span>, dtype=<span class="string">&#x27;int8&#x27;</span>)&#125;)</span><br><span class="line">   .....: </span><br><span class="line"></span><br><span class="line">In [<span class="number">329</span>]: dft</span><br><span class="line">Out[<span class="number">329</span>]: </span><br><span class="line">          A  B    C          D    E      F  G</span><br><span class="line"><span class="number">0</span>  <span class="number">0.035962</span>  <span class="number">1</span>  foo <span class="number">2001</span>-01-02  <span class="number">1.0</span>  <span class="literal">False</span>  <span class="number">1</span></span><br><span class="line"><span class="number">1</span>  <span class="number">0.701379</span>  <span class="number">1</span>  foo <span class="number">2001</span>-01-02  <span class="number">1.0</span>  <span class="literal">False</span>  <span class="number">1</span></span><br><span class="line"><span class="number">2</span>  <span class="number">0.281885</span>  <span class="number">1</span>  foo <span class="number">2001</span>-01-02  <span class="number">1.0</span>  <span class="literal">False</span>  <span class="number">1</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">330</span>]: dft.dtypes</span><br><span class="line">Out[<span class="number">330</span>]: </span><br><span class="line">A           float64</span><br><span class="line">B             int64</span><br><span class="line">C            <span class="built_in">object</span></span><br><span class="line">D    datetime64[ns]</span><br><span class="line">E           float32</span><br><span class="line">F              <span class="built_in">bool</span></span><br><span class="line">G              int8</span><br><span class="line">dtype: <span class="built_in">object</span></span><br></pre></td></tr></table></figure><p>要查看 <code>Series</code> 的数据类型，用 <a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.Series.dtype.html#pandas.Series.dtype" title="pandas.Series.dtype"><code>dtype</code></a> 属性。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">331</span>]: dft[<span class="string">&#x27;A&#x27;</span>].dtype</span><br><span class="line">Out[<span class="number">331</span>]: dtype(<span class="string">&#x27;float64&#x27;</span>)</span><br></pre></td></tr></table></figure><p>Pandas 对象单列中含多种类型的数据时，该列的数据类型为可适配于各类数据的数据类型，通常为 <code>object</code>。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 整数被强制转换为浮点数</span></span><br><span class="line">In [<span class="number">332</span>]: pd.Series([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6.</span>])</span><br><span class="line">Out[<span class="number">332</span>]: </span><br><span class="line"><span class="number">0</span>    <span class="number">1.0</span></span><br><span class="line"><span class="number">1</span>    <span class="number">2.0</span></span><br><span class="line"><span class="number">2</span>    <span class="number">3.0</span></span><br><span class="line"><span class="number">3</span>    <span class="number">4.0</span></span><br><span class="line"><span class="number">4</span>    <span class="number">5.0</span></span><br><span class="line"><span class="number">5</span>    <span class="number">6.0</span></span><br><span class="line">dtype: float64</span><br><span class="line"></span><br><span class="line"><span class="comment"># 字符串数据决定了该 Series 的数据类型为 ``object``</span></span><br><span class="line">In [<span class="number">333</span>]: pd.Series([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">6.</span>, <span class="string">&#x27;foo&#x27;</span>])</span><br><span class="line">Out[<span class="number">333</span>]: </span><br><span class="line"><span class="number">0</span>      <span class="number">1</span></span><br><span class="line"><span class="number">1</span>      <span class="number">2</span></span><br><span class="line"><span class="number">2</span>      <span class="number">3</span></span><br><span class="line"><span class="number">3</span>      <span class="number">6</span></span><br><span class="line"><span class="number">4</span>    foo</span><br><span class="line">dtype: <span class="built_in">object</span></span><br></pre></td></tr></table></figure><p><code>DataFrame.dtypes.value_counts()</code> 用于统计 DataFrame 里不同数据类型的列数。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">334</span>]: dft.dtypes.value_counts()</span><br><span class="line">Out[<span class="number">334</span>]: </span><br><span class="line">float32           <span class="number">1</span></span><br><span class="line"><span class="built_in">object</span>            <span class="number">1</span></span><br><span class="line"><span class="built_in">bool</span>              <span class="number">1</span></span><br><span class="line">int8              <span class="number">1</span></span><br><span class="line">float64           <span class="number">1</span></span><br><span class="line">datetime64[ns]    <span class="number">1</span></span><br><span class="line">int64             <span class="number">1</span></span><br><span class="line">dtype: int64</span><br></pre></td></tr></table></figure><p>多种数值型数据类型可以在 DataFrame 里共存。如果只传递一种数据类型，不论是通过 <code>dtype</code> 关键字直接传递，还是通过 <code>ndarray</code> 或 <code>Series</code> 传递，都会保存至 DataFrame 操作。此外，不同数值型数据类型<strong>不会</strong>合并。示例如下：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">335</span>]: df1 = pd.DataFrame(np.random.randn(<span class="number">8</span>, <span class="number">1</span>), columns=[<span class="string">&#x27;A&#x27;</span>], dtype=<span class="string">&#x27;float32&#x27;</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">336</span>]: df1</span><br><span class="line">Out[<span class="number">336</span>]: </span><br><span class="line">          A</span><br><span class="line"><span class="number">0</span>  <span class="number">0.224364</span></span><br><span class="line"><span class="number">1</span>  <span class="number">1.890546</span></span><br><span class="line"><span class="number">2</span>  <span class="number">0.182879</span></span><br><span class="line"><span class="number">3</span>  <span class="number">0.787847</span></span><br><span class="line"><span class="number">4</span> -<span class="number">0.188449</span></span><br><span class="line"><span class="number">5</span>  <span class="number">0.667715</span></span><br><span class="line"><span class="number">6</span> -<span class="number">0.011736</span></span><br><span class="line"><span class="number">7</span> -<span class="number">0.399073</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">337</span>]: df1.dtypes</span><br><span class="line">Out[<span class="number">337</span>]: </span><br><span class="line">A    float32</span><br><span class="line">dtype: <span class="built_in">object</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">338</span>]: df2 = pd.DataFrame(&#123;<span class="string">&#x27;A&#x27;</span>: pd.Series(np.random.randn(<span class="number">8</span>), dtype=<span class="string">&#x27;float16&#x27;</span>),</span><br><span class="line">   .....:                     <span class="string">&#x27;B&#x27;</span>: pd.Series(np.random.randn(<span class="number">8</span>)),</span><br><span class="line">   .....:                     <span class="string">&#x27;C&#x27;</span>: pd.Series(np.array(np.random.randn(<span class="number">8</span>),</span><br><span class="line">   .....:                                             dtype=<span class="string">&#x27;uint8&#x27;</span>))&#125;)</span><br><span class="line">   .....: </span><br><span class="line"></span><br><span class="line">In [<span class="number">339</span>]: df2</span><br><span class="line">Out[<span class="number">339</span>]: </span><br><span class="line">          A         B    C</span><br><span class="line"><span class="number">0</span>  <span class="number">0.823242</span>  <span class="number">0.256090</span>    <span class="number">0</span></span><br><span class="line"><span class="number">1</span>  <span class="number">1.607422</span>  <span class="number">1.426469</span>    <span class="number">0</span></span><br><span class="line"><span class="number">2</span> -<span class="number">0.333740</span> -<span class="number">0.416203</span>  <span class="number">255</span></span><br><span class="line"><span class="number">3</span> -<span class="number">0.063477</span>  <span class="number">1.139976</span>    <span class="number">0</span></span><br><span class="line"><span class="number">4</span> -<span class="number">1.014648</span> -<span class="number">1.193477</span>    <span class="number">0</span></span><br><span class="line"><span class="number">5</span>  <span class="number">0.678711</span>  <span class="number">0.096706</span>    <span class="number">0</span></span><br><span class="line"><span class="number">6</span> -<span class="number">0.040863</span> -<span class="number">1.956850</span>    <span class="number">1</span></span><br><span class="line"><span class="number">7</span> -<span class="number">0.357422</span> -<span class="number">0.714337</span>    <span class="number">0</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">340</span>]: df2.dtypes</span><br><span class="line">Out[<span class="number">340</span>]: </span><br><span class="line">A    float16</span><br><span class="line">B    float64</span><br><span class="line">C      uint8</span><br><span class="line">dtype: <span class="built_in">object</span></span><br></pre></td></tr></table></figure><h3 id="默认值"><a href="#默认值" class="headerlink" title="默认值"></a>默认值</h3><p>整数的默认类型为 <code>int64</code>，浮点数的默认类型为 <code>float64</code>，这里的默认值与系统平台无关，不管是 32 位系统，还是 64 位系统都是一样的。下列代码返回的结果都是 <code>int64</code>：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">341</span>]: pd.DataFrame([<span class="number">1</span>, <span class="number">2</span>], columns=[<span class="string">&#x27;a&#x27;</span>]).dtypes</span><br><span class="line">Out[<span class="number">341</span>]: </span><br><span class="line">a    int64</span><br><span class="line">dtype: <span class="built_in">object</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">342</span>]: pd.DataFrame(&#123;<span class="string">&#x27;a&#x27;</span>: [<span class="number">1</span>, <span class="number">2</span>]&#125;).dtypes</span><br><span class="line">Out[<span class="number">342</span>]: </span><br><span class="line">a    int64</span><br><span class="line">dtype: <span class="built_in">object</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">343</span>]: pd.DataFrame(&#123;<span class="string">&#x27;a&#x27;</span>: <span class="number">1</span>&#125;, index=<span class="built_in">list</span>(<span class="built_in">range</span>(<span class="number">2</span>))).dtypes</span><br><span class="line">Out[<span class="number">343</span>]: </span><br><span class="line">a    int64</span><br><span class="line">dtype: <span class="built_in">object</span></span><br></pre></td></tr></table></figure><p>注意，NumPy 创建数组时，会根据系统选择类型。下列代码在 32 位系统上<strong>将</strong>返回 <code>int32</code>。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">344</span>]: frame = pd.DataFrame(np.array([<span class="number">1</span>, <span class="number">2</span>]))</span><br></pre></td></tr></table></figure><h3 id="向上转型"><a href="#向上转型" class="headerlink" title="向上转型"></a>向上转型</h3><p>与其它类型合并时，用的是向上转型，指的是从现有类型转换为另一种类型，如<code>int</code> 变为 <code>float</code>。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">345</span>]: df3 = df1.reindex_like(df2).fillna(value=<span class="number">0.0</span>) + df2</span><br><span class="line"></span><br><span class="line">In [<span class="number">346</span>]: df3</span><br><span class="line">Out[<span class="number">346</span>]: </span><br><span class="line">          A         B      C</span><br><span class="line"><span class="number">0</span>  <span class="number">1.047606</span>  <span class="number">0.256090</span>    <span class="number">0.0</span></span><br><span class="line"><span class="number">1</span>  <span class="number">3.497968</span>  <span class="number">1.426469</span>    <span class="number">0.0</span></span><br><span class="line"><span class="number">2</span> -<span class="number">0.150862</span> -<span class="number">0.416203</span>  <span class="number">255.0</span></span><br><span class="line"><span class="number">3</span>  <span class="number">0.724370</span>  <span class="number">1.139976</span>    <span class="number">0.0</span></span><br><span class="line"><span class="number">4</span> -<span class="number">1.203098</span> -<span class="number">1.193477</span>    <span class="number">0.0</span></span><br><span class="line"><span class="number">5</span>  <span class="number">1.346426</span>  <span class="number">0.096706</span>    <span class="number">0.0</span></span><br><span class="line"><span class="number">6</span> -<span class="number">0.052599</span> -<span class="number">1.956850</span>    <span class="number">1.0</span></span><br><span class="line"><span class="number">7</span> -<span class="number">0.756495</span> -<span class="number">0.714337</span>    <span class="number">0.0</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">347</span>]: df3.dtypes</span><br><span class="line">Out[<span class="number">347</span>]: </span><br><span class="line">A    float32</span><br><span class="line">B    float64</span><br><span class="line">C    float64</span><br><span class="line">dtype: <span class="built_in">object</span></span><br></pre></td></tr></table></figure><p><a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.to_numpy.html#pandas.DataFrame.to_numpy" title="pandas.DataFrame.to_numpy"><code>DataFrame.to_numpy()</code></a> 返回多个数据类型里<strong>用得最多的数据类型</strong>，这里指的是，输出结果的数据类型，适用于所有同构 NumPy 数组的数据类型。此处强制执行<strong>向上转型</strong>。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">348</span>]: df3.to_numpy().dtype</span><br><span class="line">Out[<span class="number">348</span>]: dtype(<span class="string">&#x27;float64&#x27;</span>)</span><br></pre></td></tr></table></figure><h3 id="astype"><a href="#astype" class="headerlink" title="astype"></a>astype</h3><p><a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.astype.html#pandas.DataFrame.astype" title="pandas.DataFrame.astype"><code>astype()</code></a> 方法显式地把一种数据类型转换为另一种，默认操作为复制数据，就算数据类型没有改变也会复制数据，<code>copy=False</code> 改变默认操作模式。此外，<code>astype</code> 无效时，会触发异常。</p><p>向上转型一般都遵循 <strong>NumPy</strong> 规则。操作中含有两种不同类型的数据时，返回更为通用的那种数据类型。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">349</span>]: df3</span><br><span class="line">Out[<span class="number">349</span>]: </span><br><span class="line">          A         B      C</span><br><span class="line"><span class="number">0</span>  <span class="number">1.047606</span>  <span class="number">0.256090</span>    <span class="number">0.0</span></span><br><span class="line"><span class="number">1</span>  <span class="number">3.497968</span>  <span class="number">1.426469</span>    <span class="number">0.0</span></span><br><span class="line"><span class="number">2</span> -<span class="number">0.150862</span> -<span class="number">0.416203</span>  <span class="number">255.0</span></span><br><span class="line"><span class="number">3</span>  <span class="number">0.724370</span>  <span class="number">1.139976</span>    <span class="number">0.0</span></span><br><span class="line"><span class="number">4</span> -<span class="number">1.203098</span> -<span class="number">1.193477</span>    <span class="number">0.0</span></span><br><span class="line"><span class="number">5</span>  <span class="number">1.346426</span>  <span class="number">0.096706</span>    <span class="number">0.0</span></span><br><span class="line"><span class="number">6</span> -<span class="number">0.052599</span> -<span class="number">1.956850</span>    <span class="number">1.0</span></span><br><span class="line"><span class="number">7</span> -<span class="number">0.756495</span> -<span class="number">0.714337</span>    <span class="number">0.0</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">350</span>]: df3.dtypes</span><br><span class="line">Out[<span class="number">350</span>]: </span><br><span class="line">A    float32</span><br><span class="line">B    float64</span><br><span class="line">C    float64</span><br><span class="line">dtype: <span class="built_in">object</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 转换数据类型</span></span><br><span class="line">In [<span class="number">351</span>]: df3.astype(<span class="string">&#x27;float32&#x27;</span>).dtypes</span><br><span class="line">Out[<span class="number">351</span>]: </span><br><span class="line">A    float32</span><br><span class="line">B    float32</span><br><span class="line">C    float32</span><br><span class="line">dtype: <span class="built_in">object</span></span><br></pre></td></tr></table></figure><p>用 <a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.astype.html#pandas.DataFrame.astype" title="pandas.DataFrame.astype"><code>astype()</code></a> 把一列或多列转换为指定类型 。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">352</span>]: dft = pd.DataFrame(&#123;<span class="string">&#x27;a&#x27;</span>: [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>], <span class="string">&#x27;b&#x27;</span>: [<span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>], <span class="string">&#x27;c&#x27;</span>: [<span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>]&#125;)</span><br><span class="line"></span><br><span class="line">In [<span class="number">353</span>]: dft[[<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>]] = dft[[<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>]].astype(np.uint8)</span><br><span class="line"></span><br><span class="line">In [<span class="number">354</span>]: dft</span><br><span class="line">Out[<span class="number">354</span>]: </span><br><span class="line">   a  b  c</span><br><span class="line"><span class="number">0</span>  <span class="number">1</span>  <span class="number">4</span>  <span class="number">7</span></span><br><span class="line"><span class="number">1</span>  <span class="number">2</span>  <span class="number">5</span>  <span class="number">8</span></span><br><span class="line"><span class="number">2</span>  <span class="number">3</span>  <span class="number">6</span>  <span class="number">9</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">355</span>]: dft.dtypes</span><br><span class="line">Out[<span class="number">355</span>]: </span><br><span class="line">a    uint8</span><br><span class="line">b    uint8</span><br><span class="line">c    int64</span><br><span class="line">dtype: <span class="built_in">object</span></span><br></pre></td></tr></table></figure><p><em>0.19.0 版新增。</em></p><p><a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.astype.html#pandas.DataFrame.astype" title="pandas.DataFrame.astype"><code>astype()</code></a> 通过字典指定哪些列转换为哪些类型。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">356</span>]: dft1 = pd.DataFrame(&#123;<span class="string">&#x27;a&#x27;</span>: [<span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>], <span class="string">&#x27;b&#x27;</span>: [<span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>], <span class="string">&#x27;c&#x27;</span>: [<span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>]&#125;)</span><br><span class="line"></span><br><span class="line">In [<span class="number">357</span>]: dft1 = dft1.astype(&#123;<span class="string">&#x27;a&#x27;</span>: np.<span class="built_in">bool</span>, <span class="string">&#x27;c&#x27;</span>: np.float64&#125;)</span><br><span class="line"></span><br><span class="line">In [<span class="number">358</span>]: dft1</span><br><span class="line">Out[<span class="number">358</span>]: </span><br><span class="line">       a  b    c</span><br><span class="line"><span class="number">0</span>   <span class="literal">True</span>  <span class="number">4</span>  <span class="number">7.0</span></span><br><span class="line"><span class="number">1</span>  <span class="literal">False</span>  <span class="number">5</span>  <span class="number">8.0</span></span><br><span class="line"><span class="number">2</span>   <span class="literal">True</span>  <span class="number">6</span>  <span class="number">9.0</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">359</span>]: dft1.dtypes</span><br><span class="line">Out[<span class="number">359</span>]: </span><br><span class="line">a       <span class="built_in">bool</span></span><br><span class="line">b      int64</span><br><span class="line">c    float64</span><br><span class="line">dtype: <span class="built_in">object</span></span><br></pre></td></tr></table></figure><p>::: tip 注意</p><p>用 <a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.astype.html#pandas.DataFrame.astype" title="pandas.DataFrame.astype"><code>astype()</code></a> 与 <a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.loc.html#pandas.DataFrame.loc" title="pandas.DataFrame.loc"><code>loc()</code></a> 为部分列转换指定类型时，会发生向上转型。</p><p><a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.loc.html#pandas.DataFrame.loc" title="pandas.DataFrame.loc"><code>loc()</code></a> 尝试分配当前的数据类型，而 <code>[]</code> 则会从右方获取数据类型并进行覆盖。因此，下列代码会产出意料之外的结果：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">360</span>]: dft = pd.DataFrame(&#123;<span class="string">&#x27;a&#x27;</span>: [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>], <span class="string">&#x27;b&#x27;</span>: [<span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>], <span class="string">&#x27;c&#x27;</span>: [<span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>]&#125;)</span><br><span class="line"></span><br><span class="line">In [<span class="number">361</span>]: dft.loc[:, [<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>]].astype(np.uint8).dtypes</span><br><span class="line">Out[<span class="number">361</span>]: </span><br><span class="line">a    uint8</span><br><span class="line">b    uint8</span><br><span class="line">dtype: <span class="built_in">object</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">362</span>]: dft.loc[:, [<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>]] = dft.loc[:, [<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>]].astype(np.uint8)</span><br><span class="line"></span><br><span class="line">In [<span class="number">363</span>]: dft.dtypes</span><br><span class="line">Out[<span class="number">363</span>]: </span><br><span class="line">a    int64</span><br><span class="line">b    int64</span><br><span class="line">c    int64</span><br><span class="line">dtype: <span class="built_in">object</span></span><br></pre></td></tr></table></figure><p>:::</p><h3 id="对象转换"><a href="#对象转换" class="headerlink" title="对象转换"></a>对象转换</h3><p>Pandas 提供了多种函数可以把 <code>object</code> 从一种类型强制转为另一种类型。这是因为，数据有时存储的是正确类型，但在保存时却存成了 <code>object</code> 类型，此时，用 <a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.infer_objects.html#pandas.DataFrame.infer_objects" title="pandas.DataFrame.infer_objects"><code>DataFrame.infer_objects()</code></a> 与 <a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.Series.infer_objects.html#pandas.Series.infer_objects" title="pandas.Series.infer_objects"><code>Series.infer_objects()</code></a> 方法即可把数据<strong>软</strong>转换为正确的类型。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">364</span>]: <span class="keyword">import</span> datetime</span><br><span class="line"></span><br><span class="line">In [<span class="number">365</span>]: df = pd.DataFrame([[<span class="number">1</span>, <span class="number">2</span>],</span><br><span class="line">   .....:                    [<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>],</span><br><span class="line">   .....:                    [datetime.datetime(<span class="number">2016</span>, <span class="number">3</span>, <span class="number">2</span>),</span><br><span class="line">   .....:                     datetime.datetime(<span class="number">2016</span>, <span class="number">3</span>, <span class="number">2</span>)]])</span><br><span class="line">   .....: </span><br><span class="line"></span><br><span class="line">In [<span class="number">366</span>]: df = df.T</span><br><span class="line"></span><br><span class="line">In [<span class="number">367</span>]: df</span><br><span class="line">Out[<span class="number">367</span>]: </span><br><span class="line">   <span class="number">0</span>  <span class="number">1</span>          <span class="number">2</span></span><br><span class="line"><span class="number">0</span>  <span class="number">1</span>  a <span class="number">2016</span>-03-02</span><br><span class="line"><span class="number">1</span>  <span class="number">2</span>  b <span class="number">2016</span>-03-02</span><br><span class="line"></span><br><span class="line">In [<span class="number">368</span>]: df.dtypes</span><br><span class="line">Out[<span class="number">368</span>]: </span><br><span class="line"><span class="number">0</span>            <span class="built_in">object</span></span><br><span class="line"><span class="number">1</span>            <span class="built_in">object</span></span><br><span class="line"><span class="number">2</span>    datetime64[ns]</span><br><span class="line">dtype: <span class="built_in">object</span></span><br></pre></td></tr></table></figure><p>因为数据被转置，所以把原始列的数据类型改成了 <code>object</code>，但使用 <code>infer_objects</code> 后就变正确了。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">369</span>]: df.infer_objects().dtypes</span><br><span class="line">Out[<span class="number">369</span>]: </span><br><span class="line"><span class="number">0</span>             int64</span><br><span class="line"><span class="number">1</span>            <span class="built_in">object</span></span><br><span class="line"><span class="number">2</span>    datetime64[ns]</span><br><span class="line">dtype: <span class="built_in">object</span></span><br></pre></td></tr></table></figure><p>下列函数可以应用于一维数组与标量，执行硬转换，把对象转换为指定类型。</p><ul><li><a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.to_numeric.html#pandas.to_numeric" title="pandas.to_numeric"><code>to_numeric()</code></a>，转换为数值型</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">370</span>]: m = [<span class="string">&#x27;1.1&#x27;</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br><span class="line"></span><br><span class="line">In [<span class="number">371</span>]: pd.to_numeric(m)</span><br><span class="line">Out[<span class="number">371</span>]: array([<span class="number">1.1</span>, <span class="number">2.</span> , <span class="number">3.</span> ])</span><br></pre></td></tr></table></figure><ul><li><a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.to_datetime.html#pandas.to_datetime" title="pandas.to_datetime"><code>to_datetime()</code></a>，转换为 <code>datetime</code> 对象</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">372</span>]: <span class="keyword">import</span> datetime</span><br><span class="line"></span><br><span class="line">In [<span class="number">373</span>]: m = [<span class="string">&#x27;2016-07-09&#x27;</span>, datetime.datetime(<span class="number">2016</span>, <span class="number">3</span>, <span class="number">2</span>)]</span><br><span class="line"></span><br><span class="line">In [<span class="number">374</span>]: pd.to_datetime(m)</span><br><span class="line">Out[<span class="number">374</span>]: DatetimeIndex([<span class="string">&#x27;2016-07-09&#x27;</span>, <span class="string">&#x27;2016-03-02&#x27;</span>], dtype=<span class="string">&#x27;datetime64[ns]&#x27;</span>, freq=<span class="literal">None</span>)</span><br></pre></td></tr></table></figure><ul><li><a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.to_timedelta.html#pandas.to_timedelta" title="pandas.to_timedelta"><code>to_timedelta()</code></a>，转换为 <code>timedelta</code> 对象。</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">375</span>]: m = [<span class="string">&#x27;5us&#x27;</span>, pd.Timedelta(<span class="string">&#x27;1day&#x27;</span>)]</span><br><span class="line"></span><br><span class="line">In [<span class="number">376</span>]: pd.to_timedelta(m)</span><br><span class="line">Out[<span class="number">376</span>]: TimedeltaIndex([<span class="string">&#x27;0 days 00:00:00.000005&#x27;</span>, <span class="string">&#x27;1 days 00:00:00&#x27;</span>], dtype=<span class="string">&#x27;timedelta64[ns]&#x27;</span>, freq=<span class="literal">None</span>)</span><br></pre></td></tr></table></figure><p>如需强制转换，则要加入 <code>error</code> 参数，指定 Pandas 怎样处理不能转换为成预期类型或对象的数据。<code>errors</code> 参数的默认值为 <code>False</code>，指的是在转换过程中，遇到任何问题都触发错误。设置为 <code>errors=&#39;coerce&#39;</code> 时，pandas 会忽略错误，强制把问题数据转换为 <code>pd.NaT</code>（<code>datetime</code> 与 <code>timedelta</code>），或 <code>np.nan</code>（数值型）。读取数据时，如果大部分要转换的数据是数值型或 <code>datetime</code>，这种操作非常有用，但偶尔也会有非制式数据混合在一起，可能会导致展示数据缺失：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">377</span>]: <span class="keyword">import</span> datetime</span><br><span class="line"></span><br><span class="line">In [<span class="number">378</span>]: m = [<span class="string">&#x27;apple&#x27;</span>, datetime.datetime(<span class="number">2016</span>, <span class="number">3</span>, <span class="number">2</span>)]</span><br><span class="line"></span><br><span class="line">In [<span class="number">379</span>]: pd.to_datetime(m, errors=<span class="string">&#x27;coerce&#x27;</span>)</span><br><span class="line">Out[<span class="number">379</span>]: DatetimeIndex([<span class="string">&#x27;NaT&#x27;</span>, <span class="string">&#x27;2016-03-02&#x27;</span>], dtype=<span class="string">&#x27;datetime64[ns]&#x27;</span>, freq=<span class="literal">None</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">380</span>]: m = [<span class="string">&#x27;apple&#x27;</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br><span class="line"></span><br><span class="line">In [<span class="number">381</span>]: pd.to_numeric(m, errors=<span class="string">&#x27;coerce&#x27;</span>)</span><br><span class="line">Out[<span class="number">381</span>]: array([nan,  <span class="number">2.</span>,  <span class="number">3.</span>])</span><br><span class="line"></span><br><span class="line">In [<span class="number">382</span>]: m = [<span class="string">&#x27;apple&#x27;</span>, pd.Timedelta(<span class="string">&#x27;1day&#x27;</span>)]</span><br><span class="line"></span><br><span class="line">In [<span class="number">383</span>]: pd.to_timedelta(m, errors=<span class="string">&#x27;coerce&#x27;</span>)</span><br><span class="line">Out[<span class="number">383</span>]: TimedeltaIndex([NaT, <span class="string">&#x27;1 days&#x27;</span>], dtype=<span class="string">&#x27;timedelta64[ns]&#x27;</span>, freq=<span class="literal">None</span>)</span><br></pre></td></tr></table></figure><p><code>error</code> 参数还有第三个选项，<code>error=&#39;ignore&#39;</code>。转换数据时会忽略错误，直接输出问题数据：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">384</span>]: <span class="keyword">import</span> datetime</span><br><span class="line"></span><br><span class="line">In [<span class="number">385</span>]: m = [<span class="string">&#x27;apple&#x27;</span>, datetime.datetime(<span class="number">2016</span>, <span class="number">3</span>, <span class="number">2</span>)]</span><br><span class="line"></span><br><span class="line">In [<span class="number">386</span>]: pd.to_datetime(m, errors=<span class="string">&#x27;ignore&#x27;</span>)</span><br><span class="line">Out[<span class="number">386</span>]: Index([<span class="string">&#x27;apple&#x27;</span>, <span class="number">2016</span>-03-02 <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>], dtype=<span class="string">&#x27;object&#x27;</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">387</span>]: m = [<span class="string">&#x27;apple&#x27;</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br><span class="line"></span><br><span class="line">In [<span class="number">388</span>]: pd.to_numeric(m, errors=<span class="string">&#x27;ignore&#x27;</span>)</span><br><span class="line">Out[<span class="number">388</span>]: array([<span class="string">&#x27;apple&#x27;</span>, <span class="number">2</span>, <span class="number">3</span>], dtype=<span class="built_in">object</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">389</span>]: m = [<span class="string">&#x27;apple&#x27;</span>, pd.Timedelta(<span class="string">&#x27;1day&#x27;</span>)]</span><br><span class="line"></span><br><span class="line">In [<span class="number">390</span>]: pd.to_timedelta(m, errors=<span class="string">&#x27;ignore&#x27;</span>)</span><br><span class="line">Out[<span class="number">390</span>]: array([<span class="string">&#x27;apple&#x27;</span>, Timedelta(<span class="string">&#x27;1 days 00:00:00&#x27;</span>)], dtype=<span class="built_in">object</span>)</span><br></pre></td></tr></table></figure><p>执行转换操作时，<a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.to_numeric.html#pandas.to_numeric" title="pandas.to_numeric"><code>to_numeric()</code></a> 还有一个参数，<code>downcast</code>，即向下转型，可以把数值型转换为减少内存占用的数据类型：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">391</span>]: m = [<span class="string">&#x27;1&#x27;</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br><span class="line"></span><br><span class="line">In [<span class="number">392</span>]: pd.to_numeric(m, downcast=<span class="string">&#x27;integer&#x27;</span>)   <span class="comment"># smallest signed int dtype</span></span><br><span class="line">Out[<span class="number">392</span>]: array([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>], dtype=int8)</span><br><span class="line"></span><br><span class="line">In [<span class="number">393</span>]: pd.to_numeric(m, downcast=<span class="string">&#x27;signed&#x27;</span>)    <span class="comment"># same as &#x27;integer&#x27;</span></span><br><span class="line">Out[<span class="number">393</span>]: array([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>], dtype=int8)</span><br><span class="line"></span><br><span class="line">In [<span class="number">394</span>]: pd.to_numeric(m, downcast=<span class="string">&#x27;unsigned&#x27;</span>)  <span class="comment"># smallest unsigned int dtype</span></span><br><span class="line">Out[<span class="number">394</span>]: array([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>], dtype=uint8)</span><br><span class="line"></span><br><span class="line">In [<span class="number">395</span>]: pd.to_numeric(m, downcast=<span class="string">&#x27;float&#x27;</span>)     <span class="comment"># smallest float dtype</span></span><br><span class="line">Out[<span class="number">395</span>]: array([<span class="number">1.</span>, <span class="number">2.</span>, <span class="number">3.</span>], dtype=float32)</span><br></pre></td></tr></table></figure><p>上述方法仅能应用于一维数组、列表或标量；不能直接用于 DataFrame 等多维对象。不过，用 <a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.apply.html#pandas.DataFrame.apply" title="pandas.DataFrame.apply"><code>apply()</code></a>，可以快速为每列应用函数：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">396</span>]: <span class="keyword">import</span> datetime</span><br><span class="line"></span><br><span class="line">In [<span class="number">397</span>]: df = pd.DataFrame([</span><br><span class="line">   .....:     [<span class="string">&#x27;2016-07-09&#x27;</span>, datetime.datetime(<span class="number">2016</span>, <span class="number">3</span>, <span class="number">2</span>)]] * <span class="number">2</span>, dtype=<span class="string">&#x27;O&#x27;</span>)</span><br><span class="line">   .....: </span><br><span class="line"></span><br><span class="line">In [<span class="number">398</span>]: df</span><br><span class="line">Out[<span class="number">398</span>]: </span><br><span class="line">            <span class="number">0</span>                    <span class="number">1</span></span><br><span class="line"><span class="number">0</span>  <span class="number">2016</span>-07-09  <span class="number">2016</span>-03-02 <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span></span><br><span class="line"><span class="number">1</span>  <span class="number">2016</span>-07-09  <span class="number">2016</span>-03-02 <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">399</span>]: df.apply(pd.to_datetime)</span><br><span class="line">Out[<span class="number">399</span>]: </span><br><span class="line">           <span class="number">0</span>          <span class="number">1</span></span><br><span class="line"><span class="number">0</span> <span class="number">2016</span>-07-09 <span class="number">2016</span>-03-02</span><br><span class="line"><span class="number">1</span> <span class="number">2016</span>-07-09 <span class="number">2016</span>-03-02</span><br><span class="line"></span><br><span class="line">In [<span class="number">400</span>]: df = pd.DataFrame([[<span class="string">&#x27;1.1&#x27;</span>, <span class="number">2</span>, <span class="number">3</span>]] * <span class="number">2</span>, dtype=<span class="string">&#x27;O&#x27;</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">401</span>]: df</span><br><span class="line">Out[<span class="number">401</span>]: </span><br><span class="line">     <span class="number">0</span>  <span class="number">1</span>  <span class="number">2</span></span><br><span class="line"><span class="number">0</span>  <span class="number">1.1</span>  <span class="number">2</span>  <span class="number">3</span></span><br><span class="line"><span class="number">1</span>  <span class="number">1.1</span>  <span class="number">2</span>  <span class="number">3</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">402</span>]: df.apply(pd.to_numeric)</span><br><span class="line">Out[<span class="number">402</span>]: </span><br><span class="line">     <span class="number">0</span>  <span class="number">1</span>  <span class="number">2</span></span><br><span class="line"><span class="number">0</span>  <span class="number">1.1</span>  <span class="number">2</span>  <span class="number">3</span></span><br><span class="line"><span class="number">1</span>  <span class="number">1.1</span>  <span class="number">2</span>  <span class="number">3</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">403</span>]: df = pd.DataFrame([[<span class="string">&#x27;5us&#x27;</span>, pd.Timedelta(<span class="string">&#x27;1day&#x27;</span>)]] * <span class="number">2</span>, dtype=<span class="string">&#x27;O&#x27;</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">404</span>]: df</span><br><span class="line">Out[<span class="number">404</span>]: </span><br><span class="line">     <span class="number">0</span>                <span class="number">1</span></span><br><span class="line"><span class="number">0</span>  5us  <span class="number">1</span> days <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span></span><br><span class="line"><span class="number">1</span>  5us  <span class="number">1</span> days <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">405</span>]: df.apply(pd.to_timedelta)</span><br><span class="line">Out[<span class="number">405</span>]: </span><br><span class="line">                <span class="number">0</span>      <span class="number">1</span></span><br><span class="line"><span class="number">0</span> <span class="number">00</span>:<span class="number">00</span>:<span class="number">00.000005</span> <span class="number">1</span> days</span><br><span class="line"><span class="number">1</span> <span class="number">00</span>:<span class="number">00</span>:<span class="number">00.000005</span> <span class="number">1</span> days</span><br></pre></td></tr></table></figure><h3 id="各种坑"><a href="#各种坑" class="headerlink" title="各种坑"></a>各种坑</h3><p>对 <code>integer</code> 数据执行选择操作时，可以很轻而易举地把数据转换为 <code>floating</code> 。Pandas 会保存输入数据的数据类型，以防未引入 <code>nans</code> 的情况。参阅 <a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/user_guide/gotchas.html#gotchas-intna">对整数 NA 空值的支持</a>。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">406</span>]: dfi = df3.astype(<span class="string">&#x27;int32&#x27;</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">407</span>]: dfi[<span class="string">&#x27;E&#x27;</span>] = <span class="number">1</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">408</span>]: dfi</span><br><span class="line">Out[<span class="number">408</span>]: </span><br><span class="line">   A  B    C  E</span><br><span class="line"><span class="number">0</span>  <span class="number">1</span>  <span class="number">0</span>    <span class="number">0</span>  <span class="number">1</span></span><br><span class="line"><span class="number">1</span>  <span class="number">3</span>  <span class="number">1</span>    <span class="number">0</span>  <span class="number">1</span></span><br><span class="line"><span class="number">2</span>  <span class="number">0</span>  <span class="number">0</span>  <span class="number">255</span>  <span class="number">1</span></span><br><span class="line"><span class="number">3</span>  <span class="number">0</span>  <span class="number">1</span>    <span class="number">0</span>  <span class="number">1</span></span><br><span class="line"><span class="number">4</span> -<span class="number">1</span> -<span class="number">1</span>    <span class="number">0</span>  <span class="number">1</span></span><br><span class="line"><span class="number">5</span>  <span class="number">1</span>  <span class="number">0</span>    <span class="number">0</span>  <span class="number">1</span></span><br><span class="line"><span class="number">6</span>  <span class="number">0</span> -<span class="number">1</span>    <span class="number">1</span>  <span class="number">1</span></span><br><span class="line"><span class="number">7</span>  <span class="number">0</span>  <span class="number">0</span>    <span class="number">0</span>  <span class="number">1</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">409</span>]: dfi.dtypes</span><br><span class="line">Out[<span class="number">409</span>]: </span><br><span class="line">A    int32</span><br><span class="line">B    int32</span><br><span class="line">C    int32</span><br><span class="line">E    int64</span><br><span class="line">dtype: <span class="built_in">object</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">410</span>]: casted = dfi[dfi &gt; <span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">In [<span class="number">411</span>]: casted</span><br><span class="line">Out[<span class="number">411</span>]: </span><br><span class="line">     A    B      C  E</span><br><span class="line"><span class="number">0</span>  <span class="number">1.0</span>  NaN    NaN  <span class="number">1</span></span><br><span class="line"><span class="number">1</span>  <span class="number">3.0</span>  <span class="number">1.0</span>    NaN  <span class="number">1</span></span><br><span class="line"><span class="number">2</span>  NaN  NaN  <span class="number">255.0</span>  <span class="number">1</span></span><br><span class="line"><span class="number">3</span>  NaN  <span class="number">1.0</span>    NaN  <span class="number">1</span></span><br><span class="line"><span class="number">4</span>  NaN  NaN    NaN  <span class="number">1</span></span><br><span class="line"><span class="number">5</span>  <span class="number">1.0</span>  NaN    NaN  <span class="number">1</span></span><br><span class="line"><span class="number">6</span>  NaN  NaN    <span class="number">1.0</span>  <span class="number">1</span></span><br><span class="line"><span class="number">7</span>  NaN  NaN    NaN  <span class="number">1</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">412</span>]: casted.dtypes</span><br><span class="line">Out[<span class="number">412</span>]: </span><br><span class="line">A    float64</span><br><span class="line">B    float64</span><br><span class="line">C    float64</span><br><span class="line">E      int64</span><br><span class="line">dtype: <span class="built_in">object</span></span><br></pre></td></tr></table></figure><p>浮点数类型未改变。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">413</span>]: dfa = df3.copy()</span><br><span class="line"></span><br><span class="line">In [<span class="number">414</span>]: dfa[<span class="string">&#x27;A&#x27;</span>] = dfa[<span class="string">&#x27;A&#x27;</span>].astype(<span class="string">&#x27;float32&#x27;</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">415</span>]: dfa.dtypes</span><br><span class="line">Out[<span class="number">415</span>]: </span><br><span class="line">A    float32</span><br><span class="line">B    float64</span><br><span class="line">C    float64</span><br><span class="line">dtype: <span class="built_in">object</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">416</span>]: casted = dfa[df2 &gt; <span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">In [<span class="number">417</span>]: casted</span><br><span class="line">Out[<span class="number">417</span>]: </span><br><span class="line">          A         B      C</span><br><span class="line"><span class="number">0</span>  <span class="number">1.047606</span>  <span class="number">0.256090</span>    NaN</span><br><span class="line"><span class="number">1</span>  <span class="number">3.497968</span>  <span class="number">1.426469</span>    NaN</span><br><span class="line"><span class="number">2</span>       NaN       NaN  <span class="number">255.0</span></span><br><span class="line"><span class="number">3</span>       NaN  <span class="number">1.139976</span>    NaN</span><br><span class="line"><span class="number">4</span>       NaN       NaN    NaN</span><br><span class="line"><span class="number">5</span>  <span class="number">1.346426</span>  <span class="number">0.096706</span>    NaN</span><br><span class="line"><span class="number">6</span>       NaN       NaN    <span class="number">1.0</span></span><br><span class="line"><span class="number">7</span>       NaN       NaN    NaN</span><br><span class="line"></span><br><span class="line">In [<span class="number">418</span>]: casted.dtypes</span><br><span class="line">Out[<span class="number">418</span>]: </span><br><span class="line">A    float32</span><br><span class="line">B    float64</span><br><span class="line">C    float64</span><br><span class="line">dtype: <span class="built_in">object</span></span><br></pre></td></tr></table></figure><h2 id="基于-dtype-选择列"><a href="#基于-dtype-选择列" class="headerlink" title="基于 dtype 选择列"></a>基于 <code>dtype</code> 选择列</h2><p><a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.select_dtypes.html#pandas.DataFrame.select_dtypes" title="pandas.DataFrame.select_dtypes"><code>select_dtypes()</code></a> 方法基于 <code>dtype</code> 选择列。</p><p>首先，创建一个由多种数据类型组成的 DataFrame：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">419</span>]: df = pd.DataFrame(&#123;<span class="string">&#x27;string&#x27;</span>: <span class="built_in">list</span>(<span class="string">&#x27;abc&#x27;</span>),</span><br><span class="line">   .....:                    <span class="string">&#x27;int64&#x27;</span>: <span class="built_in">list</span>(<span class="built_in">range</span>(<span class="number">1</span>, <span class="number">4</span>)),</span><br><span class="line">   .....:                    <span class="string">&#x27;uint8&#x27;</span>: np.arange(<span class="number">3</span>, <span class="number">6</span>).astype(<span class="string">&#x27;u1&#x27;</span>),</span><br><span class="line">   .....:                    <span class="string">&#x27;float64&#x27;</span>: np.arange(<span class="number">4.0</span>, <span class="number">7.0</span>),</span><br><span class="line">   .....:                    <span class="string">&#x27;bool1&#x27;</span>: [<span class="literal">True</span>, <span class="literal">False</span>, <span class="literal">True</span>],</span><br><span class="line">   .....:                    <span class="string">&#x27;bool2&#x27;</span>: [<span class="literal">False</span>, <span class="literal">True</span>, <span class="literal">False</span>],</span><br><span class="line">   .....:                    <span class="string">&#x27;dates&#x27;</span>: pd.date_range(<span class="string">&#x27;now&#x27;</span>, periods=<span class="number">3</span>),</span><br><span class="line">   .....:                    <span class="string">&#x27;category&#x27;</span>: pd.Series(<span class="built_in">list</span>(<span class="string">&quot;ABC&quot;</span>)).astype(<span class="string">&#x27;category&#x27;</span>)&#125;)</span><br><span class="line">   .....: </span><br><span class="line"></span><br><span class="line">In [<span class="number">420</span>]: df[<span class="string">&#x27;tdeltas&#x27;</span>] = df.dates.diff()</span><br><span class="line"></span><br><span class="line">In [<span class="number">421</span>]: df[<span class="string">&#x27;uint64&#x27;</span>] = np.arange(<span class="number">3</span>, <span class="number">6</span>).astype(<span class="string">&#x27;u8&#x27;</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">422</span>]: df[<span class="string">&#x27;other_dates&#x27;</span>] = pd.date_range(<span class="string">&#x27;20130101&#x27;</span>, periods=<span class="number">3</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">423</span>]: df[<span class="string">&#x27;tz_aware_dates&#x27;</span>] = pd.date_range(<span class="string">&#x27;20130101&#x27;</span>, periods=<span class="number">3</span>, tz=<span class="string">&#x27;US/Eastern&#x27;</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">424</span>]: df</span><br><span class="line">Out[<span class="number">424</span>]: </span><br><span class="line">  string  int64  uint8  float64  bool1  bool2                      dates category tdeltas  uint64 other_dates            tz_aware_dates</span><br><span class="line"><span class="number">0</span>      a      <span class="number">1</span>      <span class="number">3</span>      <span class="number">4.0</span>   <span class="literal">True</span>  <span class="literal">False</span> <span class="number">2019</span>-08-<span class="number">22</span> <span class="number">15</span>:<span class="number">49</span>:<span class="number">01.870038</span>        A     NaT       <span class="number">3</span>  <span class="number">2013</span>-01-01 <span class="number">2013</span>-01-01 <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>-05:<span class="number">00</span></span><br><span class="line"><span class="number">1</span>      b      <span class="number">2</span>      <span class="number">4</span>      <span class="number">5.0</span>  <span class="literal">False</span>   <span class="literal">True</span> <span class="number">2019</span>-08-<span class="number">23</span> <span class="number">15</span>:<span class="number">49</span>:<span class="number">01.870038</span>        B  <span class="number">1</span> days       <span class="number">4</span>  <span class="number">2013</span>-01-02 <span class="number">2013</span>-01-02 <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>-05:<span class="number">00</span></span><br><span class="line"><span class="number">2</span>      c      <span class="number">3</span>      <span class="number">5</span>      <span class="number">6.0</span>   <span class="literal">True</span>  <span class="literal">False</span> <span class="number">2019</span>-08-<span class="number">24</span> <span class="number">15</span>:<span class="number">49</span>:<span class="number">01.870038</span>        C  <span class="number">1</span> days       <span class="number">5</span>  <span class="number">2013</span>-01-03 <span class="number">2013</span>-01-03 <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>-05:<span class="number">00</span></span><br></pre></td></tr></table></figure><p>该 DataFrame 的数据类型：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">425</span>]: df.dtypes</span><br><span class="line">Out[<span class="number">425</span>]: </span><br><span class="line">string                                <span class="built_in">object</span></span><br><span class="line">int64                                  int64</span><br><span class="line">uint8                                  uint8</span><br><span class="line">float64                              float64</span><br><span class="line">bool1                                   <span class="built_in">bool</span></span><br><span class="line">bool2                                   <span class="built_in">bool</span></span><br><span class="line">dates                         datetime64[ns]</span><br><span class="line">category                            category</span><br><span class="line">tdeltas                      timedelta64[ns]</span><br><span class="line">uint64                                uint64</span><br><span class="line">other_dates                   datetime64[ns]</span><br><span class="line">tz_aware_dates    datetime64[ns, US/Eastern]</span><br><span class="line">dtype: <span class="built_in">object</span></span><br></pre></td></tr></table></figure><p><a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.select_dtypes.html#pandas.DataFrame.select_dtypes" title="pandas.DataFrame.select_dtypes"><code>select_dtypes()</code></a> 有两个参数，<code>include</code> 与 <code>exclude</code>，用于实现“提取这些数据类型的列” （<code>include</code>）或 “提取不是这些数据类型的列”（<code>exclude</code>）。</p><p>选择 <code>bool</code> 型的列，示例如下：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">426</span>]: df.select_dtypes(include=[<span class="built_in">bool</span>])</span><br><span class="line">Out[<span class="number">426</span>]: </span><br><span class="line">   bool1  bool2</span><br><span class="line"><span class="number">0</span>   <span class="literal">True</span>  <span class="literal">False</span></span><br><span class="line"><span class="number">1</span>  <span class="literal">False</span>   <span class="literal">True</span></span><br><span class="line"><span class="number">2</span>   <span class="literal">True</span>  <span class="literal">False</span></span><br></pre></td></tr></table></figure><p>该方法还支持输入 <a target="_blank" rel="noopener" href="https://docs.scipy.org/doc/numpy/reference/arrays.scalars.html">NumPy 数据类型</a>的名称：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">427</span>]: df.select_dtypes(include=[<span class="string">&#x27;bool&#x27;</span>])</span><br><span class="line">Out[<span class="number">427</span>]: </span><br><span class="line">   bool1  bool2</span><br><span class="line"><span class="number">0</span>   <span class="literal">True</span>  <span class="literal">False</span></span><br><span class="line"><span class="number">1</span>  <span class="literal">False</span>   <span class="literal">True</span></span><br><span class="line"><span class="number">2</span>   <span class="literal">True</span>  <span class="literal">False</span></span><br></pre></td></tr></table></figure><p><a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.select_dtypes.html#pandas.DataFrame.select_dtypes" title="pandas.DataFrame.select_dtypes"><code>select_dtypes()</code></a> 还支持通用数据类型。</p><p>比如，选择所有数值型与布尔型的列，同时，排除无符号整数：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">428</span>]: df.select_dtypes(include=[<span class="string">&#x27;number&#x27;</span>, <span class="string">&#x27;bool&#x27;</span>], exclude=[<span class="string">&#x27;unsignedinteger&#x27;</span>])</span><br><span class="line">Out[<span class="number">428</span>]: </span><br><span class="line">   int64  float64  bool1  bool2 tdeltas</span><br><span class="line"><span class="number">0</span>      <span class="number">1</span>      <span class="number">4.0</span>   <span class="literal">True</span>  <span class="literal">False</span>     NaT</span><br><span class="line"><span class="number">1</span>      <span class="number">2</span>      <span class="number">5.0</span>  <span class="literal">False</span>   <span class="literal">True</span>  <span class="number">1</span> days</span><br><span class="line"><span class="number">2</span>      <span class="number">3</span>      <span class="number">6.0</span>   <span class="literal">True</span>  <span class="literal">False</span>  <span class="number">1</span> days</span><br></pre></td></tr></table></figure><p>选择字符串型的列必须要用 <code>object</code>：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">429</span>]: df.select_dtypes(include=[<span class="string">&#x27;object&#x27;</span>])</span><br><span class="line">Out[<span class="number">429</span>]: </span><br><span class="line">  string</span><br><span class="line"><span class="number">0</span>      a</span><br><span class="line"><span class="number">1</span>      b</span><br><span class="line"><span class="number">2</span>      c</span><br></pre></td></tr></table></figure><p>要查看 <code>numpy.number</code> 等通用 <code>dtype</code> 的所有子类型，可以定义一个函数，返回子类型树：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">430</span>]: <span class="function"><span class="keyword">def</span> <span class="title">subdtypes</span>(<span class="params">dtype</span>):</span></span><br><span class="line">   .....:     subs = dtype.__subclasses__()</span><br><span class="line">   .....:     <span class="keyword">if</span> <span class="keyword">not</span> subs:</span><br><span class="line">   .....:         <span class="keyword">return</span> dtype</span><br><span class="line">   .....:     <span class="keyword">return</span> [dtype, [subdtypes(dt) <span class="keyword">for</span> dt <span class="keyword">in</span> subs]]</span><br><span class="line">   .....: </span><br></pre></td></tr></table></figure><p>所有 NumPy 数据类型都是 <code>numpy.generic</code> 的子类：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">431</span>]: subdtypes(np.generic)</span><br><span class="line">Out[<span class="number">431</span>]: </span><br><span class="line">[numpy.generic,</span><br><span class="line"> [[numpy.number,</span><br><span class="line">   [[numpy.integer,</span><br><span class="line">     [[numpy.signedinteger,</span><br><span class="line">       [numpy.int8,</span><br><span class="line">        numpy.int16,</span><br><span class="line">        numpy.int32,</span><br><span class="line">        numpy.int64,</span><br><span class="line">        numpy.int64,</span><br><span class="line">        numpy.timedelta64]],</span><br><span class="line">      [numpy.unsignedinteger,</span><br><span class="line">       [numpy.uint8,</span><br><span class="line">        numpy.uint16,</span><br><span class="line">        numpy.uint32,</span><br><span class="line">        numpy.uint64,</span><br><span class="line">        numpy.uint64]]]],</span><br><span class="line">    [numpy.inexact,</span><br><span class="line">     [[numpy.floating,</span><br><span class="line">       [numpy.float16, numpy.float32, numpy.float64, numpy.float128]],</span><br><span class="line">      [numpy.complexfloating,</span><br><span class="line">       [numpy.complex64, numpy.complex128, numpy.complex256]]]]]],</span><br><span class="line">  [numpy.flexible,</span><br><span class="line">   [[numpy.character, [numpy.bytes_, numpy.str_]],</span><br><span class="line">    [numpy.void, [numpy.record]]]],</span><br><span class="line">  numpy.bool_,</span><br><span class="line">  numpy.datetime64,</span><br><span class="line">  numpy.object_]]</span><br></pre></td></tr></table></figure><p><strong>tip 注意: Pandas 支持 <code>category</code> 与 <code>datetime64[ns, tz]</code> 类型，但这两种类型未整合到 NumPy 架构，因此，上面的函数没有显示。</strong></p></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者:</span> <span class="post-copyright-info"><a href="mailto:undefined">Jackerzz</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接:</span> <span class="post-copyright-info"><a href="https://jackerzz.github.io/posts/toolkit/pandas/pd2.html">https://jackerzz.github.io/posts/toolkit/pandas/pd2.html</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明:</span> <span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://jackerzz.github.io" target="_blank">Jackerzz's Blog</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/tookit/">tookit</a></div><div class="post_share"><div class="social-share" data-image="https://cdn.jsdelivr.net/gh/jackerzz/jackerzz.github.io@ersion1.1/images/canva/3244513.jpg" data-sites="wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css" media="print" onload='this.media="all"'><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/posts/toolkit/pandas/pd3.html"><img class="prev-cover" src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://cdn.jsdelivr.net/gh/jackerzz/jackerzz.github.io@ersion1.1/images/canva/1142950.jpg" onerror='onerror=null,src="http://static.kongdf.com/bg4.jpg"' alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">如何让 Pandas 按数据类型选择列？</div></div></a></div><div class="next-post pull-right"><a href="/posts/toolkit/pandas/pd1.html"><img class="next-cover" src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://cdn.jsdelivr.net/gh/jackerzz/jackerzz.github.io@ersion1.1/images/canva/2347011.jpg" onerror='onerror=null,src="http://static.kongdf.com/bg4.jpg"' alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">Pandas 概览</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i> <span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/posts/toolkit/pandas/pd1.html" title="Pandas 概览"><img class="cover" src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://cdn.jsdelivr.net/gh/jackerzz/jackerzz.github.io@ersion1.1/images/canva/2347011.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-09-15</div><div class="title">Pandas 概览</div></div></a></div><div><a href="/posts/toolkit/pandas/pd3.html" title="如何让 Pandas 按数据类型选择列？"><img class="cover" src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://cdn.jsdelivr.net/gh/jackerzz/jackerzz.github.io@ersion1.1/images/canva/1142950.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-09-16</div><div class="title">如何让 Pandas 按数据类型选择列？</div></div></a></div><div><a href="/posts/toolkit/pandas/pd5.html" title="Pandas 数据结构"><img class="cover" src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://cdn.jsdelivr.net/gh/jackerzz/jackerzz.github.io@ersion1.1/images/canva/615299.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-09-19</div><div class="title">Pandas 数据结构</div></div></a></div><div><a href="/posts/toolkit/pandas/pd6.html" title="时间序列与日期用法"><img class="cover" src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://cdn.jsdelivr.net/gh/jackerzz/jackerzz.github.io@ersion1.1/images/canva/531767.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-09-20</div><div class="title">时间序列与日期用法</div></div></a></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="card-info-avatar is-center"><img class="avatar-img" src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://cdn.jsdelivr.net/gh/jackerzz/jackerzz.github.io@sion1.0/images/avatar/35586448.jpg" onerror='this.onerror=null,this.src="/img/friend_404.gif"' alt="avatar"><div class="author-info__name">Jackerzz</div><div class="author-info__description">有趣的旅行</div></div><div class="card-info-data"><div class="card-info-data-item is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">57</div></a></div><div class="card-info-data-item is-center"><a href="/tags/"><div class="headline">标签</div><div class="length-num">11</div></a></div><div class="card-info-data-item is-center"><a href="/categories/"><div class="headline">分类</div><div class="length-num">8</div></a></div></div><a class="button--animated" id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/jackerzz"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/jackerzz" target="_blank" title="Github"><i class="fab fa-github"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn card-announcement-animation"></i><span>公告</span></div><div class="announcement_content">只有一件事会使人疲劳，摇摆不定和优柔寡断。而每做一件事，都会使人身心解放，即使把事情办坏了，也比什么都不做强。——斯蒂芬·茨威格《人类的群星闪耀时》</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Pandas-%E5%9F%BA%E7%A1%80%E7%94%A8%E6%B3%95"><span class="toc-number">1.</span> <span class="toc-text">Pandas 基础用法</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Head-%E4%B8%8E-Tail"><span class="toc-number">1.1.</span> <span class="toc-text">Head 与 Tail</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B1%9E%E6%80%A7%E4%B8%8E%E5%BA%95%E5%B1%82%E6%95%B0%E6%8D%AE"><span class="toc-number">1.2.</span> <span class="toc-text">属性与底层数据</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8A%A0%E9%80%9F%E6%93%8D%E4%BD%9C"><span class="toc-number">1.3.</span> <span class="toc-text">加速操作</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8C%E8%BF%9B%E5%88%B6%E6%93%8D%E4%BD%9C"><span class="toc-number">1.4.</span> <span class="toc-text">二进制操作</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8C%B9%E9%85%8D-%E5%B9%BF%E6%92%AD%E6%9C%BA%E5%88%B6"><span class="toc-number">1.4.1.</span> <span class="toc-text">匹配&#x2F;广播机制</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BC%BA%E5%A4%B1%E5%80%BC%E4%B8%8E%E5%A1%AB%E5%85%85%E7%BC%BA%E5%A4%B1%E5%80%BC%E6%93%8D%E4%BD%9C"><span class="toc-number">1.4.2.</span> <span class="toc-text">缺失值与填充缺失值操作</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#tip-%E6%B3%A8%E6%84%8F"><span class="toc-number">1.4.2.1.</span> <span class="toc-text">tip 注意</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%AF%94%E8%BE%83%E6%93%8D%E4%BD%9C"><span class="toc-number">1.4.3.</span> <span class="toc-text">比较操作</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B8%83%E5%B0%94%E7%AE%80%E5%8C%96"><span class="toc-number">1.4.4.</span> <span class="toc-text">布尔简化</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#danger-%E8%AD%A6%E5%91%8A"><span class="toc-number">1.4.4.1.</span> <span class="toc-text">danger 警告</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%AF%94%E8%BE%83%E5%AF%B9%E8%B1%A1%E6%98%AF%E5%90%A6%E7%AD%89%E6%95%88"><span class="toc-number">1.4.5.</span> <span class="toc-text">比较对象是否等效</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B3%A8%E6%84%8F%EF%BC%9A%E5%B8%83%E5%B0%94%E5%9E%8B-DataFrame-df-df-df-2-%E4%B8%AD%E6%9C%89-False-%E5%80%BC%EF%BC%81%E8%BF%99%E6%98%AF%E5%9B%A0%E4%B8%BA%E4%B8%A4%E4%B8%AA-NaN-%E5%80%BC%E7%9A%84%E6%AF%94%E8%BE%83%E7%BB%93%E6%9E%9C%E4%B8%BA%E4%B8%8D%E7%AD%89%EF%BC%9A"><span class="toc-number">1.4.5.1.</span> <span class="toc-text">注意：布尔型 DataFrame df + df &#x3D;&#x3D; df * 2 中有 False 值！这是因为两个 NaN 值的比较结果为不等：</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%AF%94%E8%BE%83-array-%E5%9E%8B%E5%AF%B9%E8%B1%A1"><span class="toc-number">1.4.6.</span> <span class="toc-text">比较 array 型对象</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%90%88%E5%B9%B6%E9%87%8D%E5%8F%A0%E6%95%B0%E6%8D%AE%E9%9B%86"><span class="toc-number">1.4.7.</span> <span class="toc-text">合并重叠数据集</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#DataFrame-%E9%80%9A%E7%94%A8%E5%90%88%E5%B9%B6%E6%96%B9%E6%B3%95"><span class="toc-number">1.4.8.</span> <span class="toc-text">DataFrame 通用合并方法</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8F%8F%E8%BF%B0%E6%80%A7%E7%BB%9F%E8%AE%A1"><span class="toc-number">1.5.</span> <span class="toc-text">描述性统计</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E6%80%BB%E7%BB%93%EF%BC%9Adescribe"><span class="toc-number">1.5.1.</span> <span class="toc-text">数据总结：describe</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9C%80%E5%A4%A7%E5%80%BC%E4%B8%8E%E6%9C%80%E5%B0%8F%E5%80%BC%E5%AF%B9%E5%BA%94%E7%9A%84%E7%B4%A2%E5%BC%95"><span class="toc-number">1.5.2.</span> <span class="toc-text">最大值与最小值对应的索引</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%80%BC%E8%AE%A1%E6%95%B0%EF%BC%88%E7%9B%B4%E6%96%B9%E5%9B%BE%EF%BC%89%E4%B8%8E%E4%BC%97%E6%95%B0"><span class="toc-number">1.5.3.</span> <span class="toc-text">值计数（直方图）与众数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%A6%BB%E6%95%A3%E5%8C%96%E4%B8%8E%E5%88%86%E4%BD%8D%E6%95%B0"><span class="toc-number">1.5.4.</span> <span class="toc-text">离散化与分位数</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%87%BD%E6%95%B0%E5%BA%94%E7%94%A8"><span class="toc-number">1.6.</span> <span class="toc-text">函数应用</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A1%A8%E7%BA%A7%E5%87%BD%E6%95%B0%E5%BA%94%E7%94%A8"><span class="toc-number">1.6.1.</span> <span class="toc-text">表级函数应用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A1%8C%E5%88%97%E7%BA%A7%E5%87%BD%E6%95%B0%E5%BA%94%E7%94%A8"><span class="toc-number">1.6.2.</span> <span class="toc-text">行列级函数应用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%81%9A%E5%90%88-API"><span class="toc-number">1.6.3.</span> <span class="toc-text">聚合 API</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%9A%E5%87%BD%E6%95%B0%E8%81%9A%E5%90%88"><span class="toc-number">1.6.4.</span> <span class="toc-text">多函数聚合</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%94%A8%E5%AD%97%E5%85%B8%E5%AE%9E%E7%8E%B0%E8%81%9A%E5%90%88"><span class="toc-number">1.6.5.</span> <span class="toc-text">用字典实现聚合</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%9A%E7%A7%8D%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B%EF%BC%88Dtype%EF%BC%89"><span class="toc-number">1.6.6.</span> <span class="toc-text">多种数据类型（Dtype）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89-Describe"><span class="toc-number">1.6.7.</span> <span class="toc-text">自定义 Describe</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Transform-API"><span class="toc-number">1.6.8.</span> <span class="toc-text">Transform API</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%9A%E5%87%BD%E6%95%B0-Transform"><span class="toc-number">1.6.9.</span> <span class="toc-text">多函数 Transform</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%94%A8%E5%AD%97%E5%85%B8%E6%89%A7%E8%A1%8C-transform-%E6%93%8D%E4%BD%9C"><span class="toc-number">1.6.10.</span> <span class="toc-text">用字典执行 transform 操作</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%83%E7%B4%A0%E7%BA%A7%E5%87%BD%E6%95%B0%E5%BA%94%E7%94%A8"><span class="toc-number">1.6.11.</span> <span class="toc-text">元素级函数应用</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%87%8D%E7%BD%AE%E7%B4%A2%E5%BC%95%E4%B8%8E%E6%9B%B4%E6%8D%A2%E6%A0%87%E7%AD%BE"><span class="toc-number">1.7.</span> <span class="toc-text">重置索引与更换标签</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%87%8D%E7%BD%AE%E7%B4%A2%E5%BC%95%EF%BC%8C%E5%B9%B6%E4%B8%8E%E5%85%B6%E5%AE%83%E5%AF%B9%E8%B1%A1%E5%AF%B9%E9%BD%90"><span class="toc-number">1.7.1.</span> <span class="toc-text">重置索引，并与其它对象对齐</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%94%A8-align-%E5%AF%B9%E9%BD%90%E5%A4%9A%E4%B8%AA%E5%AF%B9%E8%B1%A1"><span class="toc-number">1.7.2.</span> <span class="toc-text">用 align 对齐多个对象</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%87%8D%E7%BD%AE%E7%B4%A2%E5%BC%95%E5%A1%AB%E5%85%85%E7%9A%84%E9%99%90%E5%88%B6"><span class="toc-number">1.7.3.</span> <span class="toc-text">重置索引填充的限制</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8E%BB%E6%8E%89%E8%BD%B4%E4%B8%8A%E7%9A%84%E6%A0%87%E7%AD%BE"><span class="toc-number">1.7.4.</span> <span class="toc-text">去掉轴上的标签</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%87%8D%E5%91%BD%E5%90%8D%E6%88%96%E6%98%A0%E5%B0%84%E6%A0%87%E7%AD%BE"><span class="toc-number">1.7.5.</span> <span class="toc-text">重命名或映射标签</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%BF%AD%E4%BB%A3"><span class="toc-number">1.8.</span> <span class="toc-text">迭代</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%A1%B9%E7%9B%AE%EF%BC%88items%EF%BC%89"><span class="toc-number">1.8.1.</span> <span class="toc-text">项目（items）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#iterrows"><span class="toc-number">1.8.2.</span> <span class="toc-text">iterrows</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#itertuples"><span class="toc-number">1.8.3.</span> <span class="toc-text">itertuples</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#dt-%E8%AE%BF%E9%97%AE%E5%99%A8"><span class="toc-number">1.9.</span> <span class="toc-text">.dt 访问器</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%9F%A2%E9%87%8F%E5%8C%96%E5%AD%97%E7%AC%A6%E4%B8%B2%E6%96%B9%E6%B3%95"><span class="toc-number">1.10.</span> <span class="toc-text">矢量化字符串方法</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8E%92%E5%BA%8F"><span class="toc-number">1.11.</span> <span class="toc-text">排序</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8C%89%E7%B4%A2%E5%BC%95%E6%8E%92%E5%BA%8F"><span class="toc-number">1.11.1.</span> <span class="toc-text">按索引排序</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8C%89%E5%80%BC%E6%8E%92%E5%BA%8F"><span class="toc-number">1.11.2.</span> <span class="toc-text">按值排序</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8C%89%E7%B4%A2%E5%BC%95%E4%B8%8E%E5%80%BC%E6%8E%92%E5%BA%8F"><span class="toc-number">1.11.3.</span> <span class="toc-text">按索引与值排序</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%90%9C%E7%B4%A2%E6%8E%92%E5%BA%8F"><span class="toc-number">1.11.4.</span> <span class="toc-text">搜索排序</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9C%80%E5%A4%A7%E5%80%BC%E4%B8%8E%E6%9C%80%E5%B0%8F%E5%80%BC"><span class="toc-number">1.11.5.</span> <span class="toc-text">最大值与最小值</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%94%A8%E5%A4%9A%E5%B1%82%E7%B4%A2%E5%BC%95%E7%9A%84%E5%88%97%E6%8E%92%E5%BA%8F"><span class="toc-number">1.11.6.</span> <span class="toc-text">用多层索引的列排序</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A4%8D%E5%88%B6"><span class="toc-number">1.12.</span> <span class="toc-text">复制</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B"><span class="toc-number">1.13.</span> <span class="toc-text">数据类型</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%BB%98%E8%AE%A4%E5%80%BC"><span class="toc-number">1.13.1.</span> <span class="toc-text">默认值</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%90%91%E4%B8%8A%E8%BD%AC%E5%9E%8B"><span class="toc-number">1.13.2.</span> <span class="toc-text">向上转型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#astype"><span class="toc-number">1.13.3.</span> <span class="toc-text">astype</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AF%B9%E8%B1%A1%E8%BD%AC%E6%8D%A2"><span class="toc-number">1.13.4.</span> <span class="toc-text">对象转换</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%90%84%E7%A7%8D%E5%9D%91"><span class="toc-number">1.13.5.</span> <span class="toc-text">各种坑</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9F%BA%E4%BA%8E-dtype-%E9%80%89%E6%8B%A9%E5%88%97"><span class="toc-number">1.14.</span> <span class="toc-text">基于 dtype 选择列</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/posts/Bookmark/python.html" title="常用的python资源"><img src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://cdn.jsdelivr.net/gh/jackerzz/jackerzz.github.io@ersion1.1/images/canva/777211.jpg" onerror='this.onerror=null,this.src="http://static.kongdf.com/bg4.jpg"' alt="常用的python资源"></a><div class="content"><a class="title" href="/posts/Bookmark/python.html" title="常用的python资源">常用的python资源</a><time datetime="2021-12-24T16:00:00.000Z" title="发表于 2021-12-25 00:00:00">2021-12-25</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/standardlibrary/threadingQueue.html" title="一个基于thread和queue的线程池，以任务为队列元素，动态创建线程，重复利用线程，"><img src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://cdn.jsdelivr.net/gh/jackerzz/jackerzz.github.io@ersion1.1/images/canva/1553463.jpg" onerror='this.onerror=null,this.src="http://static.kongdf.com/bg4.jpg"' alt="一个基于thread和queue的线程池，以任务为队列元素，动态创建线程，重复利用线程，"></a><div class="content"><a class="title" href="/posts/standardlibrary/threadingQueue.html" title="一个基于thread和queue的线程池，以任务为队列元素，动态创建线程，重复利用线程，">一个基于thread和queue的线程池，以任务为队列元素，动态创建线程，重复利用线程，</a><time datetime="2021-10-07T12:50:34.000Z" title="发表于 2021-10-07 20:50:34">2021-10-07</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/toolkit/pandas/pd6.html" title="时间序列与日期用法"><img src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://cdn.jsdelivr.net/gh/jackerzz/jackerzz.github.io@ersion1.1/images/canva/531767.jpg" onerror='this.onerror=null,this.src="http://static.kongdf.com/bg4.jpg"' alt="时间序列与日期用法"></a><div class="content"><a class="title" href="/posts/toolkit/pandas/pd6.html" title="时间序列与日期用法">时间序列与日期用法</a><time datetime="2021-09-20T13:50:34.000Z" title="发表于 2021-09-20 21:50:34">2021-09-20</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/toolkit/pandas/pd5.html" title="Pandas 数据结构"><img src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://cdn.jsdelivr.net/gh/jackerzz/jackerzz.github.io@ersion1.1/images/canva/615299.jpg" onerror='this.onerror=null,this.src="http://static.kongdf.com/bg4.jpg"' alt="Pandas 数据结构"></a><div class="content"><a class="title" href="/posts/toolkit/pandas/pd5.html" title="Pandas 数据结构">Pandas 数据结构</a><time datetime="2021-09-19T13:50:34.000Z" title="发表于 2021-09-19 21:50:34">2021-09-19</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/toolkit/pandas/pd3.html" title="如何让 Pandas 按数据类型选择列？"><img src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://cdn.jsdelivr.net/gh/jackerzz/jackerzz.github.io@ersion1.1/images/canva/1142950.jpg" onerror='this.onerror=null,this.src="http://static.kongdf.com/bg4.jpg"' alt="如何让 Pandas 按数据类型选择列？"></a><div class="content"><a class="title" href="/posts/toolkit/pandas/pd3.html" title="如何让 Pandas 按数据类型选择列？">如何让 Pandas 按数据类型选择列？</a><time datetime="2021-09-16T13:50:34.000Z" title="发表于 2021-09-16 21:50:34">2021-09-16</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2021 By Jackerzz</div><div class="framework-info"><span>框架</span> <a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题</span> <a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload/dist/lazyload.iife.min.js"></script><script>function panguFn(){"object"==typeof pangu?pangu.autoSpacingPage():getScript("https://cdn.jsdelivr.net/npm/pangu/dist/browser/pangu.min.js").then(()=>{pangu.autoSpacingPage()})}function panguInit(){panguFn()}document.addEventListener("DOMContentLoaded",panguInit)</script><div class="js-pjax"></div><script id="click-show-text" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/click-show-text.min.js" data-mobile="false" data-text="IU,iu" data-fontsize="15px" data-random="false" async></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>