<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"><title>时间序列与日期用法 | Jacker-zzk's Blog</title><meta name="keywords" content="pandas"><meta name="author" content="Jackerzz-zzk"><meta name="copyright" content="Jackerzz-zzk"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="时间序列与日期用法依托 NumPy 的 datetime64、timedelta64 等数据类型，Pandas 可以处理各种时间序列数据，还能调用 scikits.timeseries 等 Python 支持库的时间序列功能。 Pandas 支持以下操作： 解析 时间字符串、np.datetime64、datetime.datetime 等多种时间序列数据。 12345678In [1]: imp"><meta property="og:type" content="article"><meta property="og:title" content="时间序列与日期用法"><meta property="og:url" content="https://jackerzz.github.io/posts/data_analysis/pd6.html"><meta property="og:site_name" content="Jacker-zzk&#39;s Blog"><meta property="og:description" content="时间序列与日期用法依托 NumPy 的 datetime64、timedelta64 等数据类型，Pandas 可以处理各种时间序列数据，还能调用 scikits.timeseries 等 Python 支持库的时间序列功能。 Pandas 支持以下操作： 解析 时间字符串、np.datetime64、datetime.datetime 等多种时间序列数据。 12345678In [1]: imp"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/jackerzz/jackerzz.github.io@ersion1.1/images/canva/2753432.jpg"><meta property="article:published_time" content="2021-09-20T13:50:34.000Z"><meta property="article:modified_time" content="2023-03-14T06:02:36.821Z"><meta property="article:author" content="Jackerzz-zzk"><meta property="article:tag" content="pandas"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://cdn.jsdelivr.net/gh/jackerzz/jackerzz.github.io@ersion1.1/images/canva/2753432.jpg"><link rel="shortcut icon" href="https://cdn.jsdelivr.net/gh/jackerzz/jackerzz.github.io@sion1.0/images/img/bookgirl_ico.jpg"><link rel="canonical" href="https://jackerzz.github.io/posts/data_analysis/pd6"><link rel="preconnect" href="//cdn.jsdelivr.net"><link rel="preconnect" href="//busuanzi.ibruce.info"><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload='this.media="all"'><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.min.css" media="print" onload='this.media="all"'><script>const GLOBAL_CONFIG={root:"/",algolia:void 0,localSearch:void 0,translate:void 0,noticeOutdate:void 0,highlight:{plugin:"highlighjs",highlightCopy:!0,highlightLang:!0,highlightHeightLimit:200},copy:{success:"复制成功",error:"复制错误",noSupport:"浏览器不支持"},relativeDate:{homepage:!1,post:!1},runtime:"",date_suffix:{just:"刚刚",min:"分钟前",hour:"小时前",day:"天前",month:"个月前"},copyright:void 0,lightbox:"fancybox",Snackbar:void 0,source:{justifiedGallery:{js:"https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js",css:"https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css"}},isPhotoFigcaption:!1,islazyload:!0,isAnchor:!1}</script><script id="config-diff">var GLOBAL_CONFIG_SITE={title:"时间序列与日期用法",isPost:!0,isHome:!1,isHighlightShrink:!1,isToc:!0,postUpdate:"2023-03-14 14:02:36"}</script><noscript><style>#nav{opacity:1}.justified-gallery img{opacity:1}#post-meta time,#recent-posts time{display:inline!important}</style></noscript><script>(e=>{e.saveToLocal={set:function(e,t,o){if(0===o)return;const n=864e5*o,a={value:t,expiry:(new Date).getTime()+n};localStorage.setItem(e,JSON.stringify(a))},get:function(e){const t=localStorage.getItem(e);if(!t)return;const o=JSON.parse(t);if(!((new Date).getTime()>o.expiry))return o.value;localStorage.removeItem(e)}},e.getScript=e=>new Promise((t,o)=>{const n=document.createElement("script");n.src=e,n.async=!0,n.onerror=o,n.onload=n.onreadystatechange=function(){const e=this.readyState;e&&"loaded"!==e&&"complete"!==e||(n.onload=n.onreadystatechange=null,t())},document.head.appendChild(n)}),e.activateDarkMode=function(){document.documentElement.setAttribute("data-theme","dark"),null!==document.querySelector('meta[name="theme-color"]')&&document.querySelector('meta[name="theme-color"]').setAttribute("content","#0d0d0d")},e.activateLightMode=function(){document.documentElement.setAttribute("data-theme","light"),null!==document.querySelector('meta[name="theme-color"]')&&document.querySelector('meta[name="theme-color"]').setAttribute("content","#ffffff")};const t=saveToLocal.get("theme");"dark"===t?activateDarkMode():"light"===t&&activateLightMode();const o=saveToLocal.get("aside-status");void 0!==o&&("hide"===o?document.documentElement.classList.add("hide-aside"):document.documentElement.classList.remove("hide-aside"));/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)&&document.documentElement.classList.add("apple")})(window)</script><meta name="generator" content="Hexo 5.4.0"></head><body><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/jackerzz/jackerzz.github.io@sion1.0/images/avatar/35586448.jpg" onerror='onerror=null,src="/img/friend_404.gif"' alt="avatar"></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">154</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">28</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">26</div></a></div><hr><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i> <span>主页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i> <span>归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i> <span>Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i> <span>文章分类</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image:url(https://cdn.jsdelivr.net/gh/jackerzz/jackerzz.github.io@ersion1.1/images/canva/2753432.jpg)"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">Jacker-zzk's Blog</a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i> <span>主页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i> <span>归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i> <span>Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i> <span>文章分类</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">时间序列与日期用法</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2021-09-20T13:50:34.000Z" title="发表于 2021-09-20 21:50:34">2021-09-20</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2023-03-14T06:02:36.821Z" title="更新于 2023-03-14 14:02:36">2023-03-14</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/pandas/">pandas</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" data-flag-title="时间序列与日期用法"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="时间序列与日期用法"><a href="#时间序列与日期用法" class="headerlink" title="时间序列与日期用法"></a>时间序列与日期用法</h1><p>依托 NumPy 的 <code>datetime64</code>、<code>timedelta64</code> 等数据类型，Pandas 可以处理各种时间序列数据，还能调用 <code>scikits.timeseries</code> 等 Python 支持库的时间序列功能。</p><p>Pandas 支持以下操作：</p><p>解析 <code>时间字符串</code>、<code>np.datetime64</code>、<code>datetime.datetime</code> 等多种时间序列数据。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">1</span>]: <span class="keyword">import</span> datetime</span><br><span class="line"></span><br><span class="line">In [<span class="number">2</span>]: dti = pd.to_datetime([<span class="string">&#x27;1/1/2018&#x27;</span>, np.datetime64(<span class="string">&#x27;2018-01-01&#x27;</span>),</span><br><span class="line">   ...:                       datetime.datetime(<span class="number">2018</span>, <span class="number">1</span>, <span class="number">1</span>)])</span><br><span class="line">   ...: </span><br><span class="line"></span><br><span class="line">In [<span class="number">3</span>]: dti</span><br><span class="line">Out[<span class="number">3</span>]: DatetimeIndex([<span class="string">&#x27;2018-01-01&#x27;</span>, <span class="string">&#x27;2018-01-01&#x27;</span>, <span class="string">&#x27;2018-01-01&#x27;</span>], dtype=<span class="string">&#x27;datetime64[ns]&#x27;</span>, freq=<span class="literal">None</span>)</span><br></pre></td></tr></table></figure><p>生成 <code>DatetimeIndex</code>、<code>TimedeltaIndex</code> 、<code>PeriodIndex</code> 等定频日期与时间段序列。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">4</span>]: dti = pd.date_range(<span class="string">&#x27;2018-01-01&#x27;</span>, periods=<span class="number">3</span>, freq=<span class="string">&#x27;H&#x27;</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">5</span>]: dti</span><br><span class="line">Out[<span class="number">5</span>]: </span><br><span class="line">DatetimeIndex([<span class="string">&#x27;2018-01-01 00:00:00&#x27;</span>, <span class="string">&#x27;2018-01-01 01:00:00&#x27;</span>,</span><br><span class="line">               <span class="string">&#x27;2018-01-01 02:00:00&#x27;</span>],</span><br><span class="line">              dtype=<span class="string">&#x27;datetime64[ns]&#x27;</span>, freq=<span class="string">&#x27;H&#x27;</span>)</span><br></pre></td></tr></table></figure><p>处理、转换带时区的日期时间数据。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">6</span>]: dti = dti.tz_localize(<span class="string">&#x27;UTC&#x27;</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">7</span>]: dti</span><br><span class="line">Out[<span class="number">7</span>]: </span><br><span class="line">DatetimeIndex([<span class="string">&#x27;2018-01-01 00:00:00+00:00&#x27;</span>, <span class="string">&#x27;2018-01-01 01:00:00+00:00&#x27;</span>,</span><br><span class="line">               <span class="string">&#x27;2018-01-01 02:00:00+00:00&#x27;</span>],</span><br><span class="line">              dtype=<span class="string">&#x27;datetime64[ns, UTC]&#x27;</span>, freq=<span class="string">&#x27;H&#x27;</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">8</span>]: dti.tz_convert(<span class="string">&#x27;US/Pacific&#x27;</span>)</span><br><span class="line">Out[<span class="number">8</span>]: </span><br><span class="line">DatetimeIndex([<span class="string">&#x27;2017-12-31 16:00:00-08:00&#x27;</span>, <span class="string">&#x27;2017-12-31 17:00:00-08:00&#x27;</span>,</span><br><span class="line">               <span class="string">&#x27;2017-12-31 18:00:00-08:00&#x27;</span>],</span><br><span class="line">              dtype=<span class="string">&#x27;datetime64[ns, US/Pacific]&#x27;</span>, freq=<span class="string">&#x27;H&#x27;</span>)</span><br></pre></td></tr></table></figure><p>按指定频率重采样，并转换为时间序列。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">9</span>]: idx = pd.date_range(<span class="string">&#x27;2018-01-01&#x27;</span>, periods=<span class="number">5</span>, freq=<span class="string">&#x27;H&#x27;</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">10</span>]: ts = pd.Series(<span class="built_in">range</span>(<span class="built_in">len</span>(idx)), index=idx)</span><br><span class="line"></span><br><span class="line">In [<span class="number">11</span>]: ts</span><br><span class="line">Out[<span class="number">11</span>]: </span><br><span class="line"><span class="number">2018</span>-01-01 <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>    <span class="number">0</span></span><br><span class="line"><span class="number">2018</span>-01-01 01:<span class="number">00</span>:<span class="number">00</span>    <span class="number">1</span></span><br><span class="line"><span class="number">2018</span>-01-01 02:<span class="number">00</span>:<span class="number">00</span>    <span class="number">2</span></span><br><span class="line"><span class="number">2018</span>-01-01 03:<span class="number">00</span>:<span class="number">00</span>    <span class="number">3</span></span><br><span class="line"><span class="number">2018</span>-01-01 04:<span class="number">00</span>:<span class="number">00</span>    <span class="number">4</span></span><br><span class="line">Freq: H, dtype: int64</span><br><span class="line"></span><br><span class="line">In [<span class="number">12</span>]: ts.resample(<span class="string">&#x27;2H&#x27;</span>).mean()</span><br><span class="line">Out[<span class="number">12</span>]: </span><br><span class="line"><span class="number">2018</span>-01-01 <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>    <span class="number">0.5</span></span><br><span class="line"><span class="number">2018</span>-01-01 02:<span class="number">00</span>:<span class="number">00</span>    <span class="number">2.5</span></span><br><span class="line"><span class="number">2018</span>-01-01 04:<span class="number">00</span>:<span class="number">00</span>    <span class="number">4.0</span></span><br><span class="line">Freq: 2H, dtype: float64</span><br></pre></td></tr></table></figure><p>用绝对或相对时间差计算日期与时间。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">13</span>]: friday = pd.Timestamp(<span class="string">&#x27;2018-01-05&#x27;</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">14</span>]: friday.day_name()</span><br><span class="line">Out[<span class="number">14</span>]: <span class="string">&#x27;Friday&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 添加 1 个日历日</span></span><br><span class="line">In [<span class="number">15</span>]: saturday = friday + pd.Timedelta(<span class="string">&#x27;1 day&#x27;</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">16</span>]: saturday.day_name()</span><br><span class="line">Out[<span class="number">16</span>]: <span class="string">&#x27;Saturday&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 添加 1 个工作日，从星期五跳到星期一</span></span><br><span class="line">In [<span class="number">17</span>]: monday = friday + pd.offsets.BDay()</span><br><span class="line"></span><br><span class="line">In [<span class="number">18</span>]: monday.day_name()</span><br><span class="line">Out[<span class="number">18</span>]: <span class="string">&#x27;Monday&#x27;</span></span><br></pre></td></tr></table></figure><p>Pandas 提供了一组精悍、实用的工具集以完成上述操作。</p><h2 id="时间序列纵览"><a href="#时间序列纵览" class="headerlink" title="时间序列纵览"></a>时间序列纵览</h2><p>Pandas 支持 4 种常见时间概念：</p><ol><li><p>日期时间（Datetime）：带时区的日期时间，类似于标准库的 <code>datetime.datetime</code> 。</p></li><li><p>时间差（Timedelta）：绝对时间周期，类似于标准库的 <code>datetime.timedelta</code>。</p></li><li><p>时间段（Timespan）：在某一时点以指定频率定义的时间跨度。</p></li><li><p>日期偏移（Dateoffset）：与日历运算对应的时间段，类似于 <code>dateutil</code> 的 <code>dateutil.relativedelta.relativedelta</code>。</p></li></ol><table><thead><tr><th align="center">时间概念</th><th align="center">标量类</th><th align="center">数组类</th><th align="center">Pandas 数据类型</th><th align="center">主要构建方法</th></tr></thead><tbody><tr><td align="center">Date times</td><td align="center"><code>Timestamp</code></td><td align="center"><code>DatetimeIndex</code></td><td align="center"><code>datetime64[ns]</code> 或 <code>datetime64[ns,tz]</code></td><td align="center"><code>to_datetime</code> 或 <code>date_range</code></td></tr><tr><td align="center">Time deltas</td><td align="center"><code>Timedelta</code></td><td align="center"><code>TimedeltaIndex</code></td><td align="center"><code>timedelta64[ns]</code></td><td align="center"><code>to_timedelta</code> 或 <code>timedelta_range</code></td></tr><tr><td align="center">Time spans</td><td align="center"><code>Period</code></td><td align="center"><code>PeriodIndex</code></td><td align="center"><code>period[freq]</code></td><td align="center"><code>Period</code> 或 <code>period_range</code></td></tr><tr><td align="center">Date offsets</td><td align="center"><code>DateOffset</code></td><td align="center"><code>None</code></td><td align="center"><code>None</code></td><td align="center"><code>DateOffset</code></td></tr></tbody></table><p>一般情况下，时间序列主要是 <a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.Series.html#pandas.Series" title="pandas.Series"><code>Series</code></a> 或 <a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.html#pandas.DataFrame" title="pandas.DataFrame"><code>DataFrame</code></a> 的时间型索引，可以用时间元素进行操控。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">19</span>]: pd.Series(<span class="built_in">range</span>(<span class="number">3</span>), index=pd.date_range(<span class="string">&#x27;2000&#x27;</span>, freq=<span class="string">&#x27;D&#x27;</span>, periods=<span class="number">3</span>))</span><br><span class="line">Out[<span class="number">19</span>]: </span><br><span class="line"><span class="number">2000</span>-01-01    <span class="number">0</span></span><br><span class="line"><span class="number">2000</span>-01-02    <span class="number">1</span></span><br><span class="line"><span class="number">2000</span>-01-03    <span class="number">2</span></span><br><span class="line">Freq: D, dtype: int64</span><br></pre></td></tr></table></figure><p>当然，<a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.Series.html#pandas.Series" title="pandas.Series"><code>Series</code></a> 与 <a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.html#pandas.DataFrame" title="pandas.DataFrame"><code>DataFrame</code></a> 也可以直接把时间序列当成数据。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">20</span>]: pd.Series(pd.date_range(<span class="string">&#x27;2000&#x27;</span>, freq=<span class="string">&#x27;D&#x27;</span>, periods=<span class="number">3</span>))</span><br><span class="line">Out[<span class="number">20</span>]: </span><br><span class="line"><span class="number">0</span>   <span class="number">2000</span>-01-01</span><br><span class="line"><span class="number">1</span>   <span class="number">2000</span>-01-02</span><br><span class="line"><span class="number">2</span>   <span class="number">2000</span>-01-03</span><br><span class="line">dtype: datetime64[ns]</span><br></pre></td></tr></table></figure><p><a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.Series.html#pandas.Series" title="pandas.Series"><code>Series</code></a> 与 <a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.html#pandas.DataFrame" title="pandas.DataFrame"><code>DataFrame</code></a> 提供了 <code>datetime</code>、<code>timedelta</code> 、<code>Period</code> 扩展类型与专有用法，不过，<code>Dateoffset</code> 则保存为 <code>object</code>。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">21</span>]: pd.Series(pd.period_range(<span class="string">&#x27;1/1/2011&#x27;</span>, freq=<span class="string">&#x27;M&#x27;</span>, periods=<span class="number">3</span>))</span><br><span class="line">Out[<span class="number">21</span>]: </span><br><span class="line"><span class="number">0</span>    <span class="number">2011</span>-01</span><br><span class="line"><span class="number">1</span>    <span class="number">2011</span>-02</span><br><span class="line"><span class="number">2</span>    <span class="number">2011</span>-03</span><br><span class="line">dtype: period[M]</span><br><span class="line"></span><br><span class="line">In [<span class="number">22</span>]: pd.Series([pd.DateOffset(<span class="number">1</span>), pd.DateOffset(<span class="number">2</span>)])</span><br><span class="line">Out[<span class="number">22</span>]: </span><br><span class="line"><span class="number">0</span>         &lt;DateOffset&gt;</span><br><span class="line"><span class="number">1</span>    &lt;<span class="number">2</span> * DateOffsets&gt;</span><br><span class="line">dtype: <span class="built_in">object</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">23</span>]: pd.Series(pd.date_range(<span class="string">&#x27;1/1/2011&#x27;</span>, freq=<span class="string">&#x27;M&#x27;</span>, periods=<span class="number">3</span>))</span><br><span class="line">Out[<span class="number">23</span>]: </span><br><span class="line"><span class="number">0</span>   <span class="number">2011</span>-01-<span class="number">31</span></span><br><span class="line"><span class="number">1</span>   <span class="number">2011</span>-02-<span class="number">28</span></span><br><span class="line"><span class="number">2</span>   <span class="number">2011</span>-03-<span class="number">31</span></span><br><span class="line">dtype: datetime64[ns]</span><br></pre></td></tr></table></figure><p>Pandas 用 <code>NaT</code> 表示日期时间、时间差及时间段的空值，代表了缺失日期或空日期的值，类似于浮点数的 <code>np.nan</code>。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">24</span>]: pd.Timestamp(pd.NaT)</span><br><span class="line">Out[<span class="number">24</span>]: NaT</span><br><span class="line"></span><br><span class="line">In [<span class="number">25</span>]: pd.Timedelta(pd.NaT)</span><br><span class="line">Out[<span class="number">25</span>]: NaT</span><br><span class="line"></span><br><span class="line">In [<span class="number">26</span>]: pd.Period(pd.NaT)</span><br><span class="line">Out[<span class="number">26</span>]: NaT</span><br><span class="line"></span><br><span class="line"><span class="comment"># 与 np.nan 一样，pd.NaT 不等于 pd.NaT </span></span><br><span class="line">In [<span class="number">27</span>]: pd.NaT == pd.NaT</span><br><span class="line">Out[<span class="number">27</span>]: <span class="literal">False</span></span><br></pre></td></tr></table></figure><h2 id="时间戳-vs-时间段"><a href="#时间戳-vs-时间段" class="headerlink" title="时间戳 vs. 时间段"></a>时间戳 vs. 时间段</h2><p>时间戳是最基本的时间序列数据，用于把数值与时点关联在一起。Pandas 对象通过时间戳调用时点数据。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">28</span>]: pd.Timestamp(datetime.datetime(<span class="number">2012</span>, <span class="number">5</span>, <span class="number">1</span>))</span><br><span class="line">Out[<span class="number">28</span>]: Timestamp(<span class="string">&#x27;2012-05-01 00:00:00&#x27;</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">29</span>]: pd.Timestamp(<span class="string">&#x27;2012-05-01&#x27;</span>)</span><br><span class="line">Out[<span class="number">29</span>]: Timestamp(<span class="string">&#x27;2012-05-01 00:00:00&#x27;</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">30</span>]: pd.Timestamp(<span class="number">2012</span>, <span class="number">5</span>, <span class="number">1</span>)</span><br><span class="line">Out[<span class="number">30</span>]: Timestamp(<span class="string">&#x27;2012-05-01 00:00:00&#x27;</span>)</span><br></pre></td></tr></table></figure><p>不过，大多数情况下，用时间段改变变量更自然。<code>Period</code> 表示的时间段更直观，还可以用日期时间格式的字符串进行推断。</p><p>示例如下：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">31</span>]: pd.Period(<span class="string">&#x27;2011-01&#x27;</span>)</span><br><span class="line">Out[<span class="number">31</span>]: Period(<span class="string">&#x27;2011-01&#x27;</span>, <span class="string">&#x27;M&#x27;</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">32</span>]: pd.Period(<span class="string">&#x27;2012-05&#x27;</span>, freq=<span class="string">&#x27;D&#x27;</span>)</span><br><span class="line">Out[<span class="number">32</span>]: Period(<span class="string">&#x27;2012-05-01&#x27;</span>, <span class="string">&#x27;D&#x27;</span>)</span><br></pre></td></tr></table></figure><p><a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.Timestamp.html#pandas.Timestamp" title="pandas.Timestamp"><code>Timestamp</code></a> 与 <a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.Period.html#pandas.Period" title="pandas.Period"><code>Period</code></a> 可以用作索引。作为索引的 <code>Timestamp</code> 与 <code>Period</code> 列表则被强制转换为对应的 <a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DatetimeIndex.html#pandas.DatetimeIndex" title="pandas.DatetimeIndex"><code>DatetimeIndex</code></a> 与 <a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.PeriodIndex.html#pandas.PeriodIndex" title="pandas.PeriodIndex"><code>PeriodIndex</code></a>。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">33</span>]: dates = [pd.Timestamp(<span class="string">&#x27;2012-05-01&#x27;</span>),</span><br><span class="line">   ....:          pd.Timestamp(<span class="string">&#x27;2012-05-02&#x27;</span>),</span><br><span class="line">   ....:          pd.Timestamp(<span class="string">&#x27;2012-05-03&#x27;</span>)]</span><br><span class="line">   ....: </span><br><span class="line"></span><br><span class="line">In [<span class="number">34</span>]: ts = pd.Series(np.random.randn(<span class="number">3</span>), dates)</span><br><span class="line"></span><br><span class="line">In [<span class="number">35</span>]: <span class="built_in">type</span>(ts.index)</span><br><span class="line">Out[<span class="number">35</span>]: pandas.core.indexes.datetimes.DatetimeIndex</span><br><span class="line"></span><br><span class="line">In [<span class="number">36</span>]: ts.index</span><br><span class="line">Out[<span class="number">36</span>]: DatetimeIndex([<span class="string">&#x27;2012-05-01&#x27;</span>, <span class="string">&#x27;2012-05-02&#x27;</span>, <span class="string">&#x27;2012-05-03&#x27;</span>], dtype=<span class="string">&#x27;datetime64[ns]&#x27;</span>, freq=<span class="literal">None</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">37</span>]: ts</span><br><span class="line">Out[<span class="number">37</span>]: </span><br><span class="line"><span class="number">2012</span>-05-01    <span class="number">0.469112</span></span><br><span class="line"><span class="number">2012</span>-05-02   -<span class="number">0.282863</span></span><br><span class="line"><span class="number">2012</span>-05-03   -<span class="number">1.509059</span></span><br><span class="line">dtype: float64</span><br><span class="line"></span><br><span class="line">In [<span class="number">38</span>]: periods = [pd.Period(<span class="string">&#x27;2012-01&#x27;</span>), pd.Period(<span class="string">&#x27;2012-02&#x27;</span>), pd.Period(<span class="string">&#x27;2012-03&#x27;</span>)]</span><br><span class="line"></span><br><span class="line">In [<span class="number">39</span>]: ts = pd.Series(np.random.randn(<span class="number">3</span>), periods)</span><br><span class="line"></span><br><span class="line">In [<span class="number">40</span>]: <span class="built_in">type</span>(ts.index)</span><br><span class="line">Out[<span class="number">40</span>]: pandas.core.indexes.period.PeriodIndex</span><br><span class="line"></span><br><span class="line">In [<span class="number">41</span>]: ts.index</span><br><span class="line">Out[<span class="number">41</span>]: PeriodIndex([<span class="string">&#x27;2012-01&#x27;</span>, <span class="string">&#x27;2012-02&#x27;</span>, <span class="string">&#x27;2012-03&#x27;</span>], dtype=<span class="string">&#x27;period[M]&#x27;</span>, freq=<span class="string">&#x27;M&#x27;</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">42</span>]: ts</span><br><span class="line">Out[<span class="number">42</span>]: </span><br><span class="line"><span class="number">2012</span>-01   -<span class="number">1.135632</span></span><br><span class="line"><span class="number">2012</span>-02    <span class="number">1.212112</span></span><br><span class="line"><span class="number">2012</span>-03   -<span class="number">0.173215</span></span><br><span class="line">Freq: M, dtype: float64</span><br></pre></td></tr></table></figure><p>Pandas 可以识别这两种表现形式，并在两者之间进行转化。Pandas 后台用 <code>Timestamp</code> 实例代表时间戳，用 <code>DatetimeIndex</code> 实例代表时间戳序列。Pandas 用 <code>Period</code> 对象表示符合规律的时间段标量值，用 <code>PeriodIndex</code> 表示时间段序列。未来版本会支持用任意起止时间实现不规律时间间隔。</p><h2 id="转换时间戳"><a href="#转换时间戳" class="headerlink" title="转换时间戳"></a>转换时间戳</h2><p><code>to_datetime</code> 函数用于转换字符串、纪元式及混合的日期 <a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.Series.html#pandas.Series" title="pandas.Series"><code>Series</code></a> 或日期列表。转换 <code>Series</code>，返回具有相同索引的 <code>Series</code>，日期时间列表被转换为 <code>DatetimeIndex</code>：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">43</span>]: pd.to_datetime(pd.Series([<span class="string">&#x27;Jul 31, 2009&#x27;</span>, <span class="string">&#x27;2010-01-10&#x27;</span>, <span class="literal">None</span>]))</span><br><span class="line">Out[<span class="number">43</span>]: </span><br><span class="line"><span class="number">0</span>   <span class="number">2009</span>-07-<span class="number">31</span></span><br><span class="line"><span class="number">1</span>   <span class="number">2010</span>-01-<span class="number">10</span></span><br><span class="line"><span class="number">2</span>          NaT</span><br><span class="line">dtype: datetime64[ns]</span><br><span class="line"></span><br><span class="line">In [<span class="number">44</span>]: pd.to_datetime([<span class="string">&#x27;2005/11/23&#x27;</span>, <span class="string">&#x27;2010.12.31&#x27;</span>])</span><br><span class="line">Out[<span class="number">44</span>]: DatetimeIndex([<span class="string">&#x27;2005-11-23&#x27;</span>, <span class="string">&#x27;2010-12-31&#x27;</span>], dtype=<span class="string">&#x27;datetime64[ns]&#x27;</span>, freq=<span class="literal">None</span>)</span><br></pre></td></tr></table></figure><p>解析欧式日期（日-月-年），要用 <code>dayfirst</code> 关键字参数：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">45</span>]: pd.to_datetime([<span class="string">&#x27;04-01-2012 10:00&#x27;</span>], dayfirst=<span class="literal">True</span>)</span><br><span class="line">Out[<span class="number">45</span>]: DatetimeIndex([<span class="string">&#x27;2012-01-04 10:00:00&#x27;</span>], dtype=<span class="string">&#x27;datetime64[ns]&#x27;</span>, freq=<span class="literal">None</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">46</span>]: pd.to_datetime([<span class="string">&#x27;14-01-2012&#x27;</span>, <span class="string">&#x27;01-14-2012&#x27;</span>], dayfirst=<span class="literal">True</span>)</span><br><span class="line">Out[<span class="number">46</span>]: DatetimeIndex([<span class="string">&#x27;2012-01-14&#x27;</span>, <span class="string">&#x27;2012-01-14&#x27;</span>], dtype=<span class="string">&#x27;datetime64[ns]&#x27;</span>, freq=<span class="literal">None</span>)</span><br></pre></td></tr></table></figure><p>::: danger 警告</p><p>从上例可以看出，<code>dayfirst</code> 并不严苛，如果不能把第一个数解析为<strong>日</strong>，就会以 <code>dayfirst</code> 为 <code>False</code> 进行解析。</p><p>:::</p><p><code>to_datetime</code> 转换单个字符串时，返回单个 <code>Timestamp</code>。<code>Timestamp</code> 仅支持字符串输入，不支持 <code>dayfirst</code>、<code>format</code> 等字符串解析选项，如果要使用这些选项，就要用 <code>to_datetime</code>。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">47</span>]: pd.to_datetime(<span class="string">&#x27;2010/11/12&#x27;</span>)</span><br><span class="line">Out[<span class="number">47</span>]: Timestamp(<span class="string">&#x27;2010-11-12 00:00:00&#x27;</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">48</span>]: pd.Timestamp(<span class="string">&#x27;2010/11/12&#x27;</span>)</span><br><span class="line">Out[<span class="number">48</span>]: Timestamp(<span class="string">&#x27;2010-11-12 00:00:00&#x27;</span>)</span><br></pre></td></tr></table></figure><p>Pandas 还支持直接使用 <code>DatetimeIndex</code> 构建器：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">49</span>]: pd.DatetimeIndex([<span class="string">&#x27;2018-01-01&#x27;</span>, <span class="string">&#x27;2018-01-03&#x27;</span>, <span class="string">&#x27;2018-01-05&#x27;</span>])</span><br><span class="line">Out[<span class="number">49</span>]: DatetimeIndex([<span class="string">&#x27;2018-01-01&#x27;</span>, <span class="string">&#x27;2018-01-03&#x27;</span>, <span class="string">&#x27;2018-01-05&#x27;</span>], dtype=<span class="string">&#x27;datetime64[ns]&#x27;</span>, freq=<span class="literal">None</span>)</span><br></pre></td></tr></table></figure><p>创建 <code>DatetimeIndex</code> 时，传递字符串 <code>infer</code> 可推断索引的频率。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">50</span>]: pd.DatetimeIndex([<span class="string">&#x27;2018-01-01&#x27;</span>, <span class="string">&#x27;2018-01-03&#x27;</span>, <span class="string">&#x27;2018-01-05&#x27;</span>], freq=<span class="string">&#x27;infer&#x27;</span>)</span><br><span class="line">Out[<span class="number">50</span>]: DatetimeIndex([<span class="string">&#x27;2018-01-01&#x27;</span>, <span class="string">&#x27;2018-01-03&#x27;</span>, <span class="string">&#x27;2018-01-05&#x27;</span>], dtype=<span class="string">&#x27;datetime64[ns]&#x27;</span>, freq=<span class="string">&#x27;2D&#x27;</span>)</span><br></pre></td></tr></table></figure><h3 id="提供格式参数"><a href="#提供格式参数" class="headerlink" title="提供格式参数"></a>提供格式参数</h3><p>要实现精准转换，除了传递 <code>datetime</code> 字符串，还要指定 <code>format</code> 参数，指定此参数还可以加速转换速度。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">51</span>]: pd.to_datetime(<span class="string">&#x27;2010/11/12&#x27;</span>, <span class="built_in">format</span>=<span class="string">&#x27;%Y/%m/%d&#x27;</span>)</span><br><span class="line">Out[<span class="number">51</span>]: Timestamp(<span class="string">&#x27;2010-11-12 00:00:00&#x27;</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">52</span>]: pd.to_datetime(<span class="string">&#x27;12-11-2010 00:00&#x27;</span>, <span class="built_in">format</span>=<span class="string">&#x27;%d-%m-%Y %H:%M&#x27;</span>)</span><br><span class="line">Out[<span class="number">52</span>]: Timestamp(<span class="string">&#x27;2010-11-12 00:00:00&#x27;</span>)</span><br></pre></td></tr></table></figure><p>要了解更多 <code>format</code> 选项，请参阅 Python <a target="_blank" rel="noopener" href="https://docs.python.org/3/library/datetime.html#strftime-and-strptime-behavior">日期时间文档</a>。</p><h3 id="用多列组合日期时间"><a href="#用多列组合日期时间" class="headerlink" title="用多列组合日期时间"></a>用多列组合日期时间</h3><p><em>0.18.1 版新增。</em></p><p>Pandas 还可以把 <code>DataFrame</code> 里的整数或字符串列组合成 <code>Timestamp Series</code>。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">53</span>]: df = pd.DataFrame(&#123;<span class="string">&#x27;year&#x27;</span>: [<span class="number">2015</span>, <span class="number">2016</span>],</span><br><span class="line">   ....:                    <span class="string">&#x27;month&#x27;</span>: [<span class="number">2</span>, <span class="number">3</span>],</span><br><span class="line">   ....:                    <span class="string">&#x27;day&#x27;</span>: [<span class="number">4</span>, <span class="number">5</span>],</span><br><span class="line">   ....:                    <span class="string">&#x27;hour&#x27;</span>: [<span class="number">2</span>, <span class="number">3</span>]&#125;)</span><br><span class="line">   ....: </span><br><span class="line"></span><br><span class="line">In [<span class="number">54</span>]: pd.to_datetime(df)</span><br><span class="line">Out[<span class="number">54</span>]: </span><br><span class="line"><span class="number">0</span>   <span class="number">2015</span>-02-04 02:<span class="number">00</span>:<span class="number">00</span></span><br><span class="line"><span class="number">1</span>   <span class="number">2016</span>-03-05 03:<span class="number">00</span>:<span class="number">00</span></span><br><span class="line">dtype: datetime64[ns]</span><br></pre></td></tr></table></figure><p>只传递组合所需的列也可以。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">55</span>]: pd.to_datetime(df[[<span class="string">&#x27;year&#x27;</span>, <span class="string">&#x27;month&#x27;</span>, <span class="string">&#x27;day&#x27;</span>]])</span><br><span class="line">Out[<span class="number">55</span>]: </span><br><span class="line"><span class="number">0</span>   <span class="number">2015</span>-02-04</span><br><span class="line"><span class="number">1</span>   <span class="number">2016</span>-03-05</span><br><span class="line">dtype: datetime64[ns]</span><br></pre></td></tr></table></figure><p><code>pd.to_datetime</code> 查找列名里日期时间组件的标准名称，包括：</p><ul><li>必填：<code>year</code>、<code>month</code>、<code>day</code></li><li>可选：<code>hour</code>、<code>minute</code>、<code>second</code>、<code>millisecond</code>、<code>microsecond</code>、<code>nanosecond</code></li></ul><h3 id="无效数据"><a href="#无效数据" class="headerlink" title="无效数据"></a>无效数据</h3><p>不可解析时，默认值 <code>errors=&#39;raise&#39;</code> 会触发错误：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">2</span>]: pd.to_datetime([<span class="string">&#x27;2009/07/31&#x27;</span>, <span class="string">&#x27;asd&#x27;</span>], errors=<span class="string">&#x27;raise&#x27;</span>)</span><br><span class="line">ValueError: Unknown string <span class="built_in">format</span></span><br></pre></td></tr></table></figure><p><code>errors=&#39;ignore&#39;</code> 返回原始输入：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">56</span>]: pd.to_datetime([<span class="string">&#x27;2009/07/31&#x27;</span>, <span class="string">&#x27;asd&#x27;</span>], errors=<span class="string">&#x27;ignore&#x27;</span>)</span><br><span class="line">Out[<span class="number">56</span>]: Index([<span class="string">&#x27;2009/07/31&#x27;</span>, <span class="string">&#x27;asd&#x27;</span>], dtype=<span class="string">&#x27;object&#x27;</span>)</span><br></pre></td></tr></table></figure><p><code>errors=&#39;coerce&#39;</code> 把无法解析的数据转换为 <code>NaT</code>，即不是时间（Not a Time）：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">57</span>]: pd.to_datetime([<span class="string">&#x27;2009/07/31&#x27;</span>, <span class="string">&#x27;asd&#x27;</span>], errors=<span class="string">&#x27;coerce&#x27;</span>)</span><br><span class="line">Out[<span class="number">57</span>]: DatetimeIndex([<span class="string">&#x27;2009-07-31&#x27;</span>, <span class="string">&#x27;NaT&#x27;</span>], dtype=<span class="string">&#x27;datetime64[ns]&#x27;</span>, freq=<span class="literal">None</span>)</span><br></pre></td></tr></table></figure><h3 id="纪元时间戳"><a href="#纪元时间戳" class="headerlink" title="纪元时间戳"></a>纪元时间戳</h3><p>Pandas 支持把整数或浮点数纪元时间转换为 <code>Timestamp</code> 与 <code>DatetimeIndex</code>。鉴于 <code>Timestamp</code> 对象内部存储方式，这种转换的默认单位是纳秒。不过，一般都会用指定其它时间单位 <code>unit</code> 来存储纪元数据，纪元时间从 <code>origin</code> 参数指定的时点开始计算。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">58</span>]: pd.to_datetime([<span class="number">1349720105</span>, <span class="number">1349806505</span>, <span class="number">1349892905</span>,</span><br><span class="line">   ....:                 <span class="number">1349979305</span>, <span class="number">1350065705</span>], unit=<span class="string">&#x27;s&#x27;</span>)</span><br><span class="line">   ....: </span><br><span class="line">Out[<span class="number">58</span>]: </span><br><span class="line">DatetimeIndex([<span class="string">&#x27;2012-10-08 18:15:05&#x27;</span>, <span class="string">&#x27;2012-10-09 18:15:05&#x27;</span>,</span><br><span class="line">               <span class="string">&#x27;2012-10-10 18:15:05&#x27;</span>, <span class="string">&#x27;2012-10-11 18:15:05&#x27;</span>,</span><br><span class="line">               <span class="string">&#x27;2012-10-12 18:15:05&#x27;</span>],</span><br><span class="line">              dtype=<span class="string">&#x27;datetime64[ns]&#x27;</span>, freq=<span class="literal">None</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">59</span>]: pd.to_datetime([<span class="number">1349720105100</span>, <span class="number">1349720105200</span>, <span class="number">1349720105300</span>,</span><br><span class="line">   ....:                 <span class="number">1349720105400</span>, <span class="number">1349720105500</span>], unit=<span class="string">&#x27;ms&#x27;</span>)</span><br><span class="line">   ....: </span><br><span class="line">Out[<span class="number">59</span>]: </span><br><span class="line">DatetimeIndex([<span class="string">&#x27;2012-10-08 18:15:05.100000&#x27;</span>, <span class="string">&#x27;2012-10-08 18:15:05.200000&#x27;</span>,</span><br><span class="line">               <span class="string">&#x27;2012-10-08 18:15:05.300000&#x27;</span>, <span class="string">&#x27;2012-10-08 18:15:05.400000&#x27;</span>,</span><br><span class="line">               <span class="string">&#x27;2012-10-08 18:15:05.500000&#x27;</span>],</span><br><span class="line">              dtype=<span class="string">&#x27;datetime64[ns]&#x27;</span>, freq=<span class="literal">None</span>)</span><br></pre></td></tr></table></figure><p>用带 <code>tz</code> 参数的纪元时间戳创建 <a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.Timestamp.html#pandas.Timestamp" title="pandas.Timestamp"><code>Timestamp</code></a> 或 <a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DatetimeIndex.html#pandas.DatetimeIndex" title="pandas.DatetimeIndex"><code>DatetimeIndex</code></a> 时，要先把纪元时间戳转化为 UTC，然后再把结果转换为指定时区。不过这种操作方式现在已经<a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/whatsnew/v0.24.0.html#whatsnew-0240-deprecations-integer-tz">废弃</a>了，对于其它时区 Wall Time 里的纪元时间戳，建议先把纪元时间戳转换为无时区时间戳，再本地化时区。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">60</span>]: pd.Timestamp(<span class="number">1262347200000000000</span>).tz_localize(<span class="string">&#x27;US/Pacific&#x27;</span>)</span><br><span class="line">Out[<span class="number">60</span>]: Timestamp(<span class="string">&#x27;2010-01-01 12:00:00-0800&#x27;</span>, tz=<span class="string">&#x27;US/Pacific&#x27;</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">61</span>]: pd.DatetimeIndex([<span class="number">1262347200000000000</span>]).tz_localize(<span class="string">&#x27;US/Pacific&#x27;</span>)</span><br><span class="line">Out[<span class="number">61</span>]: DatetimeIndex([<span class="string">&#x27;2010-01-01 12:00:00-08:00&#x27;</span>], dtype=<span class="string">&#x27;datetime64[ns, US/Pacific]&#x27;</span>, freq=<span class="literal">None</span>)</span><br></pre></td></tr></table></figure><p>::: tip 注意</p><p>纪元时间取整到最近的纳秒。</p><p>:::</p><p>::: danger 警告</p><p><a target="_blank" rel="noopener" href="https://docs.python.org/3/tutorial/floatingpoint.html#tut-fp-issues" title="(in Python v3.7)">Python 浮点数</a>只精确到 15 位小数，因此，转换浮点纪元时间可能会导致不精准或失控的结果。转换过程中，免不了对高精度 <code>Timestamp</code> 取整，只有用 <code>int64</code> 等定宽类型才有可能实现极其精准的效果。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">62</span>]: pd.to_datetime([<span class="number">1490195805.433</span>, <span class="number">1490195805.433502912</span>], unit=<span class="string">&#x27;s&#x27;</span>)</span><br><span class="line">Out[<span class="number">62</span>]: DatetimeIndex([<span class="string">&#x27;2017-03-22 15:16:45.433000088&#x27;</span>, <span class="string">&#x27;2017-03-22 15:16:45.433502913&#x27;</span>], dtype=<span class="string">&#x27;datetime64[ns]&#x27;</span>, freq=<span class="literal">None</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">63</span>]: pd.to_datetime(<span class="number">1490195805433502912</span>, unit=<span class="string">&#x27;ns&#x27;</span>)</span><br><span class="line">Out[<span class="number">63</span>]: Timestamp(<span class="string">&#x27;2017-03-22 15:16:45.433502912&#x27;</span>)</span><br></pre></td></tr></table></figure><p>:::</p><p>::: tip 参阅</p><p><a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/user_guide/timeseries.html#timeseries-origin">应用 <code>origin</code> 参数</a></p><p>:::</p><h3 id="把时间戳转换为纪元"><a href="#把时间戳转换为纪元" class="headerlink" title="把时间戳转换为纪元"></a>把时间戳转换为纪元</h3><p>反转上述操作，把 <code>Timestamp</code> 转换为 <code>unix</code> 纪元：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">64</span>]: stamps = pd.date_range(<span class="string">&#x27;2012-10-08 18:15:05&#x27;</span>, periods=<span class="number">4</span>, freq=<span class="string">&#x27;D&#x27;</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">65</span>]: stamps</span><br><span class="line">Out[<span class="number">65</span>]: </span><br><span class="line">DatetimeIndex([<span class="string">&#x27;2012-10-08 18:15:05&#x27;</span>, <span class="string">&#x27;2012-10-09 18:15:05&#x27;</span>,</span><br><span class="line">               <span class="string">&#x27;2012-10-10 18:15:05&#x27;</span>, <span class="string">&#x27;2012-10-11 18:15:05&#x27;</span>],</span><br><span class="line">              dtype=<span class="string">&#x27;datetime64[ns]&#x27;</span>, freq=<span class="string">&#x27;D&#x27;</span>)</span><br></pre></td></tr></table></figure><p>首先与纪元开始时点（1970 年 1 月 1 日午夜，UTC）相减，然后以 1 秒为时间单位（<code>unit=&#39;1s&#39;</code>）取底整除。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">66</span>]: (stamps - pd.Timestamp(<span class="string">&quot;1970-01-01&quot;</span>)) // pd.Timedelta(<span class="string">&#x27;1s&#x27;</span>)</span><br><span class="line">Out[<span class="number">66</span>]: Int64Index([<span class="number">1349720105</span>, <span class="number">1349806505</span>, <span class="number">1349892905</span>, <span class="number">1349979305</span>], dtype=<span class="string">&#x27;int64&#x27;</span>)</span><br></pre></td></tr></table></figure><h3 id="应用-origin-参数"><a href="#应用-origin-参数" class="headerlink" title="应用 origin 参数"></a>应用 <code>origin</code> 参数</h3><p><em>0.20.0 版新增。</em></p><p><code>origin</code> 参数可以指定 <code>DatetimeIndex</code> 的备选开始时点。例如，把<code>1960-01-01</code> 作为开始日期：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">67</span>]: pd.to_datetime([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>], unit=<span class="string">&#x27;D&#x27;</span>, origin=pd.Timestamp(<span class="string">&#x27;1960-01-01&#x27;</span>))</span><br><span class="line">Out[<span class="number">67</span>]: DatetimeIndex([<span class="string">&#x27;1960-01-02&#x27;</span>, <span class="string">&#x27;1960-01-03&#x27;</span>, <span class="string">&#x27;1960-01-04&#x27;</span>], dtype=<span class="string">&#x27;datetime64[ns]&#x27;</span>, freq=<span class="literal">None</span>)</span><br></pre></td></tr></table></figure><p>默认值为 <code>origin=&#39;unix&#39;</code>，即 <code>1970-01-01 00:00:00</code>，一般把这个时点称为 <code>unix 纪元</code> 或 <code>POSIX</code> 时间。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">68</span>]: pd.to_datetime([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>], unit=<span class="string">&#x27;D&#x27;</span>)</span><br><span class="line">Out[<span class="number">68</span>]: DatetimeIndex([<span class="string">&#x27;1970-01-02&#x27;</span>, <span class="string">&#x27;1970-01-03&#x27;</span>, <span class="string">&#x27;1970-01-04&#x27;</span>], dtype=<span class="string">&#x27;datetime64[ns]&#x27;</span>, freq=<span class="literal">None</span>)</span><br></pre></td></tr></table></figure><h2 id="生成时间戳范围"><a href="#生成时间戳范围" class="headerlink" title="生成时间戳范围"></a>生成时间戳范围</h2><p><code>DatetimeIndex</code>、<code>Index</code> 构建器可以生成时间戳索引，此处要提供 <code>datetime</code> 对象列表。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">69</span>]: dates = [datetime.datetime(<span class="number">2012</span>, <span class="number">5</span>, <span class="number">1</span>),</span><br><span class="line">   ....:          datetime.datetime(<span class="number">2012</span>, <span class="number">5</span>, <span class="number">2</span>),</span><br><span class="line">   ....:          datetime.datetime(<span class="number">2012</span>, <span class="number">5</span>, <span class="number">3</span>)]</span><br><span class="line">   ....: </span><br><span class="line"></span><br><span class="line"><span class="comment"># 注意频率信息</span></span><br><span class="line">In [<span class="number">70</span>]: index = pd.DatetimeIndex(dates)</span><br><span class="line"></span><br><span class="line">In [<span class="number">71</span>]: index</span><br><span class="line">Out[<span class="number">71</span>]: DatetimeIndex([<span class="string">&#x27;2012-05-01&#x27;</span>, <span class="string">&#x27;2012-05-02&#x27;</span>, <span class="string">&#x27;2012-05-03&#x27;</span>], dtype=<span class="string">&#x27;datetime64[ns]&#x27;</span>, freq=<span class="literal">None</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 自动转换为 DatetimeIndex</span></span><br><span class="line">In [<span class="number">72</span>]: index = pd.Index(dates)</span><br><span class="line"></span><br><span class="line">In [<span class="number">73</span>]: index</span><br><span class="line">Out[<span class="number">73</span>]: DatetimeIndex([<span class="string">&#x27;2012-05-01&#x27;</span>, <span class="string">&#x27;2012-05-02&#x27;</span>, <span class="string">&#x27;2012-05-03&#x27;</span>], dtype=<span class="string">&#x27;datetime64[ns]&#x27;</span>, freq=<span class="literal">None</span>)</span><br></pre></td></tr></table></figure><p>实际工作中，生成大量时间戳的超长索引时，一个个输入时间戳又枯燥，又低效。如果时间戳是定频的，用 <a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.date_range.html#pandas.date_range" title="pandas.date_range"><code>date_range()</code></a> 与 <a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.bdate_range.html#pandas.bdate_range" title="pandas.bdate_range"><code>bdate_range()</code></a> 函数即可创建 <code>DatetimeIndex</code>。<code>date_range</code> 默认的频率是<strong>日历日</strong>，<code>bdate_range</code> 的默认频率是<strong>工作日</strong>：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">74</span>]: start = datetime.datetime(<span class="number">2011</span>, <span class="number">1</span>, <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">75</span>]: end = datetime.datetime(<span class="number">2012</span>, <span class="number">1</span>, <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">76</span>]: index = pd.date_range(start, end)</span><br><span class="line"></span><br><span class="line">In [<span class="number">77</span>]: index</span><br><span class="line">Out[<span class="number">77</span>]: </span><br><span class="line">DatetimeIndex([<span class="string">&#x27;2011-01-01&#x27;</span>, <span class="string">&#x27;2011-01-02&#x27;</span>, <span class="string">&#x27;2011-01-03&#x27;</span>, <span class="string">&#x27;2011-01-04&#x27;</span>,</span><br><span class="line">               <span class="string">&#x27;2011-01-05&#x27;</span>, <span class="string">&#x27;2011-01-06&#x27;</span>, <span class="string">&#x27;2011-01-07&#x27;</span>, <span class="string">&#x27;2011-01-08&#x27;</span>,</span><br><span class="line">               <span class="string">&#x27;2011-01-09&#x27;</span>, <span class="string">&#x27;2011-01-10&#x27;</span>,</span><br><span class="line">               ...</span><br><span class="line">               <span class="string">&#x27;2011-12-23&#x27;</span>, <span class="string">&#x27;2011-12-24&#x27;</span>, <span class="string">&#x27;2011-12-25&#x27;</span>, <span class="string">&#x27;2011-12-26&#x27;</span>,</span><br><span class="line">               <span class="string">&#x27;2011-12-27&#x27;</span>, <span class="string">&#x27;2011-12-28&#x27;</span>, <span class="string">&#x27;2011-12-29&#x27;</span>, <span class="string">&#x27;2011-12-30&#x27;</span>,</span><br><span class="line">               <span class="string">&#x27;2011-12-31&#x27;</span>, <span class="string">&#x27;2012-01-01&#x27;</span>],</span><br><span class="line">              dtype=<span class="string">&#x27;datetime64[ns]&#x27;</span>, length=<span class="number">366</span>, freq=<span class="string">&#x27;D&#x27;</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">78</span>]: index = pd.bdate_range(start, end)</span><br><span class="line"></span><br><span class="line">In [<span class="number">79</span>]: index</span><br><span class="line">Out[<span class="number">79</span>]: </span><br><span class="line">DatetimeIndex([<span class="string">&#x27;2011-01-03&#x27;</span>, <span class="string">&#x27;2011-01-04&#x27;</span>, <span class="string">&#x27;2011-01-05&#x27;</span>, <span class="string">&#x27;2011-01-06&#x27;</span>,</span><br><span class="line">               <span class="string">&#x27;2011-01-07&#x27;</span>, <span class="string">&#x27;2011-01-10&#x27;</span>, <span class="string">&#x27;2011-01-11&#x27;</span>, <span class="string">&#x27;2011-01-12&#x27;</span>,</span><br><span class="line">               <span class="string">&#x27;2011-01-13&#x27;</span>, <span class="string">&#x27;2011-01-14&#x27;</span>,</span><br><span class="line">               ...</span><br><span class="line">               <span class="string">&#x27;2011-12-19&#x27;</span>, <span class="string">&#x27;2011-12-20&#x27;</span>, <span class="string">&#x27;2011-12-21&#x27;</span>, <span class="string">&#x27;2011-12-22&#x27;</span>,</span><br><span class="line">               <span class="string">&#x27;2011-12-23&#x27;</span>, <span class="string">&#x27;2011-12-26&#x27;</span>, <span class="string">&#x27;2011-12-27&#x27;</span>, <span class="string">&#x27;2011-12-28&#x27;</span>,</span><br><span class="line">               <span class="string">&#x27;2011-12-29&#x27;</span>, <span class="string">&#x27;2011-12-30&#x27;</span>],</span><br><span class="line">              dtype=<span class="string">&#x27;datetime64[ns]&#x27;</span>, length=<span class="number">260</span>, freq=<span class="string">&#x27;B&#x27;</span>)</span><br></pre></td></tr></table></figure><p><code>date_range</code>、<code>bdate_range</code> 等便捷函数可以调用各种<a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/user_guide/timeseries.html#timeseries-offset-aliases">频率别名</a>：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">80</span>]: pd.date_range(start, periods=<span class="number">1000</span>, freq=<span class="string">&#x27;M&#x27;</span>)</span><br><span class="line">Out[<span class="number">80</span>]: </span><br><span class="line">DatetimeIndex([<span class="string">&#x27;2011-01-31&#x27;</span>, <span class="string">&#x27;2011-02-28&#x27;</span>, <span class="string">&#x27;2011-03-31&#x27;</span>, <span class="string">&#x27;2011-04-30&#x27;</span>,</span><br><span class="line">               <span class="string">&#x27;2011-05-31&#x27;</span>, <span class="string">&#x27;2011-06-30&#x27;</span>, <span class="string">&#x27;2011-07-31&#x27;</span>, <span class="string">&#x27;2011-08-31&#x27;</span>,</span><br><span class="line">               <span class="string">&#x27;2011-09-30&#x27;</span>, <span class="string">&#x27;2011-10-31&#x27;</span>,</span><br><span class="line">               ...</span><br><span class="line">               <span class="string">&#x27;2093-07-31&#x27;</span>, <span class="string">&#x27;2093-08-31&#x27;</span>, <span class="string">&#x27;2093-09-30&#x27;</span>, <span class="string">&#x27;2093-10-31&#x27;</span>,</span><br><span class="line">               <span class="string">&#x27;2093-11-30&#x27;</span>, <span class="string">&#x27;2093-12-31&#x27;</span>, <span class="string">&#x27;2094-01-31&#x27;</span>, <span class="string">&#x27;2094-02-28&#x27;</span>,</span><br><span class="line">               <span class="string">&#x27;2094-03-31&#x27;</span>, <span class="string">&#x27;2094-04-30&#x27;</span>],</span><br><span class="line">              dtype=<span class="string">&#x27;datetime64[ns]&#x27;</span>, length=<span class="number">1000</span>, freq=<span class="string">&#x27;M&#x27;</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">81</span>]: pd.bdate_range(start, periods=<span class="number">250</span>, freq=<span class="string">&#x27;BQS&#x27;</span>)</span><br><span class="line">Out[<span class="number">81</span>]: </span><br><span class="line">DatetimeIndex([<span class="string">&#x27;2011-01-03&#x27;</span>, <span class="string">&#x27;2011-04-01&#x27;</span>, <span class="string">&#x27;2011-07-01&#x27;</span>, <span class="string">&#x27;2011-10-03&#x27;</span>,</span><br><span class="line">               <span class="string">&#x27;2012-01-02&#x27;</span>, <span class="string">&#x27;2012-04-02&#x27;</span>, <span class="string">&#x27;2012-07-02&#x27;</span>, <span class="string">&#x27;2012-10-01&#x27;</span>,</span><br><span class="line">               <span class="string">&#x27;2013-01-01&#x27;</span>, <span class="string">&#x27;2013-04-01&#x27;</span>,</span><br><span class="line">               ...</span><br><span class="line">               <span class="string">&#x27;2071-01-01&#x27;</span>, <span class="string">&#x27;2071-04-01&#x27;</span>, <span class="string">&#x27;2071-07-01&#x27;</span>, <span class="string">&#x27;2071-10-01&#x27;</span>,</span><br><span class="line">               <span class="string">&#x27;2072-01-01&#x27;</span>, <span class="string">&#x27;2072-04-01&#x27;</span>, <span class="string">&#x27;2072-07-01&#x27;</span>, <span class="string">&#x27;2072-10-03&#x27;</span>,</span><br><span class="line">               <span class="string">&#x27;2073-01-02&#x27;</span>, <span class="string">&#x27;2073-04-03&#x27;</span>],</span><br><span class="line">              dtype=<span class="string">&#x27;datetime64[ns]&#x27;</span>, length=<span class="number">250</span>, freq=<span class="string">&#x27;BQS-JAN&#x27;</span>)</span><br></pre></td></tr></table></figure><p><code>date_range</code> 与 <code>bdate_range</code> 通过指定 <code>start</code>、<code>end</code>、<code>period</code> 与 <code>freq</code> 等参数，简化了生成日期范围这项工作。开始与结束日期是必填项，因此，不会生成指定范围之外的日期。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">82</span>]: pd.date_range(start, end, freq=<span class="string">&#x27;BM&#x27;</span>)</span><br><span class="line">Out[<span class="number">82</span>]: </span><br><span class="line">DatetimeIndex([<span class="string">&#x27;2011-01-31&#x27;</span>, <span class="string">&#x27;2011-02-28&#x27;</span>, <span class="string">&#x27;2011-03-31&#x27;</span>, <span class="string">&#x27;2011-04-29&#x27;</span>,</span><br><span class="line">               <span class="string">&#x27;2011-05-31&#x27;</span>, <span class="string">&#x27;2011-06-30&#x27;</span>, <span class="string">&#x27;2011-07-29&#x27;</span>, <span class="string">&#x27;2011-08-31&#x27;</span>,</span><br><span class="line">               <span class="string">&#x27;2011-09-30&#x27;</span>, <span class="string">&#x27;2011-10-31&#x27;</span>, <span class="string">&#x27;2011-11-30&#x27;</span>, <span class="string">&#x27;2011-12-30&#x27;</span>],</span><br><span class="line">              dtype=<span class="string">&#x27;datetime64[ns]&#x27;</span>, freq=<span class="string">&#x27;BM&#x27;</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">83</span>]: pd.date_range(start, end, freq=<span class="string">&#x27;W&#x27;</span>)</span><br><span class="line">Out[<span class="number">83</span>]: </span><br><span class="line">DatetimeIndex([<span class="string">&#x27;2011-01-02&#x27;</span>, <span class="string">&#x27;2011-01-09&#x27;</span>, <span class="string">&#x27;2011-01-16&#x27;</span>, <span class="string">&#x27;2011-01-23&#x27;</span>,</span><br><span class="line">               <span class="string">&#x27;2011-01-30&#x27;</span>, <span class="string">&#x27;2011-02-06&#x27;</span>, <span class="string">&#x27;2011-02-13&#x27;</span>, <span class="string">&#x27;2011-02-20&#x27;</span>,</span><br><span class="line">               <span class="string">&#x27;2011-02-27&#x27;</span>, <span class="string">&#x27;2011-03-06&#x27;</span>, <span class="string">&#x27;2011-03-13&#x27;</span>, <span class="string">&#x27;2011-03-20&#x27;</span>,</span><br><span class="line">               <span class="string">&#x27;2011-03-27&#x27;</span>, <span class="string">&#x27;2011-04-03&#x27;</span>, <span class="string">&#x27;2011-04-10&#x27;</span>, <span class="string">&#x27;2011-04-17&#x27;</span>,</span><br><span class="line">               <span class="string">&#x27;2011-04-24&#x27;</span>, <span class="string">&#x27;2011-05-01&#x27;</span>, <span class="string">&#x27;2011-05-08&#x27;</span>, <span class="string">&#x27;2011-05-15&#x27;</span>,</span><br><span class="line">               <span class="string">&#x27;2011-05-22&#x27;</span>, <span class="string">&#x27;2011-05-29&#x27;</span>, <span class="string">&#x27;2011-06-05&#x27;</span>, <span class="string">&#x27;2011-06-12&#x27;</span>,</span><br><span class="line">               <span class="string">&#x27;2011-06-19&#x27;</span>, <span class="string">&#x27;2011-06-26&#x27;</span>, <span class="string">&#x27;2011-07-03&#x27;</span>, <span class="string">&#x27;2011-07-10&#x27;</span>,</span><br><span class="line">               <span class="string">&#x27;2011-07-17&#x27;</span>, <span class="string">&#x27;2011-07-24&#x27;</span>, <span class="string">&#x27;2011-07-31&#x27;</span>, <span class="string">&#x27;2011-08-07&#x27;</span>,</span><br><span class="line">               <span class="string">&#x27;2011-08-14&#x27;</span>, <span class="string">&#x27;2011-08-21&#x27;</span>, <span class="string">&#x27;2011-08-28&#x27;</span>, <span class="string">&#x27;2011-09-04&#x27;</span>,</span><br><span class="line">               <span class="string">&#x27;2011-09-11&#x27;</span>, <span class="string">&#x27;2011-09-18&#x27;</span>, <span class="string">&#x27;2011-09-25&#x27;</span>, <span class="string">&#x27;2011-10-02&#x27;</span>,</span><br><span class="line">               <span class="string">&#x27;2011-10-09&#x27;</span>, <span class="string">&#x27;2011-10-16&#x27;</span>, <span class="string">&#x27;2011-10-23&#x27;</span>, <span class="string">&#x27;2011-10-30&#x27;</span>,</span><br><span class="line">               <span class="string">&#x27;2011-11-06&#x27;</span>, <span class="string">&#x27;2011-11-13&#x27;</span>, <span class="string">&#x27;2011-11-20&#x27;</span>, <span class="string">&#x27;2011-11-27&#x27;</span>,</span><br><span class="line">               <span class="string">&#x27;2011-12-04&#x27;</span>, <span class="string">&#x27;2011-12-11&#x27;</span>, <span class="string">&#x27;2011-12-18&#x27;</span>, <span class="string">&#x27;2011-12-25&#x27;</span>,</span><br><span class="line">               <span class="string">&#x27;2012-01-01&#x27;</span>],</span><br><span class="line">              dtype=<span class="string">&#x27;datetime64[ns]&#x27;</span>, freq=<span class="string">&#x27;W-SUN&#x27;</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">84</span>]: pd.bdate_range(end=end, periods=<span class="number">20</span>)</span><br><span class="line">Out[<span class="number">84</span>]: </span><br><span class="line">DatetimeIndex([<span class="string">&#x27;2011-12-05&#x27;</span>, <span class="string">&#x27;2011-12-06&#x27;</span>, <span class="string">&#x27;2011-12-07&#x27;</span>, <span class="string">&#x27;2011-12-08&#x27;</span>,</span><br><span class="line">               <span class="string">&#x27;2011-12-09&#x27;</span>, <span class="string">&#x27;2011-12-12&#x27;</span>, <span class="string">&#x27;2011-12-13&#x27;</span>, <span class="string">&#x27;2011-12-14&#x27;</span>,</span><br><span class="line">               <span class="string">&#x27;2011-12-15&#x27;</span>, <span class="string">&#x27;2011-12-16&#x27;</span>, <span class="string">&#x27;2011-12-19&#x27;</span>, <span class="string">&#x27;2011-12-20&#x27;</span>,</span><br><span class="line">               <span class="string">&#x27;2011-12-21&#x27;</span>, <span class="string">&#x27;2011-12-22&#x27;</span>, <span class="string">&#x27;2011-12-23&#x27;</span>, <span class="string">&#x27;2011-12-26&#x27;</span>,</span><br><span class="line">               <span class="string">&#x27;2011-12-27&#x27;</span>, <span class="string">&#x27;2011-12-28&#x27;</span>, <span class="string">&#x27;2011-12-29&#x27;</span>, <span class="string">&#x27;2011-12-30&#x27;</span>],</span><br><span class="line">              dtype=<span class="string">&#x27;datetime64[ns]&#x27;</span>, freq=<span class="string">&#x27;B&#x27;</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">85</span>]: pd.bdate_range(start=start, periods=<span class="number">20</span>)</span><br><span class="line">Out[<span class="number">85</span>]: </span><br><span class="line">DatetimeIndex([<span class="string">&#x27;2011-01-03&#x27;</span>, <span class="string">&#x27;2011-01-04&#x27;</span>, <span class="string">&#x27;2011-01-05&#x27;</span>, <span class="string">&#x27;2011-01-06&#x27;</span>,</span><br><span class="line">               <span class="string">&#x27;2011-01-07&#x27;</span>, <span class="string">&#x27;2011-01-10&#x27;</span>, <span class="string">&#x27;2011-01-11&#x27;</span>, <span class="string">&#x27;2011-01-12&#x27;</span>,</span><br><span class="line">               <span class="string">&#x27;2011-01-13&#x27;</span>, <span class="string">&#x27;2011-01-14&#x27;</span>, <span class="string">&#x27;2011-01-17&#x27;</span>, <span class="string">&#x27;2011-01-18&#x27;</span>,</span><br><span class="line">               <span class="string">&#x27;2011-01-19&#x27;</span>, <span class="string">&#x27;2011-01-20&#x27;</span>, <span class="string">&#x27;2011-01-21&#x27;</span>, <span class="string">&#x27;2011-01-24&#x27;</span>,</span><br><span class="line">               <span class="string">&#x27;2011-01-25&#x27;</span>, <span class="string">&#x27;2011-01-26&#x27;</span>, <span class="string">&#x27;2011-01-27&#x27;</span>, <span class="string">&#x27;2011-01-28&#x27;</span>],</span><br><span class="line">              dtype=<span class="string">&#x27;datetime64[ns]&#x27;</span>, freq=<span class="string">&#x27;B&#x27;</span>)</span><br></pre></td></tr></table></figure><p><em>0.23.0 版新增。</em></p><p>指定 <code>start</code>、<code>end</code>、<code>periods</code> 即可生成从 <code>start</code> 开始至 <code>end</code> 结束的等距日期范围，这个日期范围包含了 <code>start</code> 与 <code>end</code>，生成的 <code>DatetimeIndex</code> 里的元素数量为 <code>periods</code> 的值。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">86</span>]: pd.date_range(<span class="string">&#x27;2018-01-01&#x27;</span>, <span class="string">&#x27;2018-01-05&#x27;</span>, periods=<span class="number">5</span>)</span><br><span class="line">Out[<span class="number">86</span>]: </span><br><span class="line">DatetimeIndex([<span class="string">&#x27;2018-01-01&#x27;</span>, <span class="string">&#x27;2018-01-02&#x27;</span>, <span class="string">&#x27;2018-01-03&#x27;</span>, <span class="string">&#x27;2018-01-04&#x27;</span>,</span><br><span class="line">               <span class="string">&#x27;2018-01-05&#x27;</span>],</span><br><span class="line">              dtype=<span class="string">&#x27;datetime64[ns]&#x27;</span>, freq=<span class="literal">None</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">87</span>]: pd.date_range(<span class="string">&#x27;2018-01-01&#x27;</span>, <span class="string">&#x27;2018-01-05&#x27;</span>, periods=<span class="number">10</span>)</span><br><span class="line">Out[<span class="number">87</span>]: </span><br><span class="line">DatetimeIndex([<span class="string">&#x27;2018-01-01 00:00:00&#x27;</span>, <span class="string">&#x27;2018-01-01 10:40:00&#x27;</span>,</span><br><span class="line">               <span class="string">&#x27;2018-01-01 21:20:00&#x27;</span>, <span class="string">&#x27;2018-01-02 08:00:00&#x27;</span>,</span><br><span class="line">               <span class="string">&#x27;2018-01-02 18:40:00&#x27;</span>, <span class="string">&#x27;2018-01-03 05:20:00&#x27;</span>,</span><br><span class="line">               <span class="string">&#x27;2018-01-03 16:00:00&#x27;</span>, <span class="string">&#x27;2018-01-04 02:40:00&#x27;</span>,</span><br><span class="line">               <span class="string">&#x27;2018-01-04 13:20:00&#x27;</span>, <span class="string">&#x27;2018-01-05 00:00:00&#x27;</span>],</span><br><span class="line">              dtype=<span class="string">&#x27;datetime64[ns]&#x27;</span>, freq=<span class="literal">None</span>)</span><br></pre></td></tr></table></figure><h3 id="自定义频率范围"><a href="#自定义频率范围" class="headerlink" title="自定义频率范围"></a>自定义频率范围</h3><p>设定 <code>weekmask</code> 与 <code>holidays</code> 参数，<code>bdate_range</code> 还可以生成自定义频率日期范围。这些参数只用于传递自定义字符串。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">88</span>]: weekmask = <span class="string">&#x27;Mon Wed Fri&#x27;</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">89</span>]: holidays = [datetime.datetime(<span class="number">2011</span>, <span class="number">1</span>, <span class="number">5</span>), datetime.datetime(<span class="number">2011</span>, <span class="number">3</span>, <span class="number">14</span>)]</span><br><span class="line"></span><br><span class="line">In [<span class="number">90</span>]: pd.bdate_range(start, end, freq=<span class="string">&#x27;C&#x27;</span>, weekmask=weekmask, holidays=holidays)</span><br><span class="line">Out[<span class="number">90</span>]: </span><br><span class="line">DatetimeIndex([<span class="string">&#x27;2011-01-03&#x27;</span>, <span class="string">&#x27;2011-01-07&#x27;</span>, <span class="string">&#x27;2011-01-10&#x27;</span>, <span class="string">&#x27;2011-01-12&#x27;</span>,</span><br><span class="line">               <span class="string">&#x27;2011-01-14&#x27;</span>, <span class="string">&#x27;2011-01-17&#x27;</span>, <span class="string">&#x27;2011-01-19&#x27;</span>, <span class="string">&#x27;2011-01-21&#x27;</span>,</span><br><span class="line">               <span class="string">&#x27;2011-01-24&#x27;</span>, <span class="string">&#x27;2011-01-26&#x27;</span>,</span><br><span class="line">               ...</span><br><span class="line">               <span class="string">&#x27;2011-12-09&#x27;</span>, <span class="string">&#x27;2011-12-12&#x27;</span>, <span class="string">&#x27;2011-12-14&#x27;</span>, <span class="string">&#x27;2011-12-16&#x27;</span>,</span><br><span class="line">               <span class="string">&#x27;2011-12-19&#x27;</span>, <span class="string">&#x27;2011-12-21&#x27;</span>, <span class="string">&#x27;2011-12-23&#x27;</span>, <span class="string">&#x27;2011-12-26&#x27;</span>,</span><br><span class="line">               <span class="string">&#x27;2011-12-28&#x27;</span>, <span class="string">&#x27;2011-12-30&#x27;</span>],</span><br><span class="line">              dtype=<span class="string">&#x27;datetime64[ns]&#x27;</span>, length=<span class="number">154</span>, freq=<span class="string">&#x27;C&#x27;</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">91</span>]: pd.bdate_range(start, end, freq=<span class="string">&#x27;CBMS&#x27;</span>, weekmask=weekmask)</span><br><span class="line">Out[<span class="number">91</span>]: </span><br><span class="line">DatetimeIndex([<span class="string">&#x27;2011-01-03&#x27;</span>, <span class="string">&#x27;2011-02-02&#x27;</span>, <span class="string">&#x27;2011-03-02&#x27;</span>, <span class="string">&#x27;2011-04-01&#x27;</span>,</span><br><span class="line">               <span class="string">&#x27;2011-05-02&#x27;</span>, <span class="string">&#x27;2011-06-01&#x27;</span>, <span class="string">&#x27;2011-07-01&#x27;</span>, <span class="string">&#x27;2011-08-01&#x27;</span>,</span><br><span class="line">               <span class="string">&#x27;2011-09-02&#x27;</span>, <span class="string">&#x27;2011-10-03&#x27;</span>, <span class="string">&#x27;2011-11-02&#x27;</span>, <span class="string">&#x27;2011-12-02&#x27;</span>],</span><br><span class="line">              dtype=<span class="string">&#x27;datetime64[ns]&#x27;</span>, freq=<span class="string">&#x27;CBMS&#x27;</span>)</span><br></pre></td></tr></table></figure><p>::: tip 参阅</p><p><a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/user_guide/timeseries.html#timeseries-custombusinessdays">自定义工作日</a></p><p>:::</p><h2 id="时间戳的界限"><a href="#时间戳的界限" class="headerlink" title="时间戳的界限"></a>时间戳的界限</h2><p>Pandas 时间戳的最低单位为纳秒，64 位整数显示的时间跨度约为 584 年，这就是 <code>Timestamp</code> 的界限：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">92</span>]: pd.Timestamp.<span class="built_in">min</span></span><br><span class="line">Out[<span class="number">92</span>]: Timestamp(<span class="string">&#x27;1677-09-21 00:12:43.145225&#x27;</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">93</span>]: pd.Timestamp.<span class="built_in">max</span></span><br><span class="line">Out[<span class="number">93</span>]: Timestamp(<span class="string">&#x27;2262-04-11 23:47:16.854775807&#x27;</span>)</span><br></pre></td></tr></table></figure><p>::: tip 参阅</p><p><a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/user_guide/timeseries.html#timeseries-oob">时间段越界展示</a></p><p>:::</p><h2 id="索引"><a href="#索引" class="headerlink" title="索引"></a>索引</h2><p><code>DatetimeIndex</code> 主要用于 Pandas 对象的索引，为时间序列做了很多优化：</p><ul><li><p>预计算了各种偏移量的日期范围，并在后台缓存，让后台生成后续日期范围的速度非常快（仅需抓取切片）。</p></li><li><p>在 Pandas 对象上用 <code>shift</code> 与 <code>tshift</code> 方法进行快速偏移。</p></li><li><p>合并具有相同频率的重叠 <code>DatetimeIndex</code> 对象的速度非常快（这点对快速数据对齐非常重要）。</p></li><li><p>通过 <code>year</code>、<code>month</code> 等属性快速访问日期字段。</p></li><li><p><code>snap</code> 等正则函数与超快的 <code>asof</code> 逻辑。</p></li></ul><p><code>DatetimeIndex</code> 支持 <code>Index</code> 的所有基本用法，以及一些列简化频率处理的高级时间序列专有方法。</p><p>::: tip 参阅</p><p><a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/getting_started/basics.html#basics-reindexing">重置索引</a></p><p>:::</p><p>::: tip 注意</p><p>Pandas 不强制排序日期索引，但如果日期未排序，可能会引发失控或错误操作。</p><p>:::</p><p><code>DatetimeIndex</code> 可以当作常规索引，支持选择、切片等方法。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">94</span>]: rng = pd.date_range(start, end, freq=<span class="string">&#x27;BM&#x27;</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">95</span>]: ts = pd.Series(np.random.randn(<span class="built_in">len</span>(rng)), index=rng)</span><br><span class="line"></span><br><span class="line">In [<span class="number">96</span>]: ts.index</span><br><span class="line">Out[<span class="number">96</span>]: </span><br><span class="line">DatetimeIndex([<span class="string">&#x27;2011-01-31&#x27;</span>, <span class="string">&#x27;2011-02-28&#x27;</span>, <span class="string">&#x27;2011-03-31&#x27;</span>, <span class="string">&#x27;2011-04-29&#x27;</span>,</span><br><span class="line">               <span class="string">&#x27;2011-05-31&#x27;</span>, <span class="string">&#x27;2011-06-30&#x27;</span>, <span class="string">&#x27;2011-07-29&#x27;</span>, <span class="string">&#x27;2011-08-31&#x27;</span>,</span><br><span class="line">               <span class="string">&#x27;2011-09-30&#x27;</span>, <span class="string">&#x27;2011-10-31&#x27;</span>, <span class="string">&#x27;2011-11-30&#x27;</span>, <span class="string">&#x27;2011-12-30&#x27;</span>],</span><br><span class="line">              dtype=<span class="string">&#x27;datetime64[ns]&#x27;</span>, freq=<span class="string">&#x27;BM&#x27;</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">97</span>]: ts[:<span class="number">5</span>].index</span><br><span class="line">Out[<span class="number">97</span>]: </span><br><span class="line">DatetimeIndex([<span class="string">&#x27;2011-01-31&#x27;</span>, <span class="string">&#x27;2011-02-28&#x27;</span>, <span class="string">&#x27;2011-03-31&#x27;</span>, <span class="string">&#x27;2011-04-29&#x27;</span>,</span><br><span class="line">               <span class="string">&#x27;2011-05-31&#x27;</span>],</span><br><span class="line">              dtype=<span class="string">&#x27;datetime64[ns]&#x27;</span>, freq=<span class="string">&#x27;BM&#x27;</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">98</span>]: ts[::<span class="number">2</span>].index</span><br><span class="line">Out[<span class="number">98</span>]: </span><br><span class="line">DatetimeIndex([<span class="string">&#x27;2011-01-31&#x27;</span>, <span class="string">&#x27;2011-03-31&#x27;</span>, <span class="string">&#x27;2011-05-31&#x27;</span>, <span class="string">&#x27;2011-07-29&#x27;</span>,</span><br><span class="line">               <span class="string">&#x27;2011-09-30&#x27;</span>, <span class="string">&#x27;2011-11-30&#x27;</span>],</span><br><span class="line">              dtype=<span class="string">&#x27;datetime64[ns]&#x27;</span>, freq=<span class="string">&#x27;2BM&#x27;</span>)</span><br></pre></td></tr></table></figure><h3 id="局部字符串索引"><a href="#局部字符串索引" class="headerlink" title="局部字符串索引"></a>局部字符串索引</h3><p>能解析为时间戳的日期与字符串可以作为索引的参数：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">99</span>]: ts[<span class="string">&#x27;1/31/2011&#x27;</span>]</span><br><span class="line">Out[<span class="number">99</span>]: <span class="number">0.11920871129693428</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">100</span>]: ts[datetime.datetime(<span class="number">2011</span>, <span class="number">12</span>, <span class="number">25</span>):]</span><br><span class="line">Out[<span class="number">100</span>]: </span><br><span class="line"><span class="number">2011</span>-<span class="number">12</span>-<span class="number">30</span>    <span class="number">0.56702</span></span><br><span class="line">Freq: BM, dtype: float64</span><br><span class="line"></span><br><span class="line">In [<span class="number">101</span>]: ts[<span class="string">&#x27;10/31/2011&#x27;</span>:<span class="string">&#x27;12/31/2011&#x27;</span>]</span><br><span class="line">Out[<span class="number">101</span>]: </span><br><span class="line"><span class="number">2011</span>-<span class="number">10</span>-<span class="number">31</span>    <span class="number">0.271860</span></span><br><span class="line"><span class="number">2011</span>-<span class="number">11</span>-<span class="number">30</span>   -<span class="number">0.424972</span></span><br><span class="line"><span class="number">2011</span>-<span class="number">12</span>-<span class="number">30</span>    <span class="number">0.567020</span></span><br><span class="line">Freq: BM, dtype: float64</span><br></pre></td></tr></table></figure><p>Pandas 为访问较长的时间序列提供了便捷方法，<strong>年</strong>、<strong>年月</strong>字符串均可：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">102</span>]: ts[<span class="string">&#x27;2011&#x27;</span>]</span><br><span class="line">Out[<span class="number">102</span>]: </span><br><span class="line"><span class="number">2011</span>-01-<span class="number">31</span>    <span class="number">0.119209</span></span><br><span class="line"><span class="number">2011</span>-02-<span class="number">28</span>   -<span class="number">1.044236</span></span><br><span class="line"><span class="number">2011</span>-03-<span class="number">31</span>   -<span class="number">0.861849</span></span><br><span class="line"><span class="number">2011</span>-04-<span class="number">29</span>   -<span class="number">2.104569</span></span><br><span class="line"><span class="number">2011</span>-05-<span class="number">31</span>   -<span class="number">0.494929</span></span><br><span class="line"><span class="number">2011</span>-06-<span class="number">30</span>    <span class="number">1.071804</span></span><br><span class="line"><span class="number">2011</span>-07-<span class="number">29</span>    <span class="number">0.721555</span></span><br><span class="line"><span class="number">2011</span>-08-<span class="number">31</span>   -<span class="number">0.706771</span></span><br><span class="line"><span class="number">2011</span>-09-<span class="number">30</span>   -<span class="number">1.039575</span></span><br><span class="line"><span class="number">2011</span>-<span class="number">10</span>-<span class="number">31</span>    <span class="number">0.271860</span></span><br><span class="line"><span class="number">2011</span>-<span class="number">11</span>-<span class="number">30</span>   -<span class="number">0.424972</span></span><br><span class="line"><span class="number">2011</span>-<span class="number">12</span>-<span class="number">30</span>    <span class="number">0.567020</span></span><br><span class="line">Freq: BM, dtype: float64</span><br><span class="line"></span><br><span class="line">In [<span class="number">103</span>]: ts[<span class="string">&#x27;2011-6&#x27;</span>]</span><br><span class="line">Out[<span class="number">103</span>]: </span><br><span class="line"><span class="number">2011</span>-06-<span class="number">30</span>    <span class="number">1.071804</span></span><br><span class="line">Freq: BM, dtype: float64</span><br></pre></td></tr></table></figure><p>带 <code>DatetimeIndex</code> 的 <code>DateFrame</code> 也支持这种切片方式。局部字符串是标签切片的一种形式，这种切片也<strong>包含</strong>截止时点，即，与日期匹配的时间也会包含在内：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">104</span>]: dft = pd.DataFrame(np.random.randn(<span class="number">100000</span>, <span class="number">1</span>), columns=[<span class="string">&#x27;A&#x27;</span>],</span><br><span class="line">   .....:                    index=pd.date_range(<span class="string">&#x27;20130101&#x27;</span>, periods=<span class="number">100000</span>, freq=<span class="string">&#x27;T&#x27;</span>))</span><br><span class="line">   .....: </span><br><span class="line"></span><br><span class="line">In [<span class="number">105</span>]: dft</span><br><span class="line">Out[<span class="number">105</span>]: </span><br><span class="line">                            A</span><br><span class="line"><span class="number">2013</span>-01-01 <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>  <span class="number">0.276232</span></span><br><span class="line"><span class="number">2013</span>-01-01 <span class="number">00</span>:01:<span class="number">00</span> -<span class="number">1.087401</span></span><br><span class="line"><span class="number">2013</span>-01-01 <span class="number">00</span>:02:<span class="number">00</span> -<span class="number">0.673690</span></span><br><span class="line"><span class="number">2013</span>-01-01 <span class="number">00</span>:03:<span class="number">00</span>  <span class="number">0.113648</span></span><br><span class="line"><span class="number">2013</span>-01-01 <span class="number">00</span>:04:<span class="number">00</span> -<span class="number">1.478427</span></span><br><span class="line"><span class="meta">... </span>                      ...</span><br><span class="line"><span class="number">2013</span>-03-<span class="number">11</span> <span class="number">10</span>:<span class="number">35</span>:<span class="number">00</span> -<span class="number">0.747967</span></span><br><span class="line"><span class="number">2013</span>-03-<span class="number">11</span> <span class="number">10</span>:<span class="number">36</span>:<span class="number">00</span> -<span class="number">0.034523</span></span><br><span class="line"><span class="number">2013</span>-03-<span class="number">11</span> <span class="number">10</span>:<span class="number">37</span>:<span class="number">00</span> -<span class="number">0.201754</span></span><br><span class="line"><span class="number">2013</span>-03-<span class="number">11</span> <span class="number">10</span>:<span class="number">38</span>:<span class="number">00</span> -<span class="number">1.509067</span></span><br><span class="line"><span class="number">2013</span>-03-<span class="number">11</span> <span class="number">10</span>:<span class="number">39</span>:<span class="number">00</span> -<span class="number">1.693043</span></span><br><span class="line"></span><br><span class="line">[<span class="number">100000</span> rows x <span class="number">1</span> columns]</span><br><span class="line"></span><br><span class="line">In [<span class="number">106</span>]: dft[<span class="string">&#x27;2013&#x27;</span>]</span><br><span class="line">Out[<span class="number">106</span>]: </span><br><span class="line">                            A</span><br><span class="line"><span class="number">2013</span>-01-01 <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>  <span class="number">0.276232</span></span><br><span class="line"><span class="number">2013</span>-01-01 <span class="number">00</span>:01:<span class="number">00</span> -<span class="number">1.087401</span></span><br><span class="line"><span class="number">2013</span>-01-01 <span class="number">00</span>:02:<span class="number">00</span> -<span class="number">0.673690</span></span><br><span class="line"><span class="number">2013</span>-01-01 <span class="number">00</span>:03:<span class="number">00</span>  <span class="number">0.113648</span></span><br><span class="line"><span class="number">2013</span>-01-01 <span class="number">00</span>:04:<span class="number">00</span> -<span class="number">1.478427</span></span><br><span class="line"><span class="meta">... </span>                      ...</span><br><span class="line"><span class="number">2013</span>-03-<span class="number">11</span> <span class="number">10</span>:<span class="number">35</span>:<span class="number">00</span> -<span class="number">0.747967</span></span><br><span class="line"><span class="number">2013</span>-03-<span class="number">11</span> <span class="number">10</span>:<span class="number">36</span>:<span class="number">00</span> -<span class="number">0.034523</span></span><br><span class="line"><span class="number">2013</span>-03-<span class="number">11</span> <span class="number">10</span>:<span class="number">37</span>:<span class="number">00</span> -<span class="number">0.201754</span></span><br><span class="line"><span class="number">2013</span>-03-<span class="number">11</span> <span class="number">10</span>:<span class="number">38</span>:<span class="number">00</span> -<span class="number">1.509067</span></span><br><span class="line"><span class="number">2013</span>-03-<span class="number">11</span> <span class="number">10</span>:<span class="number">39</span>:<span class="number">00</span> -<span class="number">1.693043</span></span><br><span class="line"></span><br><span class="line">[<span class="number">100000</span> rows x <span class="number">1</span> columns]</span><br></pre></td></tr></table></figure><p>下列代码截取了自 1 月 1 日凌晨起，至 2 月 28 日午夜的日期与时间。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">107</span>]: dft[<span class="string">&#x27;2013-1&#x27;</span>:<span class="string">&#x27;2013-2&#x27;</span>]</span><br><span class="line">Out[<span class="number">107</span>]: </span><br><span class="line">                            A</span><br><span class="line"><span class="number">2013</span>-01-01 <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>  <span class="number">0.276232</span></span><br><span class="line"><span class="number">2013</span>-01-01 <span class="number">00</span>:01:<span class="number">00</span> -<span class="number">1.087401</span></span><br><span class="line"><span class="number">2013</span>-01-01 <span class="number">00</span>:02:<span class="number">00</span> -<span class="number">0.673690</span></span><br><span class="line"><span class="number">2013</span>-01-01 <span class="number">00</span>:03:<span class="number">00</span>  <span class="number">0.113648</span></span><br><span class="line"><span class="number">2013</span>-01-01 <span class="number">00</span>:04:<span class="number">00</span> -<span class="number">1.478427</span></span><br><span class="line"><span class="meta">... </span>                      ...</span><br><span class="line"><span class="number">2013</span>-02-<span class="number">28</span> <span class="number">23</span>:<span class="number">55</span>:<span class="number">00</span>  <span class="number">0.850929</span></span><br><span class="line"><span class="number">2013</span>-02-<span class="number">28</span> <span class="number">23</span>:<span class="number">56</span>:<span class="number">00</span>  <span class="number">0.976712</span></span><br><span class="line"><span class="number">2013</span>-02-<span class="number">28</span> <span class="number">23</span>:<span class="number">57</span>:<span class="number">00</span> -<span class="number">2.693884</span></span><br><span class="line"><span class="number">2013</span>-02-<span class="number">28</span> <span class="number">23</span>:<span class="number">58</span>:<span class="number">00</span> -<span class="number">1.575535</span></span><br><span class="line"><span class="number">2013</span>-02-<span class="number">28</span> <span class="number">23</span>:<span class="number">59</span>:<span class="number">00</span> -<span class="number">1.573517</span></span><br><span class="line"></span><br><span class="line">[<span class="number">84960</span> rows x <span class="number">1</span> columns]</span><br></pre></td></tr></table></figure><p>下列代码截取了<strong>包含截止日期及其时间在内</strong>的日期与时间。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">108</span>]: dft[<span class="string">&#x27;2013-1&#x27;</span>:<span class="string">&#x27;2013-2-28&#x27;</span>]</span><br><span class="line">Out[<span class="number">108</span>]: </span><br><span class="line">                            A</span><br><span class="line"><span class="number">2013</span>-01-01 <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>  <span class="number">0.276232</span></span><br><span class="line"><span class="number">2013</span>-01-01 <span class="number">00</span>:01:<span class="number">00</span> -<span class="number">1.087401</span></span><br><span class="line"><span class="number">2013</span>-01-01 <span class="number">00</span>:02:<span class="number">00</span> -<span class="number">0.673690</span></span><br><span class="line"><span class="number">2013</span>-01-01 <span class="number">00</span>:03:<span class="number">00</span>  <span class="number">0.113648</span></span><br><span class="line"><span class="number">2013</span>-01-01 <span class="number">00</span>:04:<span class="number">00</span> -<span class="number">1.478427</span></span><br><span class="line"><span class="meta">... </span>                      ...</span><br><span class="line"><span class="number">2013</span>-02-<span class="number">28</span> <span class="number">23</span>:<span class="number">55</span>:<span class="number">00</span>  <span class="number">0.850929</span></span><br><span class="line"><span class="number">2013</span>-02-<span class="number">28</span> <span class="number">23</span>:<span class="number">56</span>:<span class="number">00</span>  <span class="number">0.976712</span></span><br><span class="line"><span class="number">2013</span>-02-<span class="number">28</span> <span class="number">23</span>:<span class="number">57</span>:<span class="number">00</span> -<span class="number">2.693884</span></span><br><span class="line"><span class="number">2013</span>-02-<span class="number">28</span> <span class="number">23</span>:<span class="number">58</span>:<span class="number">00</span> -<span class="number">1.575535</span></span><br><span class="line"><span class="number">2013</span>-02-<span class="number">28</span> <span class="number">23</span>:<span class="number">59</span>:<span class="number">00</span> -<span class="number">1.573517</span></span><br><span class="line"></span><br><span class="line">[<span class="number">84960</span> rows x <span class="number">1</span> columns]</span><br></pre></td></tr></table></figure><p>下列代码指定了精准的截止时间，注意此处的结果与上述截取结果的区别：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">109</span>]: dft[<span class="string">&#x27;2013-1&#x27;</span>:<span class="string">&#x27;2013-2-28 00:00:00&#x27;</span>]</span><br><span class="line">Out[<span class="number">109</span>]: </span><br><span class="line">                            A</span><br><span class="line"><span class="number">2013</span>-01-01 <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>  <span class="number">0.276232</span></span><br><span class="line"><span class="number">2013</span>-01-01 <span class="number">00</span>:01:<span class="number">00</span> -<span class="number">1.087401</span></span><br><span class="line"><span class="number">2013</span>-01-01 <span class="number">00</span>:02:<span class="number">00</span> -<span class="number">0.673690</span></span><br><span class="line"><span class="number">2013</span>-01-01 <span class="number">00</span>:03:<span class="number">00</span>  <span class="number">0.113648</span></span><br><span class="line"><span class="number">2013</span>-01-01 <span class="number">00</span>:04:<span class="number">00</span> -<span class="number">1.478427</span></span><br><span class="line"><span class="meta">... </span>                      ...</span><br><span class="line"><span class="number">2013</span>-02-<span class="number">27</span> <span class="number">23</span>:<span class="number">56</span>:<span class="number">00</span>  <span class="number">1.197749</span></span><br><span class="line"><span class="number">2013</span>-02-<span class="number">27</span> <span class="number">23</span>:<span class="number">57</span>:<span class="number">00</span>  <span class="number">0.720521</span></span><br><span class="line"><span class="number">2013</span>-02-<span class="number">27</span> <span class="number">23</span>:<span class="number">58</span>:<span class="number">00</span> -<span class="number">0.072718</span></span><br><span class="line"><span class="number">2013</span>-02-<span class="number">27</span> <span class="number">23</span>:<span class="number">59</span>:<span class="number">00</span> -<span class="number">0.681192</span></span><br><span class="line"><span class="number">2013</span>-02-<span class="number">28</span> <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> -<span class="number">0.557501</span></span><br><span class="line"></span><br><span class="line">[<span class="number">83521</span> rows x <span class="number">1</span> columns]</span><br></pre></td></tr></table></figure><p>截止时间是索引的一部分，包含在截取的内容之内：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">110</span>]: dft[<span class="string">&#x27;2013-1-15&#x27;</span>:<span class="string">&#x27;2013-1-15 12:30:00&#x27;</span>]</span><br><span class="line">Out[<span class="number">110</span>]: </span><br><span class="line">                            A</span><br><span class="line"><span class="number">2013</span>-01-<span class="number">15</span> <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> -<span class="number">0.984810</span></span><br><span class="line"><span class="number">2013</span>-01-<span class="number">15</span> <span class="number">00</span>:01:<span class="number">00</span>  <span class="number">0.941451</span></span><br><span class="line"><span class="number">2013</span>-01-<span class="number">15</span> <span class="number">00</span>:02:<span class="number">00</span>  <span class="number">1.559365</span></span><br><span class="line"><span class="number">2013</span>-01-<span class="number">15</span> <span class="number">00</span>:03:<span class="number">00</span>  <span class="number">1.034374</span></span><br><span class="line"><span class="number">2013</span>-01-<span class="number">15</span> <span class="number">00</span>:04:<span class="number">00</span> -<span class="number">1.480656</span></span><br><span class="line"><span class="meta">... </span>                      ...</span><br><span class="line"><span class="number">2013</span>-01-<span class="number">15</span> <span class="number">12</span>:<span class="number">26</span>:<span class="number">00</span>  <span class="number">0.371454</span></span><br><span class="line"><span class="number">2013</span>-01-<span class="number">15</span> <span class="number">12</span>:<span class="number">27</span>:<span class="number">00</span> -<span class="number">0.930806</span></span><br><span class="line"><span class="number">2013</span>-01-<span class="number">15</span> <span class="number">12</span>:<span class="number">28</span>:<span class="number">00</span> -<span class="number">0.069177</span></span><br><span class="line"><span class="number">2013</span>-01-<span class="number">15</span> <span class="number">12</span>:<span class="number">29</span>:<span class="number">00</span>  <span class="number">0.066510</span></span><br><span class="line"><span class="number">2013</span>-01-<span class="number">15</span> <span class="number">12</span>:<span class="number">30</span>:<span class="number">00</span> -<span class="number">0.003945</span></span><br><span class="line"></span><br><span class="line">[<span class="number">751</span> rows x <span class="number">1</span> columns]</span><br></pre></td></tr></table></figure><p><em>0.18.0 版新增</em>。</p><p><code>DatetimeIndex</code> 局部字符串索引还支持多层索引 <code>DataFrame</code>。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">111</span>]: dft2 = pd.DataFrame(np.random.randn(<span class="number">20</span>, <span class="number">1</span>),</span><br><span class="line">   .....:                     columns=[<span class="string">&#x27;A&#x27;</span>],</span><br><span class="line">   .....:                     index=pd.MultiIndex.from_product(</span><br><span class="line">   .....:                         [pd.date_range(<span class="string">&#x27;20130101&#x27;</span>, periods=<span class="number">10</span>, freq=<span class="string">&#x27;12H&#x27;</span>),</span><br><span class="line">   .....:                          [<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>]]))</span><br><span class="line">   .....: </span><br><span class="line"></span><br><span class="line">In [<span class="number">112</span>]: dft2</span><br><span class="line">Out[<span class="number">112</span>]: </span><br><span class="line">                              A</span><br><span class="line"><span class="number">2013</span>-01-01 <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> a -<span class="number">0.298694</span></span><br><span class="line">                    b  <span class="number">0.823553</span></span><br><span class="line"><span class="number">2013</span>-01-01 <span class="number">12</span>:<span class="number">00</span>:<span class="number">00</span> a  <span class="number">0.943285</span></span><br><span class="line">                    b -<span class="number">1.479399</span></span><br><span class="line"><span class="number">2013</span>-01-02 <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> a -<span class="number">1.643342</span></span><br><span class="line"><span class="meta">... </span>                        ...</span><br><span class="line"><span class="number">2013</span>-01-04 <span class="number">12</span>:<span class="number">00</span>:<span class="number">00</span> b  <span class="number">0.069036</span></span><br><span class="line"><span class="number">2013</span>-01-05 <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> a  <span class="number">0.122297</span></span><br><span class="line">                    b  <span class="number">1.422060</span></span><br><span class="line"><span class="number">2013</span>-01-05 <span class="number">12</span>:<span class="number">00</span>:<span class="number">00</span> a  <span class="number">0.370079</span></span><br><span class="line">                    b  <span class="number">1.016331</span></span><br><span class="line"></span><br><span class="line">[<span class="number">20</span> rows x <span class="number">1</span> columns]</span><br><span class="line"></span><br><span class="line">In [<span class="number">113</span>]: dft2.loc[<span class="string">&#x27;2013-01-05&#x27;</span>]</span><br><span class="line">Out[<span class="number">113</span>]: </span><br><span class="line">                              A</span><br><span class="line"><span class="number">2013</span>-01-05 <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> a  <span class="number">0.122297</span></span><br><span class="line">                    b  <span class="number">1.422060</span></span><br><span class="line"><span class="number">2013</span>-01-05 <span class="number">12</span>:<span class="number">00</span>:<span class="number">00</span> a  <span class="number">0.370079</span></span><br><span class="line">                    b  <span class="number">1.016331</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">114</span>]: idx = pd.IndexSlice</span><br><span class="line"></span><br><span class="line">In [<span class="number">115</span>]: dft2 = dft2.swaplevel(<span class="number">0</span>, <span class="number">1</span>).sort_index()</span><br><span class="line"></span><br><span class="line">In [<span class="number">116</span>]: dft2.loc[idx[:, <span class="string">&#x27;2013-01-05&#x27;</span>], :]</span><br><span class="line">Out[<span class="number">116</span>]: </span><br><span class="line">                              A</span><br><span class="line">a <span class="number">2013</span>-01-05 <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>  <span class="number">0.122297</span></span><br><span class="line">  <span class="number">2013</span>-01-05 <span class="number">12</span>:<span class="number">00</span>:<span class="number">00</span>  <span class="number">0.370079</span></span><br><span class="line">b <span class="number">2013</span>-01-05 <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>  <span class="number">1.422060</span></span><br><span class="line">  <span class="number">2013</span>-01-05 <span class="number">12</span>:<span class="number">00</span>:<span class="number">00</span>  <span class="number">1.016331</span></span><br></pre></td></tr></table></figure><p><em>0.25.0 版新增</em>。</p><p>字符串索引切片支持 UTC 偏移。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">117</span>]: df = pd.DataFrame([<span class="number">0</span>], index=pd.DatetimeIndex([<span class="string">&#x27;2019-01-01&#x27;</span>], tz=<span class="string">&#x27;US/Pacific&#x27;</span>))</span><br><span class="line"></span><br><span class="line">In [<span class="number">118</span>]: df</span><br><span class="line">Out[<span class="number">118</span>]: </span><br><span class="line">                           <span class="number">0</span></span><br><span class="line"><span class="number">2019</span>-01-01 <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>-08:<span class="number">00</span>  <span class="number">0</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">119</span>]: df[<span class="string">&#x27;2019-01-01 12:00:00+04:00&#x27;</span>:<span class="string">&#x27;2019-01-01 13:00:00+04:00&#x27;</span>]</span><br><span class="line">Out[<span class="number">119</span>]: </span><br><span class="line">                           <span class="number">0</span></span><br><span class="line"><span class="number">2019</span>-01-01 <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>-08:<span class="number">00</span>  <span class="number">0</span></span><br></pre></td></tr></table></figure><h3 id="切片-vs-精准匹配"><a href="#切片-vs-精准匹配" class="headerlink" title="切片 vs. 精准匹配"></a>切片 vs. 精准匹配</h3><p><em>0.20.0 版新增。</em></p><p>基于索引的精度，字符串既可用于切片，也可用于精准匹配。字符串精度比索引精度低，就是切片，比索引精度高，则是精准匹配。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">120</span>]: series_minute = pd.Series([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>],</span><br><span class="line">   .....:                           pd.DatetimeIndex([<span class="string">&#x27;2011-12-31 23:59:00&#x27;</span>,</span><br><span class="line">   .....:                                             <span class="string">&#x27;2012-01-01 00:00:00&#x27;</span>,</span><br><span class="line">   .....:                                             <span class="string">&#x27;2012-01-01 00:02:00&#x27;</span>]))</span><br><span class="line">   .....: </span><br><span class="line"></span><br><span class="line">In [<span class="number">121</span>]: series_minute.index.resolution</span><br><span class="line">Out[<span class="number">121</span>]: <span class="string">&#x27;minute&#x27;</span></span><br></pre></td></tr></table></figure><p>下例中的时间戳字符串没有 <code>Series</code> 对象的精度高。<code>series_minute</code> 到<code>秒</code>，时间戳字符串只到<code>分</code>。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">122</span>]: series_minute[<span class="string">&#x27;2011-12-31 23&#x27;</span>]</span><br><span class="line">Out[<span class="number">122</span>]: </span><br><span class="line"><span class="number">2011</span>-<span class="number">12</span>-<span class="number">31</span> <span class="number">23</span>:<span class="number">59</span>:<span class="number">00</span>    <span class="number">1</span></span><br><span class="line">dtype: int64</span><br></pre></td></tr></table></figure><p>精度为分钟（或更高精度）的时间戳字符串，给出的是标量，不会被当作切片。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">123</span>]: series_minute[<span class="string">&#x27;2011-12-31 23:59&#x27;</span>]</span><br><span class="line">Out[<span class="number">123</span>]: <span class="number">1</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">124</span>]: series_minute[<span class="string">&#x27;2011-12-31 23:59:00&#x27;</span>]</span><br><span class="line">Out[<span class="number">124</span>]: <span class="number">1</span></span><br></pre></td></tr></table></figure><p>索引的精度为秒时，精度为分钟的时间戳返回的是 <code>Series</code>。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">125</span>]: series_second = pd.Series([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>],</span><br><span class="line">   .....:                           pd.DatetimeIndex([<span class="string">&#x27;2011-12-31 23:59:59&#x27;</span>,</span><br><span class="line">   .....:                                             <span class="string">&#x27;2012-01-01 00:00:00&#x27;</span>,</span><br><span class="line">   .....:                                             <span class="string">&#x27;2012-01-01 00:00:01&#x27;</span>]))</span><br><span class="line">   .....: </span><br><span class="line"></span><br><span class="line">In [<span class="number">126</span>]: series_second.index.resolution</span><br><span class="line">Out[<span class="number">126</span>]: <span class="string">&#x27;second&#x27;</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">127</span>]: series_second[<span class="string">&#x27;2011-12-31 23:59&#x27;</span>]</span><br><span class="line">Out[<span class="number">127</span>]: </span><br><span class="line"><span class="number">2011</span>-<span class="number">12</span>-<span class="number">31</span> <span class="number">23</span>:<span class="number">59</span>:<span class="number">59</span>    <span class="number">1</span></span><br><span class="line">dtype: int64</span><br></pre></td></tr></table></figure><p>用时间戳字符串切片时，还可以用 <code>[]</code> 索引 <code>DataFrame</code>。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">128</span>]: dft_minute = pd.DataFrame(&#123;<span class="string">&#x27;a&#x27;</span>: [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>], <span class="string">&#x27;b&#x27;</span>: [<span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>]&#125;,</span><br><span class="line">   .....:                           index=series_minute.index)</span><br><span class="line">   .....: </span><br><span class="line"></span><br><span class="line">In [<span class="number">129</span>]: dft_minute[<span class="string">&#x27;2011-12-31 23&#x27;</span>]</span><br><span class="line">Out[<span class="number">129</span>]: </span><br><span class="line">                     a  b</span><br><span class="line"><span class="number">2011</span>-<span class="number">12</span>-<span class="number">31</span> <span class="number">23</span>:<span class="number">59</span>:<span class="number">00</span>  <span class="number">1</span>  <span class="number">4</span></span><br></pre></td></tr></table></figure><p>::: danger 警告</p><p>字符串执行精确匹配时，用 <code>[]</code> 按列，而不是按行截取 <code>DateFrame</code> ，参阅<a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#indexing-basics">索引基础</a>。如，<code>dft_minute [&#39;2011-12-31 23:59&#39;]</code> 会触发 <code>KeyError</code>，这是因为 <code>2012-12-31 23:59</code>与索引的精度一样，但没有叫这个名字的列。</p><p>为了实现精准切片，要用 <code>.loc</code> 对行进行切片或选择。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">130</span>]: dft_minute.loc[<span class="string">&#x27;2011-12-31 23:59&#x27;</span>]</span><br><span class="line">Out[<span class="number">130</span>]: </span><br><span class="line">a    <span class="number">1</span></span><br><span class="line">b    <span class="number">4</span></span><br><span class="line">Name: <span class="number">2011</span>-<span class="number">12</span>-<span class="number">31</span> <span class="number">23</span>:<span class="number">59</span>:<span class="number">00</span>, dtype: int64</span><br></pre></td></tr></table></figure><p>:::</p><p>注意：<code>DatetimeIndex</code> 精度不能低于日。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">131</span>]: series_monthly = pd.Series([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>],</span><br><span class="line">   .....:                            pd.DatetimeIndex([<span class="string">&#x27;2011-12&#x27;</span>, <span class="string">&#x27;2012-01&#x27;</span>, <span class="string">&#x27;2012-02&#x27;</span>]))</span><br><span class="line">   .....: </span><br><span class="line"></span><br><span class="line">In [<span class="number">132</span>]: series_monthly.index.resolution</span><br><span class="line">Out[<span class="number">132</span>]: <span class="string">&#x27;day&#x27;</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">133</span>]: series_monthly[<span class="string">&#x27;2011-12&#x27;</span>]  <span class="comment"># 返回的是 Series</span></span><br><span class="line">Out[<span class="number">133</span>]: </span><br><span class="line"><span class="number">2011</span>-<span class="number">12</span>-01    <span class="number">1</span></span><br><span class="line">dtype: int64</span><br></pre></td></tr></table></figure><h3 id="精确索引"><a href="#精确索引" class="headerlink" title="精确索引"></a>精确索引</h3><p>正如上节所述，局部字符串依靠时间段的<strong>精度</strong>索引 <code>DatetimeIndex</code>，即时间间隔与索引精度相关。反之，用 <code>Timestamp</code> 或 <code>datetime</code> 索引更精准，这些对象指定的时间更精确。注意，精确索引包含了起始时点。</p><p>就算没有显式指定，<code>Timestamp</code> 与<code>datetime</code> 也支持 <code>hours</code>、<code>minutes</code>、<code>seconds</code>，默认值为 0。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">134</span>]: dft[datetime.datetime(<span class="number">2013</span>, <span class="number">1</span>, <span class="number">1</span>):datetime.datetime(<span class="number">2013</span>, <span class="number">2</span>, <span class="number">28</span>)]</span><br><span class="line">Out[<span class="number">134</span>]: </span><br><span class="line">                            A</span><br><span class="line"><span class="number">2013</span>-01-01 <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>  <span class="number">0.276232</span></span><br><span class="line"><span class="number">2013</span>-01-01 <span class="number">00</span>:01:<span class="number">00</span> -<span class="number">1.087401</span></span><br><span class="line"><span class="number">2013</span>-01-01 <span class="number">00</span>:02:<span class="number">00</span> -<span class="number">0.673690</span></span><br><span class="line"><span class="number">2013</span>-01-01 <span class="number">00</span>:03:<span class="number">00</span>  <span class="number">0.113648</span></span><br><span class="line"><span class="number">2013</span>-01-01 <span class="number">00</span>:04:<span class="number">00</span> -<span class="number">1.478427</span></span><br><span class="line"><span class="meta">... </span>                      ...</span><br><span class="line"><span class="number">2013</span>-02-<span class="number">27</span> <span class="number">23</span>:<span class="number">56</span>:<span class="number">00</span>  <span class="number">1.197749</span></span><br><span class="line"><span class="number">2013</span>-02-<span class="number">27</span> <span class="number">23</span>:<span class="number">57</span>:<span class="number">00</span>  <span class="number">0.720521</span></span><br><span class="line"><span class="number">2013</span>-02-<span class="number">27</span> <span class="number">23</span>:<span class="number">58</span>:<span class="number">00</span> -<span class="number">0.072718</span></span><br><span class="line"><span class="number">2013</span>-02-<span class="number">27</span> <span class="number">23</span>:<span class="number">59</span>:<span class="number">00</span> -<span class="number">0.681192</span></span><br><span class="line"><span class="number">2013</span>-02-<span class="number">28</span> <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> -<span class="number">0.557501</span></span><br><span class="line"></span><br><span class="line">[<span class="number">83521</span> rows x <span class="number">1</span> columns]</span><br></pre></td></tr></table></figure><p>不用默认值。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">135</span>]: dft[datetime.datetime(<span class="number">2013</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">10</span>, <span class="number">12</span>, <span class="number">0</span>):</span><br><span class="line">   .....:     datetime.datetime(<span class="number">2013</span>, <span class="number">2</span>, <span class="number">28</span>, <span class="number">10</span>, <span class="number">12</span>, <span class="number">0</span>)]</span><br><span class="line">   .....: </span><br><span class="line">Out[<span class="number">135</span>]: </span><br><span class="line">                            A</span><br><span class="line"><span class="number">2013</span>-01-01 <span class="number">10</span>:<span class="number">12</span>:<span class="number">00</span>  <span class="number">0.565375</span></span><br><span class="line"><span class="number">2013</span>-01-01 <span class="number">10</span>:<span class="number">13</span>:<span class="number">00</span>  <span class="number">0.068184</span></span><br><span class="line"><span class="number">2013</span>-01-01 <span class="number">10</span>:<span class="number">14</span>:<span class="number">00</span>  <span class="number">0.788871</span></span><br><span class="line"><span class="number">2013</span>-01-01 <span class="number">10</span>:<span class="number">15</span>:<span class="number">00</span> -<span class="number">0.280343</span></span><br><span class="line"><span class="number">2013</span>-01-01 <span class="number">10</span>:<span class="number">16</span>:<span class="number">00</span>  <span class="number">0.931536</span></span><br><span class="line"><span class="meta">... </span>                      ...</span><br><span class="line"><span class="number">2013</span>-02-<span class="number">28</span> <span class="number">10</span>:08:<span class="number">00</span>  <span class="number">0.148098</span></span><br><span class="line"><span class="number">2013</span>-02-<span class="number">28</span> <span class="number">10</span>:09:<span class="number">00</span> -<span class="number">0.388138</span></span><br><span class="line"><span class="number">2013</span>-02-<span class="number">28</span> <span class="number">10</span>:<span class="number">10</span>:<span class="number">00</span>  <span class="number">0.139348</span></span><br><span class="line"><span class="number">2013</span>-02-<span class="number">28</span> <span class="number">10</span>:<span class="number">11</span>:<span class="number">00</span>  <span class="number">0.085288</span></span><br><span class="line"><span class="number">2013</span>-02-<span class="number">28</span> <span class="number">10</span>:<span class="number">12</span>:<span class="number">00</span>  <span class="number">0.950146</span></span><br><span class="line"></span><br><span class="line">[<span class="number">83521</span> rows x <span class="number">1</span> columns]</span><br></pre></td></tr></table></figure><h3 id="截断与花式索引"><a href="#截断与花式索引" class="headerlink" title="截断与花式索引"></a>截断与花式索引</h3><p><a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.truncate.html#pandas.DataFrame.truncate" title="pandas.DataFrame.truncate"><code>truncate()</code></a> 便捷函数与切片类似。注意，与切片返回的是部分匹配日期不同， <code>truncate</code> 假设 <code>DatetimeIndex</code> 里未标明时间组件的值为 0。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">136</span>]: rng2 = pd.date_range(<span class="string">&#x27;2011-01-01&#x27;</span>, <span class="string">&#x27;2012-01-01&#x27;</span>, freq=<span class="string">&#x27;W&#x27;</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">137</span>]: ts2 = pd.Series(np.random.randn(<span class="built_in">len</span>(rng2)), index=rng2)</span><br><span class="line"></span><br><span class="line">In [<span class="number">138</span>]: ts2.truncate(before=<span class="string">&#x27;2011-11&#x27;</span>, after=<span class="string">&#x27;2011-12&#x27;</span>)</span><br><span class="line">Out[<span class="number">138</span>]: </span><br><span class="line"><span class="number">2011</span>-<span class="number">11</span>-06    <span class="number">0.437823</span></span><br><span class="line"><span class="number">2011</span>-<span class="number">11</span>-<span class="number">13</span>   -<span class="number">0.293083</span></span><br><span class="line"><span class="number">2011</span>-<span class="number">11</span>-<span class="number">20</span>   -<span class="number">0.059881</span></span><br><span class="line"><span class="number">2011</span>-<span class="number">11</span>-<span class="number">27</span>    <span class="number">1.252450</span></span><br><span class="line">Freq: W-SUN, dtype: float64</span><br><span class="line"></span><br><span class="line">In [<span class="number">139</span>]: ts2[<span class="string">&#x27;2011-11&#x27;</span>:<span class="string">&#x27;2011-12&#x27;</span>]</span><br><span class="line">Out[<span class="number">139</span>]: </span><br><span class="line"><span class="number">2011</span>-<span class="number">11</span>-06    <span class="number">0.437823</span></span><br><span class="line"><span class="number">2011</span>-<span class="number">11</span>-<span class="number">13</span>   -<span class="number">0.293083</span></span><br><span class="line"><span class="number">2011</span>-<span class="number">11</span>-<span class="number">20</span>   -<span class="number">0.059881</span></span><br><span class="line"><span class="number">2011</span>-<span class="number">11</span>-<span class="number">27</span>    <span class="number">1.252450</span></span><br><span class="line"><span class="number">2011</span>-<span class="number">12</span>-04    <span class="number">0.046611</span></span><br><span class="line"><span class="number">2011</span>-<span class="number">12</span>-<span class="number">11</span>    <span class="number">0.059478</span></span><br><span class="line"><span class="number">2011</span>-<span class="number">12</span>-<span class="number">18</span>   -<span class="number">0.286539</span></span><br><span class="line"><span class="number">2011</span>-<span class="number">12</span>-<span class="number">25</span>    <span class="number">0.841669</span></span><br><span class="line">Freq: W-SUN, dtype: float64</span><br></pre></td></tr></table></figure><p>花式索引返回 <code>DatetimeIndex</code>， 但因为打乱了 <code>DatetimeIndex</code> 频率，丢弃了频率信息，见 <code>freq=None</code>：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">140</span>]: ts2[[<span class="number">0</span>, <span class="number">2</span>, <span class="number">6</span>]].index</span><br><span class="line">Out[<span class="number">140</span>]: DatetimeIndex([<span class="string">&#x27;2011-01-02&#x27;</span>, <span class="string">&#x27;2011-01-16&#x27;</span>, <span class="string">&#x27;2011-02-13&#x27;</span>], dtype=<span class="string">&#x27;datetime64[ns]&#x27;</span>, freq=<span class="literal">None</span>)</span><br></pre></td></tr></table></figure><h2 id="日期-时间组件"><a href="#日期-时间组件" class="headerlink" title="日期/时间组件"></a>日期/时间组件</h2><p>以下日期/时间属性可以访问 <code>Timestamp</code> 或 <code>DatetimeIndex</code>。</p><table><thead><tr><th align="center">属性</th><th align="center">说明</th></tr></thead><tbody><tr><td align="center">year</td><td align="center">datetime 的年</td></tr><tr><td align="center">month</td><td align="center">datetime 的月</td></tr><tr><td align="center">day</td><td align="center">datetime 的日</td></tr><tr><td align="center">hour</td><td align="center">datetime 的小时</td></tr><tr><td align="center">minute</td><td align="center">datetime 的分钟</td></tr><tr><td align="center">second</td><td align="center">datetime 的秒</td></tr><tr><td align="center">microsecond</td><td align="center">datetime 的微秒</td></tr><tr><td align="center">nanosecond</td><td align="center">datetime 的纳秒</td></tr><tr><td align="center">date</td><td align="center">返回 datetime.date（不包含时区信息）</td></tr><tr><td align="center">time</td><td align="center">返回 datetime.time（不包含时区信息）</td></tr><tr><td align="center">timetz</td><td align="center">返回带本地时区信息的 datetime.time</td></tr><tr><td align="center">dayofyear</td><td align="center">一年里的第几天</td></tr><tr><td align="center">weekofyear</td><td align="center">一年里的第几周</td></tr><tr><td align="center">week</td><td align="center">一年里的第几周</td></tr><tr><td align="center">dayofweek</td><td align="center">一周里的第几天，Monday=0, Sunday=6</td></tr><tr><td align="center">weekday</td><td align="center">一周里的第几天，Monday=0, Sunday=6</td></tr><tr><td align="center">weekday_name</td><td align="center">这一天是星期几 （如，Friday）</td></tr><tr><td align="center">quarter</td><td align="center">日期所处的季节：Jan-Mar = 1，Apr-Jun = 2 等</td></tr><tr><td align="center">days_in_month</td><td align="center">日期所在的月有多少天</td></tr><tr><td align="center">is_month_start</td><td align="center">逻辑判断是不是月初（由频率定义）</td></tr><tr><td align="center">is_month_end</td><td align="center">逻辑判断是不是月末（由频率定义）</td></tr><tr><td align="center">is_quarter_start</td><td align="center">逻辑判断是不是季初（由频率定义）</td></tr><tr><td align="center">is_quarter_end</td><td align="center">逻辑判断是不是季末（由频率定义）</td></tr><tr><td align="center">is_year_start</td><td align="center">逻辑判断是不是年初（由频率定义）</td></tr><tr><td align="center">is_year_end</td><td align="center">逻辑判断是不是年末（由频率定义）</td></tr><tr><td align="center">is_leap_year</td><td align="center">逻辑判断是不是日期所在年是不是闰年</td></tr></tbody></table><p>参照 <a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/getting_started/basics.html#basics-dt-accessors">.dt 访问器</a> 一节介绍的知识点，<code>Series</code> 的值为 <code>datetime</code> 时，还可以用 <code>.dt</code> 访问这些属性。</p><h2 id="DateOffset-对象"><a href="#DateOffset-对象" class="headerlink" title="DateOffset 对象"></a>DateOffset 对象</h2><p>上例中，频率字符串（如，<code>D</code>）用于定义指定的频率：</p><ul><li><p>用 <a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.date_range.html#pandas.date_range" title="pandas.date_range"><code>date_range()</code></a> 按指定频率分隔 <a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DatetimeIndex.html#pandas.DatetimeIndex" title="pandas.DatetimeIndex"><code>DatetimeIndex</code></a> 里的日期与时间</p></li><li><p><a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.Period.html#pandas.Period" title="pandas.Period"><code>Period</code></a> 或 <a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.PeriodIndex.html#pandas.PeriodIndex" title="pandas.PeriodIndex"><code>PeriodIndex</code></a> 的频率</p></li></ul><p>频率字符串表示的是 <code>DateOffset</code> 对象及其子类。<code>DateOffset</code> 类似于时间差 <a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.Timedelta.html#pandas.Timedelta" title="pandas.Timedelta"><code>Timedelta</code></a> ，但遵循指定的日历日规则。例如，<a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.Timedelta.html#pandas.Timedelta" title="pandas.Timedelta"><code>Timedelta</code></a> 表示的每日时间差一直都是 24 小时，而 <code>DateOffset</code> 的每日偏移量则是与下一天相同的时间差，使用夏时制时，每日偏移时间有可能是 23 或 24 小时，甚至还有可能是 25 小时。不过，<code>DateOffset</code> 子类只能是等于或小于<strong>小时</strong>的时间单位（<code>Hour</code>、<code>Minute</code>、<code>Second</code>、<code>Milli</code>、<code>Micro</code>、<code>Nano</code>），操作类似于 <a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.Timedelta.html#pandas.Timedelta" title="pandas.Timedelta"><code>Timedelta</code></a> 及对应的绝对时间。</p><p><code>DateOffset</code> 基础操作类似于 <code>dateutil.relativedelta</code>（<a target="_blank" rel="noopener" href="https://dateutil.readthedocs.io/en/stable/relativedelta.html">relativedelta 文档</a>），可按指定的日历日时间段偏移日期时间。可用算数运算符（+）或 <code>apply</code> 方法执行日期偏移操作。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 指定包含夏时制变迁的某天</span></span><br><span class="line">In [<span class="number">141</span>]: ts = pd.Timestamp(<span class="string">&#x27;2016-10-30 00:00:00&#x27;</span>, tz=<span class="string">&#x27;Europe/Helsinki&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 对应的绝对时间</span></span><br><span class="line">In [<span class="number">142</span>]: ts + pd.Timedelta(days=<span class="number">1</span>)</span><br><span class="line">Out[<span class="number">142</span>]: Timestamp(<span class="string">&#x27;2016-10-30 23:00:00+0200&#x27;</span>, tz=<span class="string">&#x27;Europe/Helsinki&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 对应的日历时间</span></span><br><span class="line">In [<span class="number">143</span>]: ts + pd.DateOffset(days=<span class="number">1</span>)</span><br><span class="line">Out[<span class="number">143</span>]: Timestamp(<span class="string">&#x27;2016-10-31 00:00:00+0200&#x27;</span>, tz=<span class="string">&#x27;Europe/Helsinki&#x27;</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">144</span>]: friday = pd.Timestamp(<span class="string">&#x27;2018-01-05&#x27;</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">145</span>]: friday.day_name()</span><br><span class="line">Out[<span class="number">145</span>]: <span class="string">&#x27;Friday&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 与两个工作日相加（星期五 --&gt; 星期二）</span></span><br><span class="line">In [<span class="number">146</span>]: two_business_days = <span class="number">2</span> * pd.offsets.BDay()</span><br><span class="line"></span><br><span class="line">In [<span class="number">147</span>]: two_business_days.apply(friday)</span><br><span class="line">Out[<span class="number">147</span>]: Timestamp(<span class="string">&#x27;2018-01-09 00:00:00&#x27;</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">148</span>]: friday + two_business_days</span><br><span class="line">Out[<span class="number">148</span>]: Timestamp(<span class="string">&#x27;2018-01-09 00:00:00&#x27;</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">149</span>]: (friday + two_business_days).day_name()</span><br><span class="line">Out[<span class="number">149</span>]: <span class="string">&#x27;Tuesday&#x27;</span></span><br></pre></td></tr></table></figure><p>大多数 <code>DateOffset</code> 都支持频率字符串或偏移别名，可用作 <code>freq</code> 关键字参数。有效的日期偏移及频率字符串如下：</p><table><thead><tr><th align="center">日期偏移量</th><th align="center">频率字符串</th><th align="center">说明</th></tr></thead><tbody><tr><td align="center"><a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.tseries.offsets.DateOffset.html#pandas.tseries.offsets.DateOffset"><code>DateOffset</code></a></td><td align="center">无</td><td align="center">通用偏移类，默认为一个日历日</td></tr><tr><td align="center"><a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.tseries.offsets.BDay.html#pandas.tseries.offsets.BDay"><code>BDay</code></a> 或 <a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.tseries.offsets.BusinessDay.html#pandas.tseries.offsets.BusinessDay"><code>BusinessDay</code></a></td><td align="center"><code>&#39;B&#39;</code></td><td align="center">工作日</td></tr><tr><td align="center"><a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.tseries.offsets.CDay.html#pandas.tseries.offsets.CDay"><code>CDay</code></a> 或 <a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.tseries.offsets.CustomBusinessDay.html#pandas.tseries.offsets.CustomBusinessDay"><code>CustomBusinessDay</code></a></td><td align="center"><code>&#39;C&#39;</code></td><td align="center">自定义工作日</td></tr><tr><td align="center"><a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.tseries.offsets.Week.html#pandas.tseries.offsets.Week"><code>Week</code></a></td><td align="center"><code>&#39;W&#39;</code></td><td align="center">一周，可选周内固定某日</td></tr><tr><td align="center"><a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.tseries.offsets.WeekOfMonth.html#pandas.tseries.offsets.WeekOfMonth"><code>WeekOfMonth</code></a></td><td align="center"><code>&#39;WOM&#39;</code></td><td align="center">每月第几周的第几天</td></tr><tr><td align="center"><a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.tseries.offsets.LastWeekOfMonth.html#pandas.tseries.offsets.LastWeekOfMonth"><code>LastWeekOfMonth</code></a></td><td align="center"><code>&#39;LWOM&#39;</code></td><td align="center">每月最后一周的第几天</td></tr><tr><td align="center"><a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.tseries.offsets.MonthEnd.html#pandas.tseries.offsets.MonthEnd"><code>MonthEnd</code></a></td><td align="center"><code>&#39;M&#39;</code></td><td align="center">日历日月末</td></tr><tr><td align="center"><a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.tseries.offsets.MonthBegin.html#pandas.tseries.offsets.MonthBegin"><code>MonthBegin</code></a></td><td align="center"><code>&#39;MS&#39;</code></td><td align="center">日历日月初</td></tr><tr><td align="center"><a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.tseries.offsets.BMonthEnd.html#pandas.tseries.offsets.BMonthEnd"><code>BMonthEnd</code></a> 或 <a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.tseries.offsets.BusinessMonthEnd.html#pandas.tseries.offsets.BusinessMonthEnd"><code>BusinessMonthEnd</code></a></td><td align="center"><code>&#39;BM&#39;</code></td><td align="center">工作日月末</td></tr><tr><td align="center"><a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.tseries.offsets.BMonthBegin.html#pandas.tseries.offsets.BMonthBegin"><code>BMonthBegin</code></a> 或 <a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.tseries.offsets.BusinessMonthBegin.html#pandas.tseries.offsets.BusinessMonthBegin"><code>BusinessMonthBegin</code></a></td><td align="center"><code>&#39;BMS&#39;</code></td><td align="center">工作日月初</td></tr><tr><td align="center"><a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.tseries.offsets.CBMonthEnd.html#pandas.tseries.offsets.CBMonthEnd"><code>CBMonthEnd</code></a> 或 <a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.tseries.offsets.CustomBusinessMonthEnd.html#pandas.tseries.offsets.CustomBusinessMonthEnd"><code>CustomBusinessMonthEnd</code></a></td><td align="center"><code>&#39;CBM&#39;</code></td><td align="center">自定义工作日月末</td></tr><tr><td align="center"><a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.tseries.offsets.CBMonthBegin.html#pandas.tseries.offsets.CBMonthBegin"><code>CBMonthBegin</code></a> 或 <a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.tseries.offsets.CustomBusinessMonthBegin.html#pandas.tseries.offsets.CustomBusinessMonthBegin"><code>CustomBusinessMonthBegin</code></a></td><td align="center"><code>&#39;CBMS&#39;</code></td><td align="center">自定义工作日月初</td></tr><tr><td align="center"><a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.tseries.offsets.SemiMonthEnd.html#pandas.tseries.offsets.SemiMonthEnd"><code>SemiMonthEnd</code></a></td><td align="center"><code>&#39;SM&#39;</code></td><td align="center">某月第 15 天（或其它半数日期）与日历日月末</td></tr><tr><td align="center"><a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.tseries.offsets.SemiMonthBegin.html#pandas.tseries.offsets.SemiMonthBegin"><code>SemiMonthBegin</code></a></td><td align="center"><code>&#39;SMS&#39;</code></td><td align="center">日历日月初与第 15 天（或其它半数日期）</td></tr><tr><td align="center"><a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.tseries.offsets.QuarterEnd.html#pandas.tseries.offsets.QuarterEnd"><code>QuarterEnd</code></a></td><td align="center"><code>&#39;Q&#39;</code></td><td align="center">日历日季末</td></tr><tr><td align="center"><a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.tseries.offsets.QuarterBegin.html#pandas.tseries.offsets.QuarterBegin"><code>QuarterBegin</code></a></td><td align="center"><code>&#39;QS&#39;</code></td><td align="center">日历日季初</td></tr><tr><td align="center"><a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.tseries.offsets.BQuarterEnd.html#pandas.tseries.offsets.BQuarterEnd"><code>BQuarterEnd</code></a></td><td align="center"><code>&#39;BQ</code></td><td align="center">工作日季末</td></tr><tr><td align="center"><a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.tseries.offsets.BQuarterBegin.html#pandas.tseries.offsets.BQuarterBegin"><code>BQuarterBegin</code></a></td><td align="center"><code>&#39;BQS&#39;</code></td><td align="center">工作日季初</td></tr><tr><td align="center"><a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.tseries.offsets.FY5253Quarter.html#pandas.tseries.offsets.FY5253Quarter"><code>FY5253Quarter</code></a></td><td align="center"><code>&#39;REQ&#39;</code></td><td align="center">零售季，又名 52-53 周</td></tr><tr><td align="center"><a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.tseries.offsets.YearEnd.html#pandas.tseries.offsets.YearEnd"><code>YearEnd</code></a></td><td align="center"><code>&#39;A&#39;</code></td><td align="center">日历日年末</td></tr><tr><td align="center"><a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.tseries.offsets.YearBegin.html#pandas.tseries.offsets.YearBegin"><code>YearBegin</code></a></td><td align="center"><code>&#39;AS&#39;</code> 或 <code>&#39;BYS&#39;</code></td><td align="center">日历日年初</td></tr><tr><td align="center"><a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.tseries.offsets.BYearEnd.html#pandas.tseries.offsets.BYearEnd"><code>BYearEnd</code></a></td><td align="center"><code>&#39;BA&#39;</code></td><td align="center">工作日年末</td></tr><tr><td align="center"><a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.tseries.offsets.BYearBegin.html#pandas.tseries.offsets.BYearBegin"><code>BYearBegin</code></a></td><td align="center"><code>&#39;BAS&#39;</code></td><td align="center">工作日年初</td></tr><tr><td align="center"><a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.tseries.offsets.FY5253.html#pandas.tseries.offsets.FY5253"><code>FY5253</code></a></td><td align="center"><code>&#39;RE&#39;</code></td><td align="center">零售年（又名 52-53 周）</td></tr><tr><td align="center"><a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.tseries.offsets.Easter.html#pandas.tseries.offsets.Easter"><code>Easter</code></a></td><td align="center">无</td><td align="center">复活节假日</td></tr><tr><td align="center"><a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.tseries.offsets.BusinessHour.html#pandas.tseries.offsets.BusinessHour"><code>BusinessHour</code></a></td><td align="center"><code>&#39;BH&#39;</code></td><td align="center">工作小时</td></tr><tr><td align="center"><a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.tseries.offsets.CustomBusinessHour.html#pandas.tseries.offsets.CustomBusinessHour"><code>CustomBusinessHour</code></a></td><td align="center"><code>&#39;CBH&#39;</code></td><td align="center">自定义工作小时</td></tr><tr><td align="center"><a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.tseries.offsets.Day.html#pandas.tseries.offsets.Day"><code>Day</code></a></td><td align="center"><code>&#39;D&#39;</code></td><td align="center">一天</td></tr><tr><td align="center"><a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.tseries.offsets.Hour.html#pandas.tseries.offsets.Hour"><code>Hour</code></a></td><td align="center"><code>&#39;H&#39;</code></td><td align="center">一小时</td></tr><tr><td align="center"><a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.tseries.offsets.Minute.html#pandas.tseries.offsets.Minute"><code>Minute</code></a></td><td align="center"><code>&#39;T&#39;</code> 或 <code>&#39;min&#39;</code></td><td align="center">一分钟</td></tr><tr><td align="center"><a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.tseries.offsets.Second.html#pandas.tseries.offsets.Second"><code>Second</code></a></td><td align="center"><code>&#39;S&#39;</code></td><td align="center">一秒</td></tr><tr><td align="center"><a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.tseries.offsets.Milli.html#pandas.tseries.offsets.Milli"><code>Milli</code></a></td><td align="center"><code>&#39;L&#39;</code> 或 <code>&#39;ms&#39;</code></td><td align="center">一毫秒</td></tr><tr><td align="center"><a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.tseries.offsets.Micro.html#pandas.tseries.offsets.Micro"><code>Micro</code></a></td><td align="center"><code>&#39;U&#39;</code> 或 <code>&#39;us&#39;</code></td><td align="center">一微秒</td></tr><tr><td align="center"><a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.tseries.offsets.Nano.html#pandas.tseries.offsets.Nano"><code>Nano</code></a></td><td align="center"><code>&#39;N&#39;</code></td><td align="center">一纳秒</td></tr></tbody></table><p><code>DateOffset</code> 还支持 <code>rollforward()</code> 与 <code>rollback()</code> 方法，按偏移量把某一日期<strong>向前</strong>或<strong>向后</strong>移动至有效偏移日期。例如，工作日偏移滚动日期时会跳过周末（即，星期六与星期日），直接到星期一，因为工作日偏移针对的是工作日。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">150</span>]: ts = pd.Timestamp(<span class="string">&#x27;2018-01-06 00:00:00&#x27;</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">151</span>]: ts.day_name()</span><br><span class="line">Out[<span class="number">151</span>]: <span class="string">&#x27;Saturday&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 工作时间的有效偏移日期为星期一至星期五</span></span><br><span class="line">In [<span class="number">152</span>]: offset = pd.offsets.BusinessHour(start=<span class="string">&#x27;09:00&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 向前偏移到最近的工作日，即星期一</span></span><br><span class="line">In [<span class="number">153</span>]: offset.rollforward(ts)</span><br><span class="line">Out[<span class="number">153</span>]: Timestamp(<span class="string">&#x27;2018-01-08 09:00:00&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 向前偏移至最近的工作日，同时，小时也相应增加了</span></span><br><span class="line">In [<span class="number">154</span>]: ts + offset</span><br><span class="line">Out[<span class="number">154</span>]: Timestamp(<span class="string">&#x27;2018-01-08 10:00:00&#x27;</span>)</span><br></pre></td></tr></table></figure><p>这些操作默认保存时间（小时、分钟等）信息。<code>normalize()</code> 可以把时间重置为午夜零点，是否应用此操作，取决于是否需要保留时间信息。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">155</span>]: ts = pd.Timestamp(<span class="string">&#x27;2014-01-01 09:00&#x27;</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">156</span>]: day = pd.offsets.Day()</span><br><span class="line"></span><br><span class="line">In [<span class="number">157</span>]: day.apply(ts)</span><br><span class="line">Out[<span class="number">157</span>]: Timestamp(<span class="string">&#x27;2014-01-02 09:00:00&#x27;</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">158</span>]: day.apply(ts).normalize()</span><br><span class="line">Out[<span class="number">158</span>]: Timestamp(<span class="string">&#x27;2014-01-02 00:00:00&#x27;</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">159</span>]: ts = pd.Timestamp(<span class="string">&#x27;2014-01-01 22:00&#x27;</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">160</span>]: hour = pd.offsets.Hour()</span><br><span class="line"></span><br><span class="line">In [<span class="number">161</span>]: hour.apply(ts)</span><br><span class="line">Out[<span class="number">161</span>]: Timestamp(<span class="string">&#x27;2014-01-01 23:00:00&#x27;</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">162</span>]: hour.apply(ts).normalize()</span><br><span class="line">Out[<span class="number">162</span>]: Timestamp(<span class="string">&#x27;2014-01-01 00:00:00&#x27;</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">163</span>]: hour.apply(pd.Timestamp(<span class="string">&quot;2014-01-01 23:30&quot;</span>)).normalize()</span><br><span class="line">Out[<span class="number">163</span>]: Timestamp(<span class="string">&#x27;2014-01-02 00:00:00&#x27;</span>)</span><br></pre></td></tr></table></figure><h3 id="参数偏移"><a href="#参数偏移" class="headerlink" title="参数偏移"></a>参数偏移</h3><p>偏移量支持参数，可以让不同操作生成不同结果。例如，<code>Week</code> 偏移生成每周数据时支持 <code>weekday</code> 参数，生成日期始终位于一周中的指定日期。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">164</span>]: d = datetime.datetime(<span class="number">2008</span>, <span class="number">8</span>, <span class="number">18</span>, <span class="number">9</span>, <span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">165</span>]: d</span><br><span class="line">Out[<span class="number">165</span>]: datetime.datetime(<span class="number">2008</span>, <span class="number">8</span>, <span class="number">18</span>, <span class="number">9</span>, <span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">166</span>]: d + pd.offsets.Week()</span><br><span class="line">Out[<span class="number">166</span>]: Timestamp(<span class="string">&#x27;2008-08-25 09:00:00&#x27;</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">167</span>]: d + pd.offsets.Week(weekday=<span class="number">4</span>)</span><br><span class="line">Out[<span class="number">167</span>]: Timestamp(<span class="string">&#x27;2008-08-22 09:00:00&#x27;</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">168</span>]: (d + pd.offsets.Week(weekday=<span class="number">4</span>)).weekday()</span><br><span class="line">Out[<span class="number">168</span>]: <span class="number">4</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">169</span>]: d - pd.offsets.Week()</span><br><span class="line">Out[<span class="number">169</span>]: Timestamp(<span class="string">&#x27;2008-08-11 09:00:00&#x27;</span>)</span><br></pre></td></tr></table></figure><p>加减法也支持 <code>normalize</code> 选项。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">170</span>]: d + pd.offsets.Week(normalize=<span class="literal">True</span>)</span><br><span class="line">Out[<span class="number">170</span>]: Timestamp(<span class="string">&#x27;2008-08-25 00:00:00&#x27;</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">171</span>]: d - pd.offsets.Week(normalize=<span class="literal">True</span>)</span><br><span class="line">Out[<span class="number">171</span>]: Timestamp(<span class="string">&#x27;2008-08-11 00:00:00&#x27;</span>)</span><br></pre></td></tr></table></figure><p><code>YearEnd</code> 也支持参数，如 <code>month</code> 参数，用于指定月份 。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">172</span>]: d + pd.offsets.YearEnd()</span><br><span class="line">Out[<span class="number">172</span>]: Timestamp(<span class="string">&#x27;2008-12-31 09:00:00&#x27;</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">173</span>]: d + pd.offsets.YearEnd(month=<span class="number">6</span>)</span><br><span class="line">Out[<span class="number">173</span>]: Timestamp(<span class="string">&#x27;2009-06-30 09:00:00&#x27;</span>)</span><br></pre></td></tr></table></figure><h3 id="Series-与-DatetimeIndex-偏移"><a href="#Series-与-DatetimeIndex-偏移" class="headerlink" title="Series 与 DatetimeIndex 偏移"></a><code>Series</code> 与 <code>DatetimeIndex</code> 偏移</h3><p>可以为 <code>Series</code> 或 <code>DatetimeIndex</code> 里的每个元素应用偏移。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">174</span>]: rng = pd.date_range(<span class="string">&#x27;2012-01-01&#x27;</span>, <span class="string">&#x27;2012-01-03&#x27;</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">175</span>]: s = pd.Series(rng)</span><br><span class="line"></span><br><span class="line">In [<span class="number">176</span>]: rng</span><br><span class="line">Out[<span class="number">176</span>]: DatetimeIndex([<span class="string">&#x27;2012-01-01&#x27;</span>, <span class="string">&#x27;2012-01-02&#x27;</span>, <span class="string">&#x27;2012-01-03&#x27;</span>], dtype=<span class="string">&#x27;datetime64[ns]&#x27;</span>, freq=<span class="string">&#x27;D&#x27;</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">177</span>]: rng + pd.DateOffset(months=<span class="number">2</span>)</span><br><span class="line">Out[<span class="number">177</span>]: DatetimeIndex([<span class="string">&#x27;2012-03-01&#x27;</span>, <span class="string">&#x27;2012-03-02&#x27;</span>, <span class="string">&#x27;2012-03-03&#x27;</span>], dtype=<span class="string">&#x27;datetime64[ns]&#x27;</span>, freq=<span class="string">&#x27;D&#x27;</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">178</span>]: s + pd.DateOffset(months=<span class="number">2</span>)</span><br><span class="line">Out[<span class="number">178</span>]: </span><br><span class="line"><span class="number">0</span>   <span class="number">2012</span>-03-01</span><br><span class="line"><span class="number">1</span>   <span class="number">2012</span>-03-02</span><br><span class="line"><span class="number">2</span>   <span class="number">2012</span>-03-03</span><br><span class="line">dtype: datetime64[ns]</span><br><span class="line"></span><br><span class="line">In [<span class="number">179</span>]: s - pd.DateOffset(months=<span class="number">2</span>)</span><br><span class="line">Out[<span class="number">179</span>]: </span><br><span class="line"><span class="number">0</span>   <span class="number">2011</span>-<span class="number">11</span>-01</span><br><span class="line"><span class="number">1</span>   <span class="number">2011</span>-<span class="number">11</span>-02</span><br><span class="line"><span class="number">2</span>   <span class="number">2011</span>-<span class="number">11</span>-03</span><br><span class="line">dtype: datetime64[ns]</span><br></pre></td></tr></table></figure><p>如果偏移直接映射 <code>Timedelta</code> （<code>Day</code>、<code>Hour</code>、<code>Minute</code>、<code>Second</code>、<code>Micro</code>、<code>Milli</code>、<code>Nano</code>），则该偏移与 <code>Timedelta</code> 的使用方式完全一样。参阅<a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/user_guide/timedeltas.html#timedeltas-operations">时间差 - Timedelta</a>，查看更多示例。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">180</span>]: s - pd.offsets.Day(<span class="number">2</span>)</span><br><span class="line">Out[<span class="number">180</span>]: </span><br><span class="line"><span class="number">0</span>   <span class="number">2011</span>-<span class="number">12</span>-<span class="number">30</span></span><br><span class="line"><span class="number">1</span>   <span class="number">2011</span>-<span class="number">12</span>-<span class="number">31</span></span><br><span class="line"><span class="number">2</span>   <span class="number">2012</span>-01-01</span><br><span class="line">dtype: datetime64[ns]</span><br><span class="line"></span><br><span class="line">In [<span class="number">181</span>]: td = s - pd.Series(pd.date_range(<span class="string">&#x27;2011-12-29&#x27;</span>, <span class="string">&#x27;2011-12-31&#x27;</span>))</span><br><span class="line"></span><br><span class="line">In [<span class="number">182</span>]: td</span><br><span class="line">Out[<span class="number">182</span>]: </span><br><span class="line"><span class="number">0</span>   <span class="number">3</span> days</span><br><span class="line"><span class="number">1</span>   <span class="number">3</span> days</span><br><span class="line"><span class="number">2</span>   <span class="number">3</span> days</span><br><span class="line">dtype: timedelta64[ns]</span><br><span class="line"></span><br><span class="line">In [<span class="number">183</span>]: td + pd.offsets.Minute(<span class="number">15</span>)</span><br><span class="line">Out[<span class="number">183</span>]: </span><br><span class="line"><span class="number">0</span>   <span class="number">3</span> days <span class="number">00</span>:<span class="number">15</span>:<span class="number">00</span></span><br><span class="line"><span class="number">1</span>   <span class="number">3</span> days <span class="number">00</span>:<span class="number">15</span>:<span class="number">00</span></span><br><span class="line"><span class="number">2</span>   <span class="number">3</span> days <span class="number">00</span>:<span class="number">15</span>:<span class="number">00</span></span><br><span class="line">dtype: timedelta64[ns]</span><br></pre></td></tr></table></figure><p>注意，某些偏移量（如 <code>BQuarterEnd</code>）不支持矢量操作，即使可以执行运算，速度也非常慢，并可能显示 <code>PerformanceWaring</code>（性能警告）。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">184</span>]: rng + pd.offsets.BQuarterEnd()</span><br><span class="line">Out[<span class="number">184</span>]: DatetimeIndex([<span class="string">&#x27;2012-03-30&#x27;</span>, <span class="string">&#x27;2012-03-30&#x27;</span>, <span class="string">&#x27;2012-03-30&#x27;</span>], dtype=<span class="string">&#x27;datetime64[ns]&#x27;</span>, freq=<span class="string">&#x27;D&#x27;</span>)</span><br></pre></td></tr></table></figure><h3 id="自定义工作日"><a href="#自定义工作日" class="headerlink" title="自定义工作日"></a>自定义工作日</h3><p><code>Cday</code> 或 <code>CustomBusinessDay</code> 类可以参数化 <code>BusinessDay</code> 类，用于创建支持本地周末与传统节假日的自定义工作日历。</p><p>下面这个例子就很有意思，知道吗？埃及的周末是星期五与星期六。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">185</span>]: weekmask_egypt = <span class="string">&#x27;Sun Mon Tue Wed Thu&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 下面是 2012 - 2014 年的五一劳动节</span></span><br><span class="line">In [<span class="number">186</span>]: holidays = [<span class="string">&#x27;2012-05-01&#x27;</span>,</span><br><span class="line">   .....:             datetime.datetime(<span class="number">2013</span>, <span class="number">5</span>, <span class="number">1</span>),</span><br><span class="line">   .....:             np.datetime64(<span class="string">&#x27;2014-05-01&#x27;</span>)]</span><br><span class="line">   .....: </span><br><span class="line"></span><br><span class="line">In [<span class="number">187</span>]: bday_egypt = pd.offsets.CustomBusinessDay(holidays=holidays,</span><br><span class="line">   .....:                                           weekmask=weekmask_egypt)</span><br><span class="line">   .....: </span><br><span class="line"></span><br><span class="line">In [<span class="number">188</span>]: dt = datetime.datetime(<span class="number">2013</span>, <span class="number">4</span>, <span class="number">30</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">189</span>]: dt + <span class="number">2</span> * bday_egypt</span><br><span class="line">Out[<span class="number">189</span>]: Timestamp(<span class="string">&#x27;2013-05-05 00:00:00&#x27;</span>)</span><br></pre></td></tr></table></figure><p>下列代码实现了日期与工作日之间的映射关系。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">190</span>]: dts = pd.date_range(dt, periods=<span class="number">5</span>, freq=bday_egypt)</span><br><span class="line"></span><br><span class="line">In [<span class="number">191</span>]: pd.Series(dts.weekday, dts).<span class="built_in">map</span>(</span><br><span class="line">   .....:     pd.Series(<span class="string">&#x27;Mon Tue Wed Thu Fri Sat Sun&#x27;</span>.split()))</span><br><span class="line">   .....: </span><br><span class="line">Out[<span class="number">191</span>]: </span><br><span class="line"><span class="number">2013</span>-04-<span class="number">30</span>    Tue</span><br><span class="line"><span class="number">2013</span>-05-02    Thu</span><br><span class="line"><span class="number">2013</span>-05-05    Sun</span><br><span class="line"><span class="number">2013</span>-05-06    Mon</span><br><span class="line"><span class="number">2013</span>-05-07    Tue</span><br><span class="line">Freq: C, dtype: <span class="built_in">object</span></span><br></pre></td></tr></table></figure><p>节日日历支持节假日列表。更多信息，请参阅<a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/user_guide/timeseries.html#timeseries-holiday">节日日历</a>文档。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">192</span>]: <span class="keyword">from</span> pandas.tseries.holiday <span class="keyword">import</span> USFederalHolidayCalendar</span><br><span class="line"></span><br><span class="line">In [<span class="number">193</span>]: bday_us = pd.offsets.CustomBusinessDay(calendar=USFederalHolidayCalendar())</span><br><span class="line"></span><br><span class="line"><span class="comment"># 马丁路德金纪念日前的星期五</span></span><br><span class="line">In [<span class="number">194</span>]: dt = datetime.datetime(<span class="number">2014</span>, <span class="number">1</span>, <span class="number">17</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 马丁路德金纪念日后的星期二，因为星期一放假，所以跳过了</span></span><br><span class="line">In [<span class="number">195</span>]: dt + bday_us</span><br><span class="line">Out[<span class="number">195</span>]: Timestamp(<span class="string">&#x27;2014-01-21 00:00:00&#x27;</span>)</span><br></pre></td></tr></table></figure><p>遵循节日日历规则的月偏移可以用正常方式定义。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">196</span>]: bmth_us = pd.offsets.CustomBusinessMonthBegin(</span><br><span class="line">   .....:     calendar=USFederalHolidayCalendar())</span><br><span class="line">   .....: </span><br><span class="line"></span><br><span class="line"><span class="comment"># 跳过新年</span></span><br><span class="line">In [<span class="number">197</span>]: dt = datetime.datetime(<span class="number">2013</span>, <span class="number">12</span>, <span class="number">17</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">198</span>]: dt + bmth_us</span><br><span class="line">Out[<span class="number">198</span>]: Timestamp(<span class="string">&#x27;2014-01-02 00:00:00&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 定义带自定义偏移的日期索引</span></span><br><span class="line">In [<span class="number">199</span>]: pd.date_range(start=<span class="string">&#x27;20100101&#x27;</span>, end=<span class="string">&#x27;20120101&#x27;</span>, freq=bmth_us)</span><br><span class="line">Out[<span class="number">199</span>]: </span><br><span class="line">DatetimeIndex([<span class="string">&#x27;2010-01-04&#x27;</span>, <span class="string">&#x27;2010-02-01&#x27;</span>, <span class="string">&#x27;2010-03-01&#x27;</span>, <span class="string">&#x27;2010-04-01&#x27;</span>,</span><br><span class="line">               <span class="string">&#x27;2010-05-03&#x27;</span>, <span class="string">&#x27;2010-06-01&#x27;</span>, <span class="string">&#x27;2010-07-01&#x27;</span>, <span class="string">&#x27;2010-08-02&#x27;</span>,</span><br><span class="line">               <span class="string">&#x27;2010-09-01&#x27;</span>, <span class="string">&#x27;2010-10-01&#x27;</span>, <span class="string">&#x27;2010-11-01&#x27;</span>, <span class="string">&#x27;2010-12-01&#x27;</span>,</span><br><span class="line">               <span class="string">&#x27;2011-01-03&#x27;</span>, <span class="string">&#x27;2011-02-01&#x27;</span>, <span class="string">&#x27;2011-03-01&#x27;</span>, <span class="string">&#x27;2011-04-01&#x27;</span>,</span><br><span class="line">               <span class="string">&#x27;2011-05-02&#x27;</span>, <span class="string">&#x27;2011-06-01&#x27;</span>, <span class="string">&#x27;2011-07-01&#x27;</span>, <span class="string">&#x27;2011-08-01&#x27;</span>,</span><br><span class="line">               <span class="string">&#x27;2011-09-01&#x27;</span>, <span class="string">&#x27;2011-10-03&#x27;</span>, <span class="string">&#x27;2011-11-01&#x27;</span>, <span class="string">&#x27;2011-12-01&#x27;</span>],</span><br><span class="line">              dtype=<span class="string">&#x27;datetime64[ns]&#x27;</span>, freq=<span class="string">&#x27;CBMS&#x27;</span>)</span><br></pre></td></tr></table></figure><p>::: tip 注意</p><p>频率字符串 ‘C’ 验证 <code>CustomBusinessDay</code> 日期偏移 调用，注意，<code>CustomBusinessDay</code> 可实现参数化，<code>CustomBusinessDay</code> 实例会各不相同，且频率字符串 ‘C’ 无法识别这个问题。用户应确保应用里调用的频率字符串 ‘C’ 的一致性 。</p><h3 id="工作时间"><a href="#工作时间" class="headerlink" title="工作时间"></a>工作时间</h3><p><code>BusinessHour</code> 表示 <code>BusinessDay</code> 基础上的工作时间，用于指定开始与结束工作时间。</p><p><code>BusinessHour</code> 默认的工作时间是 9:00 - 17:00。<code>BusinessHour</code> 加法以小时频率增加 <code>Timestamp</code> 。如果目标 <code>Timestamp</code> 超出了一小时，则要先移动到下一个工作小时，再行增加。如果超过了当日工作时间的范围，剩下的时间则添加到下一个工作日。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">200</span>]: bh = pd.offsets.BusinessHour()</span><br><span class="line"></span><br><span class="line">In [<span class="number">201</span>]: bh</span><br><span class="line">Out[<span class="number">201</span>]: &lt;BusinessHour: BH=09:<span class="number">00</span>-<span class="number">17</span>:<span class="number">00</span>&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2014 年 8 月 1 日是星期五</span></span><br><span class="line">In [<span class="number">202</span>]: pd.Timestamp(<span class="string">&#x27;2014-08-01 10:00&#x27;</span>).weekday()</span><br><span class="line">Out[<span class="number">202</span>]: <span class="number">4</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">203</span>]: pd.Timestamp(<span class="string">&#x27;2014-08-01 10:00&#x27;</span>) + bh</span><br><span class="line">Out[<span class="number">203</span>]: Timestamp(<span class="string">&#x27;2014-08-01 11:00:00&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 下例等同于： pd.Timestamp(&#x27;2014-08-01 09:00&#x27;) + bh</span></span><br><span class="line">In [<span class="number">204</span>]: pd.Timestamp(<span class="string">&#x27;2014-08-01 08:00&#x27;</span>) + bh</span><br><span class="line">Out[<span class="number">204</span>]: Timestamp(<span class="string">&#x27;2014-08-01 10:00:00&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 如果计算结果为当日下班时间，则转移到下一个工作日的上班时间</span></span><br><span class="line">In [<span class="number">205</span>]: pd.Timestamp(<span class="string">&#x27;2014-08-01 16:00&#x27;</span>) + bh</span><br><span class="line">Out[<span class="number">205</span>]: Timestamp(<span class="string">&#x27;2014-08-04 09:00:00&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 剩下的时间也会添加到下一天</span></span><br><span class="line">In [<span class="number">206</span>]: pd.Timestamp(<span class="string">&#x27;2014-08-01 16:30&#x27;</span>) + bh</span><br><span class="line">Out[<span class="number">206</span>]: Timestamp(<span class="string">&#x27;2014-08-04 09:30:00&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 添加 2 个工作小时</span></span><br><span class="line">In [<span class="number">207</span>]: pd.Timestamp(<span class="string">&#x27;2014-08-01 10:00&#x27;</span>) + pd.offsets.BusinessHour(<span class="number">2</span>)</span><br><span class="line">Out[<span class="number">207</span>]: Timestamp(<span class="string">&#x27;2014-08-01 12:00:00&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 减掉 3 个工作小时</span></span><br><span class="line">In [<span class="number">208</span>]: pd.Timestamp(<span class="string">&#x27;2014-08-01 10:00&#x27;</span>) + pd.offsets.BusinessHour(-<span class="number">3</span>)</span><br><span class="line">Out[<span class="number">208</span>]: Timestamp(<span class="string">&#x27;2014-07-31 15:00:00&#x27;</span>)</span><br></pre></td></tr></table></figure><p>还可以用关键字指定 <code>start</code> 与 <code>end</code> 时间。参数必须是<code>hour:minute</code> 格式的字符串或 <code>datetime.time</code> 实例。把秒、微秒、纳秒设置为工作时间会导致 <code>ValueError</code>。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">209</span>]: bh = pd.offsets.BusinessHour(start=<span class="string">&#x27;11:00&#x27;</span>, end=datetime.time(<span class="number">20</span>, <span class="number">0</span>))</span><br><span class="line"></span><br><span class="line">In [<span class="number">210</span>]: bh</span><br><span class="line">Out[<span class="number">210</span>]: &lt;BusinessHour: BH=<span class="number">11</span>:<span class="number">00</span>-<span class="number">20</span>:<span class="number">00</span>&gt;</span><br><span class="line"></span><br><span class="line">In [<span class="number">211</span>]: pd.Timestamp(<span class="string">&#x27;2014-08-01 13:00&#x27;</span>) + bh</span><br><span class="line">Out[<span class="number">211</span>]: Timestamp(<span class="string">&#x27;2014-08-01 14:00:00&#x27;</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">212</span>]: pd.Timestamp(<span class="string">&#x27;2014-08-01 09:00&#x27;</span>) + bh</span><br><span class="line">Out[<span class="number">212</span>]: Timestamp(<span class="string">&#x27;2014-08-01 12:00:00&#x27;</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">213</span>]: pd.Timestamp(<span class="string">&#x27;2014-08-01 18:00&#x27;</span>) + bh</span><br><span class="line">Out[<span class="number">213</span>]: Timestamp(<span class="string">&#x27;2014-08-01 19:00:00&#x27;</span>)</span><br></pre></td></tr></table></figure><p><code>start</code> 时间晚于 <code>end</code> 时间表示夜班工作时间。此时，工作时间将从午夜延至第二天。工作时间是否有效取决于该时间是否开始于有效的 <code>BusinessDay</code>。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">214</span>]: bh = pd.offsets.BusinessHour(start=<span class="string">&#x27;17:00&#x27;</span>, end=<span class="string">&#x27;09:00&#x27;</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">215</span>]: bh</span><br><span class="line">Out[<span class="number">215</span>]: &lt;BusinessHour: BH=<span class="number">17</span>:<span class="number">00</span>-09:<span class="number">00</span>&gt;</span><br><span class="line"></span><br><span class="line">In [<span class="number">216</span>]: pd.Timestamp(<span class="string">&#x27;2014-08-01 17:00&#x27;</span>) + bh</span><br><span class="line">Out[<span class="number">216</span>]: Timestamp(<span class="string">&#x27;2014-08-01 18:00:00&#x27;</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">217</span>]: pd.Timestamp(<span class="string">&#x27;2014-08-01 23:00&#x27;</span>) + bh</span><br><span class="line">Out[<span class="number">217</span>]: Timestamp(<span class="string">&#x27;2014-08-02 00:00:00&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 虽然 2014 年 8 月 2 日是星期六，</span></span><br><span class="line"><span class="comment"># 但因为工作时间开始于星期五，因此，也是有效的</span></span><br><span class="line">In [<span class="number">218</span>]: pd.Timestamp(<span class="string">&#x27;2014-08-02 04:00&#x27;</span>) + bh</span><br><span class="line">Out[<span class="number">218</span>]: Timestamp(<span class="string">&#x27;2014-08-02 05:00:00&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 虽然 2014 年 8 月 4 日是星期一，</span></span><br><span class="line"><span class="comment"># 但开始时间是星期日，因此，超出了工作时间</span></span><br><span class="line">In [<span class="number">219</span>]: pd.Timestamp(<span class="string">&#x27;2014-08-04 04:00&#x27;</span>) + bh</span><br><span class="line">Out[<span class="number">219</span>]: Timestamp(<span class="string">&#x27;2014-08-04 18:00:00&#x27;</span>)</span><br></pre></td></tr></table></figure><p><code>BusinessHour.rollforward</code> 与 <code>rollback</code> 操作将前滚至下一天的上班时间，或回滚至前一天的下班时间。与其它偏移量不同，<code>BusinessHour.rollforward</code> 输出与 <code>apply</code> 定义不同的结果。</p><p>这是因为一天工作时间的结束等同于第二天工作时间的开始。默认情况下，工作时间为 9:00 - 17:00，Pandas 认为 <code>2014-08-01 17:00</code> 与 <code>2014-08-04 09:00</code> 之间的时间间隔为 0 分钟。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 把时间戳回滚到前一天的下班时间</span></span><br><span class="line">In [<span class="number">220</span>]: pd.offsets.BusinessHour().rollback(pd.Timestamp(<span class="string">&#x27;2014-08-02 15:00&#x27;</span>))</span><br><span class="line">Out[<span class="number">220</span>]: Timestamp(<span class="string">&#x27;2014-08-01 17:00:00&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 把时间戳前滚到下一个工作日的上班时间</span></span><br><span class="line">In [<span class="number">221</span>]: pd.offsets.BusinessHour().rollforward(pd.Timestamp(<span class="string">&#x27;2014-08-02 15:00&#x27;</span>))</span><br><span class="line">Out[<span class="number">221</span>]: Timestamp(<span class="string">&#x27;2014-08-04 09:00:00&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 等同于：BusinessHour().apply(pd.Timestamp(&#x27;2014-08-01 17:00&#x27;))</span></span><br><span class="line"><span class="comment"># 与 BusinessHour().apply(pd.Timestamp(&#x27;2014-08-04 09:00&#x27;))</span></span><br><span class="line">In [<span class="number">222</span>]: pd.offsets.BusinessHour().apply(pd.Timestamp(<span class="string">&#x27;2014-08-02 15:00&#x27;</span>))</span><br><span class="line">Out[<span class="number">222</span>]: Timestamp(<span class="string">&#x27;2014-08-04 10:00:00&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 工作日的结果（仅供参考）</span></span><br><span class="line">In [<span class="number">223</span>]: pd.offsets.BusinessHour().rollforward(pd.Timestamp(<span class="string">&#x27;2014-08-02&#x27;</span>))</span><br><span class="line">Out[<span class="number">223</span>]: Timestamp(<span class="string">&#x27;2014-08-04 09:00:00&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 等同于 BusinessDay().apply(pd.Timestamp(&#x27;2014-08-01&#x27;))</span></span><br><span class="line"><span class="comment"># 等同于 rollforward 因为工作日不会重叠</span></span><br><span class="line">In [<span class="number">224</span>]: pd.offsets.BusinessHour().apply(pd.Timestamp(<span class="string">&#x27;2014-08-02&#x27;</span>))</span><br><span class="line">Out[<span class="number">224</span>]: Timestamp(<span class="string">&#x27;2014-08-04 10:00:00&#x27;</span>)</span><br></pre></td></tr></table></figure><p><code>BusinessHour</code> 把星期六与星期日当成假日。<code>CustomBusinessHour</code> 可以把节假日设为工作时间，详见下文。</p><h3 id="自定义工作时间"><a href="#自定义工作时间" class="headerlink" title="自定义工作时间"></a>自定义工作时间</h3><p><em>0.18.1 版新增</em>。</p><p><code>CustomBusinessHour</code> 是 <code>BusinessHour</code> 和 <code>CustomBusinessDay</code> 的混合体，可以指定任意节假日。除了跳过自定义节假日之外，<code>CustomBusinessHour</code> 的运作方式与 <code>BusinessHour</code> 一样。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">225</span>]: <span class="keyword">from</span> pandas.tseries.holiday <span class="keyword">import</span> USFederalHolidayCalendar</span><br><span class="line"></span><br><span class="line">In [<span class="number">226</span>]: bhour_us = pd.offsets.CustomBusinessHour(calendar=USFederalHolidayCalendar())</span><br><span class="line"></span><br><span class="line"><span class="comment"># 马丁路德金纪念日之前的星期五</span></span><br><span class="line">In [<span class="number">227</span>]: dt = datetime.datetime(<span class="number">2014</span>, <span class="number">1</span>, <span class="number">17</span>, <span class="number">15</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">228</span>]: dt + bhour_us</span><br><span class="line">Out[<span class="number">228</span>]: Timestamp(<span class="string">&#x27;2014-01-17 16:00:00&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 跳至马丁路德金纪念日之后的星期二，星期一过节，所以跳过了</span></span><br><span class="line">In [<span class="number">229</span>]: dt + bhour_us * <span class="number">2</span></span><br><span class="line">Out[<span class="number">229</span>]: Timestamp(<span class="string">&#x27;2014-01-21 09:00:00&#x27;</span>)</span><br></pre></td></tr></table></figure><p><code>BusinessHour</code> 支持与 <code>CustomBusinessDay</code> 一样的关键字参数。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">230</span>]: bhour_mon = pd.offsets.CustomBusinessHour(start=<span class="string">&#x27;10:00&#x27;</span>,</span><br><span class="line">   .....:                                           weekmask=<span class="string">&#x27;Tue Wed Thu Fri&#x27;</span>)</span><br><span class="line">   .....: </span><br><span class="line"></span><br><span class="line"><span class="comment"># 跳过了星期一，因为星期一过节，工作时间从 10 点开始</span></span><br><span class="line">In [<span class="number">231</span>]: dt + bhour_mon * <span class="number">2</span></span><br><span class="line">Out[<span class="number">231</span>]: Timestamp(<span class="string">&#x27;2014-01-21 10:00:00&#x27;</span>)</span><br></pre></td></tr></table></figure><h3 id="偏移量别名"><a href="#偏移量别名" class="headerlink" title="偏移量别名"></a>偏移量别名</h3><p>时间序列频率的字符串别名在这里叫<strong>偏移量别名</strong>。</p><table><thead><tr><th align="center">别名</th><th align="left">说明</th></tr></thead><tbody><tr><td align="center">B</td><td align="left">工作日频率</td></tr><tr><td align="center">C</td><td align="left">自定义工作日频率</td></tr><tr><td align="center">D</td><td align="left">日历日频率</td></tr><tr><td align="center">W</td><td align="left">周频率</td></tr><tr><td align="center">M</td><td align="left">月末频率</td></tr><tr><td align="center">SM</td><td align="left">半月末频率（15 号与月末）</td></tr><tr><td align="center">BM</td><td align="left">工作日月末频率</td></tr><tr><td align="center">CBM</td><td align="left">自定义工作日月末频率</td></tr><tr><td align="center">MS</td><td align="left">月初频率</td></tr><tr><td align="center">SMS</td><td align="left">半月初频率（1 号与 15 号）</td></tr><tr><td align="center">BMS</td><td align="left">工作日月初频率</td></tr><tr><td align="center">CBMS</td><td align="left">自定义工作日月初频率</td></tr><tr><td align="center">Q</td><td align="left">季末频率</td></tr><tr><td align="center">BQ</td><td align="left">工作日季末频率</td></tr><tr><td align="center">QS</td><td align="left">季初频率</td></tr><tr><td align="center">BQS</td><td align="left">工作日季初频率</td></tr><tr><td align="center">A, Y</td><td align="left">年末频率</td></tr><tr><td align="center">BA, BY</td><td align="left">工作日年末频率</td></tr><tr><td align="center">AS, YS</td><td align="left">年初频率</td></tr><tr><td align="center">BAS, BYS</td><td align="left">工作日年初频率</td></tr><tr><td align="center">BH</td><td align="left">工作时间频率</td></tr><tr><td align="center">H</td><td align="left">小时频率</td></tr><tr><td align="center">T, min</td><td align="left">分钟频率</td></tr><tr><td align="center">S</td><td align="left">秒频率</td></tr><tr><td align="center">L, ms</td><td align="left">毫秒</td></tr><tr><td align="center">U, us</td><td align="left">微秒</td></tr><tr><td align="center">N</td><td align="left">纳秒</td></tr></tbody></table><h3 id="别名组合"><a href="#别名组合" class="headerlink" title="别名组合"></a>别名组合</h3><p>如前说述，别名与偏移量实例在绝大多数函数里可以互换：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">232</span>]: pd.date_range(start, periods=<span class="number">5</span>, freq=<span class="string">&#x27;B&#x27;</span>)</span><br><span class="line">Out[<span class="number">232</span>]: </span><br><span class="line">DatetimeIndex([<span class="string">&#x27;2011-01-03&#x27;</span>, <span class="string">&#x27;2011-01-04&#x27;</span>, <span class="string">&#x27;2011-01-05&#x27;</span>, <span class="string">&#x27;2011-01-06&#x27;</span>,</span><br><span class="line">               <span class="string">&#x27;2011-01-07&#x27;</span>],</span><br><span class="line">              dtype=<span class="string">&#x27;datetime64[ns]&#x27;</span>, freq=<span class="string">&#x27;B&#x27;</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">233</span>]: pd.date_range(start, periods=<span class="number">5</span>, freq=pd.offsets.BDay())</span><br><span class="line">Out[<span class="number">233</span>]: </span><br><span class="line">DatetimeIndex([<span class="string">&#x27;2011-01-03&#x27;</span>, <span class="string">&#x27;2011-01-04&#x27;</span>, <span class="string">&#x27;2011-01-05&#x27;</span>, <span class="string">&#x27;2011-01-06&#x27;</span>,</span><br><span class="line">               <span class="string">&#x27;2011-01-07&#x27;</span>],</span><br><span class="line">              dtype=<span class="string">&#x27;datetime64[ns]&#x27;</span>, freq=<span class="string">&#x27;B&#x27;</span>)</span><br></pre></td></tr></table></figure><p>可以组合日与当日偏移量。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">234</span>]: pd.date_range(start, periods=<span class="number">10</span>, freq=<span class="string">&#x27;2h20min&#x27;</span>)</span><br><span class="line">Out[<span class="number">234</span>]: </span><br><span class="line">DatetimeIndex([<span class="string">&#x27;2011-01-01 00:00:00&#x27;</span>, <span class="string">&#x27;2011-01-01 02:20:00&#x27;</span>,</span><br><span class="line">               <span class="string">&#x27;2011-01-01 04:40:00&#x27;</span>, <span class="string">&#x27;2011-01-01 07:00:00&#x27;</span>,</span><br><span class="line">               <span class="string">&#x27;2011-01-01 09:20:00&#x27;</span>, <span class="string">&#x27;2011-01-01 11:40:00&#x27;</span>,</span><br><span class="line">               <span class="string">&#x27;2011-01-01 14:00:00&#x27;</span>, <span class="string">&#x27;2011-01-01 16:20:00&#x27;</span>,</span><br><span class="line">               <span class="string">&#x27;2011-01-01 18:40:00&#x27;</span>, <span class="string">&#x27;2011-01-01 21:00:00&#x27;</span>],</span><br><span class="line">              dtype=<span class="string">&#x27;datetime64[ns]&#x27;</span>, freq=<span class="string">&#x27;140T&#x27;</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">235</span>]: pd.date_range(start, periods=<span class="number">10</span>, freq=<span class="string">&#x27;1D10U&#x27;</span>)</span><br><span class="line">Out[<span class="number">235</span>]: </span><br><span class="line">DatetimeIndex([       <span class="string">&#x27;2011-01-01 00:00:00&#x27;</span>, <span class="string">&#x27;2011-01-02 00:00:00.000010&#x27;</span>,</span><br><span class="line">               <span class="string">&#x27;2011-01-03 00:00:00.000020&#x27;</span>, <span class="string">&#x27;2011-01-04 00:00:00.000030&#x27;</span>,</span><br><span class="line">               <span class="string">&#x27;2011-01-05 00:00:00.000040&#x27;</span>, <span class="string">&#x27;2011-01-06 00:00:00.000050&#x27;</span>,</span><br><span class="line">               <span class="string">&#x27;2011-01-07 00:00:00.000060&#x27;</span>, <span class="string">&#x27;2011-01-08 00:00:00.000070&#x27;</span>,</span><br><span class="line">               <span class="string">&#x27;2011-01-09 00:00:00.000080&#x27;</span>, <span class="string">&#x27;2011-01-10 00:00:00.000090&#x27;</span>],</span><br><span class="line">              dtype=<span class="string">&#x27;datetime64[ns]&#x27;</span>, freq=<span class="string">&#x27;86400000010U&#x27;</span>)</span><br></pre></td></tr></table></figure><h3 id="锚定偏移量"><a href="#锚定偏移量" class="headerlink" title="锚定偏移量"></a>锚定偏移量</h3><p>可以指定某些频率的锚定后缀：</p><table><thead><tr><th align="center">别名</th><th align="left">说明</th></tr></thead><tbody><tr><td align="center">W-SUN</td><td align="left">周频率（星期日），与 “W” 相同</td></tr><tr><td align="center">W-MON</td><td align="left">周频率（星期一）</td></tr><tr><td align="center">W-TUE</td><td align="left">周频率（星期二）</td></tr><tr><td align="center">W-WED</td><td align="left">周频率（星期三）</td></tr><tr><td align="center">W-THU</td><td align="left">周频率（星期四）</td></tr><tr><td align="center">W-FRI</td><td align="left">周频率（星期五）</td></tr><tr><td align="center">W-SAT</td><td align="left">周频率（星期六）</td></tr><tr><td align="center">(B)Q(S)-DEC</td><td align="left">季频率，该年结束于十二月，与 “Q” 相同</td></tr><tr><td align="center">(B)Q(S)-JAN</td><td align="left">季频率，该年结束于一月</td></tr><tr><td align="center">(B)Q(S)-FEB</td><td align="left">季频率，该年结束于二月</td></tr><tr><td align="center">(B)Q(S)-MAR</td><td align="left">季频率，该年结束于三月</td></tr><tr><td align="center">(B)Q(S)-APR</td><td align="left">季频率，该年结束于四月</td></tr><tr><td align="center">(B)Q(S)-MAY</td><td align="left">季频率，该年结束于五月</td></tr><tr><td align="center">(B)Q(S)-JUN</td><td align="left">季频率，该年结束于六月</td></tr><tr><td align="center">(B)Q(S)-JUL</td><td align="left">季频率，该年结束于七月</td></tr><tr><td align="center">(B)Q(S)-AUG</td><td align="left">季频率，该年结束于八月</td></tr><tr><td align="center">(B)Q(S)-SEP</td><td align="left">季频率，该年结束于九月</td></tr><tr><td align="center">(B)Q(S)-OCT</td><td align="left">季频率，该年结束于十月</td></tr><tr><td align="center">(B)Q(S)-NOV</td><td align="left">季频率，该年结束于十一月</td></tr><tr><td align="center">(B)A(S)-DEC</td><td align="left">年频率，锚定结束于十二月，与 “A” 相同</td></tr><tr><td align="center">(B)A(S)-JAN</td><td align="left">年频率，锚定结束于一月</td></tr><tr><td align="center">(B)A(S)-FEB</td><td align="left">年频率，锚定结束于二月</td></tr><tr><td align="center">(B)A(S)-MAR</td><td align="left">年频率，锚定结束于三月</td></tr><tr><td align="center">(B)A(S)-APR</td><td align="left">年频率，锚定结束于四月</td></tr><tr><td align="center">(B)A(S)-MAY</td><td align="left">年频率，锚定结束于五月</td></tr><tr><td align="center">(B)A(S)-JUN</td><td align="left">年频率，锚定结束于六月</td></tr><tr><td align="center">(B)A(S)-JUL</td><td align="left">年频率，锚定结束于七月</td></tr><tr><td align="center">(B)A(S)-AUG</td><td align="left">年频率，锚定结束于八月</td></tr><tr><td align="center">(B)A(S)-SEP</td><td align="left">年频率，锚定结束于九月</td></tr><tr><td align="center">(B)A(S)-OCT</td><td align="left">年频率，锚定结束于十月</td></tr><tr><td align="center">(B)A(S)-NOV</td><td align="left">年频率，锚定结束于十一月</td></tr></tbody></table><p>这些别名可以用作 <code>date_range</code>、<code>bdate_range</code> 、<code>DatetimeIndex</code> 及其它时间序列函数的参数。</p><h3 id="锚定偏移量的含义"><a href="#锚定偏移量的含义" class="headerlink" title="锚定偏移量的含义"></a>锚定偏移量的含义</h3><p>对于偏移量锚定于开始或结束指定频率（<code>MonthEnd</code>、<code>MonthBegin</code>、<code>WeekEnd</code> 等）下列规则应用于前滚与后滚。</p><p><code>n</code> 不为 0 时，如果给定日期不是锚定日期，将寻找下一个或上一个锚点，并向前或向后移动 <code>|n|-1</code> 步。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">236</span>]: pd.Timestamp(<span class="string">&#x27;2014-01-02&#x27;</span>) + pd.offsets.MonthBegin(n=<span class="number">1</span>)</span><br><span class="line">Out[<span class="number">236</span>]: Timestamp(<span class="string">&#x27;2014-02-01 00:00:00&#x27;</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">237</span>]: pd.Timestamp(<span class="string">&#x27;2014-01-02&#x27;</span>) + pd.offsets.MonthEnd(n=<span class="number">1</span>)</span><br><span class="line">Out[<span class="number">237</span>]: Timestamp(<span class="string">&#x27;2014-01-31 00:00:00&#x27;</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">238</span>]: pd.Timestamp(<span class="string">&#x27;2014-01-02&#x27;</span>) - pd.offsets.MonthBegin(n=<span class="number">1</span>)</span><br><span class="line">Out[<span class="number">238</span>]: Timestamp(<span class="string">&#x27;2014-01-01 00:00:00&#x27;</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">239</span>]: pd.Timestamp(<span class="string">&#x27;2014-01-02&#x27;</span>) - pd.offsets.MonthEnd(n=<span class="number">1</span>)</span><br><span class="line">Out[<span class="number">239</span>]: Timestamp(<span class="string">&#x27;2013-12-31 00:00:00&#x27;</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">240</span>]: pd.Timestamp(<span class="string">&#x27;2014-01-02&#x27;</span>) + pd.offsets.MonthBegin(n=<span class="number">4</span>)</span><br><span class="line">Out[<span class="number">240</span>]: Timestamp(<span class="string">&#x27;2014-05-01 00:00:00&#x27;</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">241</span>]: pd.Timestamp(<span class="string">&#x27;2014-01-02&#x27;</span>) - pd.offsets.MonthBegin(n=<span class="number">4</span>)</span><br><span class="line">Out[<span class="number">241</span>]: Timestamp(<span class="string">&#x27;2013-10-01 00:00:00&#x27;</span>)</span><br></pre></td></tr></table></figure><p>如果给定日期是锚定日期，则向前（或向后）移动 <code>|n|</code> 个点。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">242</span>]: pd.Timestamp(<span class="string">&#x27;2014-01-01&#x27;</span>) + pd.offsets.MonthBegin(n=<span class="number">1</span>)</span><br><span class="line">Out[<span class="number">242</span>]: Timestamp(<span class="string">&#x27;2014-02-01 00:00:00&#x27;</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">243</span>]: pd.Timestamp(<span class="string">&#x27;2014-01-31&#x27;</span>) + pd.offsets.MonthEnd(n=<span class="number">1</span>)</span><br><span class="line">Out[<span class="number">243</span>]: Timestamp(<span class="string">&#x27;2014-02-28 00:00:00&#x27;</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">244</span>]: pd.Timestamp(<span class="string">&#x27;2014-01-01&#x27;</span>) - pd.offsets.MonthBegin(n=<span class="number">1</span>)</span><br><span class="line">Out[<span class="number">244</span>]: Timestamp(<span class="string">&#x27;2013-12-01 00:00:00&#x27;</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">245</span>]: pd.Timestamp(<span class="string">&#x27;2014-01-31&#x27;</span>) - pd.offsets.MonthEnd(n=<span class="number">1</span>)</span><br><span class="line">Out[<span class="number">245</span>]: Timestamp(<span class="string">&#x27;2013-12-31 00:00:00&#x27;</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">246</span>]: pd.Timestamp(<span class="string">&#x27;2014-01-01&#x27;</span>) + pd.offsets.MonthBegin(n=<span class="number">4</span>)</span><br><span class="line">Out[<span class="number">246</span>]: Timestamp(<span class="string">&#x27;2014-05-01 00:00:00&#x27;</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">247</span>]: pd.Timestamp(<span class="string">&#x27;2014-01-31&#x27;</span>) - pd.offsets.MonthBegin(n=<span class="number">4</span>)</span><br><span class="line">Out[<span class="number">247</span>]: Timestamp(<span class="string">&#x27;2013-10-01 00:00:00&#x27;</span>)</span><br></pre></td></tr></table></figure><p><code>n=0</code> 时，如果日期在锚点，则不移动，否则将前滚至下一个锚点。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">248</span>]: pd.Timestamp(<span class="string">&#x27;2014-01-02&#x27;</span>) + pd.offsets.MonthBegin(n=<span class="number">0</span>)</span><br><span class="line">Out[<span class="number">248</span>]: Timestamp(<span class="string">&#x27;2014-02-01 00:00:00&#x27;</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">249</span>]: pd.Timestamp(<span class="string">&#x27;2014-01-02&#x27;</span>) + pd.offsets.MonthEnd(n=<span class="number">0</span>)</span><br><span class="line">Out[<span class="number">249</span>]: Timestamp(<span class="string">&#x27;2014-01-31 00:00:00&#x27;</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">250</span>]: pd.Timestamp(<span class="string">&#x27;2014-01-01&#x27;</span>) + pd.offsets.MonthBegin(n=<span class="number">0</span>)</span><br><span class="line">Out[<span class="number">250</span>]: Timestamp(<span class="string">&#x27;2014-01-01 00:00:00&#x27;</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">251</span>]: pd.Timestamp(<span class="string">&#x27;2014-01-31&#x27;</span>) + pd.offsets.MonthEnd(n=<span class="number">0</span>)</span><br><span class="line">Out[<span class="number">251</span>]: Timestamp(<span class="string">&#x27;2014-01-31 00:00:00&#x27;</span>)</span><br></pre></td></tr></table></figure><h3 id="假日与节日日历"><a href="#假日与节日日历" class="headerlink" title="假日与节日日历"></a>假日与节日日历</h3><p>用假日与日历可以轻松定义 <code>CustomBusinessDay</code> 假日规则，或其它分析所需的预设假日。<code>AbstractHolidayCalendar</code> 类支持所有返回假日列表的方法，并且仅需在指定假日日历类里定义 <code>rules</code> 。<code>start_date</code> 与 <code>end_date</code> 类属性决定了假日的范围。该操作会覆盖 <code>AbstractHolidayCalendar</code> 类，适用于所有日历子类。<code>USFederalHolidayCalendar</code> 是仅有的假日日历，主要用作开发其它日历的示例。</p><p>固定日期的假日，如美国阵亡将士纪念日或美国国庆日（7 月 4 日），取决于该假日是否是在周末，可以使用以下规则：</p><table><thead><tr><th align="center">规则</th><th align="center">说明</th></tr></thead><tbody><tr><td align="center">nearest_workday</td><td align="center">把星期六移至星期五，星期日移至星期一</td></tr><tr><td align="center">sunday_to_monday</td><td align="center">星期六紧接着星期一</td></tr><tr><td align="center">next_monday_or_tuesday</td><td align="center">把星期六移至星期一，并把星期日/星期一移至星期二</td></tr><tr><td align="center">previous_friday</td><td align="center">把星期六与星期日移至上一个星期五</td></tr><tr><td align="center">next_monday</td><td align="center">把星期六与星期日移至下一个星期一</td></tr></tbody></table><p>下例展示如何定义假日与假日日历：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">252</span>]: <span class="keyword">from</span> pandas.tseries.holiday <span class="keyword">import</span> Holiday, USMemorialDay,\</span><br><span class="line">   .....:     AbstractHolidayCalendar, nearest_workday, MO</span><br><span class="line">   .....: </span><br><span class="line"></span><br><span class="line">In [<span class="number">253</span>]: <span class="class"><span class="keyword">class</span> <span class="title">ExampleCalendar</span>(<span class="params">AbstractHolidayCalendar</span>):</span></span><br><span class="line">   .....:     rules = [</span><br><span class="line">   .....:         USMemorialDay,</span><br><span class="line">   .....:         Holiday(<span class="string">&#x27;July 4th&#x27;</span>, month=<span class="number">7</span>, day=<span class="number">4</span>, observance=nearest_workday),</span><br><span class="line">   .....:         Holiday(<span class="string">&#x27;Columbus Day&#x27;</span>, month=<span class="number">10</span>, day=<span class="number">1</span>,</span><br><span class="line">   .....:                 offset=pd.DateOffset(weekday=MO(<span class="number">2</span>)))]</span><br><span class="line">   .....: </span><br><span class="line"></span><br><span class="line">In [<span class="number">254</span>]: cal = ExampleCalendar()</span><br><span class="line"></span><br><span class="line">In [<span class="number">255</span>]: cal.holidays(datetime.datetime(<span class="number">2012</span>, <span class="number">1</span>, <span class="number">1</span>), datetime.datetime(<span class="number">2012</span>, <span class="number">12</span>, <span class="number">31</span>))</span><br><span class="line">Out[<span class="number">255</span>]: DatetimeIndex([<span class="string">&#x27;2012-05-28&#x27;</span>, <span class="string">&#x27;2012-07-04&#x27;</span>, <span class="string">&#x27;2012-10-08&#x27;</span>], dtype=<span class="string">&#x27;datetime64[ns]&#x27;</span>, freq=<span class="literal">None</span>)</span><br></pre></td></tr></table></figure><p>::: tip 提示</p><p><code>weekday=MO(2)</code> 与 <code>2 * Week(weekday=2)</code> 相同。</p><p>:::</p><p>用这个日历创建索引，或计算偏移量，将跳过周末与假日（如，纪念日与国庆节）。下列代码用 <code>ExampleCalendar</code> 设定自定义工作日偏移量。至于其它偏移量，可以用于创建 <code>DatetimeIndex</code> 或添加到 <code>datetime</code> 与 <code>Timestamp</code> 对象。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">256</span>]: pd.date_range(start=<span class="string">&#x27;7/1/2012&#x27;</span>, end=<span class="string">&#x27;7/10/2012&#x27;</span>,</span><br><span class="line">   .....:               freq=pd.offsets.CDay(calendar=cal)).to_pydatetime()</span><br><span class="line">   .....: </span><br><span class="line">Out[<span class="number">256</span>]: </span><br><span class="line">array([datetime.datetime(<span class="number">2012</span>, <span class="number">7</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">0</span>),</span><br><span class="line">       datetime.datetime(<span class="number">2012</span>, <span class="number">7</span>, <span class="number">3</span>, <span class="number">0</span>, <span class="number">0</span>),</span><br><span class="line">       datetime.datetime(<span class="number">2012</span>, <span class="number">7</span>, <span class="number">5</span>, <span class="number">0</span>, <span class="number">0</span>),</span><br><span class="line">       datetime.datetime(<span class="number">2012</span>, <span class="number">7</span>, <span class="number">6</span>, <span class="number">0</span>, <span class="number">0</span>),</span><br><span class="line">       datetime.datetime(<span class="number">2012</span>, <span class="number">7</span>, <span class="number">9</span>, <span class="number">0</span>, <span class="number">0</span>),</span><br><span class="line">       datetime.datetime(<span class="number">2012</span>, <span class="number">7</span>, <span class="number">10</span>, <span class="number">0</span>, <span class="number">0</span>)], dtype=<span class="built_in">object</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">257</span>]: offset = pd.offsets.CustomBusinessDay(calendar=cal)</span><br><span class="line"></span><br><span class="line">In [<span class="number">258</span>]: datetime.datetime(<span class="number">2012</span>, <span class="number">5</span>, <span class="number">25</span>) + offset</span><br><span class="line">Out[<span class="number">258</span>]: Timestamp(<span class="string">&#x27;2012-05-29 00:00:00&#x27;</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">259</span>]: datetime.datetime(<span class="number">2012</span>, <span class="number">7</span>, <span class="number">3</span>) + offset</span><br><span class="line">Out[<span class="number">259</span>]: Timestamp(<span class="string">&#x27;2012-07-05 00:00:00&#x27;</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">260</span>]: datetime.datetime(<span class="number">2012</span>, <span class="number">7</span>, <span class="number">3</span>) + <span class="number">2</span> * offset</span><br><span class="line">Out[<span class="number">260</span>]: Timestamp(<span class="string">&#x27;2012-07-06 00:00:00&#x27;</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">261</span>]: datetime.datetime(<span class="number">2012</span>, <span class="number">7</span>, <span class="number">6</span>) + offset</span><br><span class="line">Out[<span class="number">261</span>]: Timestamp(<span class="string">&#x27;2012-07-09 00:00:00&#x27;</span>)</span><br></pre></td></tr></table></figure><p><code>AbstractHolidayCalendar</code> 的类属性 <code>start_date</code> 与 <code>end_date</code> 定义日期范围。默认值如下：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">262</span>]: AbstractHolidayCalendar.start_date</span><br><span class="line">Out[<span class="number">262</span>]: Timestamp(<span class="string">&#x27;1970-01-01 00:00:00&#x27;</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">263</span>]: AbstractHolidayCalendar.end_date</span><br><span class="line">Out[<span class="number">263</span>]: Timestamp(<span class="string">&#x27;2030-12-31 00:00:00&#x27;</span>)</span><br></pre></td></tr></table></figure><p>这两个日期可以用 <code>datetime</code>、<code>Timestamp</code>、<code>字符串</code> 修改。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">264</span>]: AbstractHolidayCalendar.start_date = datetime.datetime(<span class="number">2012</span>, <span class="number">1</span>, <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">265</span>]: AbstractHolidayCalendar.end_date = datetime.datetime(<span class="number">2012</span>, <span class="number">12</span>, <span class="number">31</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">266</span>]: cal.holidays()</span><br><span class="line">Out[<span class="number">266</span>]: DatetimeIndex([<span class="string">&#x27;2012-05-28&#x27;</span>, <span class="string">&#x27;2012-07-04&#x27;</span>, <span class="string">&#x27;2012-10-08&#x27;</span>], dtype=<span class="string">&#x27;datetime64[ns]&#x27;</span>, freq=<span class="literal">None</span>)</span><br></pre></td></tr></table></figure><p><code>get_calender</code> 函数通过日历名称访问日历，返回的是日历实例。任意导入的日历都自动适用于此函数。同时，<code>HolidayCalendarFactory</code> 还提供了一个创建日历组合或含附加规则日历的简易接口。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">267</span>]: <span class="keyword">from</span> pandas.tseries.holiday <span class="keyword">import</span> get_calendar, HolidayCalendarFactory,\</span><br><span class="line">   .....:     USLaborDay</span><br><span class="line">   .....: </span><br><span class="line"></span><br><span class="line">In [<span class="number">268</span>]: cal = get_calendar(<span class="string">&#x27;ExampleCalendar&#x27;</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">269</span>]: cal.rules</span><br><span class="line">Out[<span class="number">269</span>]: </span><br><span class="line">[Holiday: Memorial Day (month=<span class="number">5</span>, day=<span class="number">31</span>, offset=&lt;DateOffset: weekday=MO(-<span class="number">1</span>)&gt;),</span><br><span class="line"> Holiday: July 4th (month=<span class="number">7</span>, day=<span class="number">4</span>, observance=&lt;function nearest_workday at <span class="number">0x7f2460862c20</span>&gt;),</span><br><span class="line"> Holiday: Columbus Day (month=<span class="number">10</span>, day=<span class="number">1</span>, offset=&lt;DateOffset: weekday=MO(+<span class="number">2</span>)&gt;)]</span><br><span class="line"></span><br><span class="line">In [<span class="number">270</span>]: new_cal = HolidayCalendarFactory(<span class="string">&#x27;NewExampleCalendar&#x27;</span>, cal, USLaborDay)</span><br><span class="line"></span><br><span class="line">In [<span class="number">271</span>]: new_cal.rules</span><br><span class="line">Out[<span class="number">271</span>]: </span><br><span class="line">[Holiday: Labor Day (month=<span class="number">9</span>, day=<span class="number">1</span>, offset=&lt;DateOffset: weekday=MO(+<span class="number">1</span>)&gt;),</span><br><span class="line"> Holiday: Memorial Day (month=<span class="number">5</span>, day=<span class="number">31</span>, offset=&lt;DateOffset: weekday=MO(-<span class="number">1</span>)&gt;),</span><br><span class="line"> Holiday: July 4th (month=<span class="number">7</span>, day=<span class="number">4</span>, observance=&lt;function nearest_workday at <span class="number">0x7f2460862c20</span>&gt;),</span><br><span class="line"> Holiday: Columbus Day (month=<span class="number">10</span>, day=<span class="number">1</span>, offset=&lt;DateOffset: weekday=MO(+<span class="number">2</span>)&gt;)]</span><br></pre></td></tr></table></figure><h2 id="时间序列实例方法"><a href="#时间序列实例方法" class="headerlink" title="时间序列实例方法"></a>时间序列实例方法</h2><h3 id="移位与延迟"><a href="#移位与延迟" class="headerlink" title="移位与延迟"></a>移位与延迟</h3><p>有时，需要整体向前或向后移动时间序列里的值，这就是移位与延迟。实现这一操作的方法是 <a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.Series.shift.html#pandas.Series.shift" title="pandas.Series.shift"><code>shift()</code></a>，该方法适用于所有 Pandas 对象。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">272</span>]: ts = pd.Series(<span class="built_in">range</span>(<span class="built_in">len</span>(rng)), index=rng)</span><br><span class="line"></span><br><span class="line">In [<span class="number">273</span>]: ts = ts[:<span class="number">5</span>]</span><br><span class="line"></span><br><span class="line">In [<span class="number">274</span>]: ts.shift(<span class="number">1</span>)</span><br><span class="line">Out[<span class="number">274</span>]: </span><br><span class="line"><span class="number">2012</span>-01-01    NaN</span><br><span class="line"><span class="number">2012</span>-01-02    <span class="number">0.0</span></span><br><span class="line"><span class="number">2012</span>-01-03    <span class="number">1.0</span></span><br><span class="line">Freq: D, dtype: float64</span><br></pre></td></tr></table></figure><p><code>shift</code> 方法支持 <code>freq</code> 参数，可以把 <code>DateOffset</code>、<code>timedelta</code> 对象、<a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/user_guide/timeseries.html#timeseries-offset-aliases"><code>偏移量别名</code></a> 作为参数值：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">275</span>]: ts.shift(<span class="number">5</span>, freq=pd.offsets.BDay())</span><br><span class="line">Out[<span class="number">275</span>]: </span><br><span class="line"><span class="number">2012</span>-01-06    <span class="number">0</span></span><br><span class="line"><span class="number">2012</span>-01-09    <span class="number">1</span></span><br><span class="line"><span class="number">2012</span>-01-<span class="number">10</span>    <span class="number">2</span></span><br><span class="line">Freq: B, dtype: int64</span><br><span class="line"></span><br><span class="line">In [<span class="number">276</span>]: ts.shift(<span class="number">5</span>, freq=<span class="string">&#x27;BM&#x27;</span>)</span><br><span class="line">Out[<span class="number">276</span>]: </span><br><span class="line"><span class="number">2012</span>-05-<span class="number">31</span>    <span class="number">0</span></span><br><span class="line"><span class="number">2012</span>-05-<span class="number">31</span>    <span class="number">1</span></span><br><span class="line"><span class="number">2012</span>-05-<span class="number">31</span>    <span class="number">2</span></span><br><span class="line">Freq: D, dtype: int64</span><br></pre></td></tr></table></figure><p>除更改数据与索引的对齐方式外，<code>DataFrame</code> 与 <code>Series</code> 对象还提供了 <a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.Series.tshift.html#pandas.Series.tshift" title="pandas.Series.tshift"><code>tshift()</code></a> 便捷方法，可以指定偏移量修改索引日期。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">277</span>]: ts.tshift(<span class="number">5</span>, freq=<span class="string">&#x27;D&#x27;</span>)</span><br><span class="line">Out[<span class="number">277</span>]: </span><br><span class="line"><span class="number">2012</span>-01-06    <span class="number">0</span></span><br><span class="line"><span class="number">2012</span>-01-07    <span class="number">1</span></span><br><span class="line"><span class="number">2012</span>-01-08    <span class="number">2</span></span><br><span class="line">Freq: D, dtype: int64</span><br></pre></td></tr></table></figure><p>注意，使用 <code>tshift()</code> 时，因为数据没有重对齐，<code>NaN</code> 不会排在前面。</p><h3 id="频率转换"><a href="#频率转换" class="headerlink" title="频率转换"></a>频率转换</h3><p>改变频率的函数主要是 <a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.Series.asfreq.html#pandas.Series.asfreq" title="pandas.Series.asfreq"><code>asfreq()</code></a>。对于 <code>DatetimeIndex</code>，这就是一个调用 <a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.Series.reindex.html#pandas.Series.reindex" title="pandas.Series.reindex"><code>reindex()</code></a>，并生成 <code>date_range</code> 的便捷打包器。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">278</span>]: dr = pd.date_range(<span class="string">&#x27;1/1/2010&#x27;</span>, periods=<span class="number">3</span>, freq=<span class="number">3</span> * pd.offsets.BDay())</span><br><span class="line"></span><br><span class="line">In [<span class="number">279</span>]: ts = pd.Series(np.random.randn(<span class="number">3</span>), index=dr)</span><br><span class="line"></span><br><span class="line">In [<span class="number">280</span>]: ts</span><br><span class="line">Out[<span class="number">280</span>]: </span><br><span class="line"><span class="number">2010</span>-01-01    <span class="number">1.494522</span></span><br><span class="line"><span class="number">2010</span>-01-06   -<span class="number">0.778425</span></span><br><span class="line"><span class="number">2010</span>-01-<span class="number">11</span>   -<span class="number">0.253355</span></span><br><span class="line">Freq: 3B, dtype: float64</span><br><span class="line"></span><br><span class="line">In [<span class="number">281</span>]: ts.asfreq(pd.offsets.BDay())</span><br><span class="line">Out[<span class="number">281</span>]: </span><br><span class="line"><span class="number">2010</span>-01-01    <span class="number">1.494522</span></span><br><span class="line"><span class="number">2010</span>-01-04         NaN</span><br><span class="line"><span class="number">2010</span>-01-05         NaN</span><br><span class="line"><span class="number">2010</span>-01-06   -<span class="number">0.778425</span></span><br><span class="line"><span class="number">2010</span>-01-07         NaN</span><br><span class="line"><span class="number">2010</span>-01-08         NaN</span><br><span class="line"><span class="number">2010</span>-01-<span class="number">11</span>   -<span class="number">0.253355</span></span><br><span class="line">Freq: B, dtype: float64</span><br></pre></td></tr></table></figure><p><code>asfreq</code> 用起来很方便，可以为频率转化后出现的任意间隔指定插值方法。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">282</span>]: ts.asfreq(pd.offsets.BDay(), method=<span class="string">&#x27;pad&#x27;</span>)</span><br><span class="line">Out[<span class="number">282</span>]: </span><br><span class="line"><span class="number">2010</span>-01-01    <span class="number">1.494522</span></span><br><span class="line"><span class="number">2010</span>-01-04    <span class="number">1.494522</span></span><br><span class="line"><span class="number">2010</span>-01-05    <span class="number">1.494522</span></span><br><span class="line"><span class="number">2010</span>-01-06   -<span class="number">0.778425</span></span><br><span class="line"><span class="number">2010</span>-01-07   -<span class="number">0.778425</span></span><br><span class="line"><span class="number">2010</span>-01-08   -<span class="number">0.778425</span></span><br><span class="line"><span class="number">2010</span>-01-<span class="number">11</span>   -<span class="number">0.253355</span></span><br><span class="line">Freq: B, dtype: float64</span><br></pre></td></tr></table></figure><h3 id="向前与向后填充"><a href="#向前与向后填充" class="headerlink" title="向前与向后填充"></a>向前与向后填充</h3><p>与 <code>asfreq</code> 与 <code>reindex</code> 相关的是 <a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.Series.fillna.html#pandas.Series.fillna" title="pandas.Series.fillna"><code>fillna()</code></a>，有关文档请参阅<a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/user_guide/missing_data.html#missing-data-fillna">缺失值</a>。</p><h3 id="转换-Python-日期与时间"><a href="#转换-Python-日期与时间" class="headerlink" title="转换 Python 日期与时间"></a>转换 Python 日期与时间</h3><p>用 <code>to_datetime</code> 方法可以把<code>DatetimeIndex</code> 转换为 Python 原生 <a target="_blank" rel="noopener" href="https://docs.python.org/3/library/datetime.html#datetime.datetime" title="(in Python v3.7)"><code>datetime.datetime</code></a> 对象数组。</p><h2 id="重采样"><a href="#重采样" class="headerlink" title="重采样"></a>重采样</h2><p>::: danger 警告</p><p>0.18.0 版修改了 <code>.resample</code> 接口，现在的 <code>.resample</code> 更灵活，更像 groupby。参阅<a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/whatsnew/v0.18.0.html#whatsnew-0180-breaking-resample">更新文档</a> ，对比新旧版本操作的区别。</p><p>:::</p><p>Pandas 有一个虽然简单，但却强大、高效的功能，可在频率转换时执行重采样，如，将秒数据转换为 5 分钟数据，这种操作在金融等领域里的应用非常广泛。</p><p><a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.Series.resample.html#pandas.Series.resample" title="pandas.Series.resample"><code>resample()</code></a> 是基于时间的分组操作，每个组都遵循归纳方法。参阅 <a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/user_guide/cookbook.html#cookbook-resample">Cookbook 示例</a>了解高级应用。</p><p>从 0.18.0 版开始，<code>resample()</code> 可以直接用于 <code>DataFrameGroupBy</code> 对象，参阅 <a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/user_guide/groupby.html#groupby-transform-window-resample">groupby 文档</a>。</p><p>::: tip 注意</p><p><code>.resample()</code> 类似于基于时间偏移量的 <a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.Series.rolling.html#pandas.Series.rolling" title="pandas.Series.rolling"><code>rolling()</code></a> 操作，请参阅<a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/user_guide/computation.html#stats-moments-ts-versus-resampling">这里</a>的讨论。</p><p>:::</p><h3 id="基础知识"><a href="#基础知识" class="headerlink" title="基础知识"></a>基础知识</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">283</span>]: rng = pd.date_range(<span class="string">&#x27;1/1/2012&#x27;</span>, periods=<span class="number">100</span>, freq=<span class="string">&#x27;S&#x27;</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">284</span>]: ts = pd.Series(np.random.randint(<span class="number">0</span>, <span class="number">500</span>, <span class="built_in">len</span>(rng)), index=rng)</span><br><span class="line"></span><br><span class="line">In [<span class="number">285</span>]: ts.resample(<span class="string">&#x27;5Min&#x27;</span>).<span class="built_in">sum</span>()</span><br><span class="line">Out[<span class="number">285</span>]: </span><br><span class="line"><span class="number">2012</span>-01-01    <span class="number">25103</span></span><br><span class="line">Freq: 5T, dtype: int64</span><br></pre></td></tr></table></figure><p><code>resample</code> 函数非常灵活，可以指定多种频率转换与重采样参数。</p><p>任何支持<a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/user_guide/groupby.html#groupby-dispatch">派送（dispatch）</a>的函数都可用于 <code>resample</code> 返回对象，包括 <code>sum</code>、<code>mean</code>、<code>std</code>、<code>sem</code>、<code>max</code>、<code>min</code>、<code>mid</code>、<code>median</code>、<code>first</code>、<code>last</code>、<code>ohlc</code>：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">286</span>]: ts.resample(<span class="string">&#x27;5Min&#x27;</span>).mean()</span><br><span class="line">Out[<span class="number">286</span>]: </span><br><span class="line"><span class="number">2012</span>-01-01    <span class="number">251.03</span></span><br><span class="line">Freq: 5T, dtype: float64</span><br><span class="line"></span><br><span class="line">In [<span class="number">287</span>]: ts.resample(<span class="string">&#x27;5Min&#x27;</span>).ohlc()</span><br><span class="line">Out[<span class="number">287</span>]: </span><br><span class="line">            <span class="built_in">open</span>  high  low  close</span><br><span class="line"><span class="number">2012</span>-01-01   <span class="number">308</span>   <span class="number">460</span>    <span class="number">9</span>    <span class="number">205</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">288</span>]: ts.resample(<span class="string">&#x27;5Min&#x27;</span>).<span class="built_in">max</span>()</span><br><span class="line">Out[<span class="number">288</span>]: </span><br><span class="line"><span class="number">2012</span>-01-01    <span class="number">460</span></span><br><span class="line">Freq: 5T, dtype: int64</span><br></pre></td></tr></table></figure><p>对于下采样，<code>closed</code> 可以设置为<code>left</code> 或 <code>right</code>，用于指定关闭哪一端间隔：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">289</span>]: ts.resample(<span class="string">&#x27;5Min&#x27;</span>, closed=<span class="string">&#x27;right&#x27;</span>).mean()</span><br><span class="line">Out[<span class="number">289</span>]: </span><br><span class="line"><span class="number">2011</span>-<span class="number">12</span>-<span class="number">31</span> <span class="number">23</span>:<span class="number">55</span>:<span class="number">00</span>    <span class="number">308.000000</span></span><br><span class="line"><span class="number">2012</span>-01-01 <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>    <span class="number">250.454545</span></span><br><span class="line">Freq: 5T, dtype: float64</span><br><span class="line"></span><br><span class="line">In [<span class="number">290</span>]: ts.resample(<span class="string">&#x27;5Min&#x27;</span>, closed=<span class="string">&#x27;left&#x27;</span>).mean()</span><br><span class="line">Out[<span class="number">290</span>]: </span><br><span class="line"><span class="number">2012</span>-01-01    <span class="number">251.03</span></span><br><span class="line">Freq: 5T, dtype: float64</span><br></pre></td></tr></table></figure><p><code>label</code>、<code>loffset</code> 等参数用于生成标签。<code>label</code> 指定生成的结果是否要为间隔标注起始时间。<code>loffset</code> 调整输出标签的时间。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">291</span>]: ts.resample(<span class="string">&#x27;5Min&#x27;</span>).mean()  <span class="comment"># 默认为 label=&#x27;left&#x27;</span></span><br><span class="line">Out[<span class="number">291</span>]: </span><br><span class="line"><span class="number">2012</span>-01-01    <span class="number">251.03</span></span><br><span class="line">Freq: 5T, dtype: float64</span><br><span class="line"></span><br><span class="line">In [<span class="number">292</span>]: ts.resample(<span class="string">&#x27;5Min&#x27;</span>, label=<span class="string">&#x27;left&#x27;</span>).mean()</span><br><span class="line">Out[<span class="number">292</span>]: </span><br><span class="line"><span class="number">2012</span>-01-01    <span class="number">251.03</span></span><br><span class="line">Freq: 5T, dtype: float64</span><br><span class="line"></span><br><span class="line">In [<span class="number">293</span>]: ts.resample(<span class="string">&#x27;5Min&#x27;</span>, label=<span class="string">&#x27;left&#x27;</span>, loffset=<span class="string">&#x27;1s&#x27;</span>).mean()</span><br><span class="line">Out[<span class="number">293</span>]: </span><br><span class="line"><span class="number">2012</span>-01-01 <span class="number">00</span>:<span class="number">00</span>:01    <span class="number">251.03</span></span><br><span class="line">dtype: float64</span><br></pre></td></tr></table></figure><p>::: danger 警告</p><p>除了 <code>M</code>、<code>A</code>、<code>Q</code>、<code>BM</code>、<code>BA</code>、<code>BQ</code>、<code>W</code> 的默认值是 <code>right</code> 外，其它频率偏移量的 <code>label</code> 与 <code>closed</code> 默认值都是 <code>left</code>。</p><p>这种操作可能会导致时间回溯，即后面的时间会被拉回到前面的时间，如下例的 <a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.tseries.offsets.BusinessDay.html#pandas.tseries.offsets.BusinessDay" title="pandas.tseries.offsets.BusinessDay"><code>BusinessDay</code></a> 频率所示。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">294</span>]: s = pd.date_range(<span class="string">&#x27;2000-01-01&#x27;</span>, <span class="string">&#x27;2000-01-05&#x27;</span>).to_series()</span><br><span class="line"></span><br><span class="line">In [<span class="number">295</span>]: s.iloc[<span class="number">2</span>] = pd.NaT</span><br><span class="line"></span><br><span class="line">In [<span class="number">296</span>]: s.dt.weekday_name</span><br><span class="line">Out[<span class="number">296</span>]: </span><br><span class="line"><span class="number">2000</span>-01-01     Saturday</span><br><span class="line"><span class="number">2000</span>-01-02       Sunday</span><br><span class="line"><span class="number">2000</span>-01-03          NaN</span><br><span class="line"><span class="number">2000</span>-01-04      Tuesday</span><br><span class="line"><span class="number">2000</span>-01-05    Wednesday</span><br><span class="line">Freq: D, dtype: <span class="built_in">object</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 默认为：label=&#x27;left&#x27;, closed=&#x27;left&#x27;</span></span><br><span class="line">In [<span class="number">297</span>]: s.resample(<span class="string">&#x27;B&#x27;</span>).last().dt.weekday_name</span><br><span class="line">Out[<span class="number">297</span>]: </span><br><span class="line"><span class="number">1999</span>-<span class="number">12</span>-<span class="number">31</span>       Sunday</span><br><span class="line"><span class="number">2000</span>-01-03          NaN</span><br><span class="line"><span class="number">2000</span>-01-04      Tuesday</span><br><span class="line"><span class="number">2000</span>-01-05    Wednesday</span><br><span class="line">Freq: B, dtype: <span class="built_in">object</span></span><br></pre></td></tr></table></figure><p>看到了吗？星期日被拉回到了上一个星期五。要想把星期日移至星期一，改用以下代码：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">298</span>]: s.resample(<span class="string">&#x27;B&#x27;</span>, label=<span class="string">&#x27;right&#x27;</span>, closed=<span class="string">&#x27;right&#x27;</span>).last().dt.weekday_name</span><br><span class="line">Out[<span class="number">298</span>]: </span><br><span class="line"><span class="number">2000</span>-01-03       Sunday</span><br><span class="line"><span class="number">2000</span>-01-04      Tuesday</span><br><span class="line"><span class="number">2000</span>-01-05    Wednesday</span><br><span class="line">Freq: B, dtype: <span class="built_in">object</span></span><br></pre></td></tr></table></figure><p>:::</p><p><code>axis</code> 参数的值为 <code>0</code> 或 <code>1</code>，并可指定 <code>DataFrame</code> 重采样的轴。</p><p><code>kind</code> 参数可以是 <code>timestamp</code> 或 <code>period</code>，转换为时间戳或时间段形式的索引。<code>resample</code> 默认保留输入的日期时间形式。</p><p>重采样 <code>period</code> 数据时（详情见下文），<code>convention</code> 可以设置为 <code>start</code> 或 <code>end</code>。指定低频时间段如何转换为高频时间段。</p><h3 id="上采样"><a href="#上采样" class="headerlink" title="上采样"></a>上采样</h3><p>上采样可以指定上采样的方式及插入时间间隔的 <code>limit</code> 参数：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 从秒到每 250 毫秒</span></span><br><span class="line">In [<span class="number">299</span>]: ts[:<span class="number">2</span>].resample(<span class="string">&#x27;250L&#x27;</span>).asfreq()</span><br><span class="line">Out[<span class="number">299</span>]: </span><br><span class="line"><span class="number">2012</span>-01-01 <span class="number">00</span>:<span class="number">00</span>:<span class="number">00.000</span>    <span class="number">308.0</span></span><br><span class="line"><span class="number">2012</span>-01-01 <span class="number">00</span>:<span class="number">00</span>:<span class="number">00.250</span>      NaN</span><br><span class="line"><span class="number">2012</span>-01-01 <span class="number">00</span>:<span class="number">00</span>:<span class="number">00.500</span>      NaN</span><br><span class="line"><span class="number">2012</span>-01-01 <span class="number">00</span>:<span class="number">00</span>:<span class="number">00.750</span>      NaN</span><br><span class="line"><span class="number">2012</span>-01-01 <span class="number">00</span>:<span class="number">00</span>:<span class="number">01.000</span>    <span class="number">204.0</span></span><br><span class="line">Freq: <span class="number">250L</span>, dtype: float64</span><br><span class="line"></span><br><span class="line">In [<span class="number">300</span>]: ts[:<span class="number">2</span>].resample(<span class="string">&#x27;250L&#x27;</span>).ffill()</span><br><span class="line">Out[<span class="number">300</span>]: </span><br><span class="line"><span class="number">2012</span>-01-01 <span class="number">00</span>:<span class="number">00</span>:<span class="number">00.000</span>    <span class="number">308</span></span><br><span class="line"><span class="number">2012</span>-01-01 <span class="number">00</span>:<span class="number">00</span>:<span class="number">00.250</span>    <span class="number">308</span></span><br><span class="line"><span class="number">2012</span>-01-01 <span class="number">00</span>:<span class="number">00</span>:<span class="number">00.500</span>    <span class="number">308</span></span><br><span class="line"><span class="number">2012</span>-01-01 <span class="number">00</span>:<span class="number">00</span>:<span class="number">00.750</span>    <span class="number">308</span></span><br><span class="line"><span class="number">2012</span>-01-01 <span class="number">00</span>:<span class="number">00</span>:<span class="number">01.000</span>    <span class="number">204</span></span><br><span class="line">Freq: <span class="number">250L</span>, dtype: int64</span><br><span class="line"></span><br><span class="line">In [<span class="number">301</span>]: ts[:<span class="number">2</span>].resample(<span class="string">&#x27;250L&#x27;</span>).ffill(limit=<span class="number">2</span>)</span><br><span class="line">Out[<span class="number">301</span>]: </span><br><span class="line"><span class="number">2012</span>-01-01 <span class="number">00</span>:<span class="number">00</span>:<span class="number">00.000</span>    <span class="number">308.0</span></span><br><span class="line"><span class="number">2012</span>-01-01 <span class="number">00</span>:<span class="number">00</span>:<span class="number">00.250</span>    <span class="number">308.0</span></span><br><span class="line"><span class="number">2012</span>-01-01 <span class="number">00</span>:<span class="number">00</span>:<span class="number">00.500</span>    <span class="number">308.0</span></span><br><span class="line"><span class="number">2012</span>-01-01 <span class="number">00</span>:<span class="number">00</span>:<span class="number">00.750</span>      NaN</span><br><span class="line"><span class="number">2012</span>-01-01 <span class="number">00</span>:<span class="number">00</span>:<span class="number">01.000</span>    <span class="number">204.0</span></span><br><span class="line">Freq: <span class="number">250L</span>, dtype: float64</span><br></pre></td></tr></table></figure><h3 id="稀疏重采样"><a href="#稀疏重采样" class="headerlink" title="稀疏重采样"></a>稀疏重采样</h3><p>相对于时间点总量，稀疏时间序列重采样的点要少很多。单纯上采样稀疏系列可能会生成很多中间值。未指定填充值，即 <code>fill_method</code> 是 <code>None</code> 时，中间值将填充为 <code>NaN</code>。</p><p>鉴于 <code>resample</code> 是基于时间的分组，下列这种方法可以有效重采样，只是分组不是都为 <code>NaN</code>。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">302</span>]: rng = pd.date_range(<span class="string">&#x27;2014-1-1&#x27;</span>, periods=<span class="number">100</span>, freq=<span class="string">&#x27;D&#x27;</span>) + pd.Timedelta(<span class="string">&#x27;1s&#x27;</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">303</span>]: ts = pd.Series(<span class="built_in">range</span>(<span class="number">100</span>), index=rng)</span><br></pre></td></tr></table></figure><p>对 <code>Series</code> 全范围重采样。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">304</span>]: ts.resample(<span class="string">&#x27;3T&#x27;</span>).<span class="built_in">sum</span>()</span><br><span class="line">Out[<span class="number">304</span>]: </span><br><span class="line"><span class="number">2014</span>-01-01 <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>     <span class="number">0</span></span><br><span class="line"><span class="number">2014</span>-01-01 <span class="number">00</span>:03:<span class="number">00</span>     <span class="number">0</span></span><br><span class="line"><span class="number">2014</span>-01-01 <span class="number">00</span>:06:<span class="number">00</span>     <span class="number">0</span></span><br><span class="line"><span class="number">2014</span>-01-01 <span class="number">00</span>:09:<span class="number">00</span>     <span class="number">0</span></span><br><span class="line"><span class="number">2014</span>-01-01 <span class="number">00</span>:<span class="number">12</span>:<span class="number">00</span>     <span class="number">0</span></span><br><span class="line">                       ..</span><br><span class="line"><span class="number">2014</span>-04-09 <span class="number">23</span>:<span class="number">48</span>:<span class="number">00</span>     <span class="number">0</span></span><br><span class="line"><span class="number">2014</span>-04-09 <span class="number">23</span>:<span class="number">51</span>:<span class="number">00</span>     <span class="number">0</span></span><br><span class="line"><span class="number">2014</span>-04-09 <span class="number">23</span>:<span class="number">54</span>:<span class="number">00</span>     <span class="number">0</span></span><br><span class="line"><span class="number">2014</span>-04-09 <span class="number">23</span>:<span class="number">57</span>:<span class="number">00</span>     <span class="number">0</span></span><br><span class="line"><span class="number">2014</span>-04-<span class="number">10</span> <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>    <span class="number">99</span></span><br><span class="line">Freq: 3T, Length: <span class="number">47521</span>, dtype: int64</span><br></pre></td></tr></table></figure><p>对以下包含点的分组重采样：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">305</span>]: <span class="keyword">from</span> functools <span class="keyword">import</span> partial</span><br><span class="line"></span><br><span class="line">In [<span class="number">306</span>]: <span class="keyword">from</span> pandas.tseries.frequencies <span class="keyword">import</span> to_offset</span><br><span class="line"></span><br><span class="line">In [<span class="number">307</span>]: <span class="function"><span class="keyword">def</span> <span class="title">round</span>(<span class="params">t, freq</span>):</span></span><br><span class="line">   .....:     freq = to_offset(freq)</span><br><span class="line">   .....:     <span class="keyword">return</span> pd.Timestamp((t.value // freq.delta.value) * freq.delta.value)</span><br><span class="line">   .....: </span><br><span class="line"></span><br><span class="line">In [<span class="number">308</span>]: ts.groupby(partial(<span class="built_in">round</span>, freq=<span class="string">&#x27;3T&#x27;</span>)).<span class="built_in">sum</span>()</span><br><span class="line">Out[<span class="number">308</span>]: </span><br><span class="line"><span class="number">2014</span>-01-01     <span class="number">0</span></span><br><span class="line"><span class="number">2014</span>-01-02     <span class="number">1</span></span><br><span class="line"><span class="number">2014</span>-01-03     <span class="number">2</span></span><br><span class="line"><span class="number">2014</span>-01-04     <span class="number">3</span></span><br><span class="line"><span class="number">2014</span>-01-05     <span class="number">4</span></span><br><span class="line">              ..</span><br><span class="line"><span class="number">2014</span>-04-06    <span class="number">95</span></span><br><span class="line"><span class="number">2014</span>-04-07    <span class="number">96</span></span><br><span class="line"><span class="number">2014</span>-04-08    <span class="number">97</span></span><br><span class="line"><span class="number">2014</span>-04-09    <span class="number">98</span></span><br><span class="line"><span class="number">2014</span>-04-<span class="number">10</span>    <span class="number">99</span></span><br><span class="line">Length: <span class="number">100</span>, dtype: int64</span><br></pre></td></tr></table></figure><h3 id="聚合"><a href="#聚合" class="headerlink" title="聚合"></a>聚合</h3><p>类似于<a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/getting_started/basics.html#basics-aggregate">聚合 API</a>，<a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/user_guide/groupby.html#groupby-aggregate">Groupby API</a> 及<a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/user_guide/computation.html#stats-aggregate">窗口函数 API</a>，<code>Resampler</code> 可以有选择地重采样。</p><p><code>DataFrame</code> 重采样，默认用相同函数操作所有列。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">309</span>]: df = pd.DataFrame(np.random.randn(<span class="number">1000</span>, <span class="number">3</span>),</span><br><span class="line">   .....:                   index=pd.date_range(<span class="string">&#x27;1/1/2012&#x27;</span>, freq=<span class="string">&#x27;S&#x27;</span>, periods=<span class="number">1000</span>),</span><br><span class="line">   .....:                   columns=[<span class="string">&#x27;A&#x27;</span>, <span class="string">&#x27;B&#x27;</span>, <span class="string">&#x27;C&#x27;</span>])</span><br><span class="line">   .....: </span><br><span class="line"></span><br><span class="line">In [<span class="number">310</span>]: r = df.resample(<span class="string">&#x27;3T&#x27;</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">311</span>]: r.mean()</span><br><span class="line">Out[<span class="number">311</span>]: </span><br><span class="line">                            A         B         C</span><br><span class="line"><span class="number">2012</span>-01-01 <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> -<span class="number">0.033823</span> -<span class="number">0.121514</span> -<span class="number">0.081447</span></span><br><span class="line"><span class="number">2012</span>-01-01 <span class="number">00</span>:03:<span class="number">00</span>  <span class="number">0.056909</span>  <span class="number">0.146731</span> -<span class="number">0.024320</span></span><br><span class="line"><span class="number">2012</span>-01-01 <span class="number">00</span>:06:<span class="number">00</span> -<span class="number">0.058837</span>  <span class="number">0.047046</span> -<span class="number">0.052021</span></span><br><span class="line"><span class="number">2012</span>-01-01 <span class="number">00</span>:09:<span class="number">00</span>  <span class="number">0.063123</span> -<span class="number">0.026158</span> -<span class="number">0.066533</span></span><br><span class="line"><span class="number">2012</span>-01-01 <span class="number">00</span>:<span class="number">12</span>:<span class="number">00</span>  <span class="number">0.186340</span> -<span class="number">0.003144</span>  <span class="number">0.074752</span></span><br><span class="line"><span class="number">2012</span>-01-01 <span class="number">00</span>:<span class="number">15</span>:<span class="number">00</span> -<span class="number">0.085954</span> -<span class="number">0.016287</span> -<span class="number">0.050046</span></span><br></pre></td></tr></table></figure><p>标准 <code>getitem</code> 操作可以指定的一列或多列。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">312</span>]: r[<span class="string">&#x27;A&#x27;</span>].mean()</span><br><span class="line">Out[<span class="number">312</span>]: </span><br><span class="line"><span class="number">2012</span>-01-01 <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>   -<span class="number">0.033823</span></span><br><span class="line"><span class="number">2012</span>-01-01 <span class="number">00</span>:03:<span class="number">00</span>    <span class="number">0.056909</span></span><br><span class="line"><span class="number">2012</span>-01-01 <span class="number">00</span>:06:<span class="number">00</span>   -<span class="number">0.058837</span></span><br><span class="line"><span class="number">2012</span>-01-01 <span class="number">00</span>:09:<span class="number">00</span>    <span class="number">0.063123</span></span><br><span class="line"><span class="number">2012</span>-01-01 <span class="number">00</span>:<span class="number">12</span>:<span class="number">00</span>    <span class="number">0.186340</span></span><br><span class="line"><span class="number">2012</span>-01-01 <span class="number">00</span>:<span class="number">15</span>:<span class="number">00</span>   -<span class="number">0.085954</span></span><br><span class="line">Freq: 3T, Name: A, dtype: float64</span><br><span class="line"></span><br><span class="line">In [<span class="number">313</span>]: r[[<span class="string">&#x27;A&#x27;</span>, <span class="string">&#x27;B&#x27;</span>]].mean()</span><br><span class="line">Out[<span class="number">313</span>]: </span><br><span class="line">                            A         B</span><br><span class="line"><span class="number">2012</span>-01-01 <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> -<span class="number">0.033823</span> -<span class="number">0.121514</span></span><br><span class="line"><span class="number">2012</span>-01-01 <span class="number">00</span>:03:<span class="number">00</span>  <span class="number">0.056909</span>  <span class="number">0.146731</span></span><br><span class="line"><span class="number">2012</span>-01-01 <span class="number">00</span>:06:<span class="number">00</span> -<span class="number">0.058837</span>  <span class="number">0.047046</span></span><br><span class="line"><span class="number">2012</span>-01-01 <span class="number">00</span>:09:<span class="number">00</span>  <span class="number">0.063123</span> -<span class="number">0.026158</span></span><br><span class="line"><span class="number">2012</span>-01-01 <span class="number">00</span>:<span class="number">12</span>:<span class="number">00</span>  <span class="number">0.186340</span> -<span class="number">0.003144</span></span><br><span class="line"><span class="number">2012</span>-01-01 <span class="number">00</span>:<span class="number">15</span>:<span class="number">00</span> -<span class="number">0.085954</span> -<span class="number">0.016287</span></span><br></pre></td></tr></table></figure><p>聚合还支持函数列表与字典，输出的是 <code>DataFrame</code>。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">314</span>]: r[<span class="string">&#x27;A&#x27;</span>].agg([np.<span class="built_in">sum</span>, np.mean, np.std])</span><br><span class="line">Out[<span class="number">314</span>]: </span><br><span class="line">                           <span class="built_in">sum</span>      mean       std</span><br><span class="line"><span class="number">2012</span>-01-01 <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>  -<span class="number">6.088060</span> -<span class="number">0.033823</span>  <span class="number">1.043263</span></span><br><span class="line"><span class="number">2012</span>-01-01 <span class="number">00</span>:03:<span class="number">00</span>  <span class="number">10.243678</span>  <span class="number">0.056909</span>  <span class="number">1.058534</span></span><br><span class="line"><span class="number">2012</span>-01-01 <span class="number">00</span>:06:<span class="number">00</span> -<span class="number">10.590584</span> -<span class="number">0.058837</span>  <span class="number">0.949264</span></span><br><span class="line"><span class="number">2012</span>-01-01 <span class="number">00</span>:09:<span class="number">00</span>  <span class="number">11.362228</span>  <span class="number">0.063123</span>  <span class="number">1.028096</span></span><br><span class="line"><span class="number">2012</span>-01-01 <span class="number">00</span>:<span class="number">12</span>:<span class="number">00</span>  <span class="number">33.541257</span>  <span class="number">0.186340</span>  <span class="number">0.884586</span></span><br><span class="line"><span class="number">2012</span>-01-01 <span class="number">00</span>:<span class="number">15</span>:<span class="number">00</span>  -<span class="number">8.595393</span> -<span class="number">0.085954</span>  <span class="number">1.035476</span></span><br></pre></td></tr></table></figure><p>重采样后的 <code>DataFrame</code>，可以为每列指定函数列表，生成结构化索引的聚合结果：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">315</span>]: r.agg([np.<span class="built_in">sum</span>, np.mean])</span><br><span class="line">Out[<span class="number">315</span>]: </span><br><span class="line">                             A                    B                    C          </span><br><span class="line">                           <span class="built_in">sum</span>      mean        <span class="built_in">sum</span>      mean        <span class="built_in">sum</span>      mean</span><br><span class="line"><span class="number">2012</span>-01-01 <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>  -<span class="number">6.088060</span> -<span class="number">0.033823</span> -<span class="number">21.872530</span> -<span class="number">0.121514</span> -<span class="number">14.660515</span> -<span class="number">0.081447</span></span><br><span class="line"><span class="number">2012</span>-01-01 <span class="number">00</span>:03:<span class="number">00</span>  <span class="number">10.243678</span>  <span class="number">0.056909</span>  <span class="number">26.411633</span>  <span class="number">0.146731</span>  -<span class="number">4.377642</span> -<span class="number">0.024320</span></span><br><span class="line"><span class="number">2012</span>-01-01 <span class="number">00</span>:06:<span class="number">00</span> -<span class="number">10.590584</span> -<span class="number">0.058837</span>   <span class="number">8.468289</span>  <span class="number">0.047046</span>  -<span class="number">9.363825</span> -<span class="number">0.052021</span></span><br><span class="line"><span class="number">2012</span>-01-01 <span class="number">00</span>:09:<span class="number">00</span>  <span class="number">11.362228</span>  <span class="number">0.063123</span>  -<span class="number">4.708526</span> -<span class="number">0.026158</span> -<span class="number">11.975895</span> -<span class="number">0.066533</span></span><br><span class="line"><span class="number">2012</span>-01-01 <span class="number">00</span>:<span class="number">12</span>:<span class="number">00</span>  <span class="number">33.541257</span>  <span class="number">0.186340</span>  -<span class="number">0.565895</span> -<span class="number">0.003144</span>  <span class="number">13.455299</span>  <span class="number">0.074752</span></span><br><span class="line"><span class="number">2012</span>-01-01 <span class="number">00</span>:<span class="number">15</span>:<span class="number">00</span>  -<span class="number">8.595393</span> -<span class="number">0.085954</span>  -<span class="number">1.628689</span> -<span class="number">0.016287</span>  -<span class="number">5.004580</span> -<span class="number">0.050046</span></span><br></pre></td></tr></table></figure><p>把字典传递给 <code>aggregate</code>，可以为 <code>DataFrame</code> 里不同的列应用不同聚合函数。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">316</span>]: r.agg(&#123;<span class="string">&#x27;A&#x27;</span>: np.<span class="built_in">sum</span>,</span><br><span class="line">   .....:        <span class="string">&#x27;B&#x27;</span>: <span class="keyword">lambda</span> x: np.std(x, ddof=<span class="number">1</span>)&#125;)</span><br><span class="line">   .....: </span><br><span class="line">Out[<span class="number">316</span>]: </span><br><span class="line">                             A         B</span><br><span class="line"><span class="number">2012</span>-01-01 <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>  -<span class="number">6.088060</span>  <span class="number">1.001294</span></span><br><span class="line"><span class="number">2012</span>-01-01 <span class="number">00</span>:03:<span class="number">00</span>  <span class="number">10.243678</span>  <span class="number">1.074597</span></span><br><span class="line"><span class="number">2012</span>-01-01 <span class="number">00</span>:06:<span class="number">00</span> -<span class="number">10.590584</span>  <span class="number">0.987309</span></span><br><span class="line"><span class="number">2012</span>-01-01 <span class="number">00</span>:09:<span class="number">00</span>  <span class="number">11.362228</span>  <span class="number">0.944953</span></span><br><span class="line"><span class="number">2012</span>-01-01 <span class="number">00</span>:<span class="number">12</span>:<span class="number">00</span>  <span class="number">33.541257</span>  <span class="number">1.095025</span></span><br><span class="line"><span class="number">2012</span>-01-01 <span class="number">00</span>:<span class="number">15</span>:<span class="number">00</span>  -<span class="number">8.595393</span>  <span class="number">1.035312</span></span><br></pre></td></tr></table></figure><p>还可以用字符串代替函数名。为了让字符串有效，必须在重采样对象上操作：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">317</span>]: r.agg(&#123;<span class="string">&#x27;A&#x27;</span>: <span class="string">&#x27;sum&#x27;</span>, <span class="string">&#x27;B&#x27;</span>: <span class="string">&#x27;std&#x27;</span>&#125;)</span><br><span class="line">Out[<span class="number">317</span>]: </span><br><span class="line">                             A         B</span><br><span class="line"><span class="number">2012</span>-01-01 <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>  -<span class="number">6.088060</span>  <span class="number">1.001294</span></span><br><span class="line"><span class="number">2012</span>-01-01 <span class="number">00</span>:03:<span class="number">00</span>  <span class="number">10.243678</span>  <span class="number">1.074597</span></span><br><span class="line"><span class="number">2012</span>-01-01 <span class="number">00</span>:06:<span class="number">00</span> -<span class="number">10.590584</span>  <span class="number">0.987309</span></span><br><span class="line"><span class="number">2012</span>-01-01 <span class="number">00</span>:09:<span class="number">00</span>  <span class="number">11.362228</span>  <span class="number">0.944953</span></span><br><span class="line"><span class="number">2012</span>-01-01 <span class="number">00</span>:<span class="number">12</span>:<span class="number">00</span>  <span class="number">33.541257</span>  <span class="number">1.095025</span></span><br><span class="line"><span class="number">2012</span>-01-01 <span class="number">00</span>:<span class="number">15</span>:<span class="number">00</span>  -<span class="number">8.595393</span>  <span class="number">1.035312</span></span><br></pre></td></tr></table></figure><p>甚至还可以为每列单独多个聚合函数。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">318</span>]: r.agg(&#123;<span class="string">&#x27;A&#x27;</span>: [<span class="string">&#x27;sum&#x27;</span>, <span class="string">&#x27;std&#x27;</span>], <span class="string">&#x27;B&#x27;</span>: [<span class="string">&#x27;mean&#x27;</span>, <span class="string">&#x27;std&#x27;</span>]&#125;)</span><br><span class="line">Out[<span class="number">318</span>]: </span><br><span class="line">                             A                   B          </span><br><span class="line">                           <span class="built_in">sum</span>       std      mean       std</span><br><span class="line"><span class="number">2012</span>-01-01 <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>  -<span class="number">6.088060</span>  <span class="number">1.043263</span> -<span class="number">0.121514</span>  <span class="number">1.001294</span></span><br><span class="line"><span class="number">2012</span>-01-01 <span class="number">00</span>:03:<span class="number">00</span>  <span class="number">10.243678</span>  <span class="number">1.058534</span>  <span class="number">0.146731</span>  <span class="number">1.074597</span></span><br><span class="line"><span class="number">2012</span>-01-01 <span class="number">00</span>:06:<span class="number">00</span> -<span class="number">10.590584</span>  <span class="number">0.949264</span>  <span class="number">0.047046</span>  <span class="number">0.987309</span></span><br><span class="line"><span class="number">2012</span>-01-01 <span class="number">00</span>:09:<span class="number">00</span>  <span class="number">11.362228</span>  <span class="number">1.028096</span> -<span class="number">0.026158</span>  <span class="number">0.944953</span></span><br><span class="line"><span class="number">2012</span>-01-01 <span class="number">00</span>:<span class="number">12</span>:<span class="number">00</span>  <span class="number">33.541257</span>  <span class="number">0.884586</span> -<span class="number">0.003144</span>  <span class="number">1.095025</span></span><br><span class="line"><span class="number">2012</span>-01-01 <span class="number">00</span>:<span class="number">15</span>:<span class="number">00</span>  -<span class="number">8.595393</span>  <span class="number">1.035476</span> -<span class="number">0.016287</span>  <span class="number">1.035312</span></span><br></pre></td></tr></table></figure><p>如果 <code>DataFrame</code> 用的不是 <code>datetime</code> 型索引，则可以基于 <code>datetime</code> 数据列重采样，用关键字 <code>on</code> 控制。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">319</span>]: df = pd.DataFrame(&#123;<span class="string">&#x27;date&#x27;</span>: pd.date_range(<span class="string">&#x27;2015-01-01&#x27;</span>, freq=<span class="string">&#x27;W&#x27;</span>, periods=<span class="number">5</span>),</span><br><span class="line">   .....:                    <span class="string">&#x27;a&#x27;</span>: np.arange(<span class="number">5</span>)&#125;,</span><br><span class="line">   .....:                   index=pd.MultiIndex.from_arrays([</span><br><span class="line">   .....:                       [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>],</span><br><span class="line">   .....:                       pd.date_range(<span class="string">&#x27;2015-01-01&#x27;</span>, freq=<span class="string">&#x27;W&#x27;</span>, periods=<span class="number">5</span>)],</span><br><span class="line">   .....:                       names=[<span class="string">&#x27;v&#x27;</span>, <span class="string">&#x27;d&#x27;</span>]))</span><br><span class="line">   .....: </span><br><span class="line"></span><br><span class="line">In [<span class="number">320</span>]: df</span><br><span class="line">Out[<span class="number">320</span>]: </span><br><span class="line">                   date  a</span><br><span class="line">v d                       </span><br><span class="line"><span class="number">1</span> <span class="number">2015</span>-01-04 <span class="number">2015</span>-01-04  <span class="number">0</span></span><br><span class="line"><span class="number">2</span> <span class="number">2015</span>-01-<span class="number">11</span> <span class="number">2015</span>-01-<span class="number">11</span>  <span class="number">1</span></span><br><span class="line"><span class="number">3</span> <span class="number">2015</span>-01-<span class="number">18</span> <span class="number">2015</span>-01-<span class="number">18</span>  <span class="number">2</span></span><br><span class="line"><span class="number">4</span> <span class="number">2015</span>-01-<span class="number">25</span> <span class="number">2015</span>-01-<span class="number">25</span>  <span class="number">3</span></span><br><span class="line"><span class="number">5</span> <span class="number">2015</span>-02-01 <span class="number">2015</span>-02-01  <span class="number">4</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">321</span>]: df.resample(<span class="string">&#x27;M&#x27;</span>, on=<span class="string">&#x27;date&#x27;</span>).<span class="built_in">sum</span>()</span><br><span class="line">Out[<span class="number">321</span>]: </span><br><span class="line">            a</span><br><span class="line">date         </span><br><span class="line"><span class="number">2015</span>-01-<span class="number">31</span>  <span class="number">6</span></span><br><span class="line"><span class="number">2015</span>-02-<span class="number">28</span>  <span class="number">4</span></span><br></pre></td></tr></table></figure><p>同样，还可以对 <code>datetime MultiIndex</code> 重采样，通过关键字 <code>level</code> 传递名字与位置。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">322</span>]: df.resample(<span class="string">&#x27;M&#x27;</span>, level=<span class="string">&#x27;d&#x27;</span>).<span class="built_in">sum</span>()</span><br><span class="line">Out[<span class="number">322</span>]: </span><br><span class="line">            a</span><br><span class="line">d            </span><br><span class="line"><span class="number">2015</span>-01-<span class="number">31</span>  <span class="number">6</span></span><br><span class="line"><span class="number">2015</span>-02-<span class="number">28</span>  <span class="number">4</span></span><br></pre></td></tr></table></figure><h3 id="分组迭代"><a href="#分组迭代" class="headerlink" title="分组迭代"></a>分组迭代</h3><p><code>Resampler</code>对象迭代分组数据的操作非常自然，类似于 <a target="_blank" rel="noopener" href="https://docs.python.org/3/library/itertools.html#itertools.groupby" title="(in Python v3.7)"><code>itertools.groupby()</code></a>：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">323</span>]: small = pd.Series(</span><br><span class="line">   .....:     <span class="built_in">range</span>(<span class="number">6</span>),</span><br><span class="line">   .....:     index=pd.to_datetime([<span class="string">&#x27;2017-01-01T00:00:00&#x27;</span>,</span><br><span class="line">   .....:                           <span class="string">&#x27;2017-01-01T00:30:00&#x27;</span>,</span><br><span class="line">   .....:                           <span class="string">&#x27;2017-01-01T00:31:00&#x27;</span>,</span><br><span class="line">   .....:                           <span class="string">&#x27;2017-01-01T01:00:00&#x27;</span>,</span><br><span class="line">   .....:                           <span class="string">&#x27;2017-01-01T03:00:00&#x27;</span>,</span><br><span class="line">   .....:                           <span class="string">&#x27;2017-01-01T03:05:00&#x27;</span>])</span><br><span class="line">   .....: )</span><br><span class="line">   .....: </span><br><span class="line"></span><br><span class="line">In [<span class="number">324</span>]: resampled = small.resample(<span class="string">&#x27;H&#x27;</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">325</span>]: <span class="keyword">for</span> name, group <span class="keyword">in</span> resampled:</span><br><span class="line">   .....:     <span class="built_in">print</span>(<span class="string">&quot;Group: &quot;</span>, name)</span><br><span class="line">   .....:     <span class="built_in">print</span>(<span class="string">&quot;-&quot;</span> * <span class="number">27</span>)</span><br><span class="line">   .....:     <span class="built_in">print</span>(group, end=<span class="string">&quot;\n\n&quot;</span>)</span><br><span class="line">   .....: </span><br><span class="line">Group:  <span class="number">2017</span>-01-01 <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span></span><br><span class="line">---------------------------</span><br><span class="line"><span class="number">2017</span>-01-01 <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>    <span class="number">0</span></span><br><span class="line"><span class="number">2017</span>-01-01 <span class="number">00</span>:<span class="number">30</span>:<span class="number">00</span>    <span class="number">1</span></span><br><span class="line"><span class="number">2017</span>-01-01 <span class="number">00</span>:<span class="number">31</span>:<span class="number">00</span>    <span class="number">2</span></span><br><span class="line">dtype: int64</span><br><span class="line"></span><br><span class="line">Group:  <span class="number">2017</span>-01-01 01:<span class="number">00</span>:<span class="number">00</span></span><br><span class="line">---------------------------</span><br><span class="line"><span class="number">2017</span>-01-01 01:<span class="number">00</span>:<span class="number">00</span>    <span class="number">3</span></span><br><span class="line">dtype: int64</span><br><span class="line"></span><br><span class="line">Group:  <span class="number">2017</span>-01-01 02:<span class="number">00</span>:<span class="number">00</span></span><br><span class="line">---------------------------</span><br><span class="line">Series([], dtype: int64)</span><br><span class="line"></span><br><span class="line">Group:  <span class="number">2017</span>-01-01 03:<span class="number">00</span>:<span class="number">00</span></span><br><span class="line">---------------------------</span><br><span class="line"><span class="number">2017</span>-01-01 03:<span class="number">00</span>:<span class="number">00</span>    <span class="number">4</span></span><br><span class="line"><span class="number">2017</span>-01-01 03:05:<span class="number">00</span>    <span class="number">5</span></span><br><span class="line">dtype: int64</span><br></pre></td></tr></table></figure><p>了解更多详情，请参阅<a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/user_guide/groupby.html#groupby-iterating-label">分组迭代</a>或 <a target="_blank" rel="noopener" href="https://docs.python.org/3/library/itertools.html#itertools.groupby" title="(in Python v3.7)"><code>itertools.groupby()</code></a>。</p><h2 id="时间跨度表示"><a href="#时间跨度表示" class="headerlink" title="时间跨度表示"></a>时间跨度表示</h2><p>规律时间间隔可以用 Pandas 的 <code>Peirod</code> 对象表示，<code>Period</code> 对象序列叫做 <code>PeriodIndex</code>，用便捷函数 <code>period_range</code> 创建。</p><h3 id="Period"><a href="#Period" class="headerlink" title="Period"></a>Period</h3><p><code>Period</code> 表示时间跨度，即时间段，如年、季、月、日等。关键字 <code>freq</code> 与频率别名可以指定时间段。<code>freq</code> 表示的是 <code>Period</code> 的时间跨度，不能为负，如，<code>-3D</code>。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">326</span>]: pd.Period(<span class="string">&#x27;2012&#x27;</span>, freq=<span class="string">&#x27;A-DEC&#x27;</span>)</span><br><span class="line">Out[<span class="number">326</span>]: Period(<span class="string">&#x27;2012&#x27;</span>, <span class="string">&#x27;A-DEC&#x27;</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">327</span>]: pd.Period(<span class="string">&#x27;2012-1-1&#x27;</span>, freq=<span class="string">&#x27;D&#x27;</span>)</span><br><span class="line">Out[<span class="number">327</span>]: Period(<span class="string">&#x27;2012-01-01&#x27;</span>, <span class="string">&#x27;D&#x27;</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">328</span>]: pd.Period(<span class="string">&#x27;2012-1-1 19:00&#x27;</span>, freq=<span class="string">&#x27;H&#x27;</span>)</span><br><span class="line">Out[<span class="number">328</span>]: Period(<span class="string">&#x27;2012-01-01 19:00&#x27;</span>, <span class="string">&#x27;H&#x27;</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">329</span>]: pd.Period(<span class="string">&#x27;2012-1-1 19:00&#x27;</span>, freq=<span class="string">&#x27;5H&#x27;</span>)</span><br><span class="line">Out[<span class="number">329</span>]: Period(<span class="string">&#x27;2012-01-01 19:00&#x27;</span>, <span class="string">&#x27;5H&#x27;</span>)</span><br></pre></td></tr></table></figure><p>时间段加减法按自身频率位移。 不同频率的时间段不可进行算术运算。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">330</span>]: p = pd.Period(<span class="string">&#x27;2012&#x27;</span>, freq=<span class="string">&#x27;A-DEC&#x27;</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">331</span>]: p + <span class="number">1</span></span><br><span class="line">Out[<span class="number">331</span>]: Period(<span class="string">&#x27;2013&#x27;</span>, <span class="string">&#x27;A-DEC&#x27;</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">332</span>]: p - <span class="number">3</span></span><br><span class="line">Out[<span class="number">332</span>]: Period(<span class="string">&#x27;2009&#x27;</span>, <span class="string">&#x27;A-DEC&#x27;</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">333</span>]: p = pd.Period(<span class="string">&#x27;2012-01&#x27;</span>, freq=<span class="string">&#x27;2M&#x27;</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">334</span>]: p + <span class="number">2</span></span><br><span class="line">Out[<span class="number">334</span>]: Period(<span class="string">&#x27;2012-05&#x27;</span>, <span class="string">&#x27;2M&#x27;</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">335</span>]: p - <span class="number">1</span></span><br><span class="line">Out[<span class="number">335</span>]: Period(<span class="string">&#x27;2011-11&#x27;</span>, <span class="string">&#x27;2M&#x27;</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">336</span>]: p == pd.Period(<span class="string">&#x27;2012-01&#x27;</span>, freq=<span class="string">&#x27;3M&#x27;</span>)</span><br><span class="line">---------------------------------------------------------------------------</span><br><span class="line">IncompatibleFrequency                     Traceback (most recent call last)</span><br><span class="line">&lt;ipython-<span class="built_in">input</span>-<span class="number">336</span>-4b67dc0b596c&gt; <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">----&gt; <span class="number">1</span> p == pd.Period(<span class="string">&#x27;2012-01&#x27;</span>, freq=<span class="string">&#x27;3M&#x27;</span>)</span><br><span class="line"></span><br><span class="line">/pandas/pandas/_libs/tslibs/period.pyx <span class="keyword">in</span> pandas._libs.tslibs.period._Period.__richcmp__()</span><br><span class="line"></span><br><span class="line">IncompatibleFrequency: Input has different freq=3M <span class="keyword">from</span> Period(freq=2M)</span><br></pre></td></tr></table></figure><p><code>freq</code> 的频率为日或更高频率时，如 <code>D</code>、<code>H</code>、<code>T</code>、<code>S</code>、<code>L</code>、<code>U</code>、<code>N</code>，<code>offsets</code> 与 <code>timedelta</code> 可以用相同频率实现加法。否则，会触发 <code>ValueError</code>。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">337</span>]: p = pd.Period(<span class="string">&#x27;2014-07-01 09:00&#x27;</span>, freq=<span class="string">&#x27;H&#x27;</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">338</span>]: p + pd.offsets.Hour(<span class="number">2</span>)</span><br><span class="line">Out[<span class="number">338</span>]: Period(<span class="string">&#x27;2014-07-01 11:00&#x27;</span>, <span class="string">&#x27;H&#x27;</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">339</span>]: p + datetime.timedelta(minutes=<span class="number">120</span>)</span><br><span class="line">Out[<span class="number">339</span>]: Period(<span class="string">&#x27;2014-07-01 11:00&#x27;</span>, <span class="string">&#x27;H&#x27;</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">340</span>]: p + np.timedelta64(<span class="number">7200</span>, <span class="string">&#x27;s&#x27;</span>)</span><br><span class="line">Out[<span class="number">340</span>]: Period(<span class="string">&#x27;2014-07-01 11:00&#x27;</span>, <span class="string">&#x27;H&#x27;</span>)</span><br><span class="line">In [<span class="number">1</span>]: p + pd.offsets.Minute(<span class="number">5</span>)</span><br><span class="line">Traceback</span><br><span class="line">   ...</span><br><span class="line">ValueError: Input has different freq <span class="keyword">from</span> Period(freq=H)</span><br></pre></td></tr></table></figure><p>如果 <code>Period</code> 为其它频率，只有相同频率的 <code>offsets</code> 可以相加。否则，会触发 <code>ValueError</code>。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">341</span>]: p = pd.Period(<span class="string">&#x27;2014-07&#x27;</span>, freq=<span class="string">&#x27;M&#x27;</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">342</span>]: p + pd.offsets.MonthEnd(<span class="number">3</span>)</span><br><span class="line">Out[<span class="number">342</span>]: Period(<span class="string">&#x27;2014-10&#x27;</span>, <span class="string">&#x27;M&#x27;</span>)</span><br><span class="line">In [<span class="number">1</span>]: p + pd.offsets.MonthBegin(<span class="number">3</span>)</span><br><span class="line">Traceback</span><br><span class="line">   ...</span><br><span class="line">ValueError: Input has different freq <span class="keyword">from</span> Period(freq=M)</span><br></pre></td></tr></table></figure><p>用相同频率计算不同时间段实例之间的区别，将返回这些实例之间的频率单元数量。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">343</span>]: pd.Period(<span class="string">&#x27;2012&#x27;</span>, freq=<span class="string">&#x27;A-DEC&#x27;</span>) - pd.Period(<span class="string">&#x27;2002&#x27;</span>, freq=<span class="string">&#x27;A-DEC&#x27;</span>)</span><br><span class="line">Out[<span class="number">343</span>]: &lt;<span class="number">10</span> * YearEnds: month=<span class="number">12</span>&gt;</span><br></pre></td></tr></table></figure><h3 id="PeriodIndex-与-period-range"><a href="#PeriodIndex-与-period-range" class="headerlink" title="PeriodIndex 与 period_range"></a>PeriodIndex 与 period_range</h3><p><code>period_range</code> 便捷函数可以创建有规律的 <code>Period</code> 对象序列，即 <code>PeriodIndex</code>。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">344</span>]: prng = pd.period_range(<span class="string">&#x27;1/1/2011&#x27;</span>, <span class="string">&#x27;1/1/2012&#x27;</span>, freq=<span class="string">&#x27;M&#x27;</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">345</span>]: prng</span><br><span class="line">Out[<span class="number">345</span>]: </span><br><span class="line">PeriodIndex([<span class="string">&#x27;2011-01&#x27;</span>, <span class="string">&#x27;2011-02&#x27;</span>, <span class="string">&#x27;2011-03&#x27;</span>, <span class="string">&#x27;2011-04&#x27;</span>, <span class="string">&#x27;2011-05&#x27;</span>, <span class="string">&#x27;2011-06&#x27;</span>,</span><br><span class="line">             <span class="string">&#x27;2011-07&#x27;</span>, <span class="string">&#x27;2011-08&#x27;</span>, <span class="string">&#x27;2011-09&#x27;</span>, <span class="string">&#x27;2011-10&#x27;</span>, <span class="string">&#x27;2011-11&#x27;</span>, <span class="string">&#x27;2011-12&#x27;</span>,</span><br><span class="line">             <span class="string">&#x27;2012-01&#x27;</span>],</span><br><span class="line">            dtype=<span class="string">&#x27;period[M]&#x27;</span>, freq=<span class="string">&#x27;M&#x27;</span>)</span><br></pre></td></tr></table></figure><p>也可以直接用 <code>PeriodIndex</code> 创建：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">346</span>]: pd.PeriodIndex([<span class="string">&#x27;2011-1&#x27;</span>, <span class="string">&#x27;2011-2&#x27;</span>, <span class="string">&#x27;2011-3&#x27;</span>], freq=<span class="string">&#x27;M&#x27;</span>)</span><br><span class="line">Out[<span class="number">346</span>]: PeriodIndex([<span class="string">&#x27;2011-01&#x27;</span>, <span class="string">&#x27;2011-02&#x27;</span>, <span class="string">&#x27;2011-03&#x27;</span>], dtype=<span class="string">&#x27;period[M]&#x27;</span>, freq=<span class="string">&#x27;M&#x27;</span>)</span><br></pre></td></tr></table></figure><p>频率为复数时，输出的 <code>Period</code> 序列为复数时间段。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">347</span>]: pd.period_range(start=<span class="string">&#x27;2014-01&#x27;</span>, freq=<span class="string">&#x27;3M&#x27;</span>, periods=<span class="number">4</span>)</span><br><span class="line">Out[<span class="number">347</span>]: PeriodIndex([<span class="string">&#x27;2014-01&#x27;</span>, <span class="string">&#x27;2014-04&#x27;</span>, <span class="string">&#x27;2014-07&#x27;</span>, <span class="string">&#x27;2014-10&#x27;</span>], dtype=<span class="string">&#x27;period[3M]&#x27;</span>, freq=<span class="string">&#x27;3M&#x27;</span>)</span><br></pre></td></tr></table></figure><p><code>Period</code> 对象的 <code>start</code> 或 <code>end</code> 会被当作 <code>PeriodIndex</code> 的锚定终点，其频率与 <code>PeriodIndex</code> 的频率一样。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">348</span>]: pd.period_range(start=pd.Period(<span class="string">&#x27;2017Q1&#x27;</span>, freq=<span class="string">&#x27;Q&#x27;</span>),</span><br><span class="line">   .....:                 end=pd.Period(<span class="string">&#x27;2017Q2&#x27;</span>, freq=<span class="string">&#x27;Q&#x27;</span>), freq=<span class="string">&#x27;M&#x27;</span>)</span><br><span class="line">   .....: </span><br><span class="line">Out[<span class="number">348</span>]: PeriodIndex([<span class="string">&#x27;2017-03&#x27;</span>, <span class="string">&#x27;2017-04&#x27;</span>, <span class="string">&#x27;2017-05&#x27;</span>, <span class="string">&#x27;2017-06&#x27;</span>], dtype=<span class="string">&#x27;period[M]&#x27;</span>, freq=<span class="string">&#x27;M&#x27;</span>)</span><br></pre></td></tr></table></figure><p>和 <code>DatetimeIndex</code> 一样，<code>PeriodIndex</code> 也可以作为 Pandas 对象的索引。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">349</span>]: ps = pd.Series(np.random.randn(<span class="built_in">len</span>(prng)), prng)</span><br><span class="line"></span><br><span class="line">In [<span class="number">350</span>]: ps</span><br><span class="line">Out[<span class="number">350</span>]: </span><br><span class="line"><span class="number">2011</span>-01   -<span class="number">2.916901</span></span><br><span class="line"><span class="number">2011</span>-02    <span class="number">0.514474</span></span><br><span class="line"><span class="number">2011</span>-03    <span class="number">1.346470</span></span><br><span class="line"><span class="number">2011</span>-04    <span class="number">0.816397</span></span><br><span class="line"><span class="number">2011</span>-05    <span class="number">2.258648</span></span><br><span class="line"><span class="number">2011</span>-06    <span class="number">0.494789</span></span><br><span class="line"><span class="number">2011</span>-07    <span class="number">0.301239</span></span><br><span class="line"><span class="number">2011</span>-08    <span class="number">0.464776</span></span><br><span class="line"><span class="number">2011</span>-09   -<span class="number">1.393581</span></span><br><span class="line"><span class="number">2011</span>-<span class="number">10</span>    <span class="number">0.056780</span></span><br><span class="line"><span class="number">2011</span>-<span class="number">11</span>    <span class="number">0.197035</span></span><br><span class="line"><span class="number">2011</span>-<span class="number">12</span>    <span class="number">2.261385</span></span><br><span class="line"><span class="number">2012</span>-01   -<span class="number">0.329583</span></span><br><span class="line">Freq: M, dtype: float64</span><br></pre></td></tr></table></figure><p><code>PeriodIndex</code> 的加减法与 <code>Period</code> 一样。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">351</span>]: idx = pd.period_range(<span class="string">&#x27;2014-07-01 09:00&#x27;</span>, periods=<span class="number">5</span>, freq=<span class="string">&#x27;H&#x27;</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">352</span>]: idx</span><br><span class="line">Out[<span class="number">352</span>]: </span><br><span class="line">PeriodIndex([<span class="string">&#x27;2014-07-01 09:00&#x27;</span>, <span class="string">&#x27;2014-07-01 10:00&#x27;</span>, <span class="string">&#x27;2014-07-01 11:00&#x27;</span>,</span><br><span class="line">             <span class="string">&#x27;2014-07-01 12:00&#x27;</span>, <span class="string">&#x27;2014-07-01 13:00&#x27;</span>],</span><br><span class="line">            dtype=<span class="string">&#x27;period[H]&#x27;</span>, freq=<span class="string">&#x27;H&#x27;</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">353</span>]: idx + pd.offsets.Hour(<span class="number">2</span>)</span><br><span class="line">Out[<span class="number">353</span>]: </span><br><span class="line">PeriodIndex([<span class="string">&#x27;2014-07-01 11:00&#x27;</span>, <span class="string">&#x27;2014-07-01 12:00&#x27;</span>, <span class="string">&#x27;2014-07-01 13:00&#x27;</span>,</span><br><span class="line">             <span class="string">&#x27;2014-07-01 14:00&#x27;</span>, <span class="string">&#x27;2014-07-01 15:00&#x27;</span>],</span><br><span class="line">            dtype=<span class="string">&#x27;period[H]&#x27;</span>, freq=<span class="string">&#x27;H&#x27;</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">354</span>]: idx = pd.period_range(<span class="string">&#x27;2014-07&#x27;</span>, periods=<span class="number">5</span>, freq=<span class="string">&#x27;M&#x27;</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">355</span>]: idx</span><br><span class="line">Out[<span class="number">355</span>]: PeriodIndex([<span class="string">&#x27;2014-07&#x27;</span>, <span class="string">&#x27;2014-08&#x27;</span>, <span class="string">&#x27;2014-09&#x27;</span>, <span class="string">&#x27;2014-10&#x27;</span>, <span class="string">&#x27;2014-11&#x27;</span>], dtype=<span class="string">&#x27;period[M]&#x27;</span>, freq=<span class="string">&#x27;M&#x27;</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">356</span>]: idx + pd.offsets.MonthEnd(<span class="number">3</span>)</span><br><span class="line">Out[<span class="number">356</span>]: PeriodIndex([<span class="string">&#x27;2014-10&#x27;</span>, <span class="string">&#x27;2014-11&#x27;</span>, <span class="string">&#x27;2014-12&#x27;</span>, <span class="string">&#x27;2015-01&#x27;</span>, <span class="string">&#x27;2015-02&#x27;</span>], dtype=<span class="string">&#x27;period[M]&#x27;</span>, freq=<span class="string">&#x27;M&#x27;</span>)</span><br></pre></td></tr></table></figure><p><code>PeriodIndex</code> 有自己的数据类型，即 <code>period</code>，请参阅 <a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/user_guide/timeseries.html#timeseries-period-dtype">Period 数据类型</a>。</p><h3 id="Period-数据类型"><a href="#Period-数据类型" class="headerlink" title="Period 数据类型"></a>Period 数据类型</h3><p><em>0.19.0 版新增</em>。</p><p><code>PeriodIndex</code> 的自定义数据类型是 <code>period</code>，是 Pandas 扩展数据类型，类似于<a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/user_guide/timeseries.html#timeseries-timezone-series">带时区信息的数据类型</a>（<code>datetime64[ns, tz]</code>）。</p><p><code>Period</code> 数据类型支持 <code>freq</code> 属性，还可以用 <code>period[freq]</code> 表示，如，<code>period[D]</code> 或 <code>period[M]</code>，这里用的是<a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/user_guide/timeseries.html#timeseries-offset-aliases">频率字符串</a>。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">357</span>]: pi = pd.period_range(<span class="string">&#x27;2016-01-01&#x27;</span>, periods=<span class="number">3</span>, freq=<span class="string">&#x27;M&#x27;</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">358</span>]: pi</span><br><span class="line">Out[<span class="number">358</span>]: PeriodIndex([<span class="string">&#x27;2016-01&#x27;</span>, <span class="string">&#x27;2016-02&#x27;</span>, <span class="string">&#x27;2016-03&#x27;</span>], dtype=<span class="string">&#x27;period[M]&#x27;</span>, freq=<span class="string">&#x27;M&#x27;</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">359</span>]: pi.dtype</span><br><span class="line">Out[<span class="number">359</span>]: period[M]</span><br></pre></td></tr></table></figure><p><code>period</code> 数据类型在 <code>.astype(...)</code> 里使用。允许改变 <code>PeriodIndex</code> 的 <code>freq</code>， 如 <code>.asfreq()</code>，并用 <code>to_period()</code> 把 <code>DatetimeIndex</code> 转化为 <code>PeriodIndex</code>：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 把月频改为日频</span></span><br><span class="line">In [<span class="number">360</span>]: pi.astype(<span class="string">&#x27;period[D]&#x27;</span>)</span><br><span class="line">Out[<span class="number">360</span>]: PeriodIndex([<span class="string">&#x27;2016-01-31&#x27;</span>, <span class="string">&#x27;2016-02-29&#x27;</span>, <span class="string">&#x27;2016-03-31&#x27;</span>], dtype=<span class="string">&#x27;period[D]&#x27;</span>, freq=<span class="string">&#x27;D&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 转换为 DatetimeIndex</span></span><br><span class="line">In [<span class="number">361</span>]: pi.astype(<span class="string">&#x27;datetime64[ns]&#x27;</span>)</span><br><span class="line">Out[<span class="number">361</span>]: DatetimeIndex([<span class="string">&#x27;2016-01-01&#x27;</span>, <span class="string">&#x27;2016-02-01&#x27;</span>, <span class="string">&#x27;2016-03-01&#x27;</span>], dtype=<span class="string">&#x27;datetime64[ns]&#x27;</span>, freq=<span class="string">&#x27;MS&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 转换为 PeriodIndex</span></span><br><span class="line">In [<span class="number">362</span>]: dti = pd.date_range(<span class="string">&#x27;2011-01-01&#x27;</span>, freq=<span class="string">&#x27;M&#x27;</span>, periods=<span class="number">3</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">363</span>]: dti</span><br><span class="line">Out[<span class="number">363</span>]: DatetimeIndex([<span class="string">&#x27;2011-01-31&#x27;</span>, <span class="string">&#x27;2011-02-28&#x27;</span>, <span class="string">&#x27;2011-03-31&#x27;</span>], dtype=<span class="string">&#x27;datetime64[ns]&#x27;</span>, freq=<span class="string">&#x27;M&#x27;</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">364</span>]: dti.astype(<span class="string">&#x27;period[M]&#x27;</span>)</span><br><span class="line">Out[<span class="number">364</span>]: PeriodIndex([<span class="string">&#x27;2011-01&#x27;</span>, <span class="string">&#x27;2011-02&#x27;</span>, <span class="string">&#x27;2011-03&#x27;</span>], dtype=<span class="string">&#x27;period[M]&#x27;</span>, freq=<span class="string">&#x27;M&#x27;</span>)</span><br></pre></td></tr></table></figure><h3 id="PeriodIndex-局部字符串索引"><a href="#PeriodIndex-局部字符串索引" class="headerlink" title="PeriodIndex 局部字符串索引"></a>PeriodIndex 局部字符串索引</h3><p>与 <code>DatetimeIndex</code> 一样，<code>PeriodIndex</code> 可以把日期与字符串传递给 <code>Series</code> 与 <code>DataFrame</code>。详情请参阅 <a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/user_guide/timeseries.html#timeseries-partialindexing">DatetimeIndex 局部字符串索引</a>。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">365</span>]: ps[<span class="string">&#x27;2011-01&#x27;</span>]</span><br><span class="line">Out[<span class="number">365</span>]: -<span class="number">2.9169013294054507</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">366</span>]: ps[datetime.datetime(<span class="number">2011</span>, <span class="number">12</span>, <span class="number">25</span>):]</span><br><span class="line">Out[<span class="number">366</span>]: </span><br><span class="line"><span class="number">2011</span>-<span class="number">12</span>    <span class="number">2.261385</span></span><br><span class="line"><span class="number">2012</span>-01   -<span class="number">0.329583</span></span><br><span class="line">Freq: M, dtype: float64</span><br><span class="line"></span><br><span class="line">In [<span class="number">367</span>]: ps[<span class="string">&#x27;10/31/2011&#x27;</span>:<span class="string">&#x27;12/31/2011&#x27;</span>]</span><br><span class="line">Out[<span class="number">367</span>]: </span><br><span class="line"><span class="number">2011</span>-<span class="number">10</span>    <span class="number">0.056780</span></span><br><span class="line"><span class="number">2011</span>-<span class="number">11</span>    <span class="number">0.197035</span></span><br><span class="line"><span class="number">2011</span>-<span class="number">12</span>    <span class="number">2.261385</span></span><br><span class="line">Freq: M, dtype: float64</span><br></pre></td></tr></table></figure><p>传递比 <code>PeriodIndex</code> 更低频率的字符串会返回局部切片数据。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">368</span>]: ps[<span class="string">&#x27;2011&#x27;</span>]</span><br><span class="line">Out[<span class="number">368</span>]: </span><br><span class="line"><span class="number">2011</span>-01   -<span class="number">2.916901</span></span><br><span class="line"><span class="number">2011</span>-02    <span class="number">0.514474</span></span><br><span class="line"><span class="number">2011</span>-03    <span class="number">1.346470</span></span><br><span class="line"><span class="number">2011</span>-04    <span class="number">0.816397</span></span><br><span class="line"><span class="number">2011</span>-05    <span class="number">2.258648</span></span><br><span class="line"><span class="number">2011</span>-06    <span class="number">0.494789</span></span><br><span class="line"><span class="number">2011</span>-07    <span class="number">0.301239</span></span><br><span class="line"><span class="number">2011</span>-08    <span class="number">0.464776</span></span><br><span class="line"><span class="number">2011</span>-09   -<span class="number">1.393581</span></span><br><span class="line"><span class="number">2011</span>-<span class="number">10</span>    <span class="number">0.056780</span></span><br><span class="line"><span class="number">2011</span>-<span class="number">11</span>    <span class="number">0.197035</span></span><br><span class="line"><span class="number">2011</span>-<span class="number">12</span>    <span class="number">2.261385</span></span><br><span class="line">Freq: M, dtype: float64</span><br><span class="line"></span><br><span class="line">In [<span class="number">369</span>]: dfp = pd.DataFrame(np.random.randn(<span class="number">600</span>, <span class="number">1</span>),</span><br><span class="line">   .....:                    columns=[<span class="string">&#x27;A&#x27;</span>],</span><br><span class="line">   .....:                    index=pd.period_range(<span class="string">&#x27;2013-01-01 9:00&#x27;</span>,</span><br><span class="line">   .....:                                          periods=<span class="number">600</span>,</span><br><span class="line">   .....:                                          freq=<span class="string">&#x27;T&#x27;</span>))</span><br><span class="line">   .....: </span><br><span class="line"></span><br><span class="line">In [<span class="number">370</span>]: dfp</span><br><span class="line">Out[<span class="number">370</span>]: </span><br><span class="line">                         A</span><br><span class="line"><span class="number">2013</span>-01-01 09:<span class="number">00</span> -<span class="number">0.538468</span></span><br><span class="line"><span class="number">2013</span>-01-01 09:01 -<span class="number">1.365819</span></span><br><span class="line"><span class="number">2013</span>-01-01 09:02 -<span class="number">0.969051</span></span><br><span class="line"><span class="number">2013</span>-01-01 09:03 -<span class="number">0.331152</span></span><br><span class="line"><span class="number">2013</span>-01-01 09:04 -<span class="number">0.245334</span></span><br><span class="line"><span class="meta">... </span>                   ...</span><br><span class="line"><span class="number">2013</span>-01-01 <span class="number">18</span>:<span class="number">55</span>  <span class="number">0.522460</span></span><br><span class="line"><span class="number">2013</span>-01-01 <span class="number">18</span>:<span class="number">56</span>  <span class="number">0.118710</span></span><br><span class="line"><span class="number">2013</span>-01-01 <span class="number">18</span>:<span class="number">57</span>  <span class="number">0.167517</span></span><br><span class="line"><span class="number">2013</span>-01-01 <span class="number">18</span>:<span class="number">58</span>  <span class="number">0.922883</span></span><br><span class="line"><span class="number">2013</span>-01-01 <span class="number">18</span>:<span class="number">59</span>  <span class="number">1.721104</span></span><br><span class="line"></span><br><span class="line">[<span class="number">600</span> rows x <span class="number">1</span> columns]</span><br><span class="line"></span><br><span class="line">In [<span class="number">371</span>]: dfp[<span class="string">&#x27;2013-01-01 10H&#x27;</span>]</span><br><span class="line">Out[<span class="number">371</span>]: </span><br><span class="line">                         A</span><br><span class="line"><span class="number">2013</span>-01-01 <span class="number">10</span>:<span class="number">00</span> -<span class="number">0.308975</span></span><br><span class="line"><span class="number">2013</span>-01-01 <span class="number">10</span>:01  <span class="number">0.542520</span></span><br><span class="line"><span class="number">2013</span>-01-01 <span class="number">10</span>:02  <span class="number">1.061068</span></span><br><span class="line"><span class="number">2013</span>-01-01 <span class="number">10</span>:03  <span class="number">0.754005</span></span><br><span class="line"><span class="number">2013</span>-01-01 <span class="number">10</span>:04  <span class="number">0.352933</span></span><br><span class="line"><span class="meta">... </span>                   ...</span><br><span class="line"><span class="number">2013</span>-01-01 <span class="number">10</span>:<span class="number">55</span> -<span class="number">0.865621</span></span><br><span class="line"><span class="number">2013</span>-01-01 <span class="number">10</span>:<span class="number">56</span> -<span class="number">1.167818</span></span><br><span class="line"><span class="number">2013</span>-01-01 <span class="number">10</span>:<span class="number">57</span> -<span class="number">2.081748</span></span><br><span class="line"><span class="number">2013</span>-01-01 <span class="number">10</span>:<span class="number">58</span> -<span class="number">0.527146</span></span><br><span class="line"><span class="number">2013</span>-01-01 <span class="number">10</span>:<span class="number">59</span>  <span class="number">0.802298</span></span><br><span class="line"></span><br><span class="line">[<span class="number">60</span> rows x <span class="number">1</span> columns]</span><br></pre></td></tr></table></figure><p>与 <code>DatetimeIndex</code> 一样，终点包含在结果范围之内。下例中的切片数据就是从 10:00 到 11:59。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">372</span>]: dfp[<span class="string">&#x27;2013-01-01 10H&#x27;</span>:<span class="string">&#x27;2013-01-01 11H&#x27;</span>]</span><br><span class="line">Out[<span class="number">372</span>]: </span><br><span class="line">                         A</span><br><span class="line"><span class="number">2013</span>-01-01 <span class="number">10</span>:<span class="number">00</span> -<span class="number">0.308975</span></span><br><span class="line"><span class="number">2013</span>-01-01 <span class="number">10</span>:01  <span class="number">0.542520</span></span><br><span class="line"><span class="number">2013</span>-01-01 <span class="number">10</span>:02  <span class="number">1.061068</span></span><br><span class="line"><span class="number">2013</span>-01-01 <span class="number">10</span>:03  <span class="number">0.754005</span></span><br><span class="line"><span class="number">2013</span>-01-01 <span class="number">10</span>:04  <span class="number">0.352933</span></span><br><span class="line"><span class="meta">... </span>                   ...</span><br><span class="line"><span class="number">2013</span>-01-01 <span class="number">11</span>:<span class="number">55</span> -<span class="number">0.590204</span></span><br><span class="line"><span class="number">2013</span>-01-01 <span class="number">11</span>:<span class="number">56</span>  <span class="number">1.539990</span></span><br><span class="line"><span class="number">2013</span>-01-01 <span class="number">11</span>:<span class="number">57</span> -<span class="number">1.224826</span></span><br><span class="line"><span class="number">2013</span>-01-01 <span class="number">11</span>:<span class="number">58</span>  <span class="number">0.578798</span></span><br><span class="line"><span class="number">2013</span>-01-01 <span class="number">11</span>:<span class="number">59</span> -<span class="number">0.685496</span></span><br><span class="line"></span><br><span class="line">[<span class="number">120</span> rows x <span class="number">1</span> columns]</span><br></pre></td></tr></table></figure><h3 id="频率转换与-PeriodIndex-重采样"><a href="#频率转换与-PeriodIndex-重采样" class="headerlink" title="频率转换与 PeriodIndex 重采样"></a>频率转换与 <code>PeriodIndex</code> 重采样</h3><p><code>Period</code> 与 <code>PeriodIndex</code> 的频率可以用 <code>asfreq</code> 转换。下列代码开始于 2011 财年，结束时间为十二月：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">373</span>]: p = pd.Period(<span class="string">&#x27;2011&#x27;</span>, freq=<span class="string">&#x27;A-DEC&#x27;</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">374</span>]: p</span><br><span class="line">Out[<span class="number">374</span>]: Period(<span class="string">&#x27;2011&#x27;</span>, <span class="string">&#x27;A-DEC&#x27;</span>)</span><br></pre></td></tr></table></figure><p>可以把它转换为月频。使用 <code>how</code> 参数，指定是否返回开始或结束月份。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">375</span>]: p.asfreq(<span class="string">&#x27;M&#x27;</span>, how=<span class="string">&#x27;start&#x27;</span>)</span><br><span class="line">Out[<span class="number">375</span>]: Period(<span class="string">&#x27;2011-01&#x27;</span>, <span class="string">&#x27;M&#x27;</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">376</span>]: p.asfreq(<span class="string">&#x27;M&#x27;</span>, how=<span class="string">&#x27;end&#x27;</span>)</span><br><span class="line">Out[<span class="number">376</span>]: Period(<span class="string">&#x27;2011-12&#x27;</span>, <span class="string">&#x27;M&#x27;</span>)</span><br></pre></td></tr></table></figure><p>简称 <code>s</code> 与 <code>e</code> 用起来更方便：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">377</span>]: p.asfreq(<span class="string">&#x27;M&#x27;</span>, <span class="string">&#x27;s&#x27;</span>)</span><br><span class="line">Out[<span class="number">377</span>]: Period(<span class="string">&#x27;2011-01&#x27;</span>, <span class="string">&#x27;M&#x27;</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">378</span>]: p.asfreq(<span class="string">&#x27;M&#x27;</span>, <span class="string">&#x27;e&#x27;</span>)</span><br><span class="line">Out[<span class="number">378</span>]: Period(<span class="string">&#x27;2011-12&#x27;</span>, <span class="string">&#x27;M&#x27;</span>)</span><br></pre></td></tr></table></figure><p>转换为“超级 period”，（如，年频就是季频的超级 period），自动返回包含输入时间段的超级 period：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">379</span>]: p = pd.Period(<span class="string">&#x27;2011-12&#x27;</span>, freq=<span class="string">&#x27;M&#x27;</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">380</span>]: p.asfreq(<span class="string">&#x27;A-NOV&#x27;</span>)</span><br><span class="line">Out[<span class="number">380</span>]: Period(<span class="string">&#x27;2012&#x27;</span>, <span class="string">&#x27;A-NOV&#x27;</span>)</span><br></pre></td></tr></table></figure><p>注意，因为转换年频是在十一月结束的，2011 年 12 月的月时间段实际上是 <code>2012 A-NOV</code> period。</p><p>用锚定频率转换时间段，对经济学、商业等领域里的各种季度数据特别有用。很多公司都依据其财年开始月与结束月定义季度。因此，2011 年第一个季度有可能 2010 年就开始了，也有可能 2011 年过了几个月才开始。通过锚定频率，Pandas 可以处理所有从 <code>Q-JAN</code> 至 <code>Q-DEC</code>的季度频率。</p><p><code>Q-DEC</code> 定义的是常规日历季度：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">381</span>]: p = pd.Period(<span class="string">&#x27;2012Q1&#x27;</span>, freq=<span class="string">&#x27;Q-DEC&#x27;</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">382</span>]: p.asfreq(<span class="string">&#x27;D&#x27;</span>, <span class="string">&#x27;s&#x27;</span>)</span><br><span class="line">Out[<span class="number">382</span>]: Period(<span class="string">&#x27;2012-01-01&#x27;</span>, <span class="string">&#x27;D&#x27;</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">383</span>]: p.asfreq(<span class="string">&#x27;D&#x27;</span>, <span class="string">&#x27;e&#x27;</span>)</span><br><span class="line">Out[<span class="number">383</span>]: Period(<span class="string">&#x27;2012-03-31&#x27;</span>, <span class="string">&#x27;D&#x27;</span>)</span><br></pre></td></tr></table></figure><p><code>Q-MAR</code> 定义的是财年结束于三月：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">384</span>]: p = pd.Period(<span class="string">&#x27;2011Q4&#x27;</span>, freq=<span class="string">&#x27;Q-MAR&#x27;</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">385</span>]: p.asfreq(<span class="string">&#x27;D&#x27;</span>, <span class="string">&#x27;s&#x27;</span>)</span><br><span class="line">Out[<span class="number">385</span>]: Period(<span class="string">&#x27;2011-01-01&#x27;</span>, <span class="string">&#x27;D&#x27;</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">386</span>]: p.asfreq(<span class="string">&#x27;D&#x27;</span>, <span class="string">&#x27;e&#x27;</span>)</span><br><span class="line">Out[<span class="number">386</span>]: Period(<span class="string">&#x27;2011-03-31&#x27;</span>, <span class="string">&#x27;D&#x27;</span>)</span><br></pre></td></tr></table></figure><h3 id="不同表现形式之间的转换"><a href="#不同表现形式之间的转换" class="headerlink" title="不同表现形式之间的转换"></a>不同表现形式之间的转换</h3><p><code>to_period</code> 把时间戳转换为 <code>PeriodIndex</code>，<code>to_timestamp</code> 则执行反向操作。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">387</span>]: rng = pd.date_range(<span class="string">&#x27;1/1/2012&#x27;</span>, periods=<span class="number">5</span>, freq=<span class="string">&#x27;M&#x27;</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">388</span>]: ts = pd.Series(np.random.randn(<span class="built_in">len</span>(rng)), index=rng)</span><br><span class="line"></span><br><span class="line">In [<span class="number">389</span>]: ts</span><br><span class="line">Out[<span class="number">389</span>]: </span><br><span class="line"><span class="number">2012</span>-01-<span class="number">31</span>    <span class="number">1.931253</span></span><br><span class="line"><span class="number">2012</span>-02-<span class="number">29</span>   -<span class="number">0.184594</span></span><br><span class="line"><span class="number">2012</span>-03-<span class="number">31</span>    <span class="number">0.249656</span></span><br><span class="line"><span class="number">2012</span>-04-<span class="number">30</span>   -<span class="number">0.978151</span></span><br><span class="line"><span class="number">2012</span>-05-<span class="number">31</span>   -<span class="number">0.873389</span></span><br><span class="line">Freq: M, dtype: float64</span><br><span class="line"></span><br><span class="line">In [<span class="number">390</span>]: ps = ts.to_period()</span><br><span class="line"></span><br><span class="line">In [<span class="number">391</span>]: ps</span><br><span class="line">Out[<span class="number">391</span>]: </span><br><span class="line"><span class="number">2012</span>-01    <span class="number">1.931253</span></span><br><span class="line"><span class="number">2012</span>-02   -<span class="number">0.184594</span></span><br><span class="line"><span class="number">2012</span>-03    <span class="number">0.249656</span></span><br><span class="line"><span class="number">2012</span>-04   -<span class="number">0.978151</span></span><br><span class="line"><span class="number">2012</span>-05   -<span class="number">0.873389</span></span><br><span class="line">Freq: M, dtype: float64</span><br><span class="line"></span><br><span class="line">In [<span class="number">392</span>]: ps.to_timestamp()</span><br><span class="line">Out[<span class="number">392</span>]: </span><br><span class="line"><span class="number">2012</span>-01-01    <span class="number">1.931253</span></span><br><span class="line"><span class="number">2012</span>-02-01   -<span class="number">0.184594</span></span><br><span class="line"><span class="number">2012</span>-03-01    <span class="number">0.249656</span></span><br><span class="line"><span class="number">2012</span>-04-01   -<span class="number">0.978151</span></span><br><span class="line"><span class="number">2012</span>-05-01   -<span class="number">0.873389</span></span><br><span class="line">Freq: MS, dtype: float64</span><br></pre></td></tr></table></figure><p>记住 <code>s</code> 与 <code>e</code> 返回 <code>period</code> 开始或结束的时间戳：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">393</span>]: ps.to_timestamp(<span class="string">&#x27;D&#x27;</span>, how=<span class="string">&#x27;s&#x27;</span>)</span><br><span class="line">Out[<span class="number">393</span>]: </span><br><span class="line"><span class="number">2012</span>-01-01    <span class="number">1.931253</span></span><br><span class="line"><span class="number">2012</span>-02-01   -<span class="number">0.184594</span></span><br><span class="line"><span class="number">2012</span>-03-01    <span class="number">0.249656</span></span><br><span class="line"><span class="number">2012</span>-04-01   -<span class="number">0.978151</span></span><br><span class="line"><span class="number">2012</span>-05-01   -<span class="number">0.873389</span></span><br><span class="line">Freq: MS, dtype: float64</span><br></pre></td></tr></table></figure><p>用便捷算数函数可以转换时间段与时间戳。下例中，把以 11 月年度结束的季频转换为以下一个季度月末上午 9 点：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">394</span>]: prng = pd.period_range(<span class="string">&#x27;1990Q1&#x27;</span>, <span class="string">&#x27;2000Q4&#x27;</span>, freq=<span class="string">&#x27;Q-NOV&#x27;</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">395</span>]: ts = pd.Series(np.random.randn(<span class="built_in">len</span>(prng)), prng)</span><br><span class="line"></span><br><span class="line">In [<span class="number">396</span>]: ts.index = (prng.asfreq(<span class="string">&#x27;M&#x27;</span>, <span class="string">&#x27;e&#x27;</span>) + <span class="number">1</span>).asfreq(<span class="string">&#x27;H&#x27;</span>, <span class="string">&#x27;s&#x27;</span>) + <span class="number">9</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">397</span>]: ts.head()</span><br><span class="line">Out[<span class="number">397</span>]: </span><br><span class="line"><span class="number">1990</span>-03-01 09:<span class="number">00</span>   -<span class="number">0.109291</span></span><br><span class="line"><span class="number">1990</span>-06-01 09:<span class="number">00</span>   -<span class="number">0.637235</span></span><br><span class="line"><span class="number">1990</span>-09-01 09:<span class="number">00</span>   -<span class="number">1.735925</span></span><br><span class="line"><span class="number">1990</span>-<span class="number">12</span>-01 09:<span class="number">00</span>    <span class="number">2.096946</span></span><br><span class="line"><span class="number">1991</span>-03-01 09:<span class="number">00</span>   -<span class="number">1.039926</span></span><br><span class="line">Freq: H, dtype: float64</span><br></pre></td></tr></table></figure><h2 id="界外跨度表示"><a href="#界外跨度表示" class="headerlink" title="界外跨度表示"></a>界外跨度表示</h2><p>数据在 <code>Timestamp</code> 限定边界外时，参阅 <a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/user_guide/timeseries.html#timeseries-timestamp-limits">Timestamp 限制</a>，可以用 <code>PeriodIndex</code> 或 <code>Periods</code> 的 <code>Series</code> 执行计算。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">398</span>]: span = pd.period_range(<span class="string">&#x27;1215-01-01&#x27;</span>, <span class="string">&#x27;1381-01-01&#x27;</span>, freq=<span class="string">&#x27;D&#x27;</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">399</span>]: span</span><br><span class="line">Out[<span class="number">399</span>]: </span><br><span class="line">PeriodIndex([<span class="string">&#x27;1215-01-01&#x27;</span>, <span class="string">&#x27;1215-01-02&#x27;</span>, <span class="string">&#x27;1215-01-03&#x27;</span>, <span class="string">&#x27;1215-01-04&#x27;</span>,</span><br><span class="line">             <span class="string">&#x27;1215-01-05&#x27;</span>, <span class="string">&#x27;1215-01-06&#x27;</span>, <span class="string">&#x27;1215-01-07&#x27;</span>, <span class="string">&#x27;1215-01-08&#x27;</span>,</span><br><span class="line">             <span class="string">&#x27;1215-01-09&#x27;</span>, <span class="string">&#x27;1215-01-10&#x27;</span>,</span><br><span class="line">             ...</span><br><span class="line">             <span class="string">&#x27;1380-12-23&#x27;</span>, <span class="string">&#x27;1380-12-24&#x27;</span>, <span class="string">&#x27;1380-12-25&#x27;</span>, <span class="string">&#x27;1380-12-26&#x27;</span>,</span><br><span class="line">             <span class="string">&#x27;1380-12-27&#x27;</span>, <span class="string">&#x27;1380-12-28&#x27;</span>, <span class="string">&#x27;1380-12-29&#x27;</span>, <span class="string">&#x27;1380-12-30&#x27;</span>,</span><br><span class="line">             <span class="string">&#x27;1380-12-31&#x27;</span>, <span class="string">&#x27;1381-01-01&#x27;</span>],</span><br><span class="line">            dtype=<span class="string">&#x27;period[D]&#x27;</span>, length=<span class="number">60632</span>, freq=<span class="string">&#x27;D&#x27;</span>)</span><br></pre></td></tr></table></figure><p>从基于 <code>int64</code> 的 <code>YYYYMMDD</code> 表示形式转换。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">400</span>]: s = pd.Series([<span class="number">20121231</span>, <span class="number">20141130</span>, <span class="number">99991231</span>])</span><br><span class="line"></span><br><span class="line">In [<span class="number">401</span>]: s</span><br><span class="line">Out[<span class="number">401</span>]: </span><br><span class="line"><span class="number">0</span>    <span class="number">20121231</span></span><br><span class="line"><span class="number">1</span>    <span class="number">20141130</span></span><br><span class="line"><span class="number">2</span>    <span class="number">99991231</span></span><br><span class="line">dtype: int64</span><br><span class="line"></span><br><span class="line">In [<span class="number">402</span>]: <span class="function"><span class="keyword">def</span> <span class="title">conv</span>(<span class="params">x</span>):</span></span><br><span class="line">   .....:     <span class="keyword">return</span> pd.Period(year=x // <span class="number">10000</span>, month=x // <span class="number">100</span> % <span class="number">100</span>,</span><br><span class="line">   .....:                      day=x % <span class="number">100</span>, freq=<span class="string">&#x27;D&#x27;</span>)</span><br><span class="line">   .....: </span><br><span class="line"></span><br><span class="line">In [<span class="number">403</span>]: s.apply(conv)</span><br><span class="line">Out[<span class="number">403</span>]: </span><br><span class="line"><span class="number">0</span>    <span class="number">2012</span>-<span class="number">12</span>-<span class="number">31</span></span><br><span class="line"><span class="number">1</span>    <span class="number">2014</span>-<span class="number">11</span>-<span class="number">30</span></span><br><span class="line"><span class="number">2</span>    <span class="number">9999</span>-<span class="number">12</span>-<span class="number">31</span></span><br><span class="line">dtype: period[D]</span><br><span class="line"></span><br><span class="line">In [<span class="number">404</span>]: s.apply(conv)[<span class="number">2</span>]</span><br><span class="line">Out[<span class="number">404</span>]: Period(<span class="string">&#x27;9999-12-31&#x27;</span>, <span class="string">&#x27;D&#x27;</span>)</span><br></pre></td></tr></table></figure><p>轻轻松松就可以这些数据转换成 <code>PeriodIndex</code>：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">405</span>]: span = pd.PeriodIndex(s.apply(conv))</span><br><span class="line"></span><br><span class="line">In [<span class="number">406</span>]: span</span><br><span class="line">Out[<span class="number">406</span>]: PeriodIndex([<span class="string">&#x27;2012-12-31&#x27;</span>, <span class="string">&#x27;2014-11-30&#x27;</span>, <span class="string">&#x27;9999-12-31&#x27;</span>], dtype=<span class="string">&#x27;period[D]&#x27;</span>, freq=<span class="string">&#x27;D&#x27;</span>)</span><br></pre></td></tr></table></figure><h2 id="时区控制"><a href="#时区控制" class="headerlink" title="时区控制"></a>时区控制</h2><p>利用 <code>pytz</code> 与 <code>datetuil</code> 或标准库 <code>datetime.timezone</code> 对象，Pandas 能以多种方式处理不同时区的时间戳。</p><h3 id="处理时区"><a href="#处理时区" class="headerlink" title="处理时区"></a>处理时区</h3><p>Pandas 对象默认不支持时区信息：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">407</span>]: rng = pd.date_range(<span class="string">&#x27;3/6/2012 00:00&#x27;</span>, periods=<span class="number">15</span>, freq=<span class="string">&#x27;D&#x27;</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">408</span>]: rng.tz <span class="keyword">is</span> <span class="literal">None</span></span><br><span class="line">Out[<span class="number">408</span>]: <span class="literal">True</span></span><br></pre></td></tr></table></figure><p>用 <a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.date_range.html#pandas.date_range" title="pandas.date_range"><code>date_range()</code></a>、<a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.Timestamp.html#pandas.Timestamp" title="pandas.Timestamp"><code>Timestamp</code></a> 、<a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DatetimeIndex.html#pandas.DatetimeIndex" title="pandas.DatetimeIndex"><code>DatetimeIndex</code></a> 的 <code>tz_localize</code> 方法或 <code>tz</code> 关键字参数，可以为这些日期加上本地时区，即，把指定时区分配给不带时区的日期。还可以传递 <code>pytz</code> 、 <code>dateutil</code> 时区对象或奥尔森时区数据库字符串。奥尔森时区字符串默认返回 <code>pytz</code> 时区对象。要返回 <code>dateutil</code> 时区对象，在字符串前加上 <code>datetuil/</code>。</p><ul><li><p>用 <code>from pytz import common_timezones, all_timezones</code> 在 <code>pytz</code> 里查找通用时区。</p></li><li><p><code>dateutil</code> 使用操作系统时区，没有固定的列表，其通用时区名与 <code>pytz</code> 相同。</p></li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">409</span>]: <span class="keyword">import</span> dateutil</span><br><span class="line"></span><br><span class="line"><span class="comment"># pytz</span></span><br><span class="line">In [<span class="number">410</span>]: rng_pytz = pd.date_range(<span class="string">&#x27;3/6/2012 00:00&#x27;</span>, periods=<span class="number">3</span>, freq=<span class="string">&#x27;D&#x27;</span>,</span><br><span class="line">   .....:                          tz=<span class="string">&#x27;Europe/London&#x27;</span>)</span><br><span class="line">   .....: </span><br><span class="line"></span><br><span class="line">In [<span class="number">411</span>]: rng_pytz.tz</span><br><span class="line">Out[<span class="number">411</span>]: &lt;DstTzInfo <span class="string">&#x27;Europe/London&#x27;</span> LMT-<span class="number">1</span> day, <span class="number">23</span>:<span class="number">59</span>:<span class="number">00</span> STD&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># dateutil</span></span><br><span class="line">In [<span class="number">412</span>]: rng_dateutil = pd.date_range(<span class="string">&#x27;3/6/2012 00:00&#x27;</span>, periods=<span class="number">3</span>, freq=<span class="string">&#x27;D&#x27;</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">413</span>]: rng_dateutil = rng_dateutil.tz_localize(<span class="string">&#x27;dateutil/Europe/London&#x27;</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">414</span>]: rng_dateutil.tz</span><br><span class="line">Out[<span class="number">414</span>]: tzfile(<span class="string">&#x27;/usr/share/zoneinfo/Europe/London&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># dateutil - utc special case</span></span><br><span class="line">In [<span class="number">415</span>]: rng_utc = pd.date_range(<span class="string">&#x27;3/6/2012 00:00&#x27;</span>, periods=<span class="number">3</span>, freq=<span class="string">&#x27;D&#x27;</span>,</span><br><span class="line">   .....:                         tz=dateutil.tz.tzutc())</span><br><span class="line">   .....: </span><br><span class="line"></span><br><span class="line">In [<span class="number">416</span>]: rng_utc.tz</span><br><span class="line">Out[<span class="number">416</span>]: tzutc()</span><br></pre></td></tr></table></figure><p><em>0.25.0 版新增。</em></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># datetime.timezone</span></span><br><span class="line">In [<span class="number">417</span>]: rng_utc = pd.date_range(<span class="string">&#x27;3/6/2012 00:00&#x27;</span>, periods=<span class="number">3</span>, freq=<span class="string">&#x27;D&#x27;</span>,</span><br><span class="line">   .....:                         tz=datetime.timezone.utc)</span><br><span class="line">   .....: </span><br><span class="line"></span><br><span class="line">In [<span class="number">418</span>]: rng_utc.tz</span><br><span class="line">Out[<span class="number">418</span>]: datetime.timezone.utc</span><br></pre></td></tr></table></figure><p>注意， <code>dateutil</code> 的 <code>UTC</code> 时区是个特例，要显式地创建 <code>dateutil.tz.tzutc</code> 实例。可以先创建其它时区对象。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">419</span>]: <span class="keyword">import</span> pytz</span><br><span class="line"></span><br><span class="line"><span class="comment"># pytz</span></span><br><span class="line">In [<span class="number">420</span>]: tz_pytz = pytz.timezone(<span class="string">&#x27;Europe/London&#x27;</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">421</span>]: rng_pytz = pd.date_range(<span class="string">&#x27;3/6/2012 00:00&#x27;</span>, periods=<span class="number">3</span>, freq=<span class="string">&#x27;D&#x27;</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">422</span>]: rng_pytz = rng_pytz.tz_localize(tz_pytz)</span><br><span class="line"></span><br><span class="line">In [<span class="number">423</span>]: rng_pytz.tz == tz_pytz</span><br><span class="line">Out[<span class="number">423</span>]: <span class="literal">True</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># dateutil</span></span><br><span class="line">In [<span class="number">424</span>]: tz_dateutil = dateutil.tz.gettz(<span class="string">&#x27;Europe/London&#x27;</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">425</span>]: rng_dateutil = pd.date_range(<span class="string">&#x27;3/6/2012 00:00&#x27;</span>, periods=<span class="number">3</span>, freq=<span class="string">&#x27;D&#x27;</span>,</span><br><span class="line">   .....:                              tz=tz_dateutil)</span><br><span class="line">   .....: </span><br><span class="line"></span><br><span class="line">In [<span class="number">426</span>]: rng_dateutil.tz == tz_dateutil</span><br><span class="line">Out[<span class="number">426</span>]: <span class="literal">True</span></span><br></pre></td></tr></table></figure><p>不同时区之间转换带时区的 Pandas 对象时，用 <code>tz_convert</code> 方法。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">427</span>]: rng_pytz.tz_convert(<span class="string">&#x27;US/Eastern&#x27;</span>)</span><br><span class="line">Out[<span class="number">427</span>]: </span><br><span class="line">DatetimeIndex([<span class="string">&#x27;2012-03-05 19:00:00-05:00&#x27;</span>, <span class="string">&#x27;2012-03-06 19:00:00-05:00&#x27;</span>,</span><br><span class="line">               <span class="string">&#x27;2012-03-07 19:00:00-05:00&#x27;</span>],</span><br><span class="line">              dtype=<span class="string">&#x27;datetime64[ns, US/Eastern]&#x27;</span>, freq=<span class="string">&#x27;D&#x27;</span>)</span><br></pre></td></tr></table></figure><p>::: tip 注意</p><p>使用 <code>pytz</code> 时区时，对于相同的输入时区，<a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DatetimeIndex.html#pandas.DatetimeIndex" title="pandas.DatetimeIndex"><code>DatetimeIndex</code></a> 会构建一个与 <a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.Timestamp.html#pandas.Timestamp" title="pandas.Timestamp"><code>Timestamp</code></a> 不同的时区对象。<a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DatetimeIndex.html#pandas.DatetimeIndex" title="pandas.DatetimeIndex"><code>DatetimeIndex</code></a> 具有一组 <a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.Timestamp.html#pandas.Timestamp" title="pandas.Timestamp"><code>Timestamp</code></a> 对象，UTC 偏移量也不同，不能用一个 <code>pytz</code> 时区实例简洁地表示，<a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.Timestamp.html#pandas.Timestamp" title="pandas.Timestamp"><code>Timestamp</code></a> 则可以用来指定 UTC 偏移量表示一个时点。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">428</span>]: dti = pd.date_range(<span class="string">&#x27;2019-01-01&#x27;</span>, periods=<span class="number">3</span>, freq=<span class="string">&#x27;D&#x27;</span>, tz=<span class="string">&#x27;US/Pacific&#x27;</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">429</span>]: dti.tz</span><br><span class="line">Out[<span class="number">429</span>]: &lt;DstTzInfo <span class="string">&#x27;US/Pacific&#x27;</span> LMT-<span class="number">1</span> day, <span class="number">16</span>:07:<span class="number">00</span> STD&gt;</span><br><span class="line"></span><br><span class="line">In [<span class="number">430</span>]: ts = pd.Timestamp(<span class="string">&#x27;2019-01-01&#x27;</span>, tz=<span class="string">&#x27;US/Pacific&#x27;</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">431</span>]: ts.tz</span><br><span class="line">Out[<span class="number">431</span>]: &lt;DstTzInfo <span class="string">&#x27;US/Pacific&#x27;</span> PST-<span class="number">1</span> day, <span class="number">16</span>:<span class="number">00</span>:<span class="number">00</span> STD&gt;</span><br></pre></td></tr></table></figure><p>:::</p><p>::: danger 警告</p><p>注意不同支持库之间的转换。一些时区，<code>pytz</code> 与 <code>datetuil</code> 对时区的定义不一样。与 <code>US/Eastern</code> 等“标准”时区相比，那些更少见的时区的问题更严重。</p><p>:::</p><p>::: danger 警告</p><p>注意不同版本时区支持库对时区的定义并不一致。在处理本地存储数据时使用一种版本的支持库，在运算时使用另一种版本的支持库，可能会引起问题。参阅<a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/user_guide/io.html#io-hdf5-notes">本文</a>了解如何处理这种问题。</p><p>:::</p><p>::: danger 警告</p><p>对于 <code>pytz</code> 时区，直接把时区对象传递给 <code>datetime.datetime</code> 构建器是不对的，如，<code>datetime.datetime(2011, 1, 1, tz=pytz.timezone(&#39;US/Eastern&#39;))</code>。反之，datetime 要在 <code>pytz</code> 时区对象上使用 <code>localize</code> 方法。</p><p>:::</p><p>在后台，所有 Timestamp 都存储为 UTC。含时区信息的 <a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DatetimeIndex.html#pandas.DatetimeIndex" title="pandas.DatetimeIndex"><code>DatetimeIndex</code></a> 或 <a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.Timestamp.html#pandas.Timestamp" title="pandas.Timestamp"><code>Timestamp</code></a> 的值有其自己的本地化时区字段（日、小时、分钟等）。不过，对于不同时区时间戳，如果其 UTC 值相同，将被视作是相等的时间。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">432</span>]: rng_eastern = rng_utc.tz_convert(<span class="string">&#x27;US/Eastern&#x27;</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">433</span>]: rng_berlin = rng_utc.tz_convert(<span class="string">&#x27;Europe/Berlin&#x27;</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">434</span>]: rng_eastern[<span class="number">2</span>]</span><br><span class="line">Out[<span class="number">434</span>]: Timestamp(<span class="string">&#x27;2012-03-07 19:00:00-0500&#x27;</span>, tz=<span class="string">&#x27;US/Eastern&#x27;</span>, freq=<span class="string">&#x27;D&#x27;</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">435</span>]: rng_berlin[<span class="number">2</span>]</span><br><span class="line">Out[<span class="number">435</span>]: Timestamp(<span class="string">&#x27;2012-03-08 01:00:00+0100&#x27;</span>, tz=<span class="string">&#x27;Europe/Berlin&#x27;</span>, freq=<span class="string">&#x27;D&#x27;</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">436</span>]: rng_eastern[<span class="number">2</span>] == rng_berlin[<span class="number">2</span>]</span><br><span class="line">Out[<span class="number">436</span>]: <span class="literal">True</span></span><br></pre></td></tr></table></figure><p>不同时区 <a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.Series.html#pandas.Series" title="pandas.Series"><code>Series</code></a> 之间的操作生成的是与 UTC 时间戳数据对齐的 UTC <a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.Series.html#pandas.Series" title="pandas.Series"><code>Series</code></a>。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">437</span>]: ts_utc = pd.Series(<span class="built_in">range</span>(<span class="number">3</span>), pd.date_range(<span class="string">&#x27;20130101&#x27;</span>, periods=<span class="number">3</span>, tz=<span class="string">&#x27;UTC&#x27;</span>))</span><br><span class="line"></span><br><span class="line">In [<span class="number">438</span>]: eastern = ts_utc.tz_convert(<span class="string">&#x27;US/Eastern&#x27;</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">439</span>]: berlin = ts_utc.tz_convert(<span class="string">&#x27;Europe/Berlin&#x27;</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">440</span>]: result = eastern + berlin</span><br><span class="line"></span><br><span class="line">In [<span class="number">441</span>]: result</span><br><span class="line">Out[<span class="number">441</span>]: </span><br><span class="line"><span class="number">2013</span>-01-01 <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>+<span class="number">00</span>:<span class="number">00</span>    <span class="number">0</span></span><br><span class="line"><span class="number">2013</span>-01-02 <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>+<span class="number">00</span>:<span class="number">00</span>    <span class="number">2</span></span><br><span class="line"><span class="number">2013</span>-01-03 <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>+<span class="number">00</span>:<span class="number">00</span>    <span class="number">4</span></span><br><span class="line">Freq: D, dtype: int64</span><br><span class="line"></span><br><span class="line">In [<span class="number">442</span>]: result.index</span><br><span class="line">Out[<span class="number">442</span>]: </span><br><span class="line">DatetimeIndex([<span class="string">&#x27;2013-01-01 00:00:00+00:00&#x27;</span>, <span class="string">&#x27;2013-01-02 00:00:00+00:00&#x27;</span>,</span><br><span class="line">               <span class="string">&#x27;2013-01-03 00:00:00+00:00&#x27;</span>],</span><br><span class="line">              dtype=<span class="string">&#x27;datetime64[ns, UTC]&#x27;</span>, freq=<span class="string">&#x27;D&#x27;</span>)</span><br></pre></td></tr></table></figure><p>用 <code>tz_localize(None)</code> 或 <code>tz_convert(None)</code> 去掉时区信息。<code>tz_localize(None)</code> 去掉带本地时间表示的时区信息。<code>tz_convert(None)</code>先把时间戳转为 UTC 时间，再去掉时区信息。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">443</span>]: didx = pd.date_range(start=<span class="string">&#x27;2014-08-01 09:00&#x27;</span>, freq=<span class="string">&#x27;H&#x27;</span>,</span><br><span class="line">   .....:                      periods=<span class="number">3</span>, tz=<span class="string">&#x27;US/Eastern&#x27;</span>)</span><br><span class="line">   .....: </span><br><span class="line"></span><br><span class="line">In [<span class="number">444</span>]: didx</span><br><span class="line">Out[<span class="number">444</span>]: </span><br><span class="line">DatetimeIndex([<span class="string">&#x27;2014-08-01 09:00:00-04:00&#x27;</span>, <span class="string">&#x27;2014-08-01 10:00:00-04:00&#x27;</span>,</span><br><span class="line">               <span class="string">&#x27;2014-08-01 11:00:00-04:00&#x27;</span>],</span><br><span class="line">              dtype=<span class="string">&#x27;datetime64[ns, US/Eastern]&#x27;</span>, freq=<span class="string">&#x27;H&#x27;</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">445</span>]: didx.tz_localize(<span class="literal">None</span>)</span><br><span class="line">Out[<span class="number">445</span>]: </span><br><span class="line">DatetimeIndex([<span class="string">&#x27;2014-08-01 09:00:00&#x27;</span>, <span class="string">&#x27;2014-08-01 10:00:00&#x27;</span>,</span><br><span class="line">               <span class="string">&#x27;2014-08-01 11:00:00&#x27;</span>],</span><br><span class="line">              dtype=<span class="string">&#x27;datetime64[ns]&#x27;</span>, freq=<span class="string">&#x27;H&#x27;</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">446</span>]: didx.tz_convert(<span class="literal">None</span>)</span><br><span class="line">Out[<span class="number">446</span>]: </span><br><span class="line">DatetimeIndex([<span class="string">&#x27;2014-08-01 13:00:00&#x27;</span>, <span class="string">&#x27;2014-08-01 14:00:00&#x27;</span>,</span><br><span class="line">               <span class="string">&#x27;2014-08-01 15:00:00&#x27;</span>],</span><br><span class="line">              dtype=<span class="string">&#x27;datetime64[ns]&#x27;</span>, freq=<span class="string">&#x27;H&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># tz_convert(None) 等同于 tz_convert(&#x27;UTC&#x27;).tz_localize(None)</span></span><br><span class="line">In [<span class="number">447</span>]: didx.tz_convert(<span class="string">&#x27;UTC&#x27;</span>).tz_localize(<span class="literal">None</span>)</span><br><span class="line">Out[<span class="number">447</span>]: </span><br><span class="line">DatetimeIndex([<span class="string">&#x27;2014-08-01 13:00:00&#x27;</span>, <span class="string">&#x27;2014-08-01 14:00:00&#x27;</span>,</span><br><span class="line">               <span class="string">&#x27;2014-08-01 15:00:00&#x27;</span>],</span><br><span class="line">              dtype=<span class="string">&#x27;datetime64[ns]&#x27;</span>, freq=<span class="string">&#x27;H&#x27;</span>)</span><br></pre></td></tr></table></figure><h3 id="本地化导致的混淆时间"><a href="#本地化导致的混淆时间" class="headerlink" title="本地化导致的混淆时间"></a>本地化导致的混淆时间</h3><p><code>tz_localize</code> 不能决定时间戳的 UTC偏移量，因为本地时区的夏时制（DST）会引起一些时间在一天内出现两次的问题（“时钟回调”）。下面的选项是有效的：</p><ul><li><code>raise</code>：默认触发 <code>pytz.AmbiguousTimeError</code></li><li><code>infer</code>：依据时间戳的单一性，尝试推断正确的偏移量</li><li><code>NaT</code>：用 <code>NaT</code> 替换混淆时间</li><li><code>bool</code>：<code>True</code> 代表夏时制（DST）时间，<code>False</code> 代表正常时间。数组型的 <code>bool</code> 值支持一组时间序列。</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">448</span>]: rng_hourly = pd.DatetimeIndex([<span class="string">&#x27;11/06/2011 00:00&#x27;</span>, <span class="string">&#x27;11/06/2011 01:00&#x27;</span>,</span><br><span class="line">   .....:                                <span class="string">&#x27;11/06/2011 01:00&#x27;</span>, <span class="string">&#x27;11/06/2011 02:00&#x27;</span>])</span><br><span class="line">   .....: </span><br></pre></td></tr></table></figure><p>这种操作会引起混淆时间失败错误（ ‘11/06/2011 01:00’）。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">2</span>]: rng_hourly.tz_localize(<span class="string">&#x27;US/Eastern&#x27;</span>)</span><br><span class="line">AmbiguousTimeError: Cannot infer dst time <span class="keyword">from</span> Timestamp(<span class="string">&#x27;2011-11-06 01:00:00&#x27;</span>), <span class="keyword">try</span> using the <span class="string">&#x27;ambiguous&#x27;</span> argument</span><br></pre></td></tr></table></figure><p>用下列指定的关键字控制混淆时间。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">449</span>]: rng_hourly.tz_localize(<span class="string">&#x27;US/Eastern&#x27;</span>, ambiguous=<span class="string">&#x27;infer&#x27;</span>)</span><br><span class="line">Out[<span class="number">449</span>]: </span><br><span class="line">DatetimeIndex([<span class="string">&#x27;2011-11-06 00:00:00-04:00&#x27;</span>, <span class="string">&#x27;2011-11-06 01:00:00-04:00&#x27;</span>,</span><br><span class="line">               <span class="string">&#x27;2011-11-06 01:00:00-05:00&#x27;</span>, <span class="string">&#x27;2011-11-06 02:00:00-05:00&#x27;</span>],</span><br><span class="line">              dtype=<span class="string">&#x27;datetime64[ns, US/Eastern]&#x27;</span>, freq=<span class="literal">None</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">450</span>]: rng_hourly.tz_localize(<span class="string">&#x27;US/Eastern&#x27;</span>, ambiguous=<span class="string">&#x27;NaT&#x27;</span>)</span><br><span class="line">Out[<span class="number">450</span>]: </span><br><span class="line">DatetimeIndex([<span class="string">&#x27;2011-11-06 00:00:00-04:00&#x27;</span>, <span class="string">&#x27;NaT&#x27;</span>, <span class="string">&#x27;NaT&#x27;</span>,</span><br><span class="line">               <span class="string">&#x27;2011-11-06 02:00:00-05:00&#x27;</span>],</span><br><span class="line">              dtype=<span class="string">&#x27;datetime64[ns, US/Eastern]&#x27;</span>, freq=<span class="literal">None</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">451</span>]: rng_hourly.tz_localize(<span class="string">&#x27;US/Eastern&#x27;</span>, ambiguous=[<span class="literal">True</span>, <span class="literal">True</span>, <span class="literal">False</span>, <span class="literal">False</span>])</span><br><span class="line">Out[<span class="number">451</span>]: </span><br><span class="line">DatetimeIndex([<span class="string">&#x27;2011-11-06 00:00:00-04:00&#x27;</span>, <span class="string">&#x27;2011-11-06 01:00:00-04:00&#x27;</span>,</span><br><span class="line">               <span class="string">&#x27;2011-11-06 01:00:00-05:00&#x27;</span>, <span class="string">&#x27;2011-11-06 02:00:00-05:00&#x27;</span>],</span><br><span class="line">              dtype=<span class="string">&#x27;datetime64[ns, US/Eastern]&#x27;</span>, freq=<span class="literal">None</span>)</span><br></pre></td></tr></table></figure><h3 id="本地化时不存在的时间"><a href="#本地化时不存在的时间" class="headerlink" title="本地化时不存在的时间"></a>本地化时不存在的时间</h3><p>夏时制转换会移位本地时间一个小时，这样会创建一个不存在的本地时间（“时钟春季前滚”）。这种本地化操作会导致时间序列出现不存在的时间，此问题可以用 <code>nonexistent</code> 参数解决。下列都是有效的选项：</p><ul><li><code>raise</code>：默认触发 <code>pytz.NonExistentTimeError</code></li><li><code>NaT</code>：用 <code>NaT</code> 替换不存在的时间</li><li><code>shift_forward</code>：把不存在的时间前移至最近的真实时间</li><li><code>shift_backward</code>：把不存在的时间后滚至最近的真实时间</li><li><code>Timedelta</code> 对象：用 <code>timedelta</code> 移位不存在的时间</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">452</span>]: dti = pd.date_range(start=<span class="string">&#x27;2015-03-29 02:30:00&#x27;</span>, periods=<span class="number">3</span>, freq=<span class="string">&#x27;H&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2:30 是不存在的时间</span></span><br></pre></td></tr></table></figure><p>对不存在的时间进行本地化操作默认会触发错误。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">2</span>]: dti.tz_localize(<span class="string">&#x27;Europe/Warsaw&#x27;</span>)</span><br><span class="line">NonExistentTimeError: <span class="number">2015</span>-03-<span class="number">29</span> 02:<span class="number">30</span>:<span class="number">00</span></span><br></pre></td></tr></table></figure><p>把不存在的时间转换为 <code>NaT</code> 或移位时间</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">453</span>]: dti</span><br><span class="line">Out[<span class="number">453</span>]: </span><br><span class="line">DatetimeIndex([<span class="string">&#x27;2015-03-29 02:30:00&#x27;</span>, <span class="string">&#x27;2015-03-29 03:30:00&#x27;</span>,</span><br><span class="line">               <span class="string">&#x27;2015-03-29 04:30:00&#x27;</span>],</span><br><span class="line">              dtype=<span class="string">&#x27;datetime64[ns]&#x27;</span>, freq=<span class="string">&#x27;H&#x27;</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">454</span>]: dti.tz_localize(<span class="string">&#x27;Europe/Warsaw&#x27;</span>, nonexistent=<span class="string">&#x27;shift_forward&#x27;</span>)</span><br><span class="line">Out[<span class="number">454</span>]: </span><br><span class="line">DatetimeIndex([<span class="string">&#x27;2015-03-29 03:00:00+02:00&#x27;</span>, <span class="string">&#x27;2015-03-29 03:30:00+02:00&#x27;</span>,</span><br><span class="line">               <span class="string">&#x27;2015-03-29 04:30:00+02:00&#x27;</span>],</span><br><span class="line">              dtype=<span class="string">&#x27;datetime64[ns, Europe/Warsaw]&#x27;</span>, freq=<span class="string">&#x27;H&#x27;</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">455</span>]: dti.tz_localize(<span class="string">&#x27;Europe/Warsaw&#x27;</span>, nonexistent=<span class="string">&#x27;shift_backward&#x27;</span>)</span><br><span class="line">Out[<span class="number">455</span>]: </span><br><span class="line">DatetimeIndex([<span class="string">&#x27;2015-03-29 01:59:59.999999999+01:00&#x27;</span>,</span><br><span class="line">                         <span class="string">&#x27;2015-03-29 03:30:00+02:00&#x27;</span>,</span><br><span class="line">                         <span class="string">&#x27;2015-03-29 04:30:00+02:00&#x27;</span>],</span><br><span class="line">              dtype=<span class="string">&#x27;datetime64[ns, Europe/Warsaw]&#x27;</span>, freq=<span class="string">&#x27;H&#x27;</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">456</span>]: dti.tz_localize(<span class="string">&#x27;Europe/Warsaw&#x27;</span>, nonexistent=pd.Timedelta(<span class="number">1</span>, unit=<span class="string">&#x27;H&#x27;</span>))</span><br><span class="line">Out[<span class="number">456</span>]: </span><br><span class="line">DatetimeIndex([<span class="string">&#x27;2015-03-29 03:30:00+02:00&#x27;</span>, <span class="string">&#x27;2015-03-29 03:30:00+02:00&#x27;</span>,</span><br><span class="line">               <span class="string">&#x27;2015-03-29 04:30:00+02:00&#x27;</span>],</span><br><span class="line">              dtype=<span class="string">&#x27;datetime64[ns, Europe/Warsaw]&#x27;</span>, freq=<span class="string">&#x27;H&#x27;</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">457</span>]: dti.tz_localize(<span class="string">&#x27;Europe/Warsaw&#x27;</span>, nonexistent=<span class="string">&#x27;NaT&#x27;</span>)</span><br><span class="line">Out[<span class="number">457</span>]: </span><br><span class="line">DatetimeIndex([<span class="string">&#x27;NaT&#x27;</span>, <span class="string">&#x27;2015-03-29 03:30:00+02:00&#x27;</span>,</span><br><span class="line">               <span class="string">&#x27;2015-03-29 04:30:00+02:00&#x27;</span>],</span><br><span class="line">              dtype=<span class="string">&#x27;datetime64[ns, Europe/Warsaw]&#x27;</span>, freq=<span class="string">&#x27;H&#x27;</span>)</span><br></pre></td></tr></table></figure><h3 id="时区序列操作"><a href="#时区序列操作" class="headerlink" title="时区序列操作"></a>时区序列操作</h3><p>无时区 <a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.Series.html#pandas.Series" title="pandas.Series"><code>Series</code></a> 值的数据类型是 datetime64[ns]。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">458</span>]: s_naive = pd.Series(pd.date_range(<span class="string">&#x27;20130101&#x27;</span>, periods=<span class="number">3</span>))</span><br><span class="line"></span><br><span class="line">In [<span class="number">459</span>]: s_naive</span><br><span class="line">Out[<span class="number">459</span>]: </span><br><span class="line"><span class="number">0</span>   <span class="number">2013</span>-01-01</span><br><span class="line"><span class="number">1</span>   <span class="number">2013</span>-01-02</span><br><span class="line"><span class="number">2</span>   <span class="number">2013</span>-01-03</span><br><span class="line">dtype: datetime64[ns]</span><br></pre></td></tr></table></figure><p>有时区 <a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.Series.html#pandas.Series" title="pandas.Series"><code>Series</code></a> 值的数据类型是 datetime64[ns, tz]，<code>tz</code> 指的是时区。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">460</span>]: s_aware = pd.Series(pd.date_range(<span class="string">&#x27;20130101&#x27;</span>, periods=<span class="number">3</span>, tz=<span class="string">&#x27;US/Eastern&#x27;</span>))</span><br><span class="line"></span><br><span class="line">In [<span class="number">461</span>]: s_aware</span><br><span class="line">Out[<span class="number">461</span>]: </span><br><span class="line"><span class="number">0</span>   <span class="number">2013</span>-01-01 <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>-05:<span class="number">00</span></span><br><span class="line"><span class="number">1</span>   <span class="number">2013</span>-01-02 <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>-05:<span class="number">00</span></span><br><span class="line"><span class="number">2</span>   <span class="number">2013</span>-01-03 <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>-05:<span class="number">00</span></span><br><span class="line">dtype: datetime64[ns, US/Eastern]</span><br></pre></td></tr></table></figure><p>这两种 <a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.Series.html#pandas.Series" title="pandas.Series"><code>Series</code></a> 的时区信息都可以用 <code>.dt</code> 访问器操控，参阅 <a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/getting_started/basics.html#basics-dt-accessors">dt 访问器</a>。</p><p>例如，本地化与把无时区时间戳转换为有时区时间戳。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">462</span>]: s_naive.dt.tz_localize(<span class="string">&#x27;UTC&#x27;</span>).dt.tz_convert(<span class="string">&#x27;US/Eastern&#x27;</span>)</span><br><span class="line">Out[<span class="number">462</span>]: </span><br><span class="line"><span class="number">0</span>   <span class="number">2012</span>-<span class="number">12</span>-<span class="number">31</span> <span class="number">19</span>:<span class="number">00</span>:<span class="number">00</span>-05:<span class="number">00</span></span><br><span class="line"><span class="number">1</span>   <span class="number">2013</span>-01-01 <span class="number">19</span>:<span class="number">00</span>:<span class="number">00</span>-05:<span class="number">00</span></span><br><span class="line"><span class="number">2</span>   <span class="number">2013</span>-01-02 <span class="number">19</span>:<span class="number">00</span>:<span class="number">00</span>-05:<span class="number">00</span></span><br><span class="line">dtype: datetime64[ns, US/Eastern]</span><br></pre></td></tr></table></figure><p>时区信息还可以用 <code>astype</code> 操控。这种方法可以本地化并转换无时区时间戳或转换有时区时间戳。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 本地化，并把无时区转换为有时区</span></span><br><span class="line">In [<span class="number">463</span>]: s_naive.astype(<span class="string">&#x27;datetime64[ns, US/Eastern]&#x27;</span>)</span><br><span class="line">Out[<span class="number">463</span>]: </span><br><span class="line"><span class="number">0</span>   <span class="number">2012</span>-<span class="number">12</span>-<span class="number">31</span> <span class="number">19</span>:<span class="number">00</span>:<span class="number">00</span>-05:<span class="number">00</span></span><br><span class="line"><span class="number">1</span>   <span class="number">2013</span>-01-01 <span class="number">19</span>:<span class="number">00</span>:<span class="number">00</span>-05:<span class="number">00</span></span><br><span class="line"><span class="number">2</span>   <span class="number">2013</span>-01-02 <span class="number">19</span>:<span class="number">00</span>:<span class="number">00</span>-05:<span class="number">00</span></span><br><span class="line">dtype: datetime64[ns, US/Eastern]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 把有时区变为无时区</span></span><br><span class="line">In [<span class="number">464</span>]: s_aware.astype(<span class="string">&#x27;datetime64[ns]&#x27;</span>)</span><br><span class="line">Out[<span class="number">464</span>]: </span><br><span class="line"><span class="number">0</span>   <span class="number">2013</span>-01-01 05:<span class="number">00</span>:<span class="number">00</span></span><br><span class="line"><span class="number">1</span>   <span class="number">2013</span>-01-02 05:<span class="number">00</span>:<span class="number">00</span></span><br><span class="line"><span class="number">2</span>   <span class="number">2013</span>-01-03 05:<span class="number">00</span>:<span class="number">00</span></span><br><span class="line">dtype: datetime64[ns]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 转换为新的时区</span></span><br><span class="line">In [<span class="number">465</span>]: s_aware.astype(<span class="string">&#x27;datetime64[ns, CET]&#x27;</span>)</span><br><span class="line">Out[<span class="number">465</span>]: </span><br><span class="line"><span class="number">0</span>   <span class="number">2013</span>-01-01 06:<span class="number">00</span>:<span class="number">00</span>+01:<span class="number">00</span></span><br><span class="line"><span class="number">1</span>   <span class="number">2013</span>-01-02 06:<span class="number">00</span>:<span class="number">00</span>+01:<span class="number">00</span></span><br><span class="line"><span class="number">2</span>   <span class="number">2013</span>-01-03 06:<span class="number">00</span>:<span class="number">00</span>+01:<span class="number">00</span></span><br><span class="line">dtype: datetime64[ns, CET]</span><br></pre></td></tr></table></figure><p>::: tip 注意</p><p>在 <code>Series</code> 上应用 <a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.Series.to_numpy.html#pandas.Series.to_numpy" title="pandas.Series.to_numpy"><code>Series.to_numpy()</code></a>，返回数据的 NumPy 数组。虽然 NumPy 可以<strong>输出</strong>本地时区！但其实它当前并不支持时区，因此，有时区时间戳数据返回的是时间戳对象数组：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">466</span>]: s_naive.to_numpy()</span><br><span class="line">Out[<span class="number">466</span>]: </span><br><span class="line">array([<span class="string">&#x27;2013-01-01T00:00:00.000000000&#x27;</span>, <span class="string">&#x27;2013-01-02T00:00:00.000000000&#x27;</span>,</span><br><span class="line">       <span class="string">&#x27;2013-01-03T00:00:00.000000000&#x27;</span>], dtype=<span class="string">&#x27;datetime64[ns]&#x27;</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">467</span>]: s_aware.to_numpy()</span><br><span class="line">Out[<span class="number">467</span>]: </span><br><span class="line">array([Timestamp(<span class="string">&#x27;2013-01-01 00:00:00-0500&#x27;</span>, tz=<span class="string">&#x27;US/Eastern&#x27;</span>, freq=<span class="string">&#x27;D&#x27;</span>),</span><br><span class="line">       Timestamp(<span class="string">&#x27;2013-01-02 00:00:00-0500&#x27;</span>, tz=<span class="string">&#x27;US/Eastern&#x27;</span>, freq=<span class="string">&#x27;D&#x27;</span>),</span><br><span class="line">       Timestamp(<span class="string">&#x27;2013-01-03 00:00:00-0500&#x27;</span>, tz=<span class="string">&#x27;US/Eastern&#x27;</span>, freq=<span class="string">&#x27;D&#x27;</span>)],</span><br><span class="line">      dtype=<span class="built_in">object</span>)</span><br></pre></td></tr></table></figure><p>通过转换时间戳数组，保留时区信息。例如，转换回 <code>Series</code> 时：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">468</span>]: pd.Series(s_aware.to_numpy())</span><br><span class="line">Out[<span class="number">468</span>]: </span><br><span class="line"><span class="number">0</span>   <span class="number">2013</span>-01-01 <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>-05:<span class="number">00</span></span><br><span class="line"><span class="number">1</span>   <span class="number">2013</span>-01-02 <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>-05:<span class="number">00</span></span><br><span class="line"><span class="number">2</span>   <span class="number">2013</span>-01-03 <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>-05:<span class="number">00</span></span><br><span class="line">dtype: datetime64[ns, US/Eastern]</span><br></pre></td></tr></table></figure><p>如果需要 NumPy <code>datetime64[ns]</code> 数组（带已转为 UTC 的值）而不是对象数组，可以指定 <code>dtype</code> 参数：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">469</span>]: s_aware.to_numpy(dtype=<span class="string">&#x27;datetime64[ns]&#x27;</span>)</span><br><span class="line">Out[<span class="number">469</span>]: </span><br><span class="line">array([<span class="string">&#x27;2013-01-01T05:00:00.000000000&#x27;</span>, <span class="string">&#x27;2013-01-02T05:00:00.000000000&#x27;</span>,</span><br><span class="line">       <span class="string">&#x27;2013-01-03T05:00:00.000000000&#x27;</span>], dtype=<span class="string">&#x27;datetime64[ns]&#x27;</span>)</span><br></pre></td></tr></table></figure><p>:::</p></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者:</span> <span class="post-copyright-info"><a href="https://jackerzz.github.io">Jackerzz-zzk</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接:</span> <span class="post-copyright-info"><a href="https://jackerzz.github.io/posts/data_analysis/pd6.html">https://jackerzz.github.io/posts/data_analysis/pd6.html</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明:</span> <span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://jackerzz.github.io" target="_blank">Jacker-zzk's Blog</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/pandas/">pandas</a></div><div class="post_share"><div class="social-share" data-image="https://cdn.jsdelivr.net/gh/jackerzz/jackerzz.github.io@ersion1.1/images/canva/2753432.jpg" data-sites="wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload='this.media="all"'><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/posts/standardlibrary/threadingQueue.html"><img class="prev-cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/jackerzz/jackerzz.github.io@ersion1.1/images/canva/3560044.jpg" onerror='onerror=null,src="http://static.kongdf.com/bg4.jpg"' alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">一个基于thread和queue的线程池，以任务为队列元素，动态创建线程，重复利用线程，</div></div></a></div><div class="next-post pull-right"><a href="/posts/data_analysis/pd5.html"><img class="next-cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/jackerzz/jackerzz.github.io@ersion1.1/images/canva/3408744.jpg" onerror='onerror=null,src="http://static.kongdf.com/bg4.jpg"' alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">Pandas 数据结构</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/posts/data_analysis/pandas1.html" title="pandas-索引"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/jackerzz/jackerzz.github.io@ersion1.1/images/canva/2579916.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-01-15</div><div class="title">pandas-索引</div></div></a></div><div><a href="/posts/data_analysis/pandas2.html" title="pandas-分块创建"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/jackerzz/jackerzz.github.io@ersion1.1/images/canva/1376766.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-01-15</div><div class="title">pandas-分块创建</div></div></a></div><div><a href="/posts/data_analysis/pd1.html" title="Pandas 概览"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/jackerzz/jackerzz.github.io@ersion1.1/images/canva/1142950.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-09-15</div><div class="title">Pandas 概览</div></div></a></div><div><a href="/posts/data_analysis/pd3.html" title="如何让 Pandas 按数据类型选择列？"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/jackerzz/jackerzz.github.io@ersion1.1/images/canva/3225517.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-09-16</div><div class="title">如何让 Pandas 按数据类型选择列？</div></div></a></div><div><a href="/posts/data_analysis/pd2.html" title="Pandas 基础用法"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/jackerzz/jackerzz.github.io@ersion1.1/images/canva/3244513.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-09-16</div><div class="title">Pandas 基础用法</div></div></a></div><div><a href="/posts/data_analysis/pd5.html" title="Pandas 数据结构"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/jackerzz/jackerzz.github.io@ersion1.1/images/canva/3408744.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-09-19</div><div class="title">Pandas 数据结构</div></div></a></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/jackerzz/jackerzz.github.io@sion1.0/images/avatar/35586448.jpg" onerror='this.onerror=null,this.src="/img/friend_404.gif"' alt="avatar"></div><div class="author-info__name">Jackerzz-zzk</div><div class="author-info__description">有趣的旅行</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">154</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">28</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">26</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/jackerzz"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/jackerzz" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="/miningrest1024@gmail.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">想赢,不一定用实力和本Q,最重要的是信心和胆识,放弃,就一定是输,尝试还有一半机会</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E4%B8%8E%E6%97%A5%E6%9C%9F%E7%94%A8%E6%B3%95"><span class="toc-number">1.</span> <span class="toc-text">时间序列与日期用法</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E7%BA%B5%E8%A7%88"><span class="toc-number">1.1.</span> <span class="toc-text">时间序列纵览</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%97%B6%E9%97%B4%E6%88%B3-vs-%E6%97%B6%E9%97%B4%E6%AE%B5"><span class="toc-number">1.2.</span> <span class="toc-text">时间戳 vs. 时间段</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%BD%AC%E6%8D%A2%E6%97%B6%E9%97%B4%E6%88%B3"><span class="toc-number">1.3.</span> <span class="toc-text">转换时间戳</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8F%90%E4%BE%9B%E6%A0%BC%E5%BC%8F%E5%8F%82%E6%95%B0"><span class="toc-number">1.3.1.</span> <span class="toc-text">提供格式参数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%94%A8%E5%A4%9A%E5%88%97%E7%BB%84%E5%90%88%E6%97%A5%E6%9C%9F%E6%97%B6%E9%97%B4"><span class="toc-number">1.3.2.</span> <span class="toc-text">用多列组合日期时间</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%97%A0%E6%95%88%E6%95%B0%E6%8D%AE"><span class="toc-number">1.3.3.</span> <span class="toc-text">无效数据</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BA%AA%E5%85%83%E6%97%B6%E9%97%B4%E6%88%B3"><span class="toc-number">1.3.4.</span> <span class="toc-text">纪元时间戳</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8A%8A%E6%97%B6%E9%97%B4%E6%88%B3%E8%BD%AC%E6%8D%A2%E4%B8%BA%E7%BA%AA%E5%85%83"><span class="toc-number">1.3.5.</span> <span class="toc-text">把时间戳转换为纪元</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BA%94%E7%94%A8-origin-%E5%8F%82%E6%95%B0"><span class="toc-number">1.3.6.</span> <span class="toc-text">应用 origin 参数</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%94%9F%E6%88%90%E6%97%B6%E9%97%B4%E6%88%B3%E8%8C%83%E5%9B%B4"><span class="toc-number">1.4.</span> <span class="toc-text">生成时间戳范围</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E9%A2%91%E7%8E%87%E8%8C%83%E5%9B%B4"><span class="toc-number">1.4.1.</span> <span class="toc-text">自定义频率范围</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%97%B6%E9%97%B4%E6%88%B3%E7%9A%84%E7%95%8C%E9%99%90"><span class="toc-number">1.5.</span> <span class="toc-text">时间戳的界限</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%B4%A2%E5%BC%95"><span class="toc-number">1.6.</span> <span class="toc-text">索引</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B1%80%E9%83%A8%E5%AD%97%E7%AC%A6%E4%B8%B2%E7%B4%A2%E5%BC%95"><span class="toc-number">1.6.1.</span> <span class="toc-text">局部字符串索引</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%87%E7%89%87-vs-%E7%B2%BE%E5%87%86%E5%8C%B9%E9%85%8D"><span class="toc-number">1.6.2.</span> <span class="toc-text">切片 vs. 精准匹配</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%B2%BE%E7%A1%AE%E7%B4%A2%E5%BC%95"><span class="toc-number">1.6.3.</span> <span class="toc-text">精确索引</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%88%AA%E6%96%AD%E4%B8%8E%E8%8A%B1%E5%BC%8F%E7%B4%A2%E5%BC%95"><span class="toc-number">1.6.4.</span> <span class="toc-text">截断与花式索引</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%97%A5%E6%9C%9F-%E6%97%B6%E9%97%B4%E7%BB%84%E4%BB%B6"><span class="toc-number">1.7.</span> <span class="toc-text">日期&#x2F;时间组件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#DateOffset-%E5%AF%B9%E8%B1%A1"><span class="toc-number">1.8.</span> <span class="toc-text">DateOffset 对象</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%82%E6%95%B0%E5%81%8F%E7%A7%BB"><span class="toc-number">1.8.1.</span> <span class="toc-text">参数偏移</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Series-%E4%B8%8E-DatetimeIndex-%E5%81%8F%E7%A7%BB"><span class="toc-number">1.8.2.</span> <span class="toc-text">Series 与 DatetimeIndex 偏移</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E5%B7%A5%E4%BD%9C%E6%97%A5"><span class="toc-number">1.8.3.</span> <span class="toc-text">自定义工作日</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B7%A5%E4%BD%9C%E6%97%B6%E9%97%B4"><span class="toc-number">1.8.4.</span> <span class="toc-text">工作时间</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E5%B7%A5%E4%BD%9C%E6%97%B6%E9%97%B4"><span class="toc-number">1.8.5.</span> <span class="toc-text">自定义工作时间</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%81%8F%E7%A7%BB%E9%87%8F%E5%88%AB%E5%90%8D"><span class="toc-number">1.8.6.</span> <span class="toc-text">偏移量别名</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%AB%E5%90%8D%E7%BB%84%E5%90%88"><span class="toc-number">1.8.7.</span> <span class="toc-text">别名组合</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%94%9A%E5%AE%9A%E5%81%8F%E7%A7%BB%E9%87%8F"><span class="toc-number">1.8.8.</span> <span class="toc-text">锚定偏移量</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%94%9A%E5%AE%9A%E5%81%8F%E7%A7%BB%E9%87%8F%E7%9A%84%E5%90%AB%E4%B9%89"><span class="toc-number">1.8.9.</span> <span class="toc-text">锚定偏移量的含义</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%81%87%E6%97%A5%E4%B8%8E%E8%8A%82%E6%97%A5%E6%97%A5%E5%8E%86"><span class="toc-number">1.8.10.</span> <span class="toc-text">假日与节日日历</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E5%AE%9E%E4%BE%8B%E6%96%B9%E6%B3%95"><span class="toc-number">1.9.</span> <span class="toc-text">时间序列实例方法</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%A7%BB%E4%BD%8D%E4%B8%8E%E5%BB%B6%E8%BF%9F"><span class="toc-number">1.9.1.</span> <span class="toc-text">移位与延迟</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%A2%91%E7%8E%87%E8%BD%AC%E6%8D%A2"><span class="toc-number">1.9.2.</span> <span class="toc-text">频率转换</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%90%91%E5%89%8D%E4%B8%8E%E5%90%91%E5%90%8E%E5%A1%AB%E5%85%85"><span class="toc-number">1.9.3.</span> <span class="toc-text">向前与向后填充</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BD%AC%E6%8D%A2-Python-%E6%97%A5%E6%9C%9F%E4%B8%8E%E6%97%B6%E9%97%B4"><span class="toc-number">1.9.4.</span> <span class="toc-text">转换 Python 日期与时间</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%87%8D%E9%87%87%E6%A0%B7"><span class="toc-number">1.10.</span> <span class="toc-text">重采样</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86"><span class="toc-number">1.10.1.</span> <span class="toc-text">基础知识</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%8A%E9%87%87%E6%A0%B7"><span class="toc-number">1.10.2.</span> <span class="toc-text">上采样</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%A8%80%E7%96%8F%E9%87%8D%E9%87%87%E6%A0%B7"><span class="toc-number">1.10.3.</span> <span class="toc-text">稀疏重采样</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%81%9A%E5%90%88"><span class="toc-number">1.10.4.</span> <span class="toc-text">聚合</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%86%E7%BB%84%E8%BF%AD%E4%BB%A3"><span class="toc-number">1.10.5.</span> <span class="toc-text">分组迭代</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%97%B6%E9%97%B4%E8%B7%A8%E5%BA%A6%E8%A1%A8%E7%A4%BA"><span class="toc-number">1.11.</span> <span class="toc-text">时间跨度表示</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Period"><span class="toc-number">1.11.1.</span> <span class="toc-text">Period</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#PeriodIndex-%E4%B8%8E-period-range"><span class="toc-number">1.11.2.</span> <span class="toc-text">PeriodIndex 与 period_range</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Period-%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B"><span class="toc-number">1.11.3.</span> <span class="toc-text">Period 数据类型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#PeriodIndex-%E5%B1%80%E9%83%A8%E5%AD%97%E7%AC%A6%E4%B8%B2%E7%B4%A2%E5%BC%95"><span class="toc-number">1.11.4.</span> <span class="toc-text">PeriodIndex 局部字符串索引</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%A2%91%E7%8E%87%E8%BD%AC%E6%8D%A2%E4%B8%8E-PeriodIndex-%E9%87%8D%E9%87%87%E6%A0%B7"><span class="toc-number">1.11.5.</span> <span class="toc-text">频率转换与 PeriodIndex 重采样</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%8D%E5%90%8C%E8%A1%A8%E7%8E%B0%E5%BD%A2%E5%BC%8F%E4%B9%8B%E9%97%B4%E7%9A%84%E8%BD%AC%E6%8D%A2"><span class="toc-number">1.11.6.</span> <span class="toc-text">不同表现形式之间的转换</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%95%8C%E5%A4%96%E8%B7%A8%E5%BA%A6%E8%A1%A8%E7%A4%BA"><span class="toc-number">1.12.</span> <span class="toc-text">界外跨度表示</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%97%B6%E5%8C%BA%E6%8E%A7%E5%88%B6"><span class="toc-number">1.13.</span> <span class="toc-text">时区控制</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%84%E7%90%86%E6%97%B6%E5%8C%BA"><span class="toc-number">1.13.1.</span> <span class="toc-text">处理时区</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9C%AC%E5%9C%B0%E5%8C%96%E5%AF%BC%E8%87%B4%E7%9A%84%E6%B7%B7%E6%B7%86%E6%97%B6%E9%97%B4"><span class="toc-number">1.13.2.</span> <span class="toc-text">本地化导致的混淆时间</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9C%AC%E5%9C%B0%E5%8C%96%E6%97%B6%E4%B8%8D%E5%AD%98%E5%9C%A8%E7%9A%84%E6%97%B6%E9%97%B4"><span class="toc-number">1.13.3.</span> <span class="toc-text">本地化时不存在的时间</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%97%B6%E5%8C%BA%E5%BA%8F%E5%88%97%E6%93%8D%E4%BD%9C"><span class="toc-number">1.13.4.</span> <span class="toc-text">时区序列操作</span></a></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/posts/LLM/cost.html" title="Prompt Engineering co star framework(提示词工程架构)"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/jackerzz/jackerzz.github.io@ersion1.1/images/canva/3560044.jpg" onerror='this.onerror=null,this.src="http://static.kongdf.com/bg4.jpg"' alt="Prompt Engineering co star framework(提示词工程架构)"></a><div class="content"><a class="title" href="/posts/LLM/cost.html" title="Prompt Engineering co star framework(提示词工程架构)">Prompt Engineering co star framework(提示词工程架构)</a><time datetime="2024-07-12T15:01:52.000Z" title="发表于 2024-07-12 23:01:52">2024-07-12</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/devops/Architecture/jira_tools.html" title="基于flask的Jira 操作公共类"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/jackerzz/jackerzz.github.io@ersion1.1/images/canva/615299.jpg" onerror='this.onerror=null,this.src="http://static.kongdf.com/bg4.jpg"' alt="基于flask的Jira 操作公共类"></a><div class="content"><a class="title" href="/posts/devops/Architecture/jira_tools.html" title="基于flask的Jira 操作公共类">基于flask的Jira 操作公共类</a><time datetime="2024-06-10T16:00:00.000Z" title="发表于 2024-06-11 00:00:00">2024-06-11</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/devops/Architecture/flask_api.html" title="flask 使用高并发下引发系统崩溃修复记录"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/jackerzz/jackerzz.github.io@ersion1.1/images/canva/615299.jpg" onerror='this.onerror=null,this.src="http://static.kongdf.com/bg4.jpg"' alt="flask 使用高并发下引发系统崩溃修复记录"></a><div class="content"><a class="title" href="/posts/devops/Architecture/flask_api.html" title="flask 使用高并发下引发系统崩溃修复记录">flask 使用高并发下引发系统崩溃修复记录</a><time datetime="2024-05-26T16:00:00.000Z" title="发表于 2024-05-27 00:00:00">2024-05-27</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/devops/Architecture/react.html" title="React 经典案例"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/jackerzz/jackerzz.github.io@ersion1.1/images/canva/4751187.jpg" onerror='this.onerror=null,this.src="http://static.kongdf.com/bg4.jpg"' alt="React 经典案例"></a><div class="content"><a class="title" href="/posts/devops/Architecture/react.html" title="React 经典案例">React 经典案例</a><time datetime="2024-05-26T16:00:00.000Z" title="发表于 2024-05-27 00:00:00">2024-05-27</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/deepLearning/mysql-sysbench.html" title="mysql-8 压力测试"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/jackerzz/jackerzz.github.io@ersion1.1/images/canva/1142950.jpg" onerror='this.onerror=null,this.src="http://static.kongdf.com/bg4.jpg"' alt="mysql-8 压力测试"></a><div class="content"><a class="title" href="/posts/deepLearning/mysql-sysbench.html" title="mysql-8 压力测试">mysql-8 压力测试</a><time datetime="2024-05-01T16:00:00.000Z" title="发表于 2024-05-02 00:00:00">2024-05-02</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2024 By Jackerzz-zzk</div><div class="framework-info"><span>框架</span> <a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题</span> <a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload/dist/lazyload.iife.min.js"></script><script>function panguFn(){"object"==typeof pangu?pangu.autoSpacingPage():getScript("https://cdn.jsdelivr.net/npm/pangu/dist/browser/pangu.min.js").then(()=>{pangu.autoSpacingPage()})}function panguInit(){panguFn()}document.addEventListener("DOMContentLoaded",panguInit)</script><div class="js-pjax"></div><script id="click-show-text" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/click-show-text.min.js" data-mobile="false" data-text="IU,iu" data-fontsize="15px" data-random="false" async></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>